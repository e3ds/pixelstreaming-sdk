(()=>{var e={267:function(e){var t=void 0;null!=window?.req_data?.E3DSConfigData?.isAdminDebugging&&0!=window?.req_data?.E3DSConfigData?.isAdminDebugging||(console.log=function(){},console.info=function(){},console.error=function(){},console.dir=function(){}),performance.mark("initialScriptsV1.jsFileExecutionStartedAt"),"undefined"==typeof e3ds_controller&&(e3ds_controller={}),void 0===e3ds_controller.callbacks&&(e3ds_controller.callbacks={}),e3ds_controller.main=function(e){e&&(window.e3ds_streaming_token=e.token,window.ss_url=e.socket_url),window.chooseNearestMS()};let n={};window.addEventListener("unhandledrejection",function(e){var t=`Unhandled Rejection: ${e.reason}`;null==window.TelegramWebviewProxy?W&&W(t,-4867366920):console.log(t)}),window.addEventListener("error",e=>{null==e.message&&null==e.filename&&null==e.lineno||([`Message: ${e.message}`,`File: ${e.filename||"(unknown)"}`,`Line: ${e.lineno}:${e.colno}`,e.error?`Stack:\n${e.error.stack}`:""].join("\n"),console.error("Global error caught:",e))},!0);var i=void 0,s=window?.req_data?.userDeviceInfo,r=void 0,o=!1;window.dispatchKickEvent=function(e,t){Q({type:"KickSelctedGuest",playerIDToKick:t})},window.dispatchMicMuteEvent=function(e,t){Q({type:"muteUser",playerId:t})};var a=void 0;function l(){1!=window.isAppPreparationprocessGoingOn?(clearInterval(a),a=setInterval(()=>{1==window.isAppPreparationprocessGoingOn&&clearInterval(a);let e=Math.ceil(new Date(getCurrentDate())-new Date(n.streamerListReceivedAt))/1e3;if(window.hasVideoStreamStarted2)return console.log("Video stream has started, clearing stream monitoring interval."),void clearInterval(a);if(e>180){const e=Math.ceil(new Date(getCurrentDate())-new Date(n.jsFileExecutionStartedAt));console.warn(`Video stream has not started after ${ie(e)}, showing error overlay.`);var t=`video stream failed to start after ${ie(e)}.`;Q({type:"DoFBEntryOfVideoStreamFailed",videoStreamFailed:!0,url:window.location.href,computerName:I?.computerName,videoStreamFailedAt:window.getCurrentDate(),timeRecords:n}),W(t,-4977345042),window.pixelStreaming.disconnect(),N(t),clearInterval(a)}},1e3)):setTimeout(function(){l()},1e3)}function d(e,t){var n;window.pixelStreaming.config.setFlagEnabled("MatchViewportRes",!1),n={"Resolution.Width":e,"Resolution.Height":t},console.log(n),"function"==typeof window?.pixelStreaming?.emitCommand&&window.pixelStreaming.emitCommand(n)}if(window.isAppPreparationprocessGoingOn=!1,function e(t=0){if(R("collectLocationInfo"),"function"==typeof modifyLoadingOverlayMessage&&modifyLoadingOverlayMessage("Collecting Location Info"),void 0!==r)return;const n=new XMLHttpRequest;n.onreadystatechange=function(){return console.log("collectLocationInfo() xmlHttp.responseText: "+n.responseText),422===n.status?(console.log("collectLocationInfo() received 422 status code. Returning default clientInfo object."),void domadeupclientinfo()):429===n.status?(console.log("collectLocationInfo() received 429 status code. Retrying after 2000ms."),null!=i&&clearTimeout(i),void(i=setTimeout(e,2e3,t))):void(""!==n.responseText&&void 0!==n.responseText&&200===n.status?(clearTimeout(i),function(e){if(null==r||"undefined"==r){var t=JSON.parse(e);t.ip_address,function(e){var t;if(null==e.latitude&&(e.latitude="38.88",console.warn("latitude undefined .so setting latitude : "+e.latitude)),null==e.longitude&&(e.longitude="-120.88",console.warn("longitude undefined .so setting longitude : "+e.longitude)),r={ip:e.ip,city:e.city,region:e.region_name,country_name:e.country,latitude:e.latitude,longitude:e.longitude,fullInfo:e},null==window.req_data?window.req_data={clientInfo:r}:window.req_data.clientInfo=r,window.csTimeStamps=window.req_data.timestampData||{},Q({type:"takeClientLocationInfo",clientInfo:r}),t="player",document.getElementById("voipUserName")&&(r&&r.city&&(t=r.city),document.getElementById("voipUserName").value=t+"_"+Math.floor(3333*Math.random())),1==req_data?.E3DSConfigData?.useVOIP){const e=document.getElementById("joinBtn");if(e){let t=setInterval(function(){"function"==typeof window?.submitJoinVoip&&null!=F&&(T&&(window.isHost=!0),e.click(),clearInterval(t))},100)}}}(t)}}(n.responseText)):t<20?(console.log("collectLocationInfo() retrying after 2000ms."),null!=i&&clearTimeout(i),i=setTimeout(e,2e3,t+1)):(console.log("collectLocationInfo() maximum retries exceeded."),domadeupclientinfo()))},n.onerror=function(){console.log("collectLocationInfo()  xmlHttp.onerror ."),domadeupclientinfo()},n.open("GET","https://ipgeolocation.abstractapi.com/v1/?api_key=667cb95019b04ea5beaa7c935dc5ce37",!0),n.send(null)}(),window.isIniFrame=function(){return!(window.location===window.parent.location||window.self===window.top)},window.sendToIframe=function(e){window?.isIniFrame()&&window.top.postMessage(e,"*")},window.addEventListener("message",function(e){console.log("processMessagesFromIframe: "+JSON.stringify(e));try{const t=JSON.parse(e.data);null!=t.Type?(console.log("Command received with Type, parsed and sendnig directly to ue app to process: %s",e.data),"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(t)):"EmulatePlayButtonPressed"==t.cmd?onClickPlay():"freezeResolutionAt"==t.cmd?d(t.x,t.y):"sendToUe4"==t.cmd||"sendDataToUE"==t.cmd?"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(t.value):"iframe-tester"==t.cmd?A=!0:console.log("Command received and parsed, but not matched with any klnown cmd : %s",e.data)}catch(t){console.error("error receiveCommand(): error : "+JSON.stringify(e.data)),console.error(t)}},!1),sendToIframe({type:"readyToReceiveMessageFromIframe"}),"connection"in navigator){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;console.log("Effective network type:",e.effectiveType),console.log("Downlink (Mbps):",e.downlink),console.log("RTT (ms):",e.rtt),console.log("Save data preference:",e.saveData),e.addEventListener("change",()=>{console.log("Network info changed:",{effectiveType:e.effectiveType,downlink:e.downlink,rtt:e.rtt})})}else console.log("Network Information API not supported on this browser.");if(navigator.connection){const e=navigator.connection;("2g"===e.effectiveType||"slow-2g"===e.effectiveType||e.rtt>500||e.downlink<.5)&&(console.warn("Detected slow network conditions."),C("Detected slow network conditions",-4835149834))}var c=!1;window.LogLevel="4",window.ShouldLogIncludeStack=!1,window.loggedInUserData=void 0;var h=window.location.href;const u=new URLSearchParams(new URL(h).search),m=u.get("owner"),p=u.get("appName"),g=u.get("version");m&&(window.owner_params=m,window.req_data.owner=m),p&&(window.appName_params=p,window.req_data.appName=p),g&&(window.version_params=g,window.req_data.version=g),window.getCurrentDate=function(){return new Date};const f=new URLSearchParams(window.location.search);var y=getCurrentDate();n.jsFileExecutionStartedAt=y,n.jsFileExecutionStartedAt_Timestamp=Date.now();const v=performance.getEntriesByType("navigation")[0];v&&performance.mark("request-initiated",{startTime:v.fetchStart}),window.hasVideoStreamStarted2=!1;var w=window.skipReporting,S=f.get("skipReporting_to_telegram");S&&(w=S),console.log("skipReporting_to_telegram:",w),r=void 0;var b=void 0;function C(e,t){e.includes("chrome-extension")||e.includes("Failed to execute 'getStats' on 'RTCPeerConnection': parameter 1 is not of type 'MediaStreamTrack")||1!=w&&"1"!=w&&1!=w&&"true"!=w&&"true"!=w&&"function"==typeof postToTelegramBody&&postToTelegramBody(e,t)}window.performance_mark=function(e){performance.mark(e)};var E=f.get("GuestMeetingId"),T=f.get("hostMeetingId");function x(){console.log("77777777 unMuteAudio4EpicAutoPlay:"),null!=window.pixelStreaming&&(console.log("77777777 window.pixelStreaming._webRtcController.videoPlayer.isVideoReady:"+window.pixelStreaming._webRtcController.videoPlayer.isVideoReady()),window.pixelStreaming._webRtcController.videoPlayer.isVideoReady()&&(pixelStreaming._webRtcController.videoPlayer.videoElement.muted=!1,pixelStreaming._webRtcController.videoPlayer.audioElement.muted=!1,console.log("77777777 pixelStreaming._webRtcController.videoPlayer.videoElement.muted:"+pixelStreaming._webRtcController.videoPlayer.videoElement.muted),console.log("77777777 pixelStreaming._webRtcController.videoPlayer.audioElement.muted:"+pixelStreaming._webRtcController.videoPlayer.audioElement.muted),pixelStreaming._webRtcController.videoPlayer.audioElement.play().then(()=>{console.log("Playback started successfully"),document.removeEventListener("mousedown",x),document.removeEventListener("keydown",x),document.removeEventListener("touchend",x)}).catch(e=>{console.error("Playback failed:",e),W("Playback failed:",-4967422120);var t="NANBYAHSAN";if("string"==typeof e)t=e;else if(e instanceof Error)t=`${e.name}: ${e.message}\n${e.stack||""}`;else try{t=JSON.stringify(e,Object.getOwnPropertyNames(e))}catch(n){t=String(e)}W(t,-4967422120)})))}function M(){var e=document.getElementById("streamingVideo");e?("function"==typeof playVideoAdd&&playVideoAdd(),e.addEventListener("loadstart",()=>{performance.mark("videoLoadStartEventCalledAt"),n.videoLoadStartEventCalledAt=getCurrentDate()}),e.addEventListener("loadedmetadata",function(e){performance.mark("videoLoadedMetaDataEventCalledAt"),n.videoLoadedMetaDataEventCalledAt=getCurrentDate(),window.isStreamReady=!0,document.addEventListener("mousedown",x),document.addEventListener("keydown",x),document.addEventListener("touchend",x),"function"==typeof customizePlayBtn&&customizePlayBtn();const t=document.getElementById("loadingVideoElement");if(t)if(1==window?.req_data?.E3DSConfigData?.ShouldAutoPlay){t.pause(),t.src="",t.remove();const e=document.getElementById("loaderStep1");e&&(e.style.display="none")}else{const e=document.getElementById("skip_video");e&&(window?.req_data?.E3DSConfigData?.LoadingScreenSkipButtonText&&(e.innerHTML=window?.req_data?.E3DSConfigData?.LoadingScreenSkipButtonText),e.style.display="flex",e.onclick=function(){e.style.display="none",t.pause(),t.src="",t.remove();const n=document.getElementById("playButton");n&&n.click();const i=document.getElementById("loaderStep1");i&&(i.style.display="none")})}else{const e=document.getElementById("loaderStep1");e&&(e.style.display="none")}}),e.addEventListener("loadeddata",function(e){performance.mark("videoLoadeddataEventCalledAt"),n.videoLoadeddataEventCalledAt=getCurrentDate()}),e.addEventListener("pause",()=>{console.log("Video is paused"),C("Video is paused window.hasVideoStreamStarted2: "+window.hasVideoStreamStarted2,-4899979845)}),e.addEventListener("ended",()=>{console.log("Video has ended"),C("Video is ended window.hasVideoStreamStarted2: "+window.hasVideoStreamStarted2,-4899979845)}),e.addEventListener("error",e=>{console.error("Video encountered an error",e),C("Video error: "+error,-4899979845)}),e.addEventListener("stalled",()=>{console.warn("Video data is not loading fast enough (stalled)")}),e.addEventListener("waiting",()=>{console.log("Video is buffering / waiting for data")}),e.addEventListener("suspend",()=>{console.log("Video loading has been suspended (likely intentionally)")}),e.addEventListener("playing",e=>{"function"==typeof checkOrientationChange&&checkOrientationChange();const t=document.getElementById("xrBtn"),i=1==window?.req_data?.E3DSConfigData?.disableVrPopup,a=document.getElementById("vrBtn");if(a&&t&&a.style.removeProperty("display"),!i&&"function"==typeof isOculusBrowser&&isOculusBrowser()?"function"==typeof createVrPopUp&&createVrPopUp():"function"!=typeof highlightVrBtn||"function"!=typeof isMobile||isMobile()||highlightVrBtn(),Y(!window.req_data.isSpectator),void 0===window?.req_data?.E3DSConfigData?.shouldDisplayContorlBar||1==window?.req_data?.E3DSConfigData?.shouldDisplayContorlBar){const e=document.getElementById("settings");e&&(e.style.display="flex")}var l=document.getElementById("overlay");if(l){if(null!=window?.req_data?.E3DSConfigData?.showPsControl&&1==window?.req_data?.E3DSConfigData?.showPsControl){let e=document.getElementById("overlayButton");l.style.display="block",e.style.display="block",l.style.display="block",document.getElementById("overlayPSSettings").style.display="block"}if(0!=window.req_data.E3DSConfigData.showWebrtcCtrlMenu&&null!=window.req_data.E3DSConfigData.showWebrtcCtrlMenu){let e=document.getElementById("overlayButton");l.style.display="block",e.style.display="block",l.style.display="block",document.getElementById("overlayWebrtcCtrlMenu").style.display="block"}}null!=window?.req_data?.E3DSConfigData?.consoleCmdsToPassToUnrealApp&&""!=window?.req_data?.E3DSConfigData?.consoleCmdsToPassToUnrealApp&&window.req_data.E3DSConfigData.consoleCmdsToPassToUnrealApp.split(";").forEach(e=>{var t=e.trim();console.log("Executing command:"+t);var n={ConsoleCommand:t};"function"==typeof window?.pixelStreaming?.emitCommand&&window.pixelStreaming.emitCommand(n)}),window.pixelStreaming.webRtcController.videoPlayer.updateVideoStreamSize(),performance.mark("videoPlayingEventCalledAt"),performance.measure("Video Start Took Time:","request-initiated","videoPlayingEventCalledAt"),n.videoPlayingEventCalledAt=getCurrentDate(),console.log("Video is no longer paused"),window.hasVideoStreamStarted2=!0,"function"==typeof statsUpdateExtra&&statsUpdateExtra();var d=`video stream took: ${(getCurrentDate()-n.jsFileExecutionStartedAt)/1e3} sec. Url: ${window.location.href}`;const h=function(){const e=performance.getEntriesByType("mark").sort((e,t)=>e.startTime-t.startTime),t=e.length>0?e[0].startTime:0,n={};return e.forEach(e=>{const i=e.startTime-t,s=i>=1e3?`${(i/1e3).toFixed(2)}s`:`${i.toFixed(2)}ms`;n[s]=e.name}),n}();console.log("Performance Marks:",h),console.log("window.csTimeStamps:",window.csTimeStamps);const u=function(e){const t=Object.entries(e);if(0===t.length)return{};t.sort((e,t)=>new Date(e[1])-new Date(t[1]));const n=new Date(t[0][1]).getTime(),i={};for(let[e,s]of t){const t=new Date(s).getTime()-n;let r;r=t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`,i[r]?Array.isArray(i[r])?i[r].push(e):i[r]=[i[r],e]:i[r]=e}return i}(window.csTimeStamps);console.log("CS Performance Marks:",u);const m=performance.getEntriesByType("measure")[0];console.log("Performance Measures:",m),d+=`\nPerformance Marks: ${JSON.stringify(h,null,2)}`,d+=`\nPerformance Measures: ${JSON.stringify(m,null,2)}`,W(d+=`\nCS Performance Marks: ${JSON.stringify(u,null,2)}`,-4659092962);var p={type:"notifyVideoStarted",uid:window.uid,owner:window.req_data.owner,appName:window.req_data.appName,version:window.req_data.version};console.log("sending message to unreal to notify video started using this.webSocket"),Q(p);var g,f={type:"DoFBEntreyofVideoStreamStartedAt",loggedInUserData:window.loggedInUserData,serverOwner:window.req_data.owner,appName:window.req_data.appName,version:window.req_data.version,clientInfo:r,url:window.location.href,isIniFrame:window.isIniFrame(),href_emulated:window.location.href,userAgent:navigator.userAgent,userDeviceInfo:s,isSpectator:c,ue4ExeInfo:k,acquiringPhase:o};if(null!=window.loggedInUserData){const e=window.loggedInUserData?.email;g=e,["@eagle3dstreaming.com","@eaglepixelstreaming.com"].some(e=>g.endsWith(e))&&(f.e3ds_employee=!0)}if(f.appInfo={owner:window.req_data.owner,appVersion:window.req_data.version,appName:window.req_data.appName},Q(f),G&&clearInterval(G),G=setInterval(function(){Q({type:"updateFBEntryofVideoStreamContinueHeartBeat",serverOwner:window.req_data.owner,webRtcStatsData:window.latestWebRtcStats,timeRecords:n})},3e4),(T||E)&&0==window?.req_data?.E3DSConfigData?.useVOIP){const e=document.getElementById("meetingControlPanel");if(e){e.style.display="flex",e.style.zIndex=9;const t=document.getElementById("meetingListBtn");t&&(t.onclick=function(){const e=document.getElementById("meetingGuestListDiv");e&&("none"==e.style.display?e.style.display="block":e.style.display="none")})}}if(T){var y=document.getElementById("epicMeetingContainer");if(null==y){(y=document.createElement("section")).id="epicMeetingContainer",y.classList.add("settingsContainer"),y.innerHTML='\n            <div class="settingsHeader settings-text">Meeting</div>\n            <div class="setting">\n            <div>Select Guest:</div>\n              <select id="Guest-filter">\n              </select>\n            </div>\n            <div id="meetingButtons">\n            <button style="width: auto" class="overlay-button btn-flat" id="giveControlBtn">Give Control</button>\n            <button style="width: auto" class="overlay-button btn-flat" id="removeControlBtn">Remove Control</button>\n            <button style="width: auto" class="overlay-button btn-flat" id="kickGuestBtn">Kick Guest</button>\n            </div>\n\n          ';const e=document.getElementById("settingsContent");if(e){e.appendChild(y);const t=document.getElementById("giveControlBtn");t&&(t.onclick=function(){const e=document.getElementById("Guest-filter")?.value;e&&window.dispatchToggleControl("on",e)});const n=document.getElementById("removeControlBtn");n&&(n.onclick=function(){const e=document.getElementById("Guest-filter")?.value;e&&window.dispatchToggleControl("off",e)});const i=document.getElementById("kickGuestBtn");i&&(i.onclick=function(){const e=document.getElementById("Guest-filter")?.value;e&&window?.dispatchKickEvent(_,e)})}}}E&&Q({type:"guestJoined",guestName:document.getElementById("voipUserName")?.value}),1==window.req_data.E3DSConfigData.reloadOnSuccessfulStreaming&&setTimeout(function(){X(),console.log("reloadOnSuccessfulStreaming: "+window.req_data.E3DSConfigData.reloadOnSuccessfulStreaming),setTimeout(function(){window.open(window.location.href,"_blank"),setTimeout(function(){!function(){try{if(!window.close)throw new Error("window.close is not supported");if(window.close(),!window.closed)throw new Error("Failed to close the window")}catch(e){console.error("Error:",e),V("Scripts may close only the windows that were opened by them.",{color:"red",timeout:5e3})}}()},2e3)},2e3)},3e3),1==window?.req_data?.E3DSConfigData?.doAutoMovement&&"function"==typeof generateRandomUnrealInput&&generateRandomUnrealInput()})):setTimeout(M,500)}window.onLoadPreExecution=function(){},window.onLoadPostExecution=function(){},window.isStreamReady=!1;var k={},I={};function P(e){let i;try{i=JSON.parse(e)}catch(e){return void console.error("handleMessageReceivedFromSS() JSON parsing error:",e)}!function(e){if("function"==typeof processTypeMsgFromSSForDarkTheme&&processTypeMsgFromSSForDarkTheme(e),"AppPreparationData"==e.datatype){window.isAppPreparationprocessGoingOn=!0,clearInterval(a);var i=e.data.percent;console.log(i);const t=Number.isInteger(i)?i.toString():parseFloat(i.toFixed(2)).toString();e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onReceivingAppPreparationProgress&&e3ds_controller.callbacks.onReceivingAppPreparationProgress(t),window.isAppPreparationprocessGoingOn=!0;var s={type:"stage3_2_AppPreparationProgress",percent:t};sendToIframe(s),null==n.AppPreparationStartedAt&&window.addToTimeRecords("AppPreparationStartedAt",window.getCurrentDate()),R("App Preparation stage:"+t+"%")}else if("AppAcquiringData"==e.datatype){window.isAppPreparationprocessGoingOn=!0,clearInterval(a),i=e.data.percent,console.log(i);const t=Number.isInteger(i)?i.toString():parseFloat(i.toFixed(2)).toString();e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onReceivingAppAcquiringProgress&&e3ds_controller.callbacks.onReceivingAppAcquiringProgress(t),s={type:"stage3_1_AppAcquiringProgress",percent:t},sendToIframe(s),null==n.AppAcquiringStartedAt&&(o=!0,window.addToTimeRecords("AppAcquiringStartedAt",window.getCurrentDate()),W(`App acquiring started at ${window.getCurrentDate()}\n`,-0xe96ac01e27)),R("App Acquiring stage:"+t+"%")}else if("askToSendPasswrod"===e.type){if(1==window.hasVideoStreamStarted2)return void C("skipping  askToSendPasswrod bcz window.hasVideoStreamStarted2: "+window.hasVideoStreamStarted2,-4899979845);!function(e){const t=document.getElementById("playerUI");if(!t)return void console.error('Element with id "playerUI" not found.');const n=document.getElementById("popupForPasswordToStart");if(n)n.style.zIndex=9999,n.style.display="flex";else{const e=document.createElement("div");e.id="popupForPasswordToStart",Object.assign(e.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"9999",padding:"20px",backgroundColor:"#fff",border:"2px solid #333",borderRadius:"10px",boxShadow:"0 0 20px rgba(0,0,0,0.5)",textAlign:"center"});const n=document.createElement("input");n.type="password",n.id="PasswordToVerify",n.placeholder="Enter your password",Object.assign(n.style,{padding:"10px",marginBottom:"15px",fontSize:"16px"});const i=document.createElement("button");i.textContent="Submit",i.id="btnPasswordSubmit",i.style.marginRight="10px",e.appendChild(n),e.appendChild(document.createElement("br")),e.appendChild(i),t.appendChild(e)}document.getElementById("btnPasswordSubmit").onclick=()=>{e(document.getElementById("PasswordToVerify").value),document.getElementById("popupForPasswordToStart").remove()}}(B)}else if("doApprequest"===e.type){Object.assign(window.req_data,e.req_data),window.applyE3DSConfigOnFlag(),window.uid=window.req_data.uid;var r={type:"listStreamers"};r.uid=window.uid,r.isSpectator=window.req_data?.isSpectator,r.req_data=window.req_data,r.hasVideoStreamStarted=window.hasVideoStreamStarted2,Q(r)}else if("config"===e.type)window.addToTimeRecords("onConfigCalledAt",window.getCurrentDate()),null==k&&null!=e.ue4ExeInfo&&(k=e.ue4ExeInfo,time_ue4ExeInfoArrived=new Date,window.addToTimeRecords("time_ue4ExeInfoArrivedAt",window.getCurrentDate()));else if("streamerList"===e.type)void 0!==e.ids&&e.ids?.length>0&&(window.addToTimeRecords("streamerListReceivedAt",window.getCurrentDate()),l());else if("elAssigned"===e.type)I={...I,...e.elInfo};else if("playerCount"===e.type);else if("sendToIframe"===e.type)sendToIframe(e.data);else if("updateTimestamp"===e.type)console.log("Received timestamp data from SS:",e.timestampData),window.csTimeStamps={...window.csTimeStamps,...e.timestampData},console.log("Updated window.csTimeStamps:",window.csTimeStamps);else if("offer"===e.type)window.addToTimeRecords("playerReceivedOfferOfAppAt",window.getCurrentDate()),console.log(" <- SS arvind offer --\x3e  msg.sdp: %o",e.sdp);else if("answer"===e.type)window.addToTimeRecords("playerReceivedAnswerOfAppAt",window.getCurrentDate()),console.log(" answer : "+JSON.stringify(e));else if("gettings"===e.type)console.log("message type:gettings:  "+JSON.stringify(e)),console.log("message type:gettings msg.data:  "+JSON.stringify(e.data));else if("guestList"==e.type){const t=document.getElementById("Guest-filter");if(t){t.innerHTML="";for(let n of e.guests){let e=document.createElement("option");e.text=e.value=n?.id,t.add(e)}}if(0==req_data?.E3DSConfigData?.useVOIP){const t=document.getElementById("meetingGuestList");e.guests.forEach(e=>{if(!document.getElementById(`guestRow-${e.id}`)&&t){let n=document.createElement("li");n.id=`guestRow-${e.id}`;let i="";e.id==F?(i=`<button id="editUsernameFor-${e.id}">\n\t\t\t\t\t<svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 112.04" width="24" height="24">\n\t\t\t\t\t\t<defs>\n\t\t\t\t\t\t<style>.cls-1{fill:#ffffff;fill-rule:evenodd;}</style>\n\t\t\t\t\t\t</defs>\n\t\t\t\t\t\t<title>Edit Username</title>\n\t\t\t\t\t\t<path class="cls-1" d="M109.28,19.61l12.21,9.88a3.77,3.77,0,0,1,.56,5.29l-5.46,6.75L98.53,26.93,104,20.17a3.79,3.79,0,0,1,5.29-.56ZM21.07,30.81a3.18,3.18,0,0,1,0-6.36H74.12a3.18,3.18,0,0,1,0,6.36ZM9.49,0H85.71A9.53,9.53,0,0,1,95.2,9.49v5.63l-4.48,5.53a9.81,9.81,0,0,0-1.18,1.85c-.24.19-.48.4-.71.62V9.49a3.14,3.14,0,0,0-3.12-3.13H9.49A3.14,3.14,0,0,0,6.36,9.49v93.06a3.16,3.16,0,0,0,.92,2.21,3.11,3.11,0,0,0,2.21.92H85.71a3.12,3.12,0,0,0,3.12-3.13V88.2l1.91-.81a10,10,0,0,0,4.34-3.13l.12-.14v18.43A9.54,9.54,0,0,1,85.71,112H9.49A9.51,9.51,0,0,1,0,102.55V9.49A9.53,9.53,0,0,1,9.49,0ZM21.07,87.6a3.19,3.19,0,0,1,0-6.37H56.19a37.1,37.1,0,0,0-.3,6.37Zm0-18.93a3.19,3.19,0,0,1,0-6.37H59.22l0,.27-1.05,6.1Zm0-18.93a3.18,3.18,0,0,1,0-6.36H72.44l-5.11,6.36ZM87.25,78,74.43,83.47c-9.35,3.47-8.93,5.43-8-3.85L69.24,63.4h0l0,0,26.56-33,18,14.6L87.27,78ZM72.31,65.89l11.86,9.59-8.42,3.6c-6.6,2.83-6.42,4.23-5.27-2.53l1.83-10.66Z"></path>\n\t\t\t\t\t</svg>\n\n\t\t\t\t\t</button>`,n.innerHTML=`<span>${e.guestName}</span> <span> (You)</span>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t${i}\n\t\t\t\t\t\t</div>`):(T&&(i+=`<button title="Give Control" id="toggleControlForGuest-${e.id}"> <img src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/controllOff.svg"/> </button> \n\t\t\t\t    <button title="Kick Guest" id="kickGuest-${e.id}"> <img src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/kick.svg"/> </button>`),n.innerHTML=`<span>${e.guestName}</span> \n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t${i}\n\t\t\t\t\t\t</div>`),n.className="list-group-item",t.appendChild(n);const s=document.getElementById(`editUsernameFor-${e.id}`);s&&(s.onclick=function(){const e=document.getElementById("joinBtn");e&&(e.innerText="Update Username");const t=document.getElementById("popupForVoipUsername");if(t){t.style.display="flex";const e=document.getElementById("voipUserName");e&&(e.select(),document.getElementById("popupForVoipUsernameForm").onsubmit=function(e){e.preventDefault();const t=document.getElementById("voipUserName").value;Q({type:"updateGuestName",guestPlayerId:F,guestName:t}),document.getElementById("popupForVoipUsername").style.display="none"})}});const r=document.getElementById(`toggleControlForGuest-${e.id}`);r&&(r.onclick=function(){const t=r.getElementsByTagName("img")[0];let n="";t.src.includes("controllOff")?(n="on",t.src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/controllOn.svg",r.title="Remove Control"):(n="off",t.src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/controllOff.svg",r.title="Give Control"),window.dispatchToggleControl(n,e.id)});const o=document.getElementById(`kickGuest-${e.id}`);o&&(o.onclick=function(){window?.dispatchKickEvent(_,e.id)})}}),T&&j()}}else if("addInExistingGuestList"===e.type)(h=document.getElementById("Guest-filter"))&&e.guestList.forEach(function(e){var t=document.createElement("option");t.text=t.value=e,h.add(t,h.length-1)});else if("setPlayerId"===e.type)F=e.playerId,T&&j();else if("guestJoined"===e.type||"GuestJoined"===e.type){if(0==req_data?.E3DSConfigData?.useVOIP){const t=document.getElementById("meetingGuestList");if(t){let n=document.createElement("li");n.id=`guestRow-${e.guestPlayerId}`,n.className="list-group-item",n.innerHTML=`<span>${null!=e.guestName?e.guestName:e.guestPlayerId}</span> \n\t\t\t\t<div>\n\t\t\t\t<button title="Give Control" id="toggleControlForGuest-${e.guestPlayerId}"> <img src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/controllOff.svg"/> </button> \n\t\t\t\t<button title="Kick Guest" id="kickGuest-${e.guestPlayerId}"> <img src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/kick.svg"/> </button> \n\t\t\t\t</div>`,t.appendChild(n);const i=document.getElementById(`toggleControlForGuest-${e.guestPlayerId}`);i&&(i.onclick=function(){const t=i.getElementsByTagName("img")[0];let n="";t.src.includes("controllOff")?(n="on",t.src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/controllOn.svg",i.title="Remove Control"):(n="off",t.src="https://d35e1ftufisrhj.cloudfront.net/v1/assets/images/UIimages/controllOff.svg",i.title="Give Control"),window.dispatchToggleControl(n,e.guestPlayerId)});const s=document.getElementById(`kickGuest-${e.guestPlayerId}`);s&&(s.onclick=function(){window?.dispatchKickEvent(_,e.guestPlayerId)})}}if(h=document.getElementById("Guest-filter")){var d=document.createElement("option");d.text=d.value=e.guestPlayerId,h.add(d,h.length-1)}}else if("GuestLeft"===e.type){const t=document.getElementById(`guestRow-${e.guestPlayerId}`);var h;if(t&&t.remove(),h=document.getElementById("Guest-filter"))for(var u=0;u<h.length;u++)h.options[u].value==e.guestPlayerId&&h.remove(u)}else if("updateGuestName"==e.type){const t=document.getElementById(`guestRow-${e.guestPlayerId}`);t&&(t.getElementsByTagName("span")[0].innerText=e.guestName)}else if("takeChatGptAnswer"===e.type){let t={ChatGptQuestion:e.ChatGptQuestion,ChatGptAnswer:e.ChatGptAnswer};"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(t)}else if("takeGameCustomizationData"===e.type)"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(e);else if("ConfigUpdateOnClientSide"===e.type)window.location.href=window.location.href;else if("takeUploadUrl"===e.type)!function(e,n,i,s){console.log("putFile() selectedFileName"+i);var r=t;let o={cmd:"onUserSideFileSelected",filename:i};"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(o),console.log(o);let a=new XMLHttpRequest;a.open("PUT",e,!0),a.setRequestHeader("Content-type",n),a.onload=function(){let n=a.responseText;if(4==a.readyState&&"200"==a.status){console.log("Successfully uploaded",n);let t={cmd:"onUserSideFileProcessingFinished",filename:i};"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(t),console.log(t),console.log("file:",r),console.log("DIRECT URL",e.split("?")[0]);var o={type:"askElToDownloadFileTO",url:e.split("?")[0],downloadPath:s+i};console.log(" ws.send(): "+JSON.stringify(o)),Q(o)}else console.error(n);t=void 0},a.onprogress=function(e){console.log("Progress",e);let t={cmd:"onUserSideProcessingProgressUpdate",filename:i,progress:e};"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(t),console.log(t)},a.send(r)}(e.uploadURL,e.input.content_type,e.input.file_name,e.input.pathToSaveFile);else if("handleshuttingDownVM"===e.type)diderrorhappend=!0,H(m="shutting down this VM .So redirecting you in 3 sec to re-establish connection",5e3);else if("handleElDisconnected"===e.type){diderrorhappend=!0;var m="EL crashed: "+e.errormsg;m+=" .So redirecting you in 3 sec to re-establish connection",console.log(m),H(m,5e3,!0,-972942690,"handleElDisconnected")}else if("handleStreamerDisconnected"===e.type)H(m="Streamer Disconnected.So redirecting you in 3 sec to re-establish connection",3e3,!0,-828953428,"StreamerDisconnected");else if("reload"===e.type)location.reload();else if("ConfigUpdateOnClientSide"===e.type)window.location.href=window.location.href;else if("redirectTo"===e.type)console.log("222222 <- SS: msg.data.url: "+e.url),window.location.replace(e.url);else if("jsonMessageForUE4"===e.type)console.log("jsonMessageForUE4: "+JSON.stringify(e.jsonObj)),"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(e.jsonObj);else if("ShowThisHtmlPage"===e.type)N(e.htmlPage),shouldTryToRediecrtToMMonDisconnect=!1,failedAttmept=!0,ws&&ws.close(),self.location=e.htmlPage;else if("setGuestId"===e.type)document.getElementById("GuestTitle")&&(document.getElementById("GuestTitle").innerHTML=e.guestId);else if("sendtoUnrealinAppPurchaseResult"===e.type){console.log("222222 <- SS: sendtoUnrealinAppPurchaseResult msg.data.info: "+e.data.purchasResult);let t={purchasResult:e.data.purchasResult};"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(t)}else if("ShowE3ds_alert"===e.type){console.log("222222 <- SS: ShowE3ds_alert msg.data.info: "+e.data.info);var p={};null!=e.data.color&&(p.color=e.data.color),null!=e.data.timeout&&(p.timeout=e.data.timeout),V(e.data.info,p)}else if("includeInTimeRecords"===e.type){var g=e.timeRecords_ssSide;for(const e in g)if(n.hasOwnProperty(e)){var f=!0;if(Object.keys(n).forEach(t=>{t.startsWith(e)&&(console.log(t),n[t]===g[e])&&(f=!1)}),f){let t=1,i=e+t;for(;n.hasOwnProperty(i);)t++,i=e+t;window.addToTimeRecords(i,g[e])}}else window.addToTimeRecords(e,g[e]);console.log(n)}else if("UE5Editorlunched"===e.type){console.log(JSON.stringify(e));var y="http://"+e.url+":"+e.port;console.log("UE5Editorlunched url "+y),location.assign(y)}else if("UE4LogFromEL"===e.type)console.info(e.data.logLine);else if("SessionExpired"===e.type)e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onSessionExpired&&e3ds_controller.callbacks.onSessionExpired(),N(`Session lasted for ${ie(e?.duration)}. Session expired.`);else if("showPageWIthMsg"===e.type)console.log("showPageWIthMsg: ",e),e.msg||e.data.info?U(e.msg):console.error("showPageWIthMsg: msg is not defined in the message from unreal.");else if("ShowInfoToInjectStreamFromEditor"===e.type){var v="ws://"+cirrusServer.domain+":"+cirrusServer.ue4StreamerToSS;console.log("injectStreamFromEditorInfo: "+v),obj=document.getElementById("loaderStep1"),obj&&(obj.style.display="none"),document.getElementById("Info4injectStreamFromEditor").value=v;var w=document.getElementById("popupForinjectStreamFromEditorInfo");w&&(w.style.display="flex")}else if("ShowInfo"===e.type){if(console.log("222222 <- SS: msg.data.info: "+e.data.info),R(e.data.info),p={},null!=e.data.color&&(p.color=e.data.color),null!=e.data.timeout&&(p.timeout=e.data.timeout),e.data.info.startsWith("showPageWIthMsg:"))return void U(e.data.info.replace("showPageWIthMsg:",""));if(e.data.info.startsWith("EL Error:")){let t=e.data.info.replace("EL Error:","");console.error(JSON.stringify(e.data)),console.error(t),t.startsWith("Upload system having critical Isssue.")&&W(t,-977631986),t.startsWith("No exe found in any subdirectories")&&U("Invalid App. No exe found in any subdirectories "),V(t,p)}}else if("TakeuserDeviceInfo"===e.type)console.log(`elInfo : ${JSON.stringify(e.elInfo)}`),console.log(" 1111111111111 useExtendedTyping > "+useExtendedTyping);else if("OnLocalFileUploadingFinished"===e.type){var S=e.data.objFromUE4;if(null!=S)switch(S.cmd){case"downloadLocalFileOnUserDevice":window.open(e.data.Location,"_blank");break;case"getDownloadUrlOfLocalFile":let t={type:"takeDownloadUrlOfLocalFile",downloadURL:e.data.Location,localFile:S.fileToDownload};"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(t)}}else if("OnFinishingOfClientFileDownladOnEL"===e.type){let t={cmd:"onUploadedFileAvailable",filename:e.data.filename};"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(t),console.log(t)}else if("ue4Version"===e.type)currentAppsUE4Version=e.currentAppsUE4Version,A&&sendToIframe({type:"ueVersion",value:currentAppsUE4Version?.versionString});else if("PsPluginPixelStreamingDireExist"===e.type)console.log("****PsPluginPixelStreamingDireExist : "+e.PsPluginPixelStreamingDireExist),PsPluginPixelStreamingDireExist=e.PsPluginPixelStreamingDireExist;else if("PsPluginEntryInManifestFile"===e.type)console.log("****PsPluginEntryInManifestFile : "+e.PsPluginEntryInManifestFile),PsPluginEntryInManifestFile=e.PsPluginEntryInManifestFile;else if("ue4ExeInfoMsg"===e.type)console.log("ue4ExeInfoMsg: ",e),console.log("ue4ExeInfoMsg.ue4ExeInfo: ",e.ue4ExeInfo),k=e.ue4ExeInfo,currentAppsUE4Version=k.versionString,time_ue4ExeInfoArrived=new Date,console.log("ue4AppExe path:"+k.ue4AppExe);else if("iceCandidate"===e.type);else if("DisableControlFromOthers"===e.type)c=!0,Y(!1),"function"==typeof e3ds_alert&&e3ds_alert("Your control has been removed by the host",{timeout:3e3});else if("AllAssetsUrls"===e.type)updateAllAssetsUrls(e);else if("AllVideoAssetsUrls"===e.type)updateAllAssetsUrls(e);else if("All2dAssetsUrls"===e.type)updateAll2dAssetsUrls(e);else if("sendplayerType"===e.type)null!=e.playerId&&(F=e.playerId,window.playerId=e.playerId,document.getElementById("popupForVoipUsername")&&E)&&(1==req_data?.E3DSConfigData?.useVOIP?(document.getElementById("popupForVoipUsername").style.display="flex",document.getElementById("voipUserName").select()):(document.getElementById("joinBtn").innerText="Join Meeting",document.getElementById("popupForVoipUsername").style.display="flex",document.getElementById("voipUserName").select(),document.getElementById("popupForVoipUsernameForm").onsubmit=function(e){e.preventDefault();const t=document.getElementById("voipUserName").value;Q({type:"updateGuestName",guestPlayerId:F,guestName:t}),document.getElementById("popupForVoipUsername").style.display="none"}));else if("GiveControlToThisGuest"===e.type)c=!1,Y(!0),"function"==typeof e3ds_alert&&e3ds_alert("You have been given control by the host",{timeout:3e3});else if("muteUser"===e.type){const e=document.getElementById("button-microphone");e&&e.click()}else console.warn(`invalid SS message type: ${e}`)}(i)}function R(e){const t=document.getElementById("messageOverlayInner"),n=document.getElementById("infoOverlay");t&&n&&(t.innerText=e,n.classList.contains("textDisplayState")||n.classList.add("textDisplayState"),n.classList.contains("hiddenState")&&n.classList.remove("hiddenState"))}async function L(){if(null==window.req_data?.E3DSConfigData)if(null!=window.e3ds_streaming_token){let e={type:"verifyToken"};e.streamingToken=window.e3ds_streaming_token,e.token=window.e3ds_streaming_token,e.serverOwner=clientUserName,Q(e)}else console.log("waiting for window.e3ds_streaming_token"),setTimeout(L,1e3);else{if(null!=window?.req_data?.E3DSConfigData?.urlExpiretime&&new Date>new Date(window?.req_data?.E3DSConfigData?.urlExpiretime))return void U("Url Expired");let e={type:"listStreamers"};e.uid=window.uid,e.isSpectator=window.req_data?.isSpectator,e.req_data=window.req_data,e.hasVideoStreamStarted=window.hasVideoStreamStarted2,null!=window?.req_data?.E3DSConfigData?.mustLogin&&1==window?.req_data?.E3DSConfigData?.mustLogin?await window.isLoggedIn()?Q(e):window.location.href=ne:Q(e)}}window.handleMessageReceivedFromSS=function(e){},window.handleDataChannelOpen=function(){pixelStreaming?._webRtcController?.videoPlayer?.updateVideoStreamSize(),e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onDataChannelOpen&&e3ds_controller.callbacks.onDataChannelOpen()},window.handleDataChannelClose=function(){e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onDataChannelClose&&e3ds_controller.callbacks.onDataChannelClose()};var D=!1,O=0;window.handleWebSocketEvent=async function(e,t){switch(e){case"open":performance.mark("ss_WebSocketConnectionEstablishedAt"),n.ss_WebSocketConnectionEstablishedAt=getCurrentDate(),D=!0,L();break;case"close":const e=document.getElementById("meetingGuestList");e&&(e.innerHTML=""),""!=t&&null!=t&&U(t);break;case"error":if(O++,!D&&10===O){const e="Websocket connection to signalling server failed.";W(e,-4977345042),window.clearE3dsAlert(),U(e)}break;case"message":P(t)}},window.chooseNearestMS=async function(){if(window.pixelStreaming){window.pixelStreaming._webRtcController.close(),clearInterval(a),clearInterval($),window.hasVideoStreamStarted2=!1;const e=document.getElementById("videoElementParent");e&&e.remove();const t=document.getElementById("uiFeatures");t&&t.remove(),window.req_data={},window.callBack_document_body_onload()}null==window.ss_url&&null!=window.ss_list&&(window.ss_list?.length>1?(initialInfo&&initialInfo.locationData?(r=initialInfo.locationData,console.log("Using locationData from getInitialInfo API:",r)):(r=await geolocationPromise,console.log("Using geolocation from Abstract API:",r)),window.ss_url="wss://"+function(e,t,n){if(!Array.isArray(e)||!e.length)return console.error("Invalid server list: must be a non-empty array"),null;if(isNaN(t)||isNaN(n))return console.error("Invalid user coordinates: must be numbers"),null;let i=null,s=1/0;const r=t*Math.PI/180,o=n*Math.PI/180;for(const t of e){const e=t.latitude*Math.PI/180,n=e-r,a=t.longitude*Math.PI/180-o,l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(r)*Math.cos(e)*Math.sin(a/2)*Math.sin(a/2),d=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371;d<s&&(s=d,i=t)}return i}(window.ss_list,r.latitude,r.longitude)):window.ss_url="wss://"+window.ss_list[0].ss_url),M()},window.chooseNearestMS();var F,A=!1;function U(e){N(e)}function N(e){if(window.pixelStreaming?.webRtcController&&(window.pixelStreaming.webRtcController.enableAutoReconnect=!1,window.pixelStreaming?.webRtcController?.closeSignalingServer(e,!1)),"undefined"!=typeof statsUpdateInterval&&clearInterval(statsUpdateInterval),void 0!==$&&clearInterval($),e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onError&&e3ds_controller.callbacks.onError(e),"undefined"!=typeof preventErrorRedirect&&preventErrorRedirect)return;const t=`\n    <!DOCTYPE html>\n    <html>\n\n    <head>\n      <title>${e}</title>\n      <style>\n        html,\n        body {\n            margin: 0;\n            padding: 0;\n            height: 100vh;\n            width: 100vw;\n            background-color: #000000;\n            color: #fff;\n            background: #000000 url(https://d35e1ftufisrhj.cloudfront.net/v1/assets/BlackTheme/images/bg1.jpg) no-repeat center center;\n            background-size: cover;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;\n        }\n\n        .message-box {\n            background: transparent;\n            padding: 40px 60px;\n            border-radius: 20px;\n            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);\n            text-align: center;\n            font-size: 2em;\n            color: white;\n            animation: fadeIn 0.8s ease-in-out;\n        }\n\n        @keyframes fadeIn {\n            from {\n                opacity: 0;\n                transform: scale(0.95);\n            }\n\n            to {\n                opacity: 1;\n                transform: scale(1);\n            }\n        }\n      </style>\n    </head>\n\n    <body>\n      <div class="message-box">${e}</div>\n    </body>\n\n  </html>\n  `,n=window.open("","_self");n.document.open(),n.document.write(t),n.document.close()}function B(e){console.log("Submitted password:",e),Q({type:"verifyPassword",password:e})}function V(e,t){"function"==typeof e3ds_alert?e3ds_alert(e,t):R(e)}function W(e,t){if(!e.includes("chrome-extension")&&!e.includes("Failed to execute 'getStats' on 'RTCPeerConnection': parameter 1 is not of type 'MediaStreamTrack")){if(e+=`\n Url: ${window.location.href}`,e+="\n uid: "+window?.uid,e+="\n computerName: "+I?.computerName,"function"==typeof isIniFrame&&(e+="\n isInIframe: "+window?.isIniFrame()),k&&(e+="\n ue4ExeInfo: "+JSON.stringify(k,null,2)),r&&(e+="\n clientInfo: "+JSON.stringify(r,null,2)),b&&(e+="\n nearestServer: "+JSON.stringify(b,null,2)),window.loggedInUserData&&(e+="\n loggedInUserData: "+JSON.stringify(window.loggedInUserData,null,2)),n){const t=function(e){const t=Object.fromEntries(Object.entries(e).map(([e,t])=>[e,new Date(t)])),n=Math.min(...Object.values(t).map(e=>e.getTime())),i=Object.entries(t).map(([e,t])=>[e,t.getTime()-n]).sort((e,t)=>e[1]-t[1]),s={};return i.forEach(([e,t])=>{const n=t>=1e3?`${(t/1e3).toFixed(2)}s`:`${t.toFixed(2)}ms`;s[n]=e}),console.log(JSON.stringify(s,null,2)),s}(n);e+="\n timeRecords: "+JSON.stringify(t,null,2)}C(e,t)}}function H(e,t,n=!0,i=void 0,s=void 0){console.trace(),window.location.href,W(e,i),V(e,{color:"Red"}),setTimeout(function(){location.reload()},t)}function j(){const e=document.getElementById("voipUserName")?.value;Q({type:"updateHostName",playerId:F,name:e})}window.addToTimeRecords=function(e,t){performance.mark(e),n&&(n[e]=t)},window.dispatchToggleControl=function(e,t){Q("on"===e?{type:"GiveControlToThisGuest",GiveControlToThisGuestID:t}:{type:"DisableControlForThisGuest",guestId:t})},window.styleAdditional="cursor: default;";var z="0"!=window?.req_data?.E3DSConfigData?.showbrowserMouse,q=window?.req_data?.E3DSConfigData?.mouseCursorPointerStyle?window?.req_data?.E3DSConfigData?.mouseCursorPointerStyle:"cursor:default";function K(){var e="";1==z?(console.log(" 1111111111111 showbrowserMouse === 1 > "),console.log(" 1111111111111 extractValueFromUrl(showbrowserMouse):"+z),e=""==e||e.includes("cursor:")?q:e+" "+q):e="cursor:none",window.styleAdditional=e,console.log(" 1111111111111 window.styleAdditional > "+window.styleAdditional),"function"==typeof window?.pixelStreaming?._webRtcController?.videoPlayer?.resizePlayerStyleToFillParentElement&&window.pixelStreaming._webRtcController.videoPlayer.resizePlayerStyleToFillParentElement()}function Q(e){void 0!==window?.pixelStreaming?.webSocketController?.webSocket&&window.pixelStreaming.webSocketController.webSocket.readyState===WebSocket.OPEN?window.pixelStreaming.webSocketController.webSocket.send(e):void 0!==window?.webSocketToSS&&window.webSocketToSS.readyState===WebSocket.OPEN?window.webSocketToSS.send(e):void 0!==window?.pixelStreaming?.signallingProtocol?.transport?.webSocket&&window.pixelStreaming.signallingProtocol.transport.webSocket.readyState===WebSocket.OPEN?window.pixelStreaming.signallingProtocol.sendMessage(e):(console.warn("WebSocket not ready. Retrying in 0.5s. Message: "+JSON.stringify(e)),setTimeout(()=>Q(e),500))}let G,$;function X(){$&&clearInterval($),G&&clearInterval(G),"undefined"!=typeof statsUpdateInterval&&clearInterval(statsUpdateInterval),window.pixelStreaming._webRtcController.enableAutoReconnect=!1,window.pixelStreaming.signallingProtocol.disconnect()}function J(e,t){if("number"!=typeof t||isNaN(t))return{};if(window.minMaxAvgData[e]){const n=window.minMaxAvgData[e];n.min=Math.min(n.min,t),n.max=Math.max(n.max,t),n.sum+=t,n.count++,n.avg=n.sum/n.count}else window.minMaxAvgData[e]={min:t,max:t,sum:t,count:1,avg:t};const{min:n,max:i,avg:s}=window.minMaxAvgData[e];return{min:n,max:i,avg:s}}function Z(e,t,n){var i=e;return n.forEach(({mapKey:e,jsonKey:n,fixedValue:s,customLogic:r})=>{if(!i.has(e))return void console.warn(`Map does not contain key: ${e}`);const o=i.get(e);if(void 0!==s)o._value=s,o._hint=`Set by fixedValue: ${s}`;else if(r&&n in t){const e=t[n];o._value=r(e),o._hint=`Set by customLogic on json["${n}"] = ${e}`}else if(n in t){const e=t[n],i="boolean"==typeof o._value?"1"===e||"true"===e||!0===e:"number"==typeof o._value?Number(e):e;o._value=i,o._hint=`Set from json["${n}"] = ${e}`}else console.warn(`JSON does not contain key: ${n} for mapKey: ${e}`);i.set(e,o)}),i}function Y(e){window?.pixelStreaming?._webRtcController?.setKeyboardInputEnabled(e),window?.pixelStreaming?._webRtcController?.setMouseInputEnabled(e),window?.pixelStreaming?._webRtcController?.setTouchInputEnabled(e),window?.pixelStreaming?._webRtcController?.setGamePadInputEnabled(e)}window.HandleResponseFromUnreal=function(e){console.log("5555555555555 ahsanHandleResponseFunction(msg_raw) :"+e),e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onResponseFromUnreal&&e3ds_controller.callbacks.onResponseFromUnreal(e);var n=JSON.parse(e);if(null!=n)switch(console.log("5555555555555 ahsanHandleResponseFunction obj.cmd :"+n.cmd),n.cmd){case"misctasks":"function"==window?.pixelStreaming?._webRtcController?.videoPlayer?.resizePlayerStyle?window.pixelStreaming._webRtcController.videoPlayer.resizePlayerStyle():resizePlayerStyle();break;case"takeFocusedWidgetText_old":waitForTakeFocusedWidgetText&&(waitForTakeFocusedWidgetText=!1,onchangehiddenInputText(),showhiddenInput(n.value));break;case"takeFocusedWidgetText":waitForTakeFocusedWidgetText&&(waitForTakeFocusedWidgetText=!1,hiddenInput=document.getElementById("hiddenInput"),hiddenInput.value=n.value,hiddenInput.style.display="block",onchangehiddenInputText(),hiddenInput.focus());break;case"getCmdLineArgs":{let e={};e.cmdLineArgs=cmdLineArgs,console.log("33333333333333 sendDataToUE4App emitUIInteraction: "+JSON.stringify(e)),"function"==typeof window?.pixelStreaming?.emitUIInteraction?window.pixelStreaming.emitUIInteraction(e):emitUIInteraction(e)}break;case"getIpaddress":{let e={Ipaddress:"contactAhsanASAP"};console.log("33333333333333 sendDataToUE4App emitUIInteraction: "+JSON.stringify(e)),"function"==typeof window?.pixelStreaming?.emitUIInteraction?window.pixelStreaming.emitUIInteraction(e):emitUIInteraction(e)}break;case"redirectTo":window.location.href=n.value;break;case"launchKeyBoard":case"lunchKeyBoard":break;case"sendLocalFileToUE":case"sendLocalFileToUE4":!function(e){console.log("Browsing");const n=document.createElement("input");n.setAttribute("type","file"),n.style.display="none",document.getElementsByTagName("body")[0].appendChild(n),n.addEventListener("cancel",()=>{console.log("âŒ File dialog closed without selection (cancel or X)"),"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction({cmd:"onUserSideFileSelectionCanceled"})}),n.addEventListener("change",()=>{const i=n.files[0];t=i,console.log("file",i),function(e,t,n,i,s){var r={type:"getUploadUrl",content_type:e,owner:n,appName:t,file_name:i,pathToSaveFile:s};console.log(JSON.stringify(r)),Q(r)}(i.type,p,m,i.name,e)}),n.click()}(n.pathToSaveFile);break;case"ToggleBrowserMouse":z=!z,K();break;case"showBrowserMouse":z=!0,K();break;case"hideBrowserMouse":z=!1,K();break;case"lunchCallApp":console.log(n.value),appWindow=window.open("tel:"+n.value,"_self");break;case"lunchMailApp":var i="mailto:"+n.value+"?subject="+n.value+"&body="+n.value;appWindow=window.open(i,"_blank");break;case"sendDeviceInfo":let e={type:"takeUserDeviceInfo",clientInfo:r};"function"==typeof window?.pixelStreaming?.emitUIInteraction?window.pixelStreaming.emitUIInteraction(e):emitUIInteraction(e);break;case"sendUserInfoInPlainJson":let a={};a=r,"function"==typeof window?.pixelStreaming?.emitUIInteraction?window.pixelStreaming.emitUIInteraction(a):emitUIInteraction(a);break;case"sendUserInfo":let l={clientInfo:r};"function"==typeof window?.pixelStreaming?.emitUIInteraction?window.pixelStreaming.emitUIInteraction(l):emitUIInteraction(l);break;case"generateDownloadableCSV":console.log(JSON.stringify(n.value)),exportToCsv(n.filename,n.csvRows);break;case"captureScreenShot":captureScreenShot();break;case"toggleFullscreen":!function(){const e=document.getElementById("fullscreen-btn");e&&e.click()}();break;case"enterFullscreen":enterFullscreen();break;case"exitFullscreen":exitFullscreen();break;case"ForeceEndTab":try{if(!window.close)throw new Error("window.close is not supported");if(window.close(),!window.closed)throw new Error("Failed to close the window")}catch(e){console.error("Error:",e),V("Denied. Scripts may close only the windows that were opened by them.",{color:"red",timeout:5e3})}break;case"ForeceEndSession":case"ForceEndSession":U("Session Ended");break;case"setVolume":console.log(n.value);const c=parseFloat(n.value);c>1?setVolume(scaleTo01(c)):setVolume(n.value);break;case"askChatGpt":askChatGpt(n.value);break;case"doInAppPurchase":doInAppPurchase(n);break;case"sendClipBoardData":sendClipBoardData();break;case"copytoclipboard":setClipBoardData(n.value);break;case"setBrowserSideMouseCursorTo":""!=n.value&&null!=n.value&&(q=n.value),K();break;case"getInGameCustomizationData":var s={type:"getInGameCustomizationData",slotId:n.slotId};null!=window?.pixelStreaming?.webSocketController?.webSocket&&window?.pixelStreaming?.webSocketController?.webSocket?.readyState==WebSocket.OPEN?window.pixelStreaming.webSocketController.webSocket.send(JSON.stringify(s)):Q(s);break;case"launchUrl":case"lunchUrl":!function(e){const t=e.value;let n;try{new URL(t),n=window.open(t,"_blank")?{result:"success",receivedMsg:e,time:(new Date).toString()}:{result:"failed",receivedMsg:e,time:(new Date).toString(),reason:"popup blocked or failed to open"}}catch(t){n={result:"failed",receivedMsg:e,time:(new Date).toString(),reason:"invalid url"}}console.log(JSON.stringify(n,null,2)),"function"==typeof window?.pixelStreaming?.emitUIInteraction&&window.pixelStreaming.emitUIInteraction(n)}(n);break;case"editorModeId":openSidebar(n);break;case"freezeResolutionAt":d(n.x,n.y);break;case"getDownloadUrlOfLocalFile":var o=JSON.stringify({type:"forwardToEL",objFromUE4:n});console.log(" ws.send(): "+JSON.stringify(o)),Q(o);break;case"downloadLocalFileOnUserDevice":o={type:"forwardToEL",objFromUE4:n},console.log(" ws.send(): "+JSON.stringify(o)),Q(o);break;case"switchMouseControlSchemeTo":"HoveringMouse"===n.value?window?.pixelStreaming?.config?.setFlagEnabled("HoveringMouse",!0):"LockedMouse"===n.value&&window?.pixelStreaming?.config?.setFlagEnabled("HoveringMouse",!1)}},r=void 0,"undefined"!=typeof e3ds_controller&&(e3ds_controller.terminate=function(){X()}),window.lastSessionData=void 0,window.onStatsReportPrepared=function(e){const t=Object.fromEntries(e);window.lastSessionData=t},window.latestWebRtcStats={},window.minMaxAvgData={},window.onStatsReceived=function(e){!function(e){if("object"!=typeof e)return;window.latestWebRtcStats.currentRoundTripTime=e.candidatePairs[0]?.currentRoundTripTime;const{min:t,max:n,avg:i}=J("currentRoundTripTime",window.latestWebRtcStats.currentRoundTripTime);window.latestWebRtcStats.timestamp=e.candidatePairs[0]?.timestamp,window.latestWebRtcStats.framesDecoded=e.inboundVideoStats.framesDecoded,window.latestWebRtcStats.packetsLost=e.inboundVideoStats.packetsLost,window.latestWebRtcStats.bitrate=e.inboundVideoStats.bitrate;const{min:s,max:r,avg:o}=J("bitrate",window.latestWebRtcStats.bitrate);window.latestWebRtcStats.framerate=e.inboundVideoStats.framesPerSecond;const{min:a,max:l,avg:d}=J("framerate",window.latestWebRtcStats.framerate);window.latestWebRtcStats.receiveToCompositeMs=e.inboundVideoStats.receiveToCompositeMs,window.latestWebRtcStats={...window.latestWebRtcStats,minRoundTripTime:t,maxRoundTripTime:n,avgRoundTripTime:i,lowBitrate:s,highBitrate:r,avgBitrate:o,lowFramerate:a,highFramerate:l,avgFramerate:d}}(e)},window.applyE3DSConfigOnFlag=function(){let e=!0;var t=window?.req_data?.E3DSConfigData?.resolutionType_ue4;e=null==t||"Dynamic"===t,1==window.req_data.isSpectator&&(e=!1);var n=[{mapKey:"AutoConnect",fixedValue:!0},{mapKey:"AutoPlayVideo",jsonKey:"ShouldAutoPlay"},{mapKey:"UseMic",jsonKey:"UseMicrophone"},{mapKey:"FakeMouseWithTouches",jsonKey:"fakeMouseWithTouches"},{mapKey:"SuppressBrowserKeys",jsonKey:"suppressBrowserKeys"},{mapKey:"UseModalForTextInput",fixedValue:!0},{mapKey:"MatchViewportRes",fixedValue:e},{mapKey:"StartVideoMuted",jsonKey:"ShouldAutoPlay",customLogic:e=>"1"===e},{mapKey:"ForceTURN",jsonKey:"forceNoTurnServer"},{mapKey:"TimeoutIfIdle",jsonKey:"isAfkEnabled"},{mapKey:"HoveringMouse",jsonKey:"MouseControlScheme",customLogic:e=>"1"===e},{mapKey:"ControlsQuality",fixedValue:!(1==window.req_data.isSpectator)},{mapKey:"KeyboardInput",fixedValue:!(1==window.req_data.isSpectator)},{mapKey:"MouseInput",fixedValue:!(1==window.req_data.isSpectator)},{mapKey:"TouchInput",fixedValue:!(1==window.req_data.isSpectator)},{mapKey:"GamepadInput",fixedValue:!(1==window.req_data.isSpectator)},{mapKey:"XRControllerInput",fixedValue:!(1==window.req_data.isSpectator)},{mapKey:"HideUI",jsonKey:"HideUI"}];Z(window.psConfigObj.flags,window.req_data.E3DSConfigData,n);var i=window.psConfigObj.numericParameters,s=window?.req_data?.E3DSConfigData.afkWarnTimeout||5;return window.req_data.E3DSConfigData.afkWarnTimeout=60*s,s=window?.req_data?.E3DSConfigData.afkCloseTimeout||1,window.req_data.E3DSConfigData.afkCloseTimeout=60*s,Z(i,window.req_data.E3DSConfigData,[{mapKey:"AFKTimeout",jsonKey:"afkWarnTimeout"},{mapKey:"AFKCountdown",jsonKey:"afkCloseTimeout"}]),async function(){K();var e=document.getElementById("settingsBtn");e&&(e.style.display="none");var t=document.getElementById("ss");t&&(t.style.display="none");var n=document.getElementById("StreamerId");n&&(n.style.display="none");var i=document.getElementById("ForceTURN");if(i&&(i.style.display="none"),1==window.req_data.E3DSConfigData.isAdminDebugging&&(e&&(e.style.display="block"),i&&(i.style.display="block"),n&&(n.style.display="block"),t&&(t.style.display="block")),1==window.req_data.E3DSConfigData.HideUI){var s=document.getElementById("messageOverlayInner");s&&(s.style.visibility="hidden");var r=document.getElementById("uiFeatures");r&&(r.style.visibility="hidden"),document.querySelectorAll(".uiElement").forEach(e=>{e.style.visibility="hidden"})}e3ds_controller.callbacks&&"function"==typeof e3ds_controller.callbacks.onConfigAcquire&&e3ds_controller.callbacks.onConfigAcquire()}(window.psConfigObj.flags,window.req_data.E3DSConfigData),console.log("configObjs:"),console.dir(window.psConfigObj),window.psConfigObj.flags},window.loginInfoCollected=!1;var ee,te=void 0,ne=void 0;function ie(e){const t=Math.floor(e/1e3%60),n=Math.floor(e/6e4%60),i=Math.floor(e/36e5);let s="";return i>0&&(s+=`${i}h `),(n>0||i>0)&&(s+=`${n}m `),t>0&&(s+=`${t}s`),s.trim()}!async function(){var e=new XMLHttpRequest;e.withCredentials=!0,e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE&&200===e.status){var t=JSON.parse(e.responseText);"Signed"===t?.message&&(window.loggedInUserData=t.data,console.log("window.loggedInUserData: "+JSON.stringify(window.loggedInUserData))),window.loginInfoCollected=!0}};const t=new URL(window.location.href).hostname.split(".").slice(-2).join(".");if(console.log(t),"eaglepixelstreaming.com"==t)te="https://auth-restful.eaglepixelstreaming.com/api/v2/session/jwt",ne="https://newlogin.eaglepixelstreaming.com/signin?redirect="+window.location.href;else{if("eagle3dstreaming.com"!=t)return;te="https://auth-restful.eagle3dstreaming.com/api/v2/session/jwt",ne="https://controlpanel.eagle3dstreaming.com/signin?redirect="+window.location.href}console.log("e3dsAuthUrl:"+te),console.log("e3dsLoginUrl:"+ne),e.open("GET",te),e.onerror=function(){console.log("collectLoginInfo()  xmlHttp.onerror network errors .")};try{e.send()}catch(e){console.error(e)}}(),window.isLoggedIn=async function(e=5e3){const t=Date.now();for(;!window.loginInfoCollected;){if(Date.now()-t>e)return console.warn("â³ isLoggedIn() timeout after",e,"ms"),!1;await new Promise(e=>setTimeout(e,100))}return void 0!==window.loggedInUserData},window.addEventListener("DOMContentLoaded",function(){"function"==typeof UpdateQueueNumber&&UpdateQueueNumber("Requesting Available Slot",""),"function"==typeof setupEventListeners&&setupEventListeners(),document.querySelectorAll("button").forEach(e=>{e.addEventListener("click",function(){this.blur()})})}),ee=()=>(()=>{"use strict";var e={63:e=>{e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},826:e=>{const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(e=>0===e.indexOf(n))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<i.length;e++)n=i[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substring(t+1,i),n.value=e.substring(i+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],s=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");n.profile=i[2];for(let s=3;s<i.length;s++){const r=i[s],o=t.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(o){const i=t.parseRtpMap(o),s=t.matchPrefix(e,"a=fmtp:"+r+" ");switch(i.parameters=s.length?t.parseFmtp(s[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{n.headerExtensions.push(t.parseExtmap(e))});const s=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(e=>{s.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)});let s=0;return n.codecs.forEach(e=>{e.maxptime>s&&(s=e.maxptime)}),s>0&&(i+="a=maxptime:"+s+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(e=>{i+=t.writeExtmap(e)}),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),s=-1!==i.fecMechanisms.indexOf("RED"),r=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),a=o.length>0&&o[0].ssrc;let l;const d=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));d.length>0&&d[0].length>1&&d[0][0]===a&&(l=d[0][1]),i.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&l&&(t.rtx={ssrc:l}),n.push(t),s&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:r?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&a&&n.push({ssrc:a});let c=t.matchPrefix(e,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substring(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=c})),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const s=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=s.length>0,n.compound=0===s.length;const r=t.matchPrefix(e,"a=rtcp-mux");return n.mux=r.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const s=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return s.length>0?(n=s[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const r=t.matchPrefix(e,"a=sctp-port:");if(r.length>0)return{port:parseInt(r[0].substring(12),10),protocol:n.fmt,maxMessageSize:s};const o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){const e=o[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:s}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,i){let s;const r=void 0!==n?n:2;return s=e||t.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+s+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let e=0;e<i.length;e++)switch(i[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};n.r(i),n.d(i,{AFKOverlay:()=>wi,ActionOverlay:()=>ui,AfkLogic:()=>nn,AfkTimedOutEvent:()=>rt,AfkWarningActivateEvent:()=>nt,AfkWarningDeactivateEvent:()=>st,AfkWarningUpdateEvent:()=>it,AggregatedStats:()=>mn,Application:()=>Xi,CandidatePairStats:()=>oi,CandidateStat:()=>ln,Config:()=>en,ConfigUI:()=>Qi,ConnectOverlay:()=>mi,ControlSchemeType:()=>tn,DataChannelCloseEvent:()=>ft,DataChannelErrorEvent:()=>yt,DataChannelLatencyTestRecord:()=>ii,DataChannelLatencyTestResponseEvent:()=>Ft,DataChannelLatencyTestResultEvent:()=>At,DataChannelOpenEvent:()=>gt,DataChannelStats:()=>an,DisconnectOverlay:()=>pi,EncoderSettings:()=>xn,ErrorOverlay:()=>vi,EventEmitter:()=>h,Flags:()=>Kt,FrameTimingInfo:()=>vn,HideFreezeFrameEvent:()=>kt,InboundAudioStats:()=>rn,InboundVideoStats:()=>on,InfoOverlay:()=>yi,InitialSettings:()=>En,InitialSettingsEvent:()=>Ut,InputCoordTranslator:()=>Zn,KeepaliveMonitor:()=>Qe,LatencyCalculatedEvent:()=>Dt,LatencyCalculator:()=>wn,LatencyInfo:()=>Sn,LatencyTestResultEvent:()=>Lt,LatencyTestResults:()=>kn,LoadFreezeFrameEvent:()=>Mt,LogLevel:()=>r,Logger:()=>d,MessageDirection:()=>Hn,MessageHelpers:()=>o,MessageRegistry:()=>ze,Messages:()=>s,NumericParameters:()=>Gt,OptionParameters:()=>Zt,OutboundRTPStats:()=>dn,OverlayBase:()=>hi,PixelStreaming:()=>ri,PixelStreamingApplicationStyle:()=>Mr,PixelStreamingEventEmitter:()=>zt,PixelStreamingSettings:()=>Tn,PlayOverlay:()=>gi,PlayStreamErrorEvent:()=>Et,PlayStreamEvent:()=>Tt,PlayStreamRejectedEvent:()=>xt,PlayerCountEvent:()=>Ht,RemoteOutboundRTPStats:()=>cn,SDPUtils:()=>fn,SettingBase:()=>Je,SettingFlag:()=>Ze,SettingNumber:()=>Ye,SettingOption:()=>tt,SettingText:()=>et,SettingUIBase:()=>Hi,SettingUIFlag:()=>ji,SettingUINumber:()=>zi,SettingUIOption:()=>Ki,SettingUIText:()=>qi,SettingsChangedEvent:()=>Nt,ShowOnScreenKeyboardEvent:()=>Ot,SignallingProtocol:()=>m,StatsReceivedEvent:()=>It,StreamLoadingEvent:()=>wt,StreamPreConnectEvent:()=>St,StreamPreDisconnectEvent:()=>bt,StreamReconnectEvent:()=>Ct,StreamerIDChangedMessageEvent:()=>Rt,StreamerListMessageEvent:()=>Pt,SubscribeFailedEvent:()=>_t,TextOverlay:()=>fi,TextParameters:()=>Xt,UIElementCreationMode:()=>ai,VideoEncoderAvgQPEvent:()=>ot,VideoInitializedEvent:()=>vt,WebRTCSettings:()=>Mn,WebRtcAutoConnectEvent:()=>ct,WebRtcConnectedEvent:()=>ut,WebRtcConnectingEvent:()=>ht,WebRtcDisconnectedEvent:()=>pt,WebRtcFailedEvent:()=>mt,WebRtcPlayerController:()=>ei,WebRtcSdpAnswerEvent:()=>lt,WebRtcSdpEvent:()=>at,WebRtcSdpOfferEvent:()=>dt,WebRtcTCPRelayDetectedEvent:()=>jt,WebSocketTransport:()=>u,WebSocketTransportNJS:()=>ci,WebXRController:()=>ni,XrFrameEvent:()=>Wt,XrSessionEndedEvent:()=>Vt,XrSessionStartedEvent:()=>Bt,isFlagId:()=>Qt,isNumericId:()=>$t,isOptionId:()=>Yt,isTextId:()=>Jt,overrideLogger:()=>l});var s={};n.r(s),n.d(s,{answer:()=>Ie,base_message:()=>me,config:()=>ge,dataChannelRequest:()=>_e,disconnectPlayer:()=>Le,endpointId:()=>ye,endpointIdConfirm:()=>ve,iceCandidate:()=>Re,iceCandidateData:()=>Pe,identify:()=>fe,layerPreference:()=>Ae,listStreamers:()=>Se,offer:()=>ke,peerConnectionOptions:()=>pe,peerDataChannels:()=>Ue,peerDataChannelsReady:()=>Ne,ping:()=>De,playerConnected:()=>xe,playerCount:()=>He,playerDisconnected:()=>Me,pong:()=>Oe,startStreaming:()=>Ve,stats:()=>je,stopStreaming:()=>We,streamerDataChannels:()=>Be,streamerDisconnected:()=>Fe,streamerIdChanged:()=>we,streamerList:()=>be,subscribe:()=>Ce,subscribeFailed:()=>Te,unsubscribe:()=>Ee});var r,o={};n.r(o),n.d(o,{createMessage:()=>qe,validateMessage:()=>Ke}),function(e){e[e.Disabled=0]="Disabled",e[e.Error=1]="Error",e[e.Warning=2]="Warning",e[e.Info=3]="Info",e[e.Debug=4]="Debug"}(r||(r={}));class a{constructor(){this.logLevel=r.Debug,this.includeStack=!0}}function l(e){d=e}let d=new class{InitLogging(e,t){this.ValidateContext(),this.context.logLevel=e,this.context.includeStack=t}Debug(e){this.ValidateContext(),this.context.logLevel>=r.Debug&&this.CommonLog("Debug",e)}Info(e){this.ValidateContext(),this.context.logLevel>=r.Info&&this.CommonLog("Info",e)}Warning(e){this.ValidateContext(),this.context.logLevel>=r.Warning&&this.CommonLog("Warning",e)}Error(e){this.ValidateContext(),this.context.logLevel>=r.Error&&this.CommonLog("Error",e)}CommonLog(e,t){let n=`[${e}] - ${t}`;this.context.includeStack&&(n+=`\nStack: ${this.GetStackTrace()}`),"Error"===e?console.error(n):"Warning"===e?console.warn(n):console.log(n)}GetStackTrace(){const e=new Error;let t="No Stack Available for this browser";return e.stack&&(t=e.stack.toString().replace(/Error/g,"")),t}ValidateContext(){this.context||("undefined"!=typeof window&&window?window.loggerContext?this.context=window.loggerContext:(this.context=new a,window.loggerContext=this.context):this.context=new a)}};class c{constructor(e){this._args=[],this._callback=e}handleEvent(e){this._callback(...this._args),this._args=[]}setArgs(...e){this._args=e}}class h extends EventTarget{constructor(){super(),this._eventListeners=new Map}removeListenerInternal(e,t){if(this._eventListeners.has(e)){const n=this._eventListeners.get(e);if(void 0===n)return this;for(let i=0;i<n.length;++i){const s=n[i];if(s.callback===t){super.removeEventListener(e,s.eventListenerWrapper),n.splice(i,1);break}}}return this}addListener(e,t){return this.on(e,t)}on(e,t){var n;const i=new c(t);return super.addEventListener(e,i),this._eventListeners.has(e)||this._eventListeners.set(e,new Array),null===(n=this._eventListeners.get(e))||void 0===n||n.push({callback:t,eventListenerWrapper:i}),this}once(e,t){var n;const i=new c((...n)=>{t(n),this.removeListenerInternal(e,t)});return super.addEventListener(e,i,{once:!0}),this._eventListeners.has(e)||this._eventListeners.set(e,new Array),null===(n=this._eventListeners.get(e))||void 0===n||n.push({callback:t,eventListenerWrapper:i}),this}removeListener(e,t){return this.removeListenerInternal(e,t),this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){if(this._eventListeners.has(e)){const t=this._eventListeners.get(e);if(void 0===t)return this;for(const n of t)this.removeEventListener(e,n.eventListenerWrapper);this._eventListeners.delete(e)}return this}emit(e,...t){if(this._eventListeners.has(e)){const n=this._eventListeners.get(e);if(void 0===n)return!1;for(const e of n)e.eventListenerWrapper.setArgs(...t);return super.dispatchEvent(new Event(e)),!0}return!1}}class u extends h{constructor(e){super(),this.WS_OPEN_STATE=1,this.protocols=e}sendMessage(e){this.webSocket&&this.webSocket.send(e)}connect(e){d.Info(e);try{return console.log("trying to connect :"+e),this.webSocket=new WebSocket(e,this.protocols),this.webSocket.onopen=e=>this.handleOnOpen(),this.webSocket.onerror=e=>this.handleOnError(),this.webSocket.onclose=e=>this.handleOnClose(e),this.webSocket.onmessage=e=>this.handleOnMessage(e),this.webSocket.onmessagebinary=e=>this.handleOnMessageBinary(e),!0}catch(e){return d.Error(e),!1}}disconnect(e,t){this.webSocket&&this.webSocket.close(e,t)}isConnected(){return!!this.webSocket&&this.webSocket.readyState!=WebSocket.CLOSED}handleOnMessageBinary(e){window.handleWebSocketEvent("messageBinary",MessageEvent),e&&e.data&&e.data.text().then(e=>{const t=new MessageEvent("messageFromBinary",{data:e});this.handleOnMessage(t)}).catch(e=>{d.Error(`Failed to parse binary blob from websocket, reason: ${e.message}`)})}handleOnMessage(e){if(e.data&&e.data instanceof Blob)return this.handleOnMessageBinary(e),void window.handleWebSocketEvent("messageBinary",e.data);this.onMessage&&(this.onMessage(e.data),window.handleWebSocketEvent("message",e.data))}handleOnOpen(){console.log("Connected to the signalling server via WebSocket"),d.Info("Connected to the signalling server via WebSocket"),this.emit("open"),window.handleWebSocketEvent("open")}handleOnError(){this.emit("error"),window.handleWebSocketEvent("error")}handleOnClose(e){d.Info("Disconnected to the signalling server via WebSocket: "+JSON.stringify(e.code)+" - "+e.reason),this.emit("close",e),window.handleWebSocketEvent("close",e?.reason)}}class m extends h{static get SIGNALLING_VERSION(){return"1.3.0"}constructor(e){super(),this.transport=e,e.onMessage=t=>{let n;window.handleMessageReceivedFromSS(t);try{const e=JSON.parse(t);d.Debug("Protocol received => \n"+JSON.stringify(e,void 0,4)),n=e}catch(e){return void(e instanceof Error?d.Error(`Error parsing message string ${t}.\n${e.message}`):d.Error("Unknown error while parsing message data in handleOnMessage"))}e.emit("message",n),this.emit(n.type,n)||this.emit("unhandled",n)}}connect(e){return this.transport.connect(e)}disconnect(e,t){this.transport.disconnect(e,t)}isConnected(){return this.transport.isConnected()}sendMessage(e){this.transport.sendMessage(JSON.stringify(e)),this.transport.emit("out",e),d.Debug("Protocol sent => \n"+JSON.stringify(e,void 0,4))}}var p,g;function f(e,t,n){let i,s,r=n;for(let n of e.fields){let e=n.localName;if(n.oneof){const o=r[n.oneof];if(null==(null==o?void 0:o.oneofKind))continue;if(i=o[e],s=t[n.oneof],s.oneofKind=o.oneofKind,null==i){delete s[e];continue}}else if(i=r[e],s=t,null==i)continue;switch(n.repeat&&(s[e].length=i.length),n.kind){case"scalar":case"enum":if(n.repeat)for(let t=0;t<i.length;t++)s[e][t]=i[t];else s[e]=i;break;case"message":let t=n.T();if(n.repeat)for(let n=0;n<i.length;n++)s[e][n]=t.create(i[n]);else void 0===s[e]?s[e]=t.create(i):t.mergePartial(s[e],i);break;case"map":switch(n.V.kind){case"scalar":case"enum":Object.assign(s[e],i);break;case"message":let t=n.V.T();for(let n of Object.keys(i))s[e][n]=t.create(i[n])}}}}!function(e){e.symbol=Symbol.for("protobuf-ts/unknown"),e.onRead=(n,i,s,r,o)=>{(t(i)?i[e.symbol]:i[e.symbol]=[]).push({no:s,wireType:r,data:o})},e.onWrite=(t,n,i)=>{for(let{no:t,wireType:s,data:r}of e.list(n))i.tag(t,s).raw(r)},e.list=(n,i)=>{if(t(n)){let t=n[e.symbol];return i?t.filter(e=>e.no==i):t}return[]},e.last=(t,n)=>e.list(t,n).slice(-1)[0];const t=t=>t&&Array.isArray(t[e.symbol])}(p||(p={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(g||(g={}));const y=Symbol.for("protobuf-ts/message-type");function v(e){let t=!1;const n=[];for(let i=0;i<e.length;i++){let s=e.charAt(i);"_"==s?t=!0:/\d/.test(s)?(n.push(s),t=!0):t?(n.push(s.toUpperCase()),t=!1):0==i?n.push(s.toLowerCase()):n.push(s)}return n.join("")}var w,S,b;function C(e){var t,n,i,s;return e.localName=null!==(t=e.localName)&&void 0!==t?t:v(e.name),e.jsonName=null!==(n=e.jsonName)&&void 0!==n?n:v(e.name),e.repeat=null!==(i=e.repeat)&&void 0!==i?i:b.NO,e.opt=null!==(s=e.opt)&&void 0!==s?s:!e.repeat&&!e.oneof&&"message"==e.kind,e}function E(e){if("object"!=typeof e||null===e||!e.hasOwnProperty("oneofKind"))return!1;switch(typeof e.oneofKind){case"string":return void 0!==e[e.oneofKind]&&2==Object.keys(e).length;case"undefined":return 1==Object.keys(e).length;default:return!1}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(w||(w={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING",e[e.NUMBER=2]="NUMBER"}(S||(S={})),function(e){e[e.NO=0]="NO",e[e.PACKED=1]="PACKED",e[e.UNPACKED=2]="UNPACKED"}(b||(b={}));class T{constructor(e){var t;this.fields=null!==(t=e.fields)&&void 0!==t?t:[]}prepare(){if(this.data)return;const e=[],t=[],n=[];for(let i of this.fields)if(i.oneof)n.includes(i.oneof)||(n.push(i.oneof),e.push(i.oneof),t.push(i.oneof));else switch(t.push(i.localName),i.kind){case"scalar":case"enum":i.opt&&!i.repeat||e.push(i.localName);break;case"message":i.repeat&&e.push(i.localName);break;case"map":e.push(i.localName)}this.data={req:e,known:t,oneofs:Object.values(n)}}is(e,t,n=!1){if(t<0)return!0;if(null==e||"object"!=typeof e)return!1;this.prepare();let i=Object.keys(e),s=this.data;if(i.length<s.req.length||s.req.some(e=>!i.includes(e)))return!1;if(!n&&i.some(e=>!s.known.includes(e)))return!1;if(t<1)return!0;for(const i of s.oneofs){const s=e[i];if(!E(s))return!1;if(void 0===s.oneofKind)continue;const r=this.fields.find(e=>e.localName===s.oneofKind);if(!r)return!1;if(!this.field(s[s.oneofKind],r,n,t))return!1}for(const i of this.fields)if(void 0===i.oneof&&!this.field(e[i.localName],i,n,t))return!1;return!0}field(e,t,n,i){let s=t.repeat;switch(t.kind){case"scalar":return void 0===e?t.opt:s?this.scalars(e,t.T,i,t.L):this.scalar(e,t.T,t.L);case"enum":return void 0===e?t.opt:s?this.scalars(e,w.INT32,i):this.scalar(e,w.INT32);case"message":return void 0===e||(s?this.messages(e,t.T(),n,i):this.message(e,t.T(),n,i));case"map":if("object"!=typeof e||null===e)return!1;if(i<2)return!0;if(!this.mapKeys(e,t.K,i))return!1;switch(t.V.kind){case"scalar":return this.scalars(Object.values(e),t.V.T,i,t.V.L);case"enum":return this.scalars(Object.values(e),w.INT32,i);case"message":return this.messages(Object.values(e),t.V.T(),n,i)}}return!0}message(e,t,n,i){return n?t.isAssignable(e,i):t.is(e,i)}messages(e,t,n,i){if(!Array.isArray(e))return!1;if(i<2)return!0;if(n){for(let n=0;n<e.length&&n<i;n++)if(!t.isAssignable(e[n],i-1))return!1}else for(let n=0;n<e.length&&n<i;n++)if(!t.is(e[n],i-1))return!1;return!0}scalar(e,t,n){let i=typeof e;switch(t){case w.UINT64:case w.FIXED64:case w.INT64:case w.SFIXED64:case w.SINT64:switch(n){case S.BIGINT:return"bigint"==i;case S.NUMBER:return"number"==i&&!isNaN(e);default:return"string"==i}case w.BOOL:return"boolean"==i;case w.STRING:return"string"==i;case w.BYTES:return e instanceof Uint8Array;case w.DOUBLE:case w.FLOAT:return"number"==i&&!isNaN(e);default:return"number"==i&&Number.isInteger(e)}}scalars(e,t,n,i){if(!Array.isArray(e))return!1;if(n<2)return!0;if(Array.isArray(e))for(let s=0;s<e.length&&s<n;s++)if(!this.scalar(e[s],t,i))return!1;return!0}mapKeys(e,t,n){let i=Object.keys(e);switch(t){case w.INT32:case w.FIXED32:case w.SFIXED32:case w.SINT32:case w.UINT32:return this.scalars(i.slice(0,n).map(e=>parseInt(e)),t,n);case w.BOOL:return this.scalars(i.slice(0,n).map(e=>"true"==e||"false"!=e&&e),t,n);default:return this.scalars(i,t,n,S.STRING)}}}function x(e){let t=typeof e;if("object"==t){if(Array.isArray(e))return"array";if(null===e)return"null"}return t}function M(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}let k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),I=[];for(let e=0;e<k.length;e++)I[k[e].charCodeAt(0)]=e;function P(){let e=0,t=0;for(let n=0;n<28;n+=7){let i=this.buf[this.pos++];if(e|=(127&i)<<n,!(128&i))return this.assertBounds(),[e,t]}let n=this.buf[this.pos++];if(e|=(15&n)<<28,t=(112&n)>>4,!(128&n))return this.assertBounds(),[e,t];for(let n=3;n<=31;n+=7){let i=this.buf[this.pos++];if(t|=(127&i)<<n,!(128&i))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function R(e,t,n){for(let i=0;i<28;i+=7){const s=e>>>i,r=!(s>>>7==0&&0==t),o=255&(r?128|s:s);if(n.push(o),!r)return}const i=e>>>28&15|(7&t)<<4,s=!!(t>>3);if(n.push(255&(s?128|i:i)),s){for(let e=3;e<31;e+=7){const i=t>>>e,s=!(i>>>7==0),r=255&(s?128|i:i);if(n.push(r),!s)return}n.push(t>>>31&1)}}I["-".charCodeAt(0)]=k.indexOf("+"),I["_".charCodeAt(0)]=k.indexOf("/");const L=4294967296;function D(e){let t="-"==e[0];t&&(e=e.slice(1));const n=1e6;let i=0,s=0;function r(t,r){const o=Number(e.slice(t,r));s*=n,i=i*n+o,i>=L&&(s+=i/L|0,i%=L)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),[t,i,s]}function O(e,t){if(t>>>0<=2097151)return""+(L*t+(e>>>0));let n=(e>>>24|t<<8)>>>0&16777215,i=t>>16&65535,s=(16777215&e)+6777216*n+6710656*i,r=n+8147497*i,o=2*i,a=1e7;function l(e,t){let n=e?String(e):"";return t?"0000000".slice(n.length)+n:n}return s>=a&&(r+=Math.floor(s/a),s%=a),r>=a&&(o+=Math.floor(r/a),r%=a),l(o,0)+l(r,o)+l(s,1)}function F(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let n=0;n<9;n++)t.push(127&e|128),e>>=7;t.push(1)}}function A(){let e=this.buf[this.pos++],t=127&e;if(!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,!(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let t=5;128&e&&t<10;t++)e=this.buf[this.pos++];if(128&e)throw new Error("invalid varint");return this.assertBounds(),t>>>0}let _;function U(e){if(!e)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}!function(){const e=new DataView(new ArrayBuffer(8)),t=void 0!==globalThis.BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64;_=t?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:e}:void 0}();const N=/^-?[0-9]+$/,B=4294967296,V=2147483648;class W{constructor(e,t){this.lo=0|e,this.hi=0|t}isZero(){return 0==this.lo&&0==this.hi}toNumber(){let e=this.hi*B+(this.lo>>>0);if(!Number.isSafeInteger(e))throw new Error("cannot convert to safe number");return e}}class H extends W{static from(e){if(_)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw new Error("string is no integer");e=_.C(e);case"number":if(0===e)return this.ZERO;e=_.C(e);case"bigint":if(!e)return this.ZERO;if(e<_.UMIN)throw new Error("signed value for ulong");if(e>_.UMAX)throw new Error("ulong too large");return _.V.setBigUint64(0,e,!0),new H(_.V.getInt32(0,!0),_.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!N.test(e))throw new Error("string is no integer");let[t,n,i]=D(e);if(t)throw new Error("signed value for ulong");return new H(n,i);case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");if(e<0)throw new Error("signed value for ulong");return new H(e,e/B)}throw new Error("unknown value "+typeof e)}toString(){return _?this.toBigInt().toString():O(this.lo,this.hi)}toBigInt(){return U(_),_.V.setInt32(0,this.lo,!0),_.V.setInt32(4,this.hi,!0),_.V.getBigUint64(0,!0)}}H.ZERO=new H(0,0);class j extends W{static from(e){if(_)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw new Error("string is no integer");e=_.C(e);case"number":if(0===e)return this.ZERO;e=_.C(e);case"bigint":if(!e)return this.ZERO;if(e<_.MIN)throw new Error("signed long too small");if(e>_.MAX)throw new Error("signed long too large");return _.V.setBigInt64(0,e,!0),new j(_.V.getInt32(0,!0),_.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!N.test(e))throw new Error("string is no integer");let[t,n,i]=D(e);if(t){if(i>V||i==V&&0!=n)throw new Error("signed long too small")}else if(i>=V)throw new Error("signed long too large");let s=new j(n,i);return t?s.negate():s;case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");return e>0?new j(e,e/B):new j(-e,-e/B).negate()}throw new Error("unknown value "+typeof e)}isNegative(){return 0!==(this.hi&V)}negate(){let e=~this.hi,t=this.lo;return t?t=1+~t:e+=1,new j(t,e)}toString(){if(_)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+O(e.lo,e.hi)}return O(this.lo,this.hi)}toBigInt(){return U(_),_.V.setInt32(0,this.lo,!0),_.V.setInt32(4,this.hi,!0),_.V.getBigInt64(0,!0)}}function z(e,t){if(!e)throw new Error(t)}function q(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function K(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function Q(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}function G(e,t){switch(t){case S.BIGINT:return e.toBigInt();case S.NUMBER:return e.toNumber();default:return e.toString()}}j.ZERO=new j(0,0);class ${constructor(e){this.info=e}prepare(){var e;if(void 0===this.fMap){this.fMap={};const t=null!==(e=this.info.fields)&&void 0!==e?e:[];for(const e of t)this.fMap[e.name]=e,this.fMap[e.jsonName]=e,this.fMap[e.localName]=e}}assert(e,t,n){if(!e){let e=x(n);throw"number"!=e&&"boolean"!=e||(e=n.toString()),new Error(`Cannot parse JSON ${e} for ${this.info.typeName}#${t}`)}}read(e,t,n){this.prepare();const i=[];for(const[s,r]of Object.entries(e)){const e=this.fMap[s];if(!e){if(!n.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${s}`);continue}const o=e.localName;let a;if(e.oneof){if(null===r&&("enum"!==e.kind||"google.protobuf.NullValue"!==e.T()[0]))continue;if(i.includes(e.oneof))throw new Error(`Multiple members of the oneof group "${e.oneof}" of ${this.info.typeName} are present in JSON.`);i.push(e.oneof),a=t[e.oneof]={oneofKind:o}}else a=t;if("map"==e.kind){if(null===r)continue;this.assert(M(r),e.name,r);const t=a[o];for(const[i,s]of Object.entries(r)){let r;switch(this.assert(null!==s,e.name+" map value",null),e.V.kind){case"message":r=e.V.T().internalJsonRead(s,n);break;case"enum":if(r=this.enum(e.V.T(),s,e.name,n.ignoreUnknownFields),!1===r)continue;break;case"scalar":r=this.scalar(s,e.V.T,e.V.L,e.name)}this.assert(void 0!==r,e.name+" map value",s);let o=i;e.K==w.BOOL&&(o="true"==o||"false"!=o&&o),o=this.scalar(o,e.K,S.STRING,e.name).toString(),t[o]=r}}else if(e.repeat){if(null===r)continue;this.assert(Array.isArray(r),e.name,r);const t=a[o];for(const i of r){let s;switch(this.assert(null!==i,e.name,null),e.kind){case"message":s=e.T().internalJsonRead(i,n);break;case"enum":if(s=this.enum(e.T(),i,e.name,n.ignoreUnknownFields),!1===s)continue;break;case"scalar":s=this.scalar(i,e.T,e.L,e.name)}this.assert(void 0!==s,e.name,r),t.push(s)}}else switch(e.kind){case"message":if(null===r&&"google.protobuf.Value"!=e.T().typeName){this.assert(void 0===e.oneof,e.name+" (oneof member)",null);continue}a[o]=e.T().internalJsonRead(r,n,a[o]);break;case"enum":if(null===r)continue;let t=this.enum(e.T(),r,e.name,n.ignoreUnknownFields);if(!1===t)continue;a[o]=t;break;case"scalar":if(null===r)continue;a[o]=this.scalar(r,e.T,e.L,e.name)}}}enum(e,t,n,i){if("google.protobuf.NullValue"==e[0]&&z(null===t||"NULL_VALUE"===t,`Unable to parse field ${this.info.typeName}#${n}, enum ${e[0]} only accepts null.`),null===t)return 0;switch(typeof t){case"number":return z(Number.isInteger(t),`Unable to parse field ${this.info.typeName}#${n}, enum can only be integral number, got ${t}.`),t;case"string":let s=t;e[2]&&t.substring(0,e[2].length)===e[2]&&(s=t.substring(e[2].length));let r=e[1][s];return(void 0!==r||!i)&&(z("number"==typeof r,`Unable to parse field ${this.info.typeName}#${n}, enum ${e[0]} has no value for "${t}".`),r)}z(!1,`Unable to parse field ${this.info.typeName}#${n}, cannot parse enum value from ${typeof t}".`)}scalar(e,t,n,i){let s;try{switch(t){case w.DOUBLE:case w.FLOAT:if(null===e)return 0;if("NaN"===e)return Number.NaN;if("Infinity"===e)return Number.POSITIVE_INFINITY;if("-Infinity"===e)return Number.NEGATIVE_INFINITY;if(""===e){s="empty string";break}if("string"==typeof e&&e.trim().length!==e.length){s="extra whitespace";break}if("string"!=typeof e&&"number"!=typeof e)break;let i=Number(e);if(Number.isNaN(i)){s="not a number";break}if(!Number.isFinite(i)){s="too large or small";break}return t==w.FLOAT&&Q(i),i;case w.INT32:case w.FIXED32:case w.SFIXED32:case w.SINT32:case w.UINT32:if(null===e)return 0;let r;if("number"==typeof e?r=e:""===e?s="empty string":"string"==typeof e&&(e.trim().length!==e.length?s="extra whitespace":r=Number(e)),void 0===r)break;return t==w.UINT32?K(r):q(r),r;case w.INT64:case w.SFIXED64:case w.SINT64:if(null===e)return G(j.ZERO,n);if("number"!=typeof e&&"string"!=typeof e)break;return G(j.from(e),n);case w.FIXED64:case w.UINT64:if(null===e)return G(H.ZERO,n);if("number"!=typeof e&&"string"!=typeof e)break;return G(H.from(e),n);case w.BOOL:if(null===e)return!1;if("boolean"!=typeof e)break;return e;case w.STRING:if(null===e)return"";if("string"!=typeof e){s="extra whitespace";break}try{encodeURIComponent(e)}catch(s){s="invalid UTF8";break}return e;case w.BYTES:if(null===e||""===e)return new Uint8Array(0);if("string"!=typeof e)break;return function(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let n,i=new Uint8Array(t),s=0,r=0,o=0;for(let t=0;t<e.length;t++){if(n=I[e.charCodeAt(t)],void 0===n)switch(e[t]){case"=":r=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=n,r=1;break;case 1:i[s++]=o<<2|(48&n)>>4,o=n,r=2;break;case 2:i[s++]=(15&o)<<4|(60&n)>>2,o=n,r=3;break;case 3:i[s++]=(3&o)<<6|n,r=0}}if(1==r)throw Error("invalid base64 string.");return i.subarray(0,s)}(e)}}catch(e){s=e.message}this.assert(!1,i+(s?" - "+s:""),e)}}class X{constructor(e){var t;this.fields=null!==(t=e.fields)&&void 0!==t?t:[]}write(e,t){const n={},i=e;for(const e of this.fields){if(!e.oneof){let s=this.field(e,i[e.localName],t);void 0!==s&&(n[t.useProtoFieldName?e.name:e.jsonName]=s);continue}const s=i[e.oneof];if(s.oneofKind!==e.localName)continue;const r="scalar"==e.kind||"enum"==e.kind?Object.assign(Object.assign({},t),{emitDefaultValues:!0}):t;let o=this.field(e,s[e.localName],r);z(void 0!==o),n[t.useProtoFieldName?e.name:e.jsonName]=o}return n}field(e,t,n){let i;if("map"==e.kind){z("object"==typeof t&&null!==t);const s={};switch(e.V.kind){case"scalar":for(const[n,i]of Object.entries(t)){const t=this.scalar(e.V.T,i,e.name,!1,!0);z(void 0!==t),s[n.toString()]=t}break;case"message":const i=e.V.T();for(const[r,o]of Object.entries(t)){const t=this.message(i,o,e.name,n);z(void 0!==t),s[r.toString()]=t}break;case"enum":const r=e.V.T();for(const[i,o]of Object.entries(t)){z(void 0===o||"number"==typeof o);const t=this.enum(r,o,e.name,!1,!0,n.enumAsInteger);z(void 0!==t),s[i.toString()]=t}}(n.emitDefaultValues||Object.keys(s).length>0)&&(i=s)}else if(e.repeat){z(Array.isArray(t));const s=[];switch(e.kind){case"scalar":for(let n=0;n<t.length;n++){const i=this.scalar(e.T,t[n],e.name,e.opt,!0);z(void 0!==i),s.push(i)}break;case"enum":const i=e.T();for(let r=0;r<t.length;r++){z(void 0===t[r]||"number"==typeof t[r]);const o=this.enum(i,t[r],e.name,e.opt,!0,n.enumAsInteger);z(void 0!==o),s.push(o)}break;case"message":const r=e.T();for(let i=0;i<t.length;i++){const o=this.message(r,t[i],e.name,n);z(void 0!==o),s.push(o)}}(n.emitDefaultValues||s.length>0||n.emitDefaultValues)&&(i=s)}else switch(e.kind){case"scalar":i=this.scalar(e.T,t,e.name,e.opt,n.emitDefaultValues);break;case"enum":i=this.enum(e.T(),t,e.name,e.opt,n.emitDefaultValues,n.enumAsInteger);break;case"message":i=this.message(e.T(),t,e.name,n)}return i}enum(e,t,n,i,s,r){if("google.protobuf.NullValue"==e[0])return s||i?null:void 0;if(void 0!==t){if(0!==t||s||i)return z("number"==typeof t),z(Number.isInteger(t)),r||!e[1].hasOwnProperty(t)?t:e[2]?e[2]+e[1][t]:e[1][t]}else z(i)}message(e,t,n,i){return void 0===t?i.emitDefaultValues?null:void 0:e.internalJsonWrite(t,i)}scalar(e,t,n,i,s){if(void 0===t)return void z(i);const r=s||i;switch(e){case w.INT32:case w.SFIXED32:case w.SINT32:return 0===t?r?0:void 0:(q(t),t);case w.FIXED32:case w.UINT32:return 0===t?r?0:void 0:(K(t),t);case w.FLOAT:Q(t);case w.DOUBLE:return 0===t?r?0:void 0:(z("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t);case w.STRING:return""===t?r?"":void 0:(z("string"==typeof t),t);case w.BOOL:return!1===t?!r&&void 0:(z("boolean"==typeof t),t);case w.UINT64:case w.FIXED64:z("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let e=H.from(t);if(e.isZero()&&!r)return;return e.toString();case w.INT64:case w.SFIXED64:case w.SINT64:z("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let n=j.from(t);if(n.isZero()&&!r)return;return n.toString();case w.BYTES:return z(t instanceof Uint8Array),t.byteLength?function(e){let t,n="",i=0,s=0;for(let r=0;r<e.length;r++)switch(t=e[r],i){case 0:n+=k[t>>2],s=(3&t)<<4,i=1;break;case 1:n+=k[s|t>>4],s=(15&t)<<2,i=2;break;case 2:n+=k[s|t>>6],n+=k[63&t],i=0}return i&&(n+=k[s],n+="=",1==i&&(n+="=")),n}(t):r?"":void 0}}}function J(e,t=S.STRING){switch(e){case w.BOOL:return!1;case w.UINT64:case w.FIXED64:return G(H.ZERO,t);case w.INT64:case w.SFIXED64:case w.SINT64:return G(j.ZERO,t);case w.DOUBLE:case w.FLOAT:return 0;case w.BYTES:return new Uint8Array(0);case w.STRING:return"";default:return 0}}class Z{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){const t=null!==(e=this.info.fields)&&void 0!==e?e:[];this.fieldNoToField=new Map(t.map(e=>[e.no,e]))}}read(e,t,n,i){this.prepare();const s=void 0===i?e.len:e.pos+i;for(;e.pos<s;){const[i,s]=e.tag(),r=this.fieldNoToField.get(i);if(!r){let r=n.readUnknownField;if("throw"==r)throw new Error(`Unknown field ${i} (wire type ${s}) for ${this.info.typeName}`);let o=e.skip(s);!1!==r&&(!0===r?p.onRead:r)(this.info.typeName,t,i,s,o);continue}let o=t,a=r.repeat,l=r.localName;switch(r.oneof&&(o=o[r.oneof],o.oneofKind!==l&&(o=t[r.oneof]={oneofKind:l})),r.kind){case"scalar":case"enum":let t="enum"==r.kind?w.INT32:r.T,i="scalar"==r.kind?r.L:void 0;if(a){let n=o[l];if(s==g.LengthDelimited&&t!=w.STRING&&t!=w.BYTES){let s=e.uint32()+e.pos;for(;e.pos<s;)n.push(this.scalar(e,t,i))}else n.push(this.scalar(e,t,i))}else o[l]=this.scalar(e,t,i);break;case"message":if(a){let t=o[l],i=r.T().internalBinaryRead(e,e.uint32(),n);t.push(i)}else o[l]=r.T().internalBinaryRead(e,e.uint32(),n,o[l]);break;case"map":let[d,c]=this.mapEntry(r,e,n);o[l][d]=c}}}mapEntry(e,t,n){let i,s,r=t.uint32(),o=t.pos+r;for(;t.pos<o;){let[r,o]=t.tag();switch(r){case 1:i=e.K==w.BOOL?t.bool().toString():this.scalar(t,e.K,S.STRING);break;case 2:switch(e.V.kind){case"scalar":s=this.scalar(t,e.V.T,e.V.L);break;case"enum":s=t.int32();break;case"message":s=e.V.T().internalBinaryRead(t,t.uint32(),n)}break;default:throw new Error(`Unknown field ${r} (wire type ${o}) in map entry for ${this.info.typeName}#${e.name}`)}}if(void 0===i){let t=J(e.K);i=e.K==w.BOOL?t.toString():t}if(void 0===s)switch(e.V.kind){case"scalar":s=J(e.V.T,e.V.L);break;case"enum":s=0;break;case"message":s=e.V.T().create()}return[i,s]}scalar(e,t,n){switch(t){case w.INT32:return e.int32();case w.STRING:return e.string();case w.BOOL:return e.bool();case w.DOUBLE:return e.double();case w.FLOAT:return e.float();case w.INT64:return G(e.int64(),n);case w.UINT64:return G(e.uint64(),n);case w.FIXED64:return G(e.fixed64(),n);case w.FIXED32:return e.fixed32();case w.BYTES:return e.bytes();case w.UINT32:return e.uint32();case w.SFIXED32:return e.sfixed32();case w.SFIXED64:return G(e.sfixed64(),n);case w.SINT32:return e.sint32();case w.SINT64:return G(e.sint64(),n)}}}class Y{constructor(e){this.info=e}prepare(){if(!this.fields){const e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort((e,t)=>e.no-t.no)}}write(e,t,n){this.prepare();for(const i of this.fields){let s,r,o=i.repeat,a=i.localName;if(i.oneof){const t=e[i.oneof];if(t.oneofKind!==a)continue;s=t[a],r=!0}else s=e[a],r=!1;switch(i.kind){case"scalar":case"enum":let e="enum"==i.kind?w.INT32:i.T;if(o)if(z(Array.isArray(s)),o==b.PACKED)this.packed(t,e,i.no,s);else for(const n of s)this.scalar(t,e,i.no,n,!0);else void 0===s?z(i.opt):this.scalar(t,e,i.no,s,r||i.opt);break;case"message":if(o){z(Array.isArray(s));for(const e of s)this.message(t,n,i.T(),i.no,e)}else this.message(t,n,i.T(),i.no,s);break;case"map":z("object"==typeof s&&null!==s);for(const[e,r]of Object.entries(s))this.mapEntry(t,n,i,e,r)}}let i=n.writeUnknownFields;!1!==i&&(!0===i?p.onWrite:i)(this.info.typeName,e,t)}mapEntry(e,t,n,i,s){e.tag(n.no,g.LengthDelimited),e.fork();let r=i;switch(n.K){case w.INT32:case w.FIXED32:case w.UINT32:case w.SFIXED32:case w.SINT32:r=Number.parseInt(i);break;case w.BOOL:z("true"==i||"false"==i),r="true"==i}switch(this.scalar(e,n.K,1,r,!0),n.V.kind){case"scalar":this.scalar(e,n.V.T,2,s,!0);break;case"enum":this.scalar(e,w.INT32,2,s,!0);break;case"message":this.message(e,t,n.V.T(),2,s)}e.join()}message(e,t,n,i,s){void 0!==s&&(n.internalBinaryWrite(s,e.tag(i,g.LengthDelimited).fork(),t),e.join())}scalar(e,t,n,i,s){let[r,o,a]=this.scalarInfo(t,i);a&&!s||(e.tag(n,r),e[o](i))}packed(e,t,n,i){if(!i.length)return;z(t!==w.BYTES&&t!==w.STRING),e.tag(n,g.LengthDelimited),e.fork();let[,s]=this.scalarInfo(t);for(let t=0;t<i.length;t++)e[s](i[t]);e.join()}scalarInfo(e,t){let n,i=g.Varint,s=void 0===t,r=0===t;switch(e){case w.INT32:n="int32";break;case w.STRING:r=s||!t.length,i=g.LengthDelimited,n="string";break;case w.BOOL:r=!1===t,n="bool";break;case w.UINT32:n="uint32";break;case w.DOUBLE:i=g.Bit64,n="double";break;case w.FLOAT:i=g.Bit32,n="float";break;case w.INT64:r=s||j.from(t).isZero(),n="int64";break;case w.UINT64:r=s||H.from(t).isZero(),n="uint64";break;case w.FIXED64:r=s||H.from(t).isZero(),i=g.Bit64,n="fixed64";break;case w.BYTES:r=s||!t.byteLength,i=g.LengthDelimited,n="bytes";break;case w.FIXED32:i=g.Bit32,n="fixed32";break;case w.SFIXED32:i=g.Bit32,n="sfixed32";break;case w.SFIXED64:r=s||j.from(t).isZero(),i=g.Bit64,n="sfixed64";break;case w.SINT32:n="sint32";break;case w.SINT64:r=s||j.from(t).isZero(),n="sint64"}return[i,n,s||r]}}const ee={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},te={ignoreUnknownFields:!1},ne=Object.values;function ie(e,t,n){if(t===n)return!0;if(e!==w.BYTES)return!1;let i=t,s=n;if(i.length!==s.length)return!1;for(let e=0;e<i.length;e++)if(i[e]!=s[e])return!1;return!0}function se(e,t,n){if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(!ie(e,t[i],n[i]))return!1;return!0}function re(e,t,n){if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(!e.equals(t[i],n[i]))return!1;return!0}const oe={writeUnknownFields:!0,writerFactory:()=>new ae};class ae{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),n=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],n),n+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(K(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return q(e),F(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){Q(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){K(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){q(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return q(e),F(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=j.from(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),n=new DataView(t.buffer),i=H.from(e);return n.setInt32(0,i.lo,!0),n.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=j.from(e);return R(t.lo,t.hi,this.buf),this}sint64(e){let t=j.from(e),n=t.hi>>31;return R(t.lo<<1^n,(t.hi<<1|t.lo>>>31)^n,this.buf),this}uint64(e){let t=H.from(e);return R(t.lo,t.hi,this.buf),this}}const le={readUnknownField:!0,readerFactory:e=>new de(e)};class de{constructor(e,t){this.varint64=P,this.uint32=A,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),t=e>>>3,n=7&e;if(t<=0||n<0||n>5)throw new Error("illegal tag: field no "+t+" wire type "+n);return[t,n]}skip(e){let t=this.pos;switch(e){case g.Varint:for(;128&this.buf[this.pos++];);break;case g.Bit64:this.pos+=4;case g.Bit32:this.pos+=4;break;case g.LengthDelimited:let t=this.uint32();this.pos+=t;break;case g.StartGroup:let n;for(;(n=this.tag()[1])!==g.EndGroup;)this.skip(n);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return new j(...this.varint64())}uint64(){return new H(...this.varint64())}sint64(){let[e,t]=this.varint64(),n=-(1&e);return e=(e>>>1|(1&t)<<31)^n,t=t>>>1^n,new j(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new H(this.sfixed32(),this.sfixed32())}sfixed64(){return new j(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}const ce=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({})),he=ce[y]={};class ue{constructor(e,t,n){this.defaultCheckDepth=16,this.typeName=e,this.fields=t.map(C),this.options=null!=n?n:{},he.value=this,this.messagePrototype=Object.create(null,ce),this.refTypeCheck=new T(this),this.refJsonReader=new $(this),this.refJsonWriter=new X(this),this.refBinReader=new Z(this),this.refBinWriter=new Y(this)}create(e){let t=function(e){const t=e.messagePrototype?Object.create(e.messagePrototype):Object.defineProperty({},y,{value:e});for(let n of e.fields){let e=n.localName;if(!n.opt)if(n.oneof)t[n.oneof]={oneofKind:void 0};else if(n.repeat)t[e]=[];else switch(n.kind){case"scalar":t[e]=J(n.T,n.L);break;case"enum":t[e]=0;break;case"map":t[e]={}}}return t}(this);return void 0!==e&&f(this,t,e),t}clone(e){let t=this.create();return f(this,t,e),t}equals(e,t){return function(e,t,n){if(t===n)return!0;if(!t||!n)return!1;for(let i of e.fields){let e=i.localName,s=i.oneof?t[i.oneof][e]:t[e],r=i.oneof?n[i.oneof][e]:n[e];switch(i.kind){case"enum":case"scalar":let e="enum"==i.kind?w.INT32:i.T;if(!(i.repeat?se(e,s,r):ie(e,s,r)))return!1;break;case"map":if(!("message"==i.V.kind?re(i.V.T(),ne(s),ne(r)):se("enum"==i.V.kind?w.INT32:i.V.T,ne(s),ne(r))))return!1;break;case"message":let t=i.T();if(!(i.repeat?re(t,s,r):t.equals(s,r)))return!1}}return!0}(this,e,t)}is(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!1)}isAssignable(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!0)}mergePartial(e,t){f(this,e,t)}fromBinary(e,t){let n=function(e){return e?Object.assign(Object.assign({},le),e):le}(t);return this.internalBinaryRead(n.readerFactory(e),e.byteLength,n)}fromJson(e,t){return this.internalJsonRead(e,function(e){return e?Object.assign(Object.assign({},te),e):te}(t))}fromJsonString(e,t){let n=JSON.parse(e);return this.fromJson(n,t)}toJson(e,t){return this.internalJsonWrite(e,function(e){return e?Object.assign(Object.assign({},ee),e):ee}(t))}toJsonString(e,t){var n;let i=this.toJson(e,t);return JSON.stringify(i,null,null!==(n=null==t?void 0:t.prettySpaces)&&void 0!==n?n:0)}toBinary(e,t){let n=function(e){return e?Object.assign(Object.assign({},oe),e):oe}(t);return this.internalBinaryWrite(e,n.writerFactory(),n).finish()}internalJsonRead(e,t,n){if(null!==e&&"object"==typeof e&&!Array.isArray(e)){let i=null!=n?n:this.create();return this.refJsonReader.read(e,i,t),i}throw new Error(`Unable to parse message ${this.typeName} from JSON ${x(e)}.`)}internalJsonWrite(e,t){return this.refJsonWriter.write(e,t)}internalBinaryWrite(e,t,n){return this.refBinWriter.write(e,t,n),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create();return this.refBinReader.read(e,s,n,t),s}}const me=new class extends ue{constructor(){super("base_message",[{no:1,name:"type",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();if(1===t)s.type=e.string();else{let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},pe=new class extends ue{constructor(){super("peerConnectionOptions",[])}create(e){const t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();{let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},ge=new class extends ue{constructor(){super("config",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"peerConnectionOptions",kind:"message",T:()=>pe},{no:3,name:"protocolVersion",kind:"scalar",opt:!0,T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.peerConnectionOptions=pe.internalBinaryRead(e,e.uint32(),n,s.peerConnectionOptions);break;case 3:s.protocolVersion=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),e.peerConnectionOptions&&pe.internalBinaryWrite(e.peerConnectionOptions,t.tag(2,g.LengthDelimited).fork(),n).join(),void 0!==e.protocolVersion&&t.tag(3,g.LengthDelimited).string(e.protocolVersion);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},fe=new class extends ue{constructor(){super("identify",[{no:1,name:"type",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();if(1===t)s.type=e.string();else{let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},ye=new class extends ue{constructor(){super("endpointId",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:9},{no:3,name:"protocolVersion",kind:"scalar",opt:!0,T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.id="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.id=e.string();break;case 3:s.protocolVersion=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),""!==e.id&&t.tag(2,g.LengthDelimited).string(e.id),void 0!==e.protocolVersion&&t.tag(3,g.LengthDelimited).string(e.protocolVersion);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},ve=new class extends ue{constructor(){super("endpointIdConfirm",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"committedId",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.committedId="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.committedId=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),""!==e.committedId&&t.tag(2,g.LengthDelimited).string(e.committedId);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},we=new class extends ue{constructor(){super("streamerIdChanged",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"newID",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.newID="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.newID=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),""!==e.newID&&t.tag(2,g.LengthDelimited).string(e.newID);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Se=new class extends ue{constructor(){super("listStreamers",[{no:1,name:"type",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();if(1===t)s.type=e.string();else{let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},be=new class extends ue{constructor(){super("streamerList",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"ids",kind:"scalar",repeat:2,T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.ids=[],void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.ids.push(e.string());break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type);for(let n=0;n<e.ids.length;n++)t.tag(2,g.LengthDelimited).string(e.ids[n]);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Ce=new class extends ue{constructor(){super("subscribe",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"streamerId",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.streamerId="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.streamerId=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),""!==e.streamerId&&t.tag(2,g.LengthDelimited).string(e.streamerId);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Ee=new class extends ue{constructor(){super("unsubscribe",[{no:1,name:"type",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();if(1===t)s.type=e.string();else{let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Te=new class extends ue{constructor(){super("subscribeFailed",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"message",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.message="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.message=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),""!==e.message&&t.tag(2,g.LengthDelimited).string(e.message);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},xe=new class extends ue{constructor(){super("playerConnected",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"dataChannel",kind:"scalar",T:8},{no:3,name:"sfu",kind:"scalar",T:8},{no:5,name:"playerId",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.dataChannel=!1,t.sfu=!1,t.playerId="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.dataChannel=e.bool();break;case 3:s.sfu=e.bool();break;case 5:s.playerId=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),!1!==e.dataChannel&&t.tag(2,g.Varint).bool(e.dataChannel),!1!==e.sfu&&t.tag(3,g.Varint).bool(e.sfu),""!==e.playerId&&t.tag(5,g.LengthDelimited).string(e.playerId);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Me=new class extends ue{constructor(){super("playerDisconnected",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"playerId",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.playerId="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.playerId=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),""!==e.playerId&&t.tag(2,g.LengthDelimited).string(e.playerId);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},ke=new class extends ue{constructor(){super("offer",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"playerId",kind:"scalar",opt:!0,T:9},{no:4,name:"sfu",kind:"scalar",opt:!0,T:8},{no:5,name:"multiplex",kind:"scalar",opt:!0,T:8},{no:6,name:"scalabilityMode",kind:"scalar",opt:!0,T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.sdp="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.sdp=e.string();break;case 3:s.playerId=e.string();break;case 4:s.sfu=e.bool();break;case 5:s.multiplex=e.bool();break;case 6:s.scalabilityMode=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),""!==e.sdp&&t.tag(2,g.LengthDelimited).string(e.sdp),void 0!==e.playerId&&t.tag(3,g.LengthDelimited).string(e.playerId),void 0!==e.sfu&&t.tag(4,g.Varint).bool(e.sfu),void 0!==e.multiplex&&t.tag(5,g.Varint).bool(e.multiplex),void 0!==e.scalabilityMode&&t.tag(6,g.LengthDelimited).string(e.scalabilityMode);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Ie=new class extends ue{constructor(){super("answer",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"playerId",kind:"scalar",opt:!0,T:9},{no:4,name:"minBitrateBps",kind:"scalar",opt:!0,T:5},{no:5,name:"maxBitrateBps",kind:"scalar",opt:!0,T:5}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.sdp="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.sdp=e.string();break;case 3:s.playerId=e.string();break;case 4:s.minBitrateBps=e.int32();break;case 5:s.maxBitrateBps=e.int32();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),""!==e.sdp&&t.tag(2,g.LengthDelimited).string(e.sdp),void 0!==e.playerId&&t.tag(3,g.LengthDelimited).string(e.playerId),void 0!==e.minBitrateBps&&t.tag(4,g.Varint).int32(e.minBitrateBps),void 0!==e.maxBitrateBps&&t.tag(5,g.Varint).int32(e.maxBitrateBps);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Pe=new class extends ue{constructor(){super("iceCandidateData",[{no:1,name:"candidate",kind:"scalar",T:9},{no:2,name:"sdpMid",kind:"scalar",T:9},{no:3,name:"sdpMLineIndex",kind:"scalar",T:5},{no:4,name:"usernameFragment",kind:"scalar",opt:!0,T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.candidate="",t.sdpMid="",t.sdpMLineIndex=0,void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.candidate=e.string();break;case 2:s.sdpMid=e.string();break;case 3:s.sdpMLineIndex=e.int32();break;case 4:s.usernameFragment=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.candidate&&t.tag(1,g.LengthDelimited).string(e.candidate),""!==e.sdpMid&&t.tag(2,g.LengthDelimited).string(e.sdpMid),0!==e.sdpMLineIndex&&t.tag(3,g.Varint).int32(e.sdpMLineIndex),void 0!==e.usernameFragment&&t.tag(4,g.LengthDelimited).string(e.usernameFragment);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Re=new class extends ue{constructor(){super("iceCandidate",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"candidate",kind:"message",T:()=>Pe},{no:3,name:"playerId",kind:"scalar",opt:!0,T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.candidate=Pe.internalBinaryRead(e,e.uint32(),n,s.candidate);break;case 3:s.playerId=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),e.candidate&&Pe.internalBinaryWrite(e.candidate,t.tag(2,g.LengthDelimited).fork(),n).join(),void 0!==e.playerId&&t.tag(3,g.LengthDelimited).string(e.playerId);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Le=new class extends ue{constructor(){super("disconnectPlayer",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"playerId",kind:"scalar",T:9},{no:3,name:"reason",kind:"scalar",opt:!0,T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.playerId="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.playerId=e.string();break;case 3:s.reason=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),""!==e.playerId&&t.tag(2,g.LengthDelimited).string(e.playerId),void 0!==e.reason&&t.tag(3,g.LengthDelimited).string(e.reason);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},De=new class extends ue{constructor(){super("ping",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"time",kind:"scalar",T:5}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.time=0,void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.time=e.int32();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),0!==e.time&&t.tag(2,g.Varint).int32(e.time);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Oe=new class extends ue{constructor(){super("pong",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"time",kind:"scalar",T:5}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.time=0,void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.time=e.int32();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),0!==e.time&&t.tag(2,g.Varint).int32(e.time);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Fe=new class extends ue{constructor(){super("streamerDisconnected",[{no:1,name:"type",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();if(1===t)s.type=e.string();else{let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Ae=new class extends ue{constructor(){super("layerPreference",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"spatialLayer",kind:"scalar",T:5},{no:3,name:"temporalLayer",kind:"scalar",T:5},{no:4,name:"playerId",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.spatialLayer=0,t.temporalLayer=0,t.playerId="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.spatialLayer=e.int32();break;case 3:s.temporalLayer=e.int32();break;case 4:s.playerId=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),0!==e.spatialLayer&&t.tag(2,g.Varint).int32(e.spatialLayer),0!==e.temporalLayer&&t.tag(3,g.Varint).int32(e.temporalLayer),""!==e.playerId&&t.tag(4,g.LengthDelimited).string(e.playerId);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},_e=new class extends ue{constructor(){super("dataChannelRequest",[{no:1,name:"type",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();if(1===t)s.type=e.string();else{let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Ue=new class extends ue{constructor(){super("peerDataChannels",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"playerId",kind:"scalar",T:9},{no:3,name:"sendStreamId",kind:"scalar",T:5},{no:4,name:"recvStreamId",kind:"scalar",T:5}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.playerId="",t.sendStreamId=0,t.recvStreamId=0,void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.playerId=e.string();break;case 3:s.sendStreamId=e.int32();break;case 4:s.recvStreamId=e.int32();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),""!==e.playerId&&t.tag(2,g.LengthDelimited).string(e.playerId),0!==e.sendStreamId&&t.tag(3,g.Varint).int32(e.sendStreamId),0!==e.recvStreamId&&t.tag(4,g.Varint).int32(e.recvStreamId);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Ne=new class extends ue{constructor(){super("peerDataChannelsReady",[{no:1,name:"type",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();if(1===t)s.type=e.string();else{let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Be=new class extends ue{constructor(){super("streamerDataChannels",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sfuId",kind:"scalar",T:9},{no:3,name:"sendStreamId",kind:"scalar",T:5},{no:4,name:"recvStreamId",kind:"scalar",T:5}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.sfuId="",t.sendStreamId=0,t.recvStreamId=0,void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.sfuId=e.string();break;case 3:s.sendStreamId=e.int32();break;case 4:s.recvStreamId=e.int32();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),""!==e.sfuId&&t.tag(2,g.LengthDelimited).string(e.sfuId),0!==e.sendStreamId&&t.tag(3,g.Varint).int32(e.sendStreamId),0!==e.recvStreamId&&t.tag(4,g.Varint).int32(e.recvStreamId);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},Ve=new class extends ue{constructor(){super("startStreaming",[{no:1,name:"type",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();if(1===t)s.type=e.string();else{let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},We=new class extends ue{constructor(){super("stopStreaming",[{no:1,name:"type",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();if(1===t)s.type=e.string();else{let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},He=new class extends ue{constructor(){super("playerCount",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"count",kind:"scalar",T:5}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.count=0,void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.count=e.int32();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),0!==e.count&&t.tag(2,g.Varint).int32(e.count);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},je=new class extends ue{constructor(){super("stats",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"data",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type="",t.data="",void 0!==e&&f(this,t,e),t}internalBinaryRead(e,t,n,i){let s=null!=i?i:this.create(),r=e.pos+t;for(;e.pos<r;){let[t,i]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.data=e.string();break;default:let r=n.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${i}) for ${this.typeName}`);let o=e.skip(i);!1!==r&&(!0===r?p.onRead:r)(this.typeName,s,t,i,o)}}return s}internalBinaryWrite(e,t,n){""!==e.type&&t.tag(1,g.LengthDelimited).string(e.type),""!==e.data&&t.tag(2,g.LengthDelimited).string(e.data);let i=n.writeUnknownFields;return!1!==i&&(1==i?p.onWrite:i)(this.typeName,e,t),t}},ze={answer:Ie,config:ge,disconnectPlayer:Le,endpointId:ye,endpointIdConfirm:ve,iceCandidate:Re,identify:fe,listStreamers:Se,offer:ke,ping:De,playerConnected:xe,playerCount:He,playerDisconnected:Me,pong:Oe,stats:je,streamerDisconnected:Fe,streamerList:be,subscribe:Ce,unsubscribe:Ee,layerPreference:Ae,dataChannelRequest:_e,peerDataChannels:Ue,peerDataChannelsReady:Ne,streamerDataChannels:Be,startStreaming:Ve,stopStreaming:We};function qe(e,t){const n=e.create();return n.type=e.typeName,t&&e.mergePartial(n,t),n}function Ke(e){let t=!0;if(!e.type)return d.Error(`Parsed message has no type. Rejected. ${JSON.stringify(e)}`),null;const n=ze[e.type];if(!n)return d.Error(`Message is of an unknown type: "${e.type}". Rejected.`),null;if(n.fields)for(const i of n.fields)i.opt||Object.prototype.hasOwnProperty.call(e,i.name)||(d.Error(`Message "${e.type}"" is missing required field "${i.name}". Rejected.`),t=!1);for(const i in e)n.fields.find(e=>e.name===i)||(d.Error(`Message "${e.type}" contains unknown field "${i}". Rejected.`),t=!1);return t?n:null}class Qe{get RTT(){return this.rtt}constructor(e,t){this.alive=!1,this.rtt=0,this.protocol=e,this.timeout=t,this.onResponse=this.onHeartbeatResponse.bind(this),this.protocol.transport.on("close",this.stop.bind(this)),this.start()}start(){this.alive=!0,this.protocol.on("pong",this.onResponse),this.keepalive=setInterval(this.sendHeartbeat.bind(this),this.timeout)}stop(){clearInterval(this.keepalive),this.protocol.off("pong",this.onResponse)}sendHeartbeat(){var e;!1!==this.alive?(this.alive=!1,this.protocol.sendMessage(qe(De,{time:(new Date).getTime()}))):null===(e=this.onTimeout)||void 0===e||e.call(this)}onHeartbeatResponse(e){this.rtt=(new Date).getTime()-e.time,this.alive=!0}}class Ge{constructor(e){this.videoElementProvider=e,this.audioElement=document.createElement("Audio"),this.videoElementProvider.setAudioElement(this.audioElement)}handleOnTrack(e){if(d.Info("handleOnTrack "+JSON.stringify(e.streams)),e.streams.length<1||"probator"==e.streams[0].id)return;const t=this.videoElementProvider.getVideoElement();return e.track&&d.Info("Got track - "+e.track.kind+" id="+e.track.id+" readyState="+e.track.readyState),"audio"==e.track.kind?(void 0!==window.addToTimeRecords&&window.addToTimeRecords("handleOnTrackAudioCalledAt",window.getCurrentDate()),void this.CreateAudioTrack(e.streams[0])):"video"==e.track.kind&&t.srcObject!==e.streams[0]?(void 0!==window.addToTimeRecords&&window.addToTimeRecords("handleOnTrackVideoCalledAt",window.getCurrentDate()),t.srcObject=e.streams[0],void d.Info("Set video source from video track ontrack.")):void 0}CreateAudioTrack(e){void 0!==window.addToTimeRecords&&window.addToTimeRecords("handleOnAudioTrackCalledAt",window.getCurrentDate());const t=this.videoElementProvider.getVideoElement();t.srcObject!=e&&t.srcObject&&t.srcObject!==e&&(this.audioElement.srcObject=e,d.Info("Created new audio element to play separate audio stream."))}}class $e{constructor(e){this.freezeFrameHeight=0,this.freezeFrameWidth=0,this.rootDiv=e,this.rootElement=document.createElement("div"),this.rootElement.id="freezeFrame",this.rootElement.style.display="none",this.rootElement.style.pointerEvents="none",this.rootElement.style.position="absolute",this.rootElement.style.zIndex="20",this.imageElement=document.createElement("img"),this.imageElement.style.position="absolute",this.rootElement.appendChild(this.imageElement),this.rootDiv.appendChild(this.rootElement)}setElementForShow(){this.rootElement.style.display="block"}setElementForHide(){this.rootElement.style.display="none"}updateImageElementSource(e){const t=btoa(e.reduce((e,t)=>e+String.fromCharCode(t),""));this.imageElement.src="data:image/jpeg;base64,"+t}setDimensionsFromElementAndResize(){this.freezeFrameHeight=this.imageElement.naturalHeight,this.freezeFrameWidth=this.imageElement.naturalWidth,this.resize()}resize(){if(0!==this.freezeFrameWidth&&0!==this.freezeFrameHeight){let e=0,t=0,n=0,i=0;const s=this.rootDiv.clientWidth/this.rootDiv.clientHeight,r=this.freezeFrameWidth/this.freezeFrameHeight;s<r?(e=this.rootDiv.clientWidth,t=Math.floor(this.rootDiv.clientWidth/r),n=Math.floor(.5*(this.rootDiv.clientHeight-t)),i=0):(e=Math.floor(this.rootDiv.clientHeight*r),t=this.rootDiv.clientHeight,n=0,i=Math.floor(.5*(this.rootDiv.clientWidth-e))),this.rootElement.style.width=this.rootDiv.offsetWidth+"px",this.rootElement.style.height=this.rootDiv.offsetHeight+"px",this.rootElement.style.left="0px",this.rootElement.style.top="0px",this.imageElement.style.width=e+"px",this.imageElement.style.height=t+"px",this.imageElement.style.left=i+"px",this.imageElement.style.top=n+"px"}}}class Xe{constructor(e){this.receiving=!1,this.size=0,this.jpeg=void 0,this.valid=!1,this.freezeFrameDelay=50,this.freezeFrame=new $e(e)}showFreezeFrame(){this.valid&&this.freezeFrame.setElementForShow()}hideFreezeFrame(){this.valid=!1,this.freezeFrame.setElementForHide()}updateFreezeFrameAndShow(e,t){this.freezeFrame.updateImageElementSource(e),this.freezeFrame.imageElement.onload=()=>{this.freezeFrame.setDimensionsFromElementAndResize(),t()}}processFreezeFrameMessage(e,t){this.receiving||(this.receiving=!0,this.valid=!1,this.size=0,this.jpeg=void 0),this.size=new DataView(e.slice(1,5).buffer).getInt32(0,!0);const n=e.slice(5);if(this.jpeg){const e=new Uint8Array(this.jpeg.length+n.length);e.set(this.jpeg,0),e.set(n,this.jpeg.length),this.jpeg=e}else this.jpeg=n,this.receiving=!0,d.Info(`received first chunk of freeze frame: ${this.jpeg.length}/${this.size}`);this.jpeg.length===this.size?(this.receiving=!1,this.valid=!0,d.Info(`received complete freeze frame ${this.size}`),this.updateFreezeFrameAndShow(this.jpeg,t)):this.jpeg.length>this.size&&(d.Error(`received bigger freeze frame than advertised: ${this.jpeg.length}/${this.size}`),this.jpeg=void 0,this.receiving=!1)}}class Je{constructor(e,t,n,i,s=()=>{}){this.parseURLParams(),this.onChange=s,this.onChangeEmit=()=>{},this.id=e,this.description=n,this.label=t,this.value=i}set label(e){this._label=e,this.onChangeEmit(this._value)}get label(){return this._label}get value(){return this._value}set value(e){this._value=e,this.onChange(this._value,this),this.onChangeEmit(this._value)}updateURLParams(){if(this.useUrlParams){const e=new URLSearchParams(window.location.search),t=this.getValueAsString();let n=!1;for(const[i,s]of e)if(i.toLowerCase()==this.id.toLowerCase()){e.set(i,t),n=!0;break}n||e.set(this.id,t),window.history.replaceState({},"",""!==e.toString()?`${location.pathname}?${e}`:`${location.pathname}`)}}getValueAsString(){return""}parseURLParams(){this._urlParams={};const e=new URLSearchParams(window.location.search);for(const[t,n]of e)this._urlParams[t.toLowerCase()]=n}hasURLParam(e){return e.toLowerCase()in this._urlParams}getURLParam(e){return this.hasURLParam(e)?this._urlParams[e.toLowerCase()]:""}}class Ze extends Je{constructor(e,t,n,i,s,r=()=>{}){if(super(e,t,n,i,r),s&&this.hasURLParam(this.id)){const e=this.getURLParam(this.id);this.flag="false"!=e.toLowerCase()}else this.flag=i;this.useUrlParams=s}getValueAsString(){return this.flag?"true":"false"}enable(){this.flag=!0}get flag(){return!!this.value}set flag(e){this.value=e}}class Ye extends Je{constructor(e,t,n,i,s,r,o,a=()=>{}){if(super(e,t,n,r,a),this._min=i,this._max=s,o&&this.hasURLParam(this.id)){const e=Number.parseFloat(this.getURLParam(this.id));this.number=Number.isNaN(e)?r:e}else this.number=r;this.useUrlParams=o}getValueAsString(){return this.number.toString()}set number(e){this.value=this.clamp(e)}get number(){return this.value}clamp(e){return null==this._min&&null==this._max?e:null==this._min?Math.min(this._max,e):null==this._max?Math.max(this._min,e):Math.max(Math.min(this._max,e),this._min)}get min(){return this._min}get max(){return this._max}addOnChangedListener(e){this.onChange=e}}class et extends Je{constructor(e,t,n,i,s,r=()=>{}){super(e,t,n,i,r),s&&this.hasURLParam(this.id)?this.text=this.getURLParam(this.id):this.text=i,this.useUrlParams=s}getValueAsString(){return this.text}get text(){return this.value}set text(e){this.value=e}}class tt extends Je{constructor(e,t,n,i,s,r,o=function(e){return e},a=()=>{}){super(e,t,n,i,a),this._urlParamResolver=o;const l=this.hasURLParam(this.id)?this._urlParamResolver(this.getURLParam(this.id)):i;this.options=null!=s?s:[l],this.selected=l,this.useUrlParams=r}getValueAsString(){return this.selected}addOnChangedListener(e){this.onChange=e}get options(){return this._options}set options(e){this._options=e,this.onChangeEmit(this.selected)}get selected(){return this.value}set selected(e){void 0!==e&&(this.options.includes(e)?this.value=e:d.Error(`Could not set "${e}" as the selected option for ${this.id} because it wasn't one of the options.`))}set urlParamResolver(e){this._urlParamResolver=e}}class nt extends Event{constructor(e){super("afkWarningActivate"),this.data=e}}class it extends Event{constructor(e){super("afkWarningUpdate"),this.data=e}}class st extends Event{constructor(){super("afkWarningDeactivate")}}class rt extends Event{constructor(){super("afkTimedOut")}}class ot extends Event{constructor(e){super("videoEncoderAvgQP"),this.data=e}}class at extends Event{constructor(){super("webRtcSdp")}}class lt extends Event{constructor(e){super("webRtcSdpAnswer"),this.data=e}}class dt extends Event{constructor(e){super("webRtcSdpOffer"),this.data=e}}class ct extends Event{constructor(){super("webRtcAutoConnect")}}class ht extends Event{constructor(){super("webRtcConnecting")}}class ut extends Event{constructor(){super("webRtcConnected")}}class mt extends Event{constructor(){super("webRtcFailed")}}class pt extends Event{constructor(e){super("webRtcDisconnected"),this.data=e}}class gt extends Event{constructor(e){super("dataChannelOpen"),this.data=e,window?.handleDataChannelOpen()}}class ft extends Event{constructor(e){super("dataChannelClose"),this.data=e,window?.handleDataChannelClose()}}class yt extends Event{constructor(e){super("dataChannelError"),this.data=e}}class vt extends Event{constructor(){super("videoInitialized")}}class wt extends Event{constructor(){super("streamLoading")}}class St extends Event{constructor(){super("streamConnect")}}class bt extends Event{constructor(){super("streamDisconnect")}}class Ct extends Event{constructor(){super("streamReconnect")}}class Et extends Event{constructor(e){super("playStreamError"),this.data=e}}class Tt extends Event{constructor(){super("playStream")}}class xt extends Event{constructor(e){super("playStreamRejected"),this.data=e}}class Mt extends Event{constructor(e){super("loadFreezeFrame"),this.data=e}}class kt extends Event{constructor(){super("hideFreezeFrame")}}class It extends Event{constructor(e){super("statsReceived"),this.data=e}}class Pt extends Event{constructor(e){super("streamerListMessage"),this.data=e}}class Rt extends Event{constructor(e){super("StreamerIDChangedMessage"),this.data=e}}class Lt extends Event{constructor(e){super("latencyTestResult"),this.data=e}}class Dt extends Event{constructor(e){super("latencyCalculated"),this.data=e}}class Ot extends Event{constructor(e){super("showOnScreenKeyboard"),this.data=e}}class Ft extends Event{constructor(e){super("dataChannelLatencyTestResponse"),this.data=e}}class At extends Event{constructor(e){super("dataChannelLatencyTestResult"),this.data=e}}class _t extends Event{constructor(e){super("subscribeFailed"),this.data=e}}class Ut extends Event{constructor(e){super("initialSettings"),this.data=e}}class Nt extends Event{constructor(e){super("settingsChanged"),this.data=e}}class Bt extends Event{constructor(){super("xrSessionStarted")}}class Vt extends Event{constructor(){super("xrSessionEnded")}}class Wt extends Event{constructor(e){super("xrFrame"),this.data=e}}class Ht extends Event{constructor(e){super("playerCount"),this.data=e}}class jt extends Event{constructor(){super("webRtcTCPRelayDetected")}}class zt extends EventTarget{dispatchEvent(e){return super.dispatchEvent(e)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}}class qt{static getSupportedVideoCodecs(){const e=[];if(!RTCRtpReceiver.getCapabilities)return d.Warning("RTCRtpReceiver.getCapabilities API is not available in your browser, defaulting to guess that we support H.264."),e.push("H264 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f"),e;const t=/(VP\d|H26\d|AV1).*/,n=RTCRtpReceiver.getCapabilities("video");return n?(n.codecs.forEach(n=>{const i=n.mimeType.split("/")[1]+" "+(n.sdpFmtpLine||"");null!==t.exec(i)&&e.push(i)}),e):(e.push("H264 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f"),e)}}class Kt{}Kt.AutoConnect="AutoConnect",Kt.AutoPlayVideo="AutoPlayVideo",Kt.AFKDetection="TimeoutIfIdle",Kt.HoveringMouseMode="HoveringMouse",Kt.ForceMonoAudio="ForceMonoAudio",Kt.ForceTURN="ForceTURN",Kt.FakeMouseWithTouches="FakeMouseWithTouches",Kt.IsQualityController="ControlsQuality",Kt.MatchViewportResolution="MatchViewportRes",Kt.StartVideoMuted="StartVideoMuted",Kt.SuppressBrowserKeys="SuppressBrowserKeys",Kt.UseMic="UseMic",Kt.UseModalForTextInput="UseModalForTextInput",Kt.UseCamera="UseCamera",Kt.KeyboardInput="KeyboardInput",Kt.MouseInput="MouseInput",Kt.TouchInput="TouchInput",Kt.GamepadInput="GamepadInput",Kt.XRControllerInput="XRControllerInput",Kt.WaitForStreamer="WaitForStreamer",Kt.HideUI="HideUI",Kt.EnableCaptureTimeExt="EnableCaptureTimeExt";const Qt=e=>Object.getOwnPropertyNames(Kt).some(t=>Kt[t]===e);class Gt{}Gt.AFKTimeoutSecs="AFKTimeout",Gt.AFKCountdownSecs="AFKCountdown",Gt.MinQP="MinQP",Gt.MaxQP="MaxQP",Gt.MinQuality="MinQuality",Gt.MaxQuality="MaxQuality",Gt.CompatQualityMin="CompatQualityMin",Gt.CompatQualityMax="CompatQualityMax",Gt.WebRTCFPS="WebRTCFPS",Gt.WebRTCMinBitrate="WebRTCMinBitrate",Gt.WebRTCMaxBitrate="WebRTCMaxBitrate",Gt.MaxReconnectAttempts="MaxReconnectAttempts",Gt.StreamerAutoJoinInterval="StreamerAutoJoinInterval",Gt.KeepaliveDelay="KeepaliveDelay";const $t=e=>Object.getOwnPropertyNames(Gt).some(t=>Gt[t]===e);class Xt{}Xt.SignallingServerUrl="ss";const Jt=e=>Object.getOwnPropertyNames(Xt).some(t=>Xt[t]===e);class Zt{}Zt.PreferredCodec="PreferredCodec",Zt.StreamerId="StreamerId",Zt.PreferredQuality="PreferredQuality";const Yt=e=>Object.getOwnPropertyNames(Zt).some(t=>Zt[t]===e);class en{constructor(e={}){this.flags=new Map,this.numericParameters=new Map,this.textParameters=new Map,this.optionParameters=new Map;const{initialSettings:t,useUrlParams:n,webSocketProtocols:i}=e;this._useUrlParams=!!n,this._webSocketProtocols=i,this.populateDefaultSettings(this._useUrlParams,t)}get useUrlParams(){return this._useUrlParams}get webSocketProtocols(){return this._webSocketProtocols}populateDefaultSettings(e,t){this.textParameters.set(Xt.SignallingServerUrl,new et(Xt.SignallingServerUrl,"Signalling url","Url of the signalling server",t&&Object.prototype.hasOwnProperty.call(t,Xt.SignallingServerUrl)?t[Xt.SignallingServerUrl]:("https:"===location.protocol?"wss://":"ws://")+window.location.hostname+("80"===window.location.port||""===window.location.port?"":`:${window.location.port}`),e)),this.optionParameters.set(Zt.StreamerId,new tt(Zt.StreamerId,"Streamer ID","The ID of the streamer to stream.",t&&Object.prototype.hasOwnProperty.call(t,Zt.StreamerId)?t[Zt.StreamerId]:"",t&&Object.prototype.hasOwnProperty.call(t,Zt.StreamerId)?[t[Zt.StreamerId]]:void 0,e));const n=function(e){const t=qt.getSupportedVideoCodecs();if(t.includes(e))return e;for(const n of t)if(n.startsWith(e))return n;return e};this.optionParameters.set(Zt.PreferredCodec,new tt(Zt.PreferredCodec,"Preferred Codec","The preferred codec to be used during codec negotiation",t&&Object.prototype.hasOwnProperty.call(t,Zt.PreferredCodec)?n(t[Zt.PreferredCodec]):function(){const e=qt.getSupportedVideoCodecs();if(1==e.length)return e[0];if(e.length>0){const t=e[0];for(const t of e)if(t.startsWith("H264"))return t;return t}return d.Error("Could not find any reasonable video codec to assign as a default."),""}(),qt.getSupportedVideoCodecs(),e,n)),this.optionParameters.set(Zt.PreferredQuality,new tt(Zt.PreferredQuality,"Preferred Quality","The preferred quality of the stream (only applicable when using the SFU)",t&&Object.prototype.hasOwnProperty.call(t,Zt.PreferredQuality)?t[Zt.PreferredQuality]:"Default",["Default"],e)),this.flags.set(Kt.AutoConnect,new Ze(Kt.AutoConnect,"Auto connect to stream","Whether we should attempt to auto connect to the signalling server or show a click to start prompt.",!0,e)),this.flags.set(Kt.AutoPlayVideo,new Ze(Kt.AutoPlayVideo,"Auto play video","When video is ready automatically start playing it as opposed to showing a play button.",!0,e)),this.flags.set(Kt.UseMic,new Ze(Kt.UseMic,"Use microphone","Make browser request microphone access and open an input audio track.",!(!t||!Object.prototype.hasOwnProperty.call(t,Kt.UseMic))&&t[Kt.UseMic],e)),this.flags.set(Kt.UseModalForTextInput,new Ze(Kt.UseModalForTextInput,"Use modal for text input","When entering input into a streamed UE text widget, use an input modal.",!t||!Object.prototype.hasOwnProperty.call(t,Kt.UseModalForTextInput)||t[Kt.UseModalForTextInput],e)),this.flags.set(Kt.UseCamera,new Ze(Kt.UseCamera,"Use webcam","Make browser request webcam access and open a input video track.",!(!t||!Object.prototype.hasOwnProperty.call(t,Kt.UseCamera))&&t[Kt.UseCamera],e)),this.flags.set(Kt.StartVideoMuted,new Ze(Kt.StartVideoMuted,"Start video muted","Video will start muted if true.",!1,e)),this.flags.set(Kt.SuppressBrowserKeys,new Ze(Kt.SuppressBrowserKeys,"Suppress browser keys","Suppress certain browser keys that we use in UE, for example F5 to show shader complexity instead of refresh the page.",!t||!Object.prototype.hasOwnProperty.call(t,Kt.SuppressBrowserKeys)||t[Kt.SuppressBrowserKeys],e)),this.flags.set(Kt.IsQualityController,new Ze(Kt.IsQualityController,"Is quality controller?","True if this peer controls stream quality",!t||!Object.prototype.hasOwnProperty.call(t,Kt.IsQualityController)||t[Kt.IsQualityController],e)),this.flags.set(Kt.ForceMonoAudio,new Ze(Kt.ForceMonoAudio,"Force mono audio","Force browser to request mono audio in the SDP",!(!t||!Object.prototype.hasOwnProperty.call(t,Kt.ForceMonoAudio))&&t[Kt.ForceMonoAudio],e)),this.flags.set(Kt.ForceTURN,new Ze(Kt.ForceTURN,"Force TURN","Only generate TURN/Relayed ICE candidates.",!(!t||!Object.prototype.hasOwnProperty.call(t,Kt.ForceTURN))&&t[Kt.ForceTURN],e)),this.flags.set(Kt.AFKDetection,new Ze(Kt.AFKDetection,"AFK if idle","Timeout the experience if user is AFK for a period.",!(!t||!Object.prototype.hasOwnProperty.call(t,Kt.AFKDetection))&&t[Kt.AFKDetection],e)),this.flags.set(Kt.MatchViewportResolution,new Ze(Kt.MatchViewportResolution,"Match viewport resolution","Pixel Streaming will be instructed to dynamically resize the video stream to match the size of the video element.",!(!t||!Object.prototype.hasOwnProperty.call(t,Kt.MatchViewportResolution))&&t[Kt.MatchViewportResolution],e)),this.flags.set(Kt.HoveringMouseMode,new Ze(Kt.HoveringMouseMode,"Control Scheme: Locked Mouse","Either locked mouse, where the pointer is consumed by the video and locked to it, or hovering mouse, where the mouse is not consumed.",!0,e,(e,t)=>{t.label=`Control Scheme: ${e?"Hovering":"Locked"} Mouse`})),this.flags.set(Kt.FakeMouseWithTouches,new Ze(Kt.FakeMouseWithTouches,"Fake mouse with touches","A single finger touch is converted into a mouse event. This allows a non-touch application to be controlled partially via a touch device.",!(!t||!Object.prototype.hasOwnProperty.call(t,Kt.FakeMouseWithTouches))&&t[Kt.FakeMouseWithTouches],e)),this.flags.set(Kt.KeyboardInput,new Ze(Kt.KeyboardInput,"Keyboard input","If enabled, send keyboard events to streamer",!t||!Object.prototype.hasOwnProperty.call(t,Kt.KeyboardInput)||t[Kt.KeyboardInput],e)),this.flags.set(Kt.MouseInput,new Ze(Kt.MouseInput,"Mouse input","If enabled, send mouse events to streamer",!t||!Object.prototype.hasOwnProperty.call(t,Kt.MouseInput)||t[Kt.MouseInput],e)),this.flags.set(Kt.TouchInput,new Ze(Kt.TouchInput,"Touch input","If enabled, send touch events to streamer",!t||!Object.prototype.hasOwnProperty.call(t,Kt.TouchInput)||t[Kt.TouchInput],e)),this.flags.set(Kt.GamepadInput,new Ze(Kt.GamepadInput,"Gamepad input","If enabled, send gamepad events to streamer",!t||!Object.prototype.hasOwnProperty.call(t,Kt.GamepadInput)||t[Kt.GamepadInput],e)),this.flags.set(Kt.XRControllerInput,new Ze(Kt.XRControllerInput,"XR controller input","If enabled, send XR controller events to streamer",!t||!Object.prototype.hasOwnProperty.call(t,Kt.XRControllerInput)||t[Kt.XRControllerInput],e)),this.flags.set(Kt.WaitForStreamer,new Ze(Kt.WaitForStreamer,"Wait for streamer","Will continue trying to connect to the first streamer available.",!t||!Object.prototype.hasOwnProperty.call(t,Kt.WaitForStreamer)||t[Kt.WaitForStreamer],e)),this.flags.set(Kt.HideUI,new Ze(Kt.HideUI,"Hide the UI overlay","Will hide all UI overlay details",!(!t||!Object.prototype.hasOwnProperty.call(t,Kt.HideUI))&&t[Kt.HideUI],e)),this.flags.set(Kt.EnableCaptureTimeExt,new Ze(Kt.EnableCaptureTimeExt,"Enable abs-capture-time","Enables the abs-capture-time RTP header extension",!(!t||!Object.prototype.hasOwnProperty.call(t,Kt.EnableCaptureTimeExt))&&t[Kt.EnableCaptureTimeExt],e)),this.numericParameters.set(Gt.AFKTimeoutSecs,new Ye(Gt.AFKTimeoutSecs,"AFK timeout","The time (in seconds) it takes for the application to time out if AFK timeout is enabled.",0,600,t&&Object.prototype.hasOwnProperty.call(t,Gt.AFKTimeoutSecs)?t[Gt.AFKTimeoutSecs]:120,e)),this.numericParameters.set(Gt.AFKCountdownSecs,new Ye(Gt.AFKCountdownSecs,"AFK countdown","The time (in seconds) for a user to respond before the stream is ended after an AFK timeout.",10,null,10,e)),this.numericParameters.set(Gt.MaxReconnectAttempts,new Ye(Gt.MaxReconnectAttempts,"Max Reconnects","Maximum number of reconnects the application will attempt when a streamer disconnects.",0,999,t&&Object.prototype.hasOwnProperty.call(t,Gt.MaxReconnectAttempts)?t[Gt.MaxReconnectAttempts]:888,e)),this.numericParameters.set(Gt.MinQP,new Ye(Gt.MinQP,"Min QP","The lower bound for the quantization parameter (QP) of the encoder. 0 = Best quality, 51 = worst quality.",0,51,t&&Object.prototype.hasOwnProperty.call(t,Gt.MinQP)?t[Gt.MinQP]:0,e)),this.numericParameters.set(Gt.MaxQP,new Ye(Gt.MaxQP,"Max QP","The upper bound for the quantization parameter (QP) of the encoder. 0 = Best quality, 51 = worst quality.",0,51,t&&Object.prototype.hasOwnProperty.call(t,Gt.MaxQP)?t[Gt.MaxQP]:51,e)),this.numericParameters.set(Gt.MinQuality,new Ye(Gt.MinQuality,"Min Quality","The lower bound for the quality factor of the encoder. 0 = Worst quality, 100 = Best quality.",0,100,t&&Object.prototype.hasOwnProperty.call(t,Gt.MinQuality)?t[Gt.MinQuality]:0,e)),this.numericParameters.set(Gt.MaxQuality,new Ye(Gt.MaxQuality,"Max Quality","The upper bound for the quality factor of the encoder. 0 = Worst quality, 100 = Best quality.",0,100,t&&Object.prototype.hasOwnProperty.call(t,Gt.MaxQuality)?t[Gt.MaxQuality]:100,e)),this.numericParameters.set(Gt.CompatQualityMin,new Ye(Gt.CompatQualityMin,"Min Quality","The lower bound for encoding quality. 0 = Worst, 100 = Best.",0,100,t&&Object.prototype.hasOwnProperty.call(t,Gt.CompatQualityMin)?t[Gt.CompatQualityMin]:0,e)),this.numericParameters.set(Gt.CompatQualityMax,new Ye(Gt.CompatQualityMax,"Max Quality","The upper bound for encoding quality. 0 = Worst, 100 = Best.",0,100,t&&Object.prototype.hasOwnProperty.call(t,Gt.CompatQualityMax)?t[Gt.CompatQualityMax]:100,e)),this.numericParameters.set(Gt.WebRTCFPS,new Ye(Gt.WebRTCFPS,"Max FPS","The maximum FPS that WebRTC will try to transmit frames at.",1,999,t&&Object.prototype.hasOwnProperty.call(t,Gt.WebRTCFPS)?t[Gt.WebRTCFPS]:60,e)),this.numericParameters.set(Gt.WebRTCMinBitrate,new Ye(Gt.WebRTCMinBitrate,"Min Bitrate (kbps)","The minimum bitrate that WebRTC should use.",0,5e5,t&&Object.prototype.hasOwnProperty.call(t,Gt.WebRTCMinBitrate)?t[Gt.WebRTCMinBitrate]:0,e)),this.numericParameters.set(Gt.WebRTCMaxBitrate,new Ye(Gt.WebRTCMaxBitrate,"Max Bitrate (kbps)","The maximum bitrate that WebRTC should use.",0,5e5,t&&Object.prototype.hasOwnProperty.call(t,Gt.WebRTCMaxBitrate)?t[Gt.WebRTCMaxBitrate]:0,e)),this.numericParameters.set(Gt.StreamerAutoJoinInterval,new Ye(Gt.StreamerAutoJoinInterval,"Streamer Auto Join Interval (ms)","Delay between retries when waiting for an available streamer.",500,9e5,t&&Object.prototype.hasOwnProperty.call(t,Gt.StreamerAutoJoinInterval)?t[Gt.StreamerAutoJoinInterval]:3e3,e)),this.numericParameters.set(Gt.KeepaliveDelay,new Ye(Gt.KeepaliveDelay,"Connection Keepalive delay","Delay between keepalive pings to the signalling server.",0,9e5,t&&Object.prototype.hasOwnProperty.call(t,Gt.KeepaliveDelay)?t[Gt.KeepaliveDelay]:3e4,e))}_addOnNumericSettingChangedListener(e,t){this.numericParameters.has(e)&&this.numericParameters.get(e).addOnChangedListener(t)}_addOnOptionSettingChangedListener(e,t){this.optionParameters.has(e)&&this.optionParameters.get(e).addOnChangedListener(t)}getNumericSettingValue(e){if(this.numericParameters.has(e))return this.numericParameters.get(e).number;throw new Error(`There is no numeric setting with the id of ${e}`)}getTextSettingValue(e){if(this.textParameters.has(e))return this.textParameters.get(e).value;throw new Error(`There is no numeric setting with the id of ${e}`)}setNumericSetting(e,t){if(!this.numericParameters.has(e))throw new Error(`There is no numeric setting with the id of ${e}`);this.numericParameters.get(e).number=t}_addOnSettingChangedListener(e,t){this.flags.has(e)&&(this.flags.get(e).onChange=t)}_addOnTextSettingChangedListener(e,t){this.textParameters.has(e)&&(this.textParameters.get(e).onChange=t)}getSettingOption(e){return this.optionParameters.get(e)}isFlagEnabled(e){return this.flags.get(e).flag}setFlagEnabled(e,t){this.flags.has(e)?this.flags.get(e).flag=t:d.Warning(`Cannot toggle flag called ${e} - it does not exist in the Config.flags map.`)}setTextSetting(e,t){this.textParameters.has(e)?this.textParameters.get(e).text=t:d.Warning(`Cannot set text setting called ${e} - it does not exist in the Config.textParameters map.`)}setOptionSettingOptions(e,t){this.optionParameters.has(e)?this.optionParameters.get(e).options=t:d.Warning(`Cannot set text setting called ${e} - it does not exist in the Config.optionParameters map.`)}setOptionSettingValue(e,t){if(this.optionParameters.has(e)){const n=this.optionParameters.get(e),i=n.options;i.includes(t)||(i.push(t),n.options=i),n.selected=t}else d.Warning(`Cannot set text setting called ${e} - it does not exist in the Config.enumParameters map.`)}setFlagLabel(e,t){this.flags.has(e)?this.flags.get(e).label=t:d.Warning(`Cannot set label for flag called ${e} - it does not exist in the Config.flags map.`)}setSettings(e){for(const t of Object.keys(e))Qt(t)?this.setFlagEnabled(t,e[t]):$t(t)?this.setNumericSetting(t,e[t]):Jt(t)?this.setTextSetting(t,e[t]):Yt(t)&&this.setOptionSettingValue(t,e[t])}getSettings(){const e={};for(const[t,n]of this.flags.entries())e[t]=n.flag;for(const[t,n]of this.numericParameters.entries())e[t]=n.number;for(const[t,n]of this.textParameters.entries())e[t]=n.text;for(const[t,n]of this.optionParameters.entries())e[t]=n.selected;return e}getFlags(){return Array.from(this.flags.values())}getTextSettings(){return Array.from(this.textParameters.values())}getNumericSettings(){return Array.from(this.numericParameters.values())}getOptionSettings(){return Array.from(this.optionParameters.values())}_registerOnChangeEvents(e){for(const t of this.flags.keys()){const n=this.flags.get(t);n&&(n.onChangeEmit=t=>e.dispatchEvent(new Nt({id:n.id,type:"flag",value:t,target:n})))}for(const t of this.numericParameters.keys()){const n=this.numericParameters.get(t);n&&(n.onChangeEmit=t=>e.dispatchEvent(new Nt({id:n.id,type:"number",value:t,target:n})))}for(const t of this.textParameters.keys()){const n=this.textParameters.get(t);n&&(n.onChangeEmit=t=>e.dispatchEvent(new Nt({id:n.id,type:"text",value:t,target:n})))}for(const t of this.optionParameters.keys()){const n=this.optionParameters.get(t);n&&(n.onChangeEmit=t=>e.dispatchEvent(new Nt({id:n.id,type:"option",value:t,target:n})))}}}var tn;!function(e){e[e.LockedMouse=0]="LockedMouse",e[e.HoveringMouse=1]="HoveringMouse"}(tn||(tn={}));class nn{constructor(e,t,n){this.active=!1,this.countdownActive=!1,this.warnTimer=void 0,this.countDown=0,this.countDownTimer=void 0,this.config=e,this.pixelStreaming=t,this.onDismissAfk=n,this.onAFKTimedOutCallback=()=>{console.log("AFK timed out, did you want to override this callback?")}}onAfkClick(){clearInterval(this.countDownTimer),(this.active||this.countdownActive)&&(this.startAfkWarningTimer(),this.pixelStreaming.dispatchEvent(new st))}startAfkWarningTimer(){this.config.getNumericSettingValue(Gt.AFKTimeoutSecs)>0&&this.config.isFlagEnabled(Kt.AFKDetection)?this.active=!0:this.active=!1,this.resetAfkWarningTimer()}stopAfkWarningTimer(){this.active=!1,this.countdownActive=!1,clearTimeout(this.warnTimer),clearInterval(this.countDownTimer)}pauseAfkWarningTimer(){this.active=!1}resetAfkWarningTimer(){this.active&&this.config.isFlagEnabled(Kt.AFKDetection)&&(clearTimeout(this.warnTimer),this.warnTimer=setTimeout(()=>this.activateAfkEvent(),1e3*this.config.getNumericSettingValue(Gt.AFKTimeoutSecs)))}activateAfkEvent(){this.pauseAfkWarningTimer(),this.pixelStreaming.dispatchEvent(new nt({countDown:this.countDown,dismissAfk:this.onDismissAfk})),this.countDown=this.config.getNumericSettingValue(Gt.AFKCountdownSecs),this.countdownActive=!0,this.pixelStreaming.dispatchEvent(new it({countDown:this.countDown})),this.config.isFlagEnabled(Kt.HoveringMouseMode)||document.exitPointerLock&&document.exitPointerLock(),this.countDownTimer=setInterval(()=>{this.countDown--,0==this.countDown?(this.pixelStreaming.dispatchEvent(new rt),this.onAFKTimedOutCallback(),d.Info("You have been disconnected due to inactivity"),this.stopAfkWarningTimer()):this.pixelStreaming.dispatchEvent(new it({countDown:this.countDown}))},1e3)}}class sn{constructor(){this.isReceivingFreezeFrame=!1}getDataChannelInstance(){return this}createDataChannel(e,t,n){this.peerConnection=e,this.label=t,this.datachannelOptions=n,null==n&&(this.datachannelOptions={},this.datachannelOptions.ordered=!0),void 0!==window.addToTimeRecords&&window.addToTimeRecords("createDataChannelCalledAt",window.getCurrentDate()),this.dataChannel=this.peerConnection.createDataChannel(this.label,this.datachannelOptions),this.setupDataChannel()}setupDataChannel(){this.dataChannel.binaryType="arraybuffer",this.dataChannel.onopen=e=>this.handleOnOpen(e),this.dataChannel.onclose=e=>this.handleOnClose(e),this.dataChannel.onmessage=e=>this.handleOnMessage(e),this.dataChannel.onerror=e=>this.handleOnError(e)}handleOnOpen(e){var t;d.Info(`Data Channel (${this.label}) opened.`),this.onOpen(null===(t=this.dataChannel)||void 0===t?void 0:t.label,e)}handleOnClose(e){var t;d.Info(`Data Channel (${this.label}) closed.`),this.onClose(null===(t=this.dataChannel)||void 0===t?void 0:t.label,e)}handleOnMessage(e){d.Info(`Data Channel (${this.label}) message: ${e}`)}handleOnError(e){var t;d.Info(`Data Channel (${this.label}) error: ${e}`),this.onError(null===(t=this.dataChannel)||void 0===t?void 0:t.label,e)}onOpen(e,t){}onClose(e,t){}onError(e,t){}}class rn{}class on{}class an{}class ln{}class dn{}class cn{}class hn{}class un{}class mn{constructor(){this.inboundVideoStats=new on,this.inboundAudioStats=new rn,this.datachannelStats=new an,this.outboundVideoStats=new dn,this.outboundAudioStats=new dn,this.remoteOutboundAudioStats=new cn,this.remoteOutboundVideoStats=new cn,this.sessionStats=new hn,this.streamStats=new un,this.codecs=new Map}processStats(e){this.localCandidates=new Array,this.remoteCandidates=new Array,this.candidatePairs=new Array,e.forEach(e=>{switch(e.type){case"candidate-pair":this.handleCandidatePair(e);break;case"certificate":case"media-source":case"media-playout":case"peer-connection":case"remote-inbound-rtp":break;case"codec":this.handleCodec(e);break;case"data-channel":this.handleDataChannel(e);break;case"inbound-rtp":this.handleInboundRTP(e);break;case"local-candidate":this.handleLocalCandidate(e);break;case"outbound-rtp":this.handleLocalOutbound(e);break;case"remote-candidate":this.handleRemoteCandidate(e);break;case"remote-outbound-rtp":this.handleRemoteOutbound(e);break;case"track":this.handleTrack(e);break;case"transport":this.handleTransport(e);break;case"stream":this.handleStream(e);break;default:d.Error("unhandled Stat Type"),d.Info(e)}})}handleStream(e){this.streamStats=e}handleCandidatePair(e){this.candidatePairs.push(e)}handleDataChannel(e){this.datachannelStats.bytesReceived=e.bytesReceived,this.datachannelStats.bytesSent=e.bytesSent,this.datachannelStats.dataChannelIdentifier=e.dataChannelIdentifier,this.datachannelStats.id=e.id,this.datachannelStats.label=e.label,this.datachannelStats.messagesReceived=e.messagesReceived,this.datachannelStats.messagesSent=e.messagesSent,this.datachannelStats.protocol=e.protocol,this.datachannelStats.state=e.state,this.datachannelStats.timestamp=e.timestamp}handleLocalCandidate(e){const t=new ln;t.label="local-candidate",t.address=e.address,t.port=e.port,t.protocol=e.protocol,t.candidateType=e.candidateType,t.id=e.id,t.relayProtocol=e.relayProtocol,t.transportId=e.transportId,this.localCandidates.push(t)}handleRemoteCandidate(e){const t=new ln;t.label="remote-candidate",t.address=e.address,t.port=e.port,t.protocol=e.protocol,t.id=e.id,t.candidateType=e.candidateType,t.relayProtocol=e.relayProtocol,t.transportId=e.transportId,this.remoteCandidates.push(t)}handleInboundRTP(e){switch(e.kind){case"video":e.bytesReceived>this.inboundVideoStats.bytesReceived&&e.timestamp>this.inboundVideoStats.timestamp&&(this.inboundVideoStats.bitrate=8*(e.bytesReceived-this.inboundVideoStats.bytesReceived)/(e.timestamp-this.inboundVideoStats.timestamp),this.inboundVideoStats.bitrate=Math.floor(this.inboundVideoStats.bitrate));for(const t in e)this.inboundVideoStats[t]=e[t];break;case"audio":e.bytesReceived>this.inboundAudioStats.bytesReceived&&e.timestamp>this.inboundAudioStats.timestamp&&(this.inboundAudioStats.bitrate=8*(e.bytesReceived-this.inboundAudioStats.bytesReceived)/(e.timestamp-this.inboundAudioStats.timestamp),this.inboundAudioStats.bitrate=Math.floor(this.inboundAudioStats.bitrate));for(const t in e)this.inboundAudioStats[t]=e[t];break;default:d.Error(`Kind should be audio or video, we got ${e.kind} - that's unsupported.`)}}handleLocalOutbound(e){const t="audio"===e.kind?this.outboundAudioStats:this.outboundVideoStats;t.active=e.active,t.codecId=e.codecId,t.bytesSent=e.bytesSent,t.frameHeight=e.frameHeight,t.frameWidth=e.frameWidth,t.framesEncoded=e.framesEncoded,t.framesPerSecond=e.framesPerSecond,t.headerBytesSent=e.headerBytesSent,t.id=e.id,t.keyFramesEncoded=e.keyFramesEncoded,t.kind=e.kind,t.mediaSourceId=e.mediaSourceId,t.mid=e.mid,t.nackCount=e.nackCount,t.packetsSent=e.packetsSent,t.qpSum=e.qpSum,t.qualityLimitationDurations=e.qualityLimitationDurations,t.qualityLimitationReason=e.qualityLimitationReason,t.remoteId=e.remoteId,t.retransmittedBytesSent=e.retransmittedBytesSent,t.rid=e.rid,t.scalabilityMode=e.scalabilityMode,t.ssrc=e.ssrc,t.targetBitrate=e.targetBitrate,t.timestamp=e.timestamp,t.totalEncodeTime=e.totalEncodeTime,t.totalEncodeBytesTarget=e.totalEncodeBytesTarget,t.totalPacketSendDelay=e.totalPacketSendDelay,t.transportId=e.transportId}handleRemoteOutbound(e){const t="audio"===e.kind?this.remoteOutboundAudioStats:this.remoteOutboundVideoStats;t.bytesSent=e.bytesSent,t.codecId=e.codecId,t.id=e.id,t.kind=e.kind,t.localId=e.localId,t.packetsSent=e.packetsSent,t.remoteTimestamp=e.remoteTimestamp,t.reportsSent=e.reportsSent,t.roundTripTimeMeasurements=e.roundTripTimeMeasurements,t.ssrc=e.ssrc,t.timestamp=e.timestamp,t.totalRoundTripTime=e.totalRoundTripTime,t.transportId=e.transportId}handleTrack(e){"track"!==e.type||"video_label"!==e.trackIdentifier&&"video"!==e.kind||(this.inboundVideoStats.framesDropped=e.framesDropped,this.inboundVideoStats.framesReceived=e.framesReceived,this.inboundVideoStats.frameHeight=e.frameHeight,this.inboundVideoStats.frameWidth=e.frameWidth)}handleTransport(e){this.transportStats=e}handleCodec(e){const t=e.id;this.codecs.set(t,e)}handleSessionStatistics(e,t,n){const i=Date.now()-e;this.sessionStats.runTime=new Date(i).toISOString().substr(11,8).toString();const s=null===t?"Not sent yet":t?"true":"false";this.sessionStats.controlsStreamInput=s,this.sessionStats.videoEncoderAvgQP=n}isNumber(e){return"number"==typeof e&&isFinite(e)}getActiveCandidatePair(){if(void 0===this.candidatePairs)return null;if(this.transportStats){const e=this.candidatePairs.find(e=>e.id===this.transportStats.selectedCandidatePairId);return void 0===e?null:e}const e=this.candidatePairs.find(e=>e.selected);return void 0===e?null:e}}var pn=n(826);class gn{static isVideoTransceiver(e){return this.canTransceiverReceiveVideo(e)||this.canTransceiverSendVideo(e)}static canTransceiverReceiveVideo(e){return!!e&&("sendrecv"===e.direction||"recvonly"===e.direction)&&e.receiver&&e.receiver.track&&"video"===e.receiver.track.kind}static canTransceiverSendVideo(e){return!!e&&("sendrecv"===e.direction||"sendonly"===e.direction)&&e.sender&&e.sender.track&&"video"===e.sender.track.kind}static isAudioTransceiver(e){return this.canTransceiverReceiveAudio(e)||this.canTransceiverSendAudio(e)}static canTransceiverReceiveAudio(e){return!!e&&("sendrecv"===e.direction||"recvonly"===e.direction)&&e.receiver&&e.receiver.track&&"audio"===e.receiver.track.kind}static canTransceiverSendAudio(e){return!!e&&("sendrecv"===e.direction||"sendonly"===e.direction)&&e.sender&&e.sender.track&&"audio"===e.sender.track.kind}}class fn{static addVideoHeaderExtensionToSdp(e,t){const n=e.split("\n").filter(e=>e.startsWith("a=extmap:")).map(e=>parseInt(e.split(" ")[0].substring(9),10)).sort((e,t)=>e-t).filter((e,t,n)=>n.indexOf(e)===t),i="a=extmap:"+(n[n.length-1]+1)+" "+t+"\r\n",s=e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n");return s.shift()+s.map(e=>e.startsWith("m=video")?e+i:e).join("")}}class yn{}class vn{}class wn{constructor(){this.latestSenderRecvClockOffset=null}calculate(e,t){const n=new Sn,i=this.getRTTMs(e);if(null!=i){n.rttMs=i;const s=this.getCaptureSource(t);if(null!=s){const t=this.calculateSenderLatency(e,s);null!==t&&(n.senderLatencyMs=t)}}return void 0!==e.inboundVideoStats.totalProcessingDelay&&void 0!==e.inboundVideoStats.framesDecoded&&(n.averageProcessingDelayMs=e.inboundVideoStats.totalProcessingDelay/e.inboundVideoStats.framesDecoded*1e3),void 0!==e.inboundVideoStats.jitterBufferDelay&&void 0!==e.inboundVideoStats.jitterBufferEmittedCount&&(n.averageJitterBufferDelayMs=e.inboundVideoStats.jitterBufferDelay/e.inboundVideoStats.jitterBufferEmittedCount*1e3),void 0!==e.inboundVideoStats.framesDecoded&&void 0!==e.inboundVideoStats.totalDecodeTime&&(n.averageDecodeLatencyMs=e.inboundVideoStats.totalDecodeTime/e.inboundVideoStats.framesDecoded*1e3),void 0!==e.inboundVideoStats.totalAssemblyTime&&void 0!==e.inboundVideoStats.framesAssembledFromMultiplePackets&&(n.averageAssemblyDelayMs=e.inboundVideoStats.totalAssemblyTime/e.inboundVideoStats.framesAssembledFromMultiplePackets*1e3),void 0!==e.inboundVideoStats.googTimingFrameInfo&&e.inboundVideoStats.googTimingFrameInfo.length>0&&(n.frameTiming=this.extractFrameTimingInfo(e.inboundVideoStats.googTimingFrameInfo)),void 0!==n.frameTiming&&void 0!==n.frameTiming.captureToSendLatencyMs&&void 0!==n.averageProcessingDelayMs&&void 0!==n.rttMs&&(n.averageE2ELatency=n.frameTiming.captureToSendLatencyMs+.5*n.rttMs+n.averageProcessingDelayMs),null!=n.senderLatencyMs&&void 0!==n.averageProcessingDelayMs&&void 0!==n.rttMs&&(n.averageE2ELatency=n.senderLatencyMs+.5*n.rttMs+n.averageProcessingDelayMs),n}extractFrameTimingInfo(e){const t=new vn,n=e.split(",");return 15===n.length&&(t.rtpTimestamp=Number.parseInt(n[0]),t.captureTimestamp=Number.parseInt(n[1]),t.encodeStartTimestamp=Number.parseInt(n[2]),t.encodeFinishTimestamp=Number.parseInt(n[3]),t.packetizerFinishTimestamp=Number.parseInt(n[4]),t.pacerExitTimestamp=Number.parseInt(n[5]),t.networkTimestamp1=Number.parseInt(n[6]),t.networkTimestamp2=Number.parseInt(n[7]),t.receiveStart=Number.parseInt(n[8]),t.receiveFinish=Number.parseInt(n[9]),t.decodeStart=Number.parseInt(n[10]),t.decodeFinish=Number.parseInt(n[11]),t.renderTime=Number.parseInt(n[12]),t.isOutlier=Number.parseInt(n[13])>0,t.isTriggeredByTimer=Number.parseInt(n[14])>0,t.encoderLatencyMs=t.encodeFinishTimestamp-t.encodeStartTimestamp,t.packetizeLatencyMs=t.packetizerFinishTimestamp-t.encodeFinishTimestamp,t.pacerLatencyMs=t.pacerExitTimestamp-t.packetizerFinishTimestamp,t.captureToSendLatencyMs=t.pacerExitTimestamp-t.captureTimestamp),t}calculateSenderLatency(e,t){const n=t.captureTimestamp+t.senderCaptureTimeOffset;let i=this.calculateSenderReceiverClockOffset(e);if(null==i){if(null==this.latestSenderRecvClockOffset)return null;i=this.latestSenderRecvClockOffset}else this.latestSenderRecvClockOffset=i;const s=n+i-22089888e5;return t.timestamp-s}getCaptureSource(e){e=e.filter(e=>"video"===e.track.kind);for(const t of e){const e=t.getSynchronizationSources().concat(t.getContributingSources());for(const t of e)if(void 0!==t.captureTimestamp&&void 0!==t.senderCaptureTimeOffset&&void 0!==t.timestamp){const e=new yn;return e.timestamp=t.timestamp,e.captureTimestamp=t.captureTimestamp,e.senderCaptureTimeOffset=t.senderCaptureTimeOffset,e}}return null}calculateSenderReceiverClockOffset(e){if(void 0===e.remoteOutboundVideoStats||void 0===e.remoteOutboundVideoStats.timestamp||void 0===e.remoteOutboundVideoStats.remoteTimestamp)return null;const t=e.remoteOutboundVideoStats.timestamp,n=e.remoteOutboundVideoStats.remoteTimestamp,i=this.getRTTMs(e);return void 0!==t&&void 0!==n&&null!==i?t-(n+.5*i):null}getRTTMs(e){const t=e.getActiveCandidatePair();return t&&void 0!==t.currentRoundTripTime?1e3*t.currentRoundTripTime:e.remoteOutboundVideoStats&&void 0!==e.remoteOutboundVideoStats.totalRoundTripTime&&void 0!==e.remoteOutboundVideoStats.roundTripTimeMeasurements&&e.remoteOutboundVideoStats.roundTripTimeMeasurements>0?e.remoteOutboundVideoStats.totalRoundTripTime/e.remoteOutboundVideoStats.roundTripTimeMeasurements*1e3:e.remoteOutboundAudioStats&&void 0!==e.remoteOutboundAudioStats.totalRoundTripTime&&void 0!==e.remoteOutboundAudioStats.roundTripTimeMeasurements&&e.remoteOutboundAudioStats.roundTripTimeMeasurements>0?e.remoteOutboundAudioStats.totalRoundTripTime/e.remoteOutboundAudioStats.roundTripTimeMeasurements*1e3:null}}class Sn{constructor(){this.senderLatencyMs=void 0,this.senderLatencyAbsCaptureTimeMs=void 0,this.rttMs=void 0,this.averageProcessingDelayMs=void 0,this.averageJitterBufferDelayMs=void 0,this.averageDecodeLatencyMs=void 0,this.averageAssemblyDelayMs=void 0,this.averageE2ELatency=void 0,this.frameTiming=void 0}}var bn=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}l((i=i.apply(e,t||[])).next())})};class Cn{constructor(e,t,n){this.config=t,this.createPeerConnection(e,n),this.latencyCalculator=new wn}createPeerConnection(e,t){this.config.isFlagEnabled(Kt.ForceTURN)&&(e.iceTransportPolicy="relay",d.Info("Forcing TURN usage by setting ICE Transport Policy in peer connection config.")),this.peerConnection=new RTCPeerConnection(e),this.peerConnection.onsignalingstatechange=e=>this.handleSignalStateChange(e),this.peerConnection.oniceconnectionstatechange=e=>this.handleIceConnectionStateChange(e),this.peerConnection.onicegatheringstatechange=e=>this.handleIceGatheringStateChange(e),this.peerConnection.ontrack=e=>this.handleOnTrack(e),this.peerConnection.onicecandidate=e=>this.handleIceCandidate(e),this.peerConnection.ondatachannel=e=>this.handleDataChannel(e),this.aggregatedStats=new mn,this.preferredCodec=t,this.updateCodecSelection=!0}createOffer(e,t){return bn(this,void 0,void 0,function*(){d.Info("Create Offer");const n="localhost"===location.hostname||"127.0.0.1"===location.hostname,i="https:"===location.protocol;let s=t.isFlagEnabled(Kt.UseMic),r=t.isFlagEnabled(Kt.UseCamera);!s&&!r||n||i||(s=!1,r=!1,d.Error("Microphone and Webcam access in the browser will not work if you are not on HTTPS or localhost. Disabling mic and webcam access."),d.Error("For testing you can enable HTTP microphone access Chrome by visiting chrome://flags/ and enabling 'unsafely-treat-insecure-origin-as-secure'")),this.setupTransceiversAsync(s,r).finally(()=>{var t;null===(t=this.peerConnection)||void 0===t||t.createOffer(e).then(e=>{var t;this.showTextOverlayConnecting(),e.sdp=this.mungeSDP(e.sdp,s),null===(t=this.peerConnection)||void 0===t||t.setLocalDescription(e),this.onSendWebRTCOffer(e)}).catch(()=>{this.showTextOverlaySetupFailure()})})})}receiveOffer(e,t){return bn(this,void 0,void 0,function*(){var n;d.Info("Receive Offer"),void 0!==window.addToTimeRecords&&window.addToTimeRecords("receivedOfferAt",window.getCurrentDate()),this.isFirefox()&&(e.sdp=e.sdp.replace(/^a=extmap:\d+ http:\/\/www\.webrtc\.org\/experiments\/rtp-hdrext\/abs-capture-time\r\n/gm,"")),null===(n=this.peerConnection)||void 0===n||n.setRemoteDescription(e).then(()=>{this.onSetRemoteDescription(e);const n="localhost"===location.hostname||"127.0.0.1"===location.hostname,i="https:"===location.protocol;let s=t.isFlagEnabled(Kt.UseMic),r=t.isFlagEnabled(Kt.UseCamera);!s&&!r||n||i||(s=!1,r=!1,d.Error("Microphone and Webcam access in the browser will not work if you are not on HTTPS or localhost. Disabling mic and webcam access."),d.Error("For testing you can enable HTTP microphone access Chrome by visiting chrome://flags/ and enabling 'unsafely-treat-insecure-origin-as-secure'")),this.config.setOptionSettingOptions(Zt.PreferredCodec,this.fuzzyIntersectUEAndBrowserCodecs(e)),this.setupTransceiversAsync(s,r).finally(()=>{var e;null===(e=this.peerConnection)||void 0===e||e.createAnswer().then(e=>{var t;return e.sdp=this.mungeSDP(e.sdp,s),null===(t=this.peerConnection)||void 0===t?void 0:t.setLocalDescription(e)}).then(()=>{var e;this.onSetLocalDescription(null===(e=this.peerConnection)||void 0===e?void 0:e.currentLocalDescription)}).catch(e=>{d.Error(`createAnswer() failed - ${e}`)})})})})}receiveAnswer(e){var t;null===(t=this.peerConnection)||void 0===t||t.setRemoteDescription(e),this.config.setOptionSettingOptions(Zt.PreferredCodec,this.fuzzyIntersectUEAndBrowserCodecs(e))}generateStats(){this.peerConnection.getStats().then(e=>{this.aggregatedStats.processStats(e),this.onVideoStats(this.aggregatedStats);const t=this.latencyCalculator.calculate(this.aggregatedStats,this.peerConnection.getReceivers());if(this.onLatencyCalculated(t),this.updateCodecSelection&&this.aggregatedStats.inboundVideoStats.codecId){const e=this.aggregatedStats.codecs.get(this.aggregatedStats.inboundVideoStats.codecId);if(void 0===e)return;const t=e.mimeType.replace("video/","");let n=t;e.sdpFmtpLine&&""!==e.sdpFmtpLine.trim()&&(n=`${t} ${e.sdpFmtpLine.trim()}`);const i=this.config.getSettingOption(Zt.PreferredCodec).options;if(i.includes(n))return void this.config.setOptionSettingValue(Zt.PreferredCodec,n);const s=i.filter(e=>-1!==e.indexOf(t));if(s.length>0)return void this.config.setOptionSettingValue(Zt.PreferredCodec,s[0])}})}close(){this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null)}mungeSDP(e,t){let n=e.replace(/(a=fmtp:\d+ .*level-asymmetry-allowed=.*)\r\n/gm,"$1;x-google-start-bitrate=10000;x-google-max-bitrate=100000\r\n"),i="maxaveragebitrate=510000;";return t&&(i+="sprop-maxcapturerate=48000;"),i+=this.config.isFlagEnabled(Kt.ForceMonoAudio)?"stereo=0;":"stereo=1;",i+="useinbandfec=1",n=n.replace("useinbandfec=1",i),this.config.isFlagEnabled(Kt.EnableCaptureTimeExt)&&!this.isFirefox()&&(n=fn.addVideoHeaderExtensionToSdp(n,"http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time")),n}isFirefox(){return navigator.userAgent.indexOf("Firefox")>0}handleOnIce(e){var t;d.Info("peerconnection handleOnIce"),this.config.isFlagEnabled(Kt.ForceTURN)&&e.candidate.indexOf("relay")<0?d.Info(`Dropping candidate because it was not TURN relay. | Type= ${e.type} | Protocol= ${e.protocol} | Address=${e.address} | Port=${e.port} |`):null===(t=this.peerConnection)||void 0===t||t.addIceCandidate(e)}handleSignalStateChange(e){d.Info("signaling state change: "+e)}handleIceConnectionStateChange(e){d.Info("ice connection state change: "+e),this.onIceConnectionStateChange(e)}handleIceGatheringStateChange(e){d.Info("ice gathering state change: "+JSON.stringify(e))}handleOnTrack(e){e.streams.length<1||"probator"==e.streams[0].id||("video"==e.track.kind&&(this.videoTrack=e.track),"audio"==e.track.kind&&(this.audioTrack=e.track),this.onTrack(e))}handleIceCandidate(e){this.onPeerIceCandidate(e)}handleDataChannel(e){this.onDataChannel(e)}onTrack(e){}onIceConnectionStateChange(e){}onPeerIceCandidate(e){}onDataChannel(e){}fuzzyIntersectUEAndBrowserCodecs(e){const t=new Array,n=this.parseAvailableCodecs(e),i=this.config.getSettingOption(Zt.PreferredCodec).options;for(const e of n)if(i.includes(e))t.push(e);else{const n=e.split(" ")[0];for(const e of i)if(e.includes(n)){t.push(e);break}}return t}setupTransceiversAsync(e,t){return bn(this,void 0,void 0,function*(){var n,i,s,r,o,a,l,d;let c=!1;for(const e of null!==(i=null===(n=this.peerConnection)||void 0===n?void 0:n.getTransceivers())&&void 0!==i?i:[])if(e&&e.receiver&&e.receiver.track&&"video"===e.receiver.track.kind){c=!0;break}if(t?yield this.setupVideoSender(c):c||null===(s=this.peerConnection)||void 0===s||s.addTransceiver("video",{direction:"recvonly"}),RTCRtpReceiver.getCapabilities&&""!=this.preferredCodec)for(const e of null!==(o=null===(r=this.peerConnection)||void 0===r?void 0:r.getTransceivers())&&void 0!==o?o:[])if(e&&e.receiver&&e.receiver.track&&"video"===e.receiver.track.kind&&e.setCodecPreferences){const t=this.preferredCodec.split(" "),n={mimeType:"video/"+t[0],clockRate:9e4,sdpFmtpLine:t[1]?t[1]:""},i=[n];RTCRtpReceiver.getCapabilities("video").codecs.forEach(e=>{(e.mimeType!=n.mimeType||(null==e?void 0:e.sdpFmtpLine)!=(null==n?void 0:n.sdpFmtpLine))&&i.push(e)});for(const e of i)void 0!==(null==e?void 0:e.sdpFmtpLine)&&""!==e.sdpFmtpLine||delete e.sdpFmtpLine;e.setCodecPreferences(i)}let h=!1;for(const e of null!==(l=null===(a=this.peerConnection)||void 0===a?void 0:a.getTransceivers())&&void 0!==l?l:[])if(e&&e.receiver&&e.receiver.track&&"audio"===e.receiver.track.kind){h=!0;break}e?yield this.setupAudioSender(h):h||null===(d=this.peerConnection)||void 0===d||d.addTransceiver("audio",{direction:"recvonly"})})}setupVideoSender(e){return bn(this,void 0,void 0,function*(){var t,n,i,s;const r=yield navigator.mediaDevices.getUserMedia({video:!0});if(r)if(e){for(const e of null!==(n=null===(t=this.peerConnection)||void 0===t?void 0:t.getTransceivers())&&void 0!==n?n:[])if(gn.canTransceiverReceiveVideo(e))for(const t of r.getTracks())t.kind&&"video"==t.kind&&(e.sender.replaceTrack(t),e.direction="sendrecv")}else for(const e of r.getTracks())e.kind&&"video"==e.kind&&(null===(i=this.peerConnection)||void 0===i||i.addTransceiver(e,{direction:"sendrecv"}));else e||null===(s=this.peerConnection)||void 0===s||s.addTransceiver("video",{direction:"recvonly"})})}setupAudioSender(e){return bn(this,void 0,void 0,function*(){var t,n,i,s;const r=yield navigator.mediaDevices.getUserMedia({video:!1,audio:{autoGainControl:!1,channelCount:1,echoCancellation:!1,latency:0,noiseSuppression:!1,sampleRate:48e3,sampleSize:16,volume:1}});if(r)if(e){for(const e of null!==(n=null===(t=this.peerConnection)||void 0===t?void 0:t.getTransceivers())&&void 0!==n?n:[])if(gn.canTransceiverReceiveAudio(e))for(const t of r.getTracks())t.kind&&"audio"==t.kind&&(e.sender.replaceTrack(t),e.direction="sendrecv")}else for(const e of r.getTracks())e.kind&&"audio"==e.kind&&(null===(i=this.peerConnection)||void 0===i||i.addTransceiver(e,{direction:"sendrecv"}));else e||null===(s=this.peerConnection)||void 0===s||s.addTransceiver("audio",{direction:"recvonly"})})}onVideoStats(e){}onLatencyCalculated(e){}onSendWebRTCOffer(e){}onSetRemoteDescription(e){}onSetLocalDescription(e){}showTextOverlayConnecting(){}showTextOverlaySetupFailure(){}parseAvailableCodecs(e){if(!RTCRtpReceiver.getCapabilities)return["Only available on Chrome"];const t=[],n=(0,pn.splitSections)(e.sdp);return n.shift(),n.forEach(e=>{const{codecs:n}=(0,pn.parseRtpParameters)(e),i=/(VP\d|H26\d|AV1).*/;n.forEach(e=>{const n=e.name+" "+Object.keys(e.parameters||{}).map(t=>t+"="+e.parameters[t]).join(";");if(null!==i.exec(n)){"VP9"==e.name&&(e.parameters={"profile-id":"0"});const n=e.name+" "+Object.keys(e.parameters||{}).map(t=>t+"="+e.parameters[t]).join(";");t.push(n)}})}),t}}class En{constructor(){this.PixelStreamingSettings=new Tn,this.EncoderSettings=new xn,this.WebRTCSettings=new Mn}ueCompatible(){null!=this.WebRTCSettings.MaxFPS&&(this.WebRTCSettings.FPS=this.WebRTCSettings.MaxFPS)}}class Tn{}class xn{}class Mn{}class kn{constructor(){this.ReceiptTimeMs=null,this.TransmissionTimeMs=null,this.PreCaptureTimeMs=null,this.PostCaptureTimeMs=null,this.PreEncodeTimeMs=null,this.PostEncodeTimeMs=null,this.EncodeMs=null,this.CaptureToSendMs=null,this.testStartTimeMs=0,this.browserReceiptTimeMs=0,this.latencyExcludingDecode=0,this.testDuration=0,this.networkLatency=0,this.browserSendLatency=0,this.frameDisplayDeltaTimeMs=0,this.endToEndLatency=0,this.encodeLatency=0}setFrameDisplayDeltaTime(e){0==this.frameDisplayDeltaTimeMs&&(this.frameDisplayDeltaTimeMs=Math.round(e))}processFields(){null!=this.EncodeMs||null==this.PreEncodeTimeMs&&null==this.PostEncodeTimeMs||(d.Info(`Setting Encode Ms \n ${this.PostEncodeTimeMs} \n ${this.PreEncodeTimeMs}`),this.EncodeMs=this.PostEncodeTimeMs-this.PreEncodeTimeMs),null!=this.CaptureToSendMs||null==this.PreCaptureTimeMs&&null==this.PostCaptureTimeMs||(d.Info(`Setting CaptureToSendMs Ms \n ${this.PostCaptureTimeMs} \n ${this.PreCaptureTimeMs}`),this.CaptureToSendMs=this.PostCaptureTimeMs-this.PreCaptureTimeMs)}}class In{static setExtensionFromBytes(e,t){t.receiving||(t.mimetype="",t.extension="",t.receiving=!0,t.valid=!1,t.chunks=0,t.data=[],t.timestampStart=(new Date).getTime(),d.Info("Received first chunk of file"));const n=new TextDecoder("utf-16").decode(e.slice(1));d.Info(n),t.extension=n}static setMimeTypeFromBytes(e,t){t.receiving||(t.mimetype="",t.extension="",t.receiving=!0,t.valid=!1,t.chunks=0,t.data=[],t.timestampStart=(new Date).getTime(),d.Info("Received first chunk of file"));const n=new TextDecoder("utf-16").decode(e.slice(1));d.Info(n),t.mimetype=n}static setContentsFromBytes(e,t){if(!t.receiving)return;t.chunks=Math.ceil(new DataView(e.slice(1,5).buffer).getInt32(0,!0)/16379);const n=e.slice(5);if(t.data.push(n),d.Info(`Received file chunk: ${t.data.length}/${t.chunks}`),t.data.length===t.chunks){t.receiving=!1,t.valid=!0,d.Info("Received complete file");const e=(new Date).getTime()-t.timestampStart,n=Math.round(16384*t.chunks/e);d.Info(`Average transfer bitrate: ${n}kb/s over ${e/1e3} seconds`);const i=new Blob(t.data,{type:t.mimetype}),s=document.createElement("a");s.setAttribute("href",URL.createObjectURL(i)),s.setAttribute("download",`transfer.${t.extension}`),document.body.append(s),s.remove()}else t.data.length>t.chunks&&(t.receiving=!1,d.Error(`Received bigger file than advertised: ${t.data.length}/${t.chunks}`))}}class Pn{constructor(){this.mimetype="",this.extension="",this.receiving=!1,this.chunks=0,this.data=[],this.valid=!1}}class Rn{}Rn.backSpace=8,Rn.shift=16,Rn.control=17,Rn.alt=18,Rn.rightShift=253,Rn.rightControl=254,Rn.rightAlt=255;const Ln=Object.freeze({Escape:27,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,Minus:173,Equal:187,Backspace:8,Tab:9,KeyQ:81,KeyW:87,KeyE:69,KeyR:82,KeyT:84,KeyY:89,KeyU:85,KeyI:73,KeyO:79,KeyP:80,BracketLeft:219,BracketRight:221,Enter:13,ControlLeft:17,KeyA:65,KeyS:83,KeyD:68,KeyF:70,KeyG:71,KeyH:72,KeyJ:74,KeyK:75,KeyL:76,Semicolon:186,Quote:222,Backquote:192,ShiftLeft:16,Backslash:220,KeyZ:90,KeyX:88,KeyC:67,KeyV:86,KeyB:66,KeyN:78,KeyM:77,Comma:188,Period:190,Slash:191,ShiftRight:253,AltLeft:18,Space:32,CapsLock:20,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Pause:19,ScrollLock:145,NumpadDivide:111,NumpadMultiply:106,NumpadSubtract:109,NumpadAdd:107,NumpadDecimal:110,Numpad9:105,Numpad8:104,Numpad7:103,Numpad6:102,Numpad5:101,Numpad4:100,Numpad3:99,Numpad2:98,Numpad1:97,Numpad0:96,NumLock:144,ControlRight:254,AltRight:255,Home:36,End:35,ArrowUp:38,ArrowLeft:37,ArrowRight:39,ArrowDown:40,PageUp:33,PageDown:34,Insert:45,Delete:46,ContextMenu:93});class Dn{constructor(e,t,n){this.streamMessageController=e,this.config=t,this.activeKeys=n,this.onKeyDownListener=this.handleOnKeyDown.bind(this),this.onKeyUpListener=this.handleOnKeyUp.bind(this),this.onKeyPressListener=this.handleOnKeyPress.bind(this)}register(){document.addEventListener("keydown",this.onKeyDownListener),document.addEventListener("keyup",this.onKeyUpListener),document.addEventListener("keypress",this.onKeyPressListener)}unregister(){document.removeEventListener("keydown",this.onKeyDownListener),document.removeEventListener("keyup",this.onKeyUpListener),document.removeEventListener("keypress",this.onKeyPressListener)}handleOnKeyDown(e){var t;const n=this.getKeycode(e);n&&229!==n&&(null===(t=this.streamMessageController.toStreamerHandlers.get("KeyDown"))||void 0===t||t([this.getKeycode(e),e.repeat?1:0]),this.activeKeys.getActiveKeys().push(n),n===Rn.backSpace&&this.handleOnKeyPress(new KeyboardEvent("keypress",{charCode:Rn.backSpace,keyCode:Rn.backSpace})),this.config.isFlagEnabled(Kt.SuppressBrowserKeys)&&this.isKeyCodeBrowserKey(n)&&e.preventDefault())}handleOnKeyUp(e){var t;const n=this.getKeycode(e);n&&(null===(t=this.streamMessageController.toStreamerHandlers.get("KeyUp"))||void 0===t||t([n]),this.config.isFlagEnabled(Kt.SuppressBrowserKeys)&&this.isKeyCodeBrowserKey(n)&&e.preventDefault())}handleOnKeyPress(e){var t;const n=this.getKeycode(e);n&&(null===(t=this.streamMessageController.toStreamerHandlers.get("KeyPress"))||void 0===t||t([n]))}getKeycode(e){if(!("keyCode"in e)){const t=e;return t.code in Ln?Ln[t.code]:(d.Warning(`Keyboard code of ${t.code} is not supported in our mapping, ignoring this key.`),null)}return e.keyCode===Rn.shift&&"ShiftRight"===e.code?Rn.rightShift:e.keyCode===Rn.control&&"ControlRight"===e.code?Rn.rightControl:e.keyCode===Rn.alt&&"AltRight"===e.code?Rn.rightAlt:e.keyCode}isKeyCodeBrowserKey(e){return e>=112&&e<=123||9===e}}class On{}On.mainButton=0,On.auxiliaryButton=1,On.secondaryButton=2,On.fourthButton=3,On.fifthButton=4;class Fn{}Fn.primaryButton=1,Fn.secondaryButton=2,Fn.auxiliaryButton=4,Fn.fourthButton=8,Fn.fifthButton=16;class An{constructor(e,t,n,i){this.streamMessageController=e,this.coordinateConverter=n,this.videoPlayer=t,this.activeKeys=i,this.onEnterListener=this.onMouseEnter.bind(this),this.onLeaveListener=this.onMouseLeave.bind(this)}register(){this.registerMouseEnterAndLeaveEvents()}unregister(){this.unregisterMouseEnterAndLeaveEvents()}registerMouseEnterAndLeaveEvents(){const e=this.videoPlayer.getVideoParentElement();null==e||e.addEventListener("mouseenter",this.onEnterListener),null==e||e.addEventListener("mouseleave",this.onLeaveListener)}unregisterMouseEnterAndLeaveEvents(){const e=this.videoPlayer.getVideoParentElement();null==e||e.removeEventListener("mouseenter",this.onEnterListener),null==e||e.removeEventListener("mouseleave",this.onLeaveListener)}onMouseEnter(e){var t;this.videoPlayer.isVideoReady()&&(null===(t=this.streamMessageController.toStreamerHandlers.get("MouseEnter"))||void 0===t||t(),this.pressMouseButtons(e.buttons,e.x,e.y))}onMouseLeave(e){var t;this.videoPlayer.isVideoReady()&&(null===(t=this.streamMessageController.toStreamerHandlers.get("MouseLeave"))||void 0===t||t(),this.releaseMouseButtons(e.buttons,e.x,e.y))}releaseMouseButtons(e,t,n){const i=this.coordinateConverter.translateUnsigned(t,n);e&Fn.primaryButton&&this.sendMouseUp(On.mainButton,i.x,i.y),e&Fn.secondaryButton&&this.sendMouseUp(On.secondaryButton,i.x,i.y),e&Fn.auxiliaryButton&&this.sendMouseUp(On.auxiliaryButton,i.x,i.y),e&Fn.fourthButton&&this.sendMouseUp(On.fourthButton,i.x,i.y),e&Fn.fifthButton&&this.sendMouseUp(On.fifthButton,i.x,i.y)}pressMouseButtons(e,t,n){if(!this.videoPlayer.isVideoReady())return;const i=this.coordinateConverter.translateUnsigned(t,n);e&Fn.primaryButton&&this.sendMouseDown(On.mainButton,i.x,i.y),e&Fn.secondaryButton&&this.sendMouseDown(On.secondaryButton,i.x,i.y),e&Fn.auxiliaryButton&&this.sendMouseDown(On.auxiliaryButton,i.x,i.y),e&Fn.fourthButton&&this.sendMouseDown(On.fourthButton,i.x,i.y),e&Fn.fifthButton&&this.sendMouseDown(On.fifthButton,i.x,i.y)}sendMouseDown(e,t,n){var i;null===(i=this.streamMessageController.toStreamerHandlers.get("MouseDown"))||void 0===i||i([e,t,n])}sendMouseUp(e,t,n){var i;const s=this.coordinateConverter.translateUnsigned(t,n);null===(i=this.streamMessageController.toStreamerHandlers.get("MouseUp"))||void 0===i||i([e,s.x,s.y])}}class _n extends An{constructor(e,t,n,i){super(e,t,n,i),this.videoElementParent=t.getVideoParentElement(),this.x=this.videoElementParent.getBoundingClientRect().width/2,this.y=this.videoElementParent.getBoundingClientRect().height/2,this.normalizedCoord=this.coordinateConverter.translateUnsigned(this.x,this.y),this.onRequestLockListener=this.onRequestLock.bind(this),this.onLockStateChangeListener=this.onLockStateChange.bind(this),this.onMouseUpListener=this.onMouseUp.bind(this),this.onMouseDownListener=this.onMouseDown.bind(this),this.onMouseDblClickListener=this.onMouseDblClick.bind(this),this.onMouseWheelListener=this.onMouseWheel.bind(this),this.onMouseMoveListener=this.onMouseMove.bind(this)}register(){super.register(),this.videoElementParent.requestPointerLock=this.videoElementParent.requestPointerLock||this.videoElementParent.mozRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,this.videoElementParent.requestPointerLock&&this.videoElementParent.addEventListener("click",this.onRequestLockListener),document.addEventListener("pointerlockchange",this.onLockStateChangeListener),document.addEventListener("mozpointerlockchange",this.onLockStateChangeListener),this.videoElementParent.addEventListener("mousedown",this.onMouseDownListener),this.videoElementParent.addEventListener("mouseup",this.onMouseUpListener),this.videoElementParent.addEventListener("wheel",this.onMouseWheelListener),this.videoElementParent.addEventListener("dblclick",this.onMouseDblClickListener)}unregister(){const e=document.pointerLockElement||document.mozPointerLockElement;document.exitPointerLock&&e===this.videoElementParent&&document.exitPointerLock(),this.videoElementParent.removeEventListener("click",this.onRequestLockListener),document.removeEventListener("pointerlockchange",this.onLockStateChangeListener),document.removeEventListener("mozpointerlockchange",this.onLockStateChangeListener),document.removeEventListener("mousemove",this.onMouseMoveListener),this.videoElementParent.removeEventListener("mousedown",this.onMouseDownListener),this.videoElementParent.removeEventListener("mouseup",this.onMouseUpListener),this.videoElementParent.removeEventListener("wheel",this.onMouseWheelListener),this.videoElementParent.removeEventListener("dblclick",this.onMouseDblClickListener),super.unregister()}onRequestLock(){this.videoElementParent.requestPointerLock()}onLockStateChange(){(document.pointerLockElement||document.mozPointerLockElement)===this.videoElementParent?(d.Info("Pointer locked"),document.addEventListener("mousemove",this.onMouseMoveListener)):(d.Info("The pointer lock status is now unlocked"),document.removeEventListener("mousemove",this.onMouseMoveListener),this.activeKeys.getActiveKeys().forEach(e=>{this.streamMessageController.toStreamerHandlers.get("KeyUp")([e])}))}onMouseDown(e){this.videoPlayer.isVideoReady()&&this.streamMessageController.toStreamerHandlers.get("MouseDown")([e.button,this.normalizedCoord.x,this.normalizedCoord.y])}onMouseUp(e){this.videoPlayer.isVideoReady()&&this.streamMessageController.toStreamerHandlers.get("MouseUp")([e.button,this.normalizedCoord.x,this.normalizedCoord.y])}onMouseMove(e){if(!this.videoPlayer.isVideoReady())return;const t=this.videoPlayer.getVideoParentElement().clientWidth,n=this.videoPlayer.getVideoParentElement().clientHeight;for(this.x+=e.movementX,this.y+=e.movementY;this.x>t;)this.x-=t;for(;this.y>n;)this.y-=n;for(;this.x<0;)this.x+=t;for(;this.y<0;)this.y+=n;this.normalizedCoord=this.coordinateConverter.translateUnsigned(this.x,this.y);const i=this.coordinateConverter.translateSigned(e.movementX,e.movementY);this.streamMessageController.toStreamerHandlers.get("MouseMove")([this.normalizedCoord.x,this.normalizedCoord.y,i.x,i.y])}onMouseWheel(e){this.videoPlayer.isVideoReady()&&this.streamMessageController.toStreamerHandlers.get("MouseWheel")([e.wheelDelta,this.normalizedCoord.x,this.normalizedCoord.y])}onMouseDblClick(e){this.videoPlayer.isVideoReady()&&this.streamMessageController.toStreamerHandlers.get("MouseDouble")([e.button,this.normalizedCoord.x,this.normalizedCoord.y])}}class Un extends An{constructor(e,t,n,i){super(e,t,n,i),this.videoElementParent=t.getVideoParentElement(),this.onMouseUpListener=this.onMouseUp.bind(this),this.onMouseDownListener=this.onMouseDown.bind(this),this.onMouseDblClickListener=this.onMouseDblClick.bind(this),this.onMouseWheelListener=this.onMouseWheel.bind(this),this.onMouseMoveListener=this.onMouseMove.bind(this),this.onContextMenuListener=this.onContextMenu.bind(this)}register(){super.register(),this.videoElementParent.addEventListener("mousemove",this.onMouseMoveListener),this.videoElementParent.addEventListener("mousedown",this.onMouseDownListener),this.videoElementParent.addEventListener("mouseup",this.onMouseUpListener),this.videoElementParent.addEventListener("contextmenu",this.onContextMenuListener),this.videoElementParent.addEventListener("wheel",this.onMouseWheelListener),this.videoElementParent.addEventListener("dblclick",this.onMouseDblClickListener)}unregister(){this.videoElementParent.removeEventListener("mousemove",this.onMouseMoveListener),this.videoElementParent.removeEventListener("mousedown",this.onMouseDownListener),this.videoElementParent.removeEventListener("mouseup",this.onMouseUpListener),this.videoElementParent.removeEventListener("contextmenu",this.onContextMenuListener),this.videoElementParent.removeEventListener("wheel",this.onMouseWheelListener),this.videoElementParent.removeEventListener("dblclick",this.onMouseDblClickListener),super.unregister()}onMouseDown(e){if(!this.videoPlayer.isVideoReady())return;const t=this.coordinateConverter.translateUnsigned(e.offsetX,e.offsetY);this.streamMessageController.toStreamerHandlers.get("MouseDown")([e.button,t.x,t.y]),e.preventDefault()}onMouseUp(e){if(!this.videoPlayer.isVideoReady())return;const t=this.coordinateConverter.translateUnsigned(e.offsetX,e.offsetY);this.streamMessageController.toStreamerHandlers.get("MouseUp")([e.button,t.x,t.y]),e.preventDefault()}onContextMenu(e){this.videoPlayer.isVideoReady()&&e.preventDefault()}onMouseMove(e){if(!this.videoPlayer.isVideoReady())return;const t=this.coordinateConverter.translateUnsigned(e.offsetX,e.offsetY),n=this.coordinateConverter.translateSigned(e.movementX,e.movementY);this.streamMessageController.toStreamerHandlers.get("MouseMove")([t.x,t.y,n.x,n.y]),e.preventDefault()}onMouseWheel(e){if(!this.videoPlayer.isVideoReady())return;const t=this.coordinateConverter.translateUnsigned(e.offsetX,e.offsetY);this.streamMessageController.toStreamerHandlers.get("MouseWheel")([e.wheelDelta,t.x,t.y]),e.preventDefault()}onMouseDblClick(e){if(!this.videoPlayer.isVideoReady())return;const t=this.coordinateConverter.translateUnsigned(e.offsetX,e.offsetY);this.streamMessageController.toStreamerHandlers.get("MouseDouble")([e.button,t.x,t.y])}}class Nn{constructor(e,t,n){this.fingers=[9,8,7,6,5,4,3,2,1,0],this.fingerIds=new Map,this.maxByteValue=255,this.streamMessageController=e,this.videoPlayer=t,this.coordinateConverter=n,this.videoElementParent=t.getVideoElement(),this.onTouchStartListener=this.onTouchStart.bind(this),this.onTouchEndListener=this.onTouchEnd.bind(this),this.onTouchMoveListener=this.onTouchMove.bind(this)}register(){this.videoElementParent.addEventListener("touchstart",this.onTouchStartListener),this.videoElementParent.addEventListener("touchend",this.onTouchEndListener),this.videoElementParent.addEventListener("touchmove",this.onTouchMoveListener)}unregister(){this.videoElementParent.removeEventListener("touchstart",this.onTouchStartListener),this.videoElementParent.removeEventListener("touchend",this.onTouchEndListener),this.videoElementParent.removeEventListener("touchmove",this.onTouchMoveListener)}rememberTouch(e){const t=this.fingers.pop();void 0===t&&d.Info("exhausted touch identifiers"),this.fingerIds.set(e.identifier,t)}forgetTouch(e){this.fingers.push(this.fingerIds.get(e.identifier)),this.fingers.sort(function(e,t){return t-e}),this.fingerIds.delete(e.identifier)}onTouchStart(e){if(this.videoPlayer.isVideoReady()){for(let t=0;t<e.changedTouches.length;t++)this.rememberTouch(e.changedTouches[t]);this.emitTouchData("TouchStart",e.changedTouches),e.preventDefault()}}onTouchEnd(e){if(this.videoPlayer.isVideoReady()){this.emitTouchData("TouchEnd",e.changedTouches);for(let t=0;t<e.changedTouches.length;t++)this.forgetTouch(e.changedTouches[t]);e.preventDefault()}}onTouchMove(e){this.videoPlayer.isVideoReady()&&(this.emitTouchData("TouchMove",e.touches),e.preventDefault())}emitTouchData(e,t){if(!this.videoPlayer.isVideoReady())return;const n=this.videoPlayer.getVideoParentElement().getBoundingClientRect(),i=this.streamMessageController.toStreamerHandlers;for(let s=0;s<t.length;s++){const r=1,o=t[s],a=o.clientX-n.left,l=o.clientY-n.top;d.Info(`F${this.fingerIds.get(o.identifier)}=(${a}, ${l})`);const c=this.coordinateConverter.translateUnsigned(a,l);switch(e){case"TouchStart":i.get("TouchStart")([r,c.x,c.y,this.fingerIds.get(o.identifier),this.maxByteValue*(o.force>0?o.force:1),c.inRange?1:0]);break;case"TouchEnd":i.get("TouchEnd")([r,c.x,c.y,this.fingerIds.get(o.identifier),this.maxByteValue*o.force,c.inRange?1:0]);break;case"TouchMove":i.get("TouchMove")([r,c.x,c.y,this.fingerIds.get(o.identifier),this.maxByteValue*(o.force>0?o.force:1),c.inRange?1:0])}}}}class Bn{constructor(e,t,n){this.streamMessageController=e,this.videoPlayer=t,this.coordinateConverter=n,this.onTouchStartListener=this.onTouchStart.bind(this),this.onTouchEndListener=this.onTouchEnd.bind(this),this.onTouchMoveListener=this.onTouchMove.bind(this),this.videoElementParentClientRect=this.videoPlayer.getVideoParentElement().getBoundingClientRect()}register(){document.addEventListener("touchstart",this.onTouchStartListener),document.addEventListener("touchend",this.onTouchEndListener),document.addEventListener("touchmove",this.onTouchMoveListener)}unregister(){document.removeEventListener("touchstart",this.onTouchStartListener),document.removeEventListener("touchend",this.onTouchEndListener),document.removeEventListener("touchmove",this.onTouchMoveListener)}onTouchStart(e){if(this.videoPlayer.isVideoReady()&&e.target===this.videoPlayer.getVideoElement()){if(null==this.fakeTouchFinger){const t=e.changedTouches[0];this.fakeTouchFinger={id:t.identifier,x:t.clientX-this.videoElementParentClientRect.left,y:t.clientY-this.videoElementParentClientRect.top};const n=this.videoPlayer.getVideoParentElement(),i=new MouseEvent("mouseenter",t);n.dispatchEvent(i);const s=this.coordinateConverter.translateUnsigned(this.fakeTouchFinger.x,this.fakeTouchFinger.y);this.streamMessageController.toStreamerHandlers.get("MouseDown")([On.mainButton,s.x,s.y])}e.preventDefault()}}onTouchEnd(e){if(!this.videoPlayer.isVideoReady()||null==this.fakeTouchFinger)return;const t=this.videoPlayer.getVideoParentElement(),n=this.streamMessageController.toStreamerHandlers;for(let i=0;i<e.changedTouches.length;i++){const s=e.changedTouches[i];if(s.identifier===this.fakeTouchFinger.id){const e=s.clientX-this.videoElementParentClientRect.left,i=s.clientY-this.videoElementParentClientRect.top,r=this.coordinateConverter.translateUnsigned(e,i);n.get("MouseUp")([On.mainButton,r.x,r.y]);const o=new MouseEvent("mouseleave",s);t.dispatchEvent(o),this.fakeTouchFinger=null;break}}e.preventDefault()}onTouchMove(e){if(!this.videoPlayer.isVideoReady()||null==this.fakeTouchFinger)return;const t=this.streamMessageController.toStreamerHandlers;for(let n=0;n<e.touches.length;n++){const i=e.touches[n];if(i.identifier===this.fakeTouchFinger.id){const e=i.clientX-this.videoElementParentClientRect.left,n=i.clientY-this.videoElementParentClientRect.top,s=this.coordinateConverter.translateUnsigned(e,n),r=this.coordinateConverter.translateSigned(e-this.fakeTouchFinger.x,n-this.fakeTouchFinger.y);t.get("MouseMove")([s.x,s.y,r.x,r.y]),this.fakeTouchFinger.x=e,this.fakeTouchFinger.y=n;break}}e.preventDefault()}}function Vn(e){return JSON.parse(JSON.stringify({buttons:e.buttons.map(e=>JSON.parse(JSON.stringify({pressed:e.pressed,touched:e.touched,value:e.value}))),axes:e.axes}))}var Wn,Hn;!function(e){e[e.RightClusterBottomButton=0]="RightClusterBottomButton",e[e.RightClusterRightButton=1]="RightClusterRightButton",e[e.RightClusterLeftButton=2]="RightClusterLeftButton",e[e.RightClusterTopButton=3]="RightClusterTopButton",e[e.LeftShoulder=4]="LeftShoulder",e[e.RightShoulder=5]="RightShoulder",e[e.LeftTrigger=6]="LeftTrigger",e[e.RightTrigger=7]="RightTrigger",e[e.SelectOrBack=8]="SelectOrBack",e[e.StartOrForward=9]="StartOrForward",e[e.LeftAnalogPress=10]="LeftAnalogPress",e[e.RightAnalogPress=11]="RightAnalogPress",e[e.LeftClusterTopButton=12]="LeftClusterTopButton",e[e.LeftClusterBottomButton=13]="LeftClusterBottomButton",e[e.LeftClusterLeftButton=14]="LeftClusterLeftButton",e[e.LeftClusterRightButton=15]="LeftClusterRightButton",e[e.CentreButton=16]="CentreButton",e[e.LeftStickHorizontal=0]="LeftStickHorizontal",e[e.LeftStickVertical=1]="LeftStickVertical",e[e.RightStickHorizontal=2]="RightStickHorizontal",e[e.RightStickVertical=3]="RightStickVertical"}(Wn||(Wn={}));class jn{constructor(e){this.streamMessageController=e,this.onGamepadConnectedListener=this.onGamepadConnected.bind(this),this.onGamepadDisconnectedListener=this.onGamepadDisconnected.bind(this),this.beforeUnloadListener=this.onBeforeUnload.bind(this),this.requestAnimationFrame=(window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.requestAnimationFrame).bind(window)}register(){window.addEventListener("beforeunload",this.beforeUnloadListener);const e=window;if("GamepadEvent"in e?(window.addEventListener("gamepadconnected",this.onGamepadConnectedListener),window.addEventListener("gamepaddisconnected",this.onGamepadDisconnectedListener)):"WebKitGamepadEvent"in e&&(window.addEventListener("webkitgamepadconnected",this.onGamepadConnectedListener),window.addEventListener("webkitgamepaddisconnected",this.onGamepadDisconnectedListener)),this.controllers=[],navigator.getGamepads)for(const e of navigator.getGamepads())e&&this.onGamepadConnected(new GamepadEvent("gamepadconnected",{gamepad:e}))}unregister(){window.removeEventListener("gamepadconnected",this.onGamepadConnectedListener),window.removeEventListener("gamepaddisconnected",this.onGamepadDisconnectedListener),window.removeEventListener("webkitgamepadconnected",this.onGamepadConnectedListener),window.removeEventListener("webkitgamepaddisconnected",this.onGamepadDisconnectedListener);for(const e of this.controllers)e&&void 0!==e.id&&this.streamMessageController.toStreamerHandlers.get("GamepadDisconnected")([e.id]);this.controllers=[]}onGamepadResponseReceived(e){for(const t of this.controllers)if(t&&void 0===t.id){t.id=e;break}}onGamepadConnected(e){const t=e.gamepad,n={currentState:Vn(t),prevState:Vn(t),id:void 0};this.controllers[t.index]=n,window.requestAnimationFrame(()=>this.updateStatus()),this.streamMessageController.toStreamerHandlers.get("GamepadConnected")()}onGamepadDisconnected(e){const t=e.gamepad,n=this.controllers[t.index];delete this.controllers[t.index],this.controllers=this.controllers.filter(e=>void 0!==e),void 0!==n.id&&this.streamMessageController.toStreamerHandlers.get("GamepadDisconnected")([n.id])}scanGamepads(){const e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];for(let t=0;t<e.length;t++)e[t]&&void 0!==this.controllers[e[t].index]&&(this.controllers[e[t].index].currentState=e[t])}updateStatus(){this.scanGamepads();const e=this.streamMessageController.toStreamerHandlers;for(const t of this.controllers){if(!t)continue;const n=void 0===t.id?this.controllers.indexOf(t):t.id,i=t.currentState;for(let i=0;i<t.currentState.buttons.length;i++){const s=t.currentState.buttons[i],r=t.prevState.buttons[i];s.pressed?i==Wn.LeftTrigger?e.get("GamepadAnalog")([n,5,s.value]):i==Wn.RightTrigger?e.get("GamepadAnalog")([n,6,s.value]):e.get("GamepadButtonPressed")([n,i,r.pressed?1:0]):!s.pressed&&r.pressed&&(i==Wn.LeftTrigger?e.get("GamepadAnalog")([n,5,0]):i==Wn.RightTrigger?e.get("GamepadAnalog")([n,6,0]):e.get("GamepadButtonReleased")([n,i,0]))}for(let t=0;t<i.axes.length;t+=2){const s=parseFloat(i.axes[t].toFixed(4)),r=-parseFloat(i.axes[t+1].toFixed(4));e.get("GamepadAnalog")([n,t+1,s]),e.get("GamepadAnalog")([n,t+2,r])}const s=this.controllers.indexOf(t);this.controllers[s].prevState=Vn(i)}this.controllers.length>0&&this.requestAnimationFrame(()=>this.updateStatus())}onBeforeUnload(e){for(const e of this.controllers)e&&void 0!==e.id&&this.streamMessageController.toStreamerHandlers.get("GamepadDisconnected")([e.id])}}class zn{constructor(e,t,n){this.activeKeys=new qn,this.toStreamerMessagesProvider=e,this.videoElementProvider=t,this.coordinateConverter=n}registerKeyBoard(e){d.Info("Register Keyboard Events");const t=new Dn(this.toStreamerMessagesProvider,e,this.activeKeys);return t.register(),t}registerMouse(e){let t;return d.Info("Register Mouse Events"),t=e==tn.HoveringMouse?new Un(this.toStreamerMessagesProvider,this.videoElementProvider,this.coordinateConverter,this.activeKeys):new _n(this.toStreamerMessagesProvider,this.videoElementProvider,this.coordinateConverter,this.activeKeys),t.register(),t}registerTouch(e){let t;return d.Info("Registering Touch"),t=e?new Bn(this.toStreamerMessagesProvider,this.videoElementProvider,this.coordinateConverter):new Nn(this.toStreamerMessagesProvider,this.videoElementProvider,this.coordinateConverter),t.register(),t}registerGamePad(){d.Info("Register Game Pad");const e=new jn(this.toStreamerMessagesProvider);return e.register(),e}}class qn{constructor(){this.activeKeys=[],this.activeKeys=[]}getActiveKeys(){return this.activeKeys}}class Kn{constructor(e,t){this.lastTimeResized=(new Date).getTime();const n=document.getElementById("streamingVideo");this.videoElement=n||document.createElement("video"),this.config=t,this.videoElement.id="streamingVideo",this.videoElement.disablePictureInPicture=!0,this.videoElement.playsInline=!0,this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.pointerEvents="all",e.appendChild(this.videoElement),this.onResizePlayerCallback=()=>{console.log("Resolution changed, restyling player, did you forget to override this function?")},this.onMatchViewportResolutionCallback=()=>{console.log("Resolution changed and match viewport resolution is turned on, did you forget to override this function?")},this.videoElement.onclick=()=>{null!=this.audioElement&&this.audioElement.paused&&(void 0!==window.addToTimeRecords&&window.addToTimeRecords("audioElemPlayCalledAt",window.getCurrentDate()),this.audioElement.play()),this.videoElement.paused&&this.videoElement.play()},this.videoElement.onloadedmetadata=()=>{void 0!==window.addToTimeRecords&&window.addToTimeRecords("videoLoadedMetaDataEventCalledAt",window.getCurrentDate()),this.onVideoInitialized()},this.videoElement.onloadeddata=()=>{void 0!==window.addToTimeRecords&&window.addToTimeRecords("videoLoadeddataEventCalledAt",window.getCurrentDate())},window.addEventListener("resize",()=>this.resizePlayerStyle(),!0),window.addEventListener("orientationchange",()=>this.onOrientationChange())}destroy(){this.videoElement.src="",this.videoElement.srcObject=null,this.videoElement.remove(),this.audioElement&&(this.audioElement.src="",this.audioElement.srcObject=null,this.audioElement.remove())}setAudioElement(e){this.audioElement=e}play(){return window.sendToIframe({type:"stage5_playBtnPressed"}),this.videoElement.muted=this.config.isFlagEnabled(Kt.StartVideoMuted),this.videoElement.autoplay=this.config.isFlagEnabled(Kt.AutoPlayVideo),this.videoElement.play()}isPaused(){return this.videoElement.paused}isVideoReady(){return void 0!==this.videoElement.readyState&&this.videoElement.readyState>0}hasVideoSource(){return void 0!==this.videoElement.srcObject&&null!==this.videoElement.srcObject}getVideoElement(){return this.videoElement}getVideoParentElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}setVideoEnabled(e){this.videoElement.srcObject.getTracks().forEach(t=>t.enabled=e)}onVideoInitialized(){}onOrientationChange(){clearTimeout(this.orientationChangeTimeout),this.orientationChangeTimeout=window.setTimeout(()=>{this.resizePlayerStyle()},500)}resizePlayerStyle(){const e=this.getVideoParentElement();e&&(this.updateVideoStreamSize(),e.classList.contains("fixed-size")||this.resizePlayerStyleToFillParentElement(),this.onResizePlayerCallback())}resizePlayerStyleToFillParentElement(){const e=this.getVideoParentElement();var t="top: 0px; left: 0px; width: 100%; height: 100%; "+(window.styleAdditional||"cursor: default;");e.setAttribute("style",t)}updateVideoStreamSize(){var e;if(!(null===(e=window.uid)||void 0===e?void 0:e.startsWith(window.e3dsUeEditorPrefix))&&this.config.isFlagEnabled(Kt.MatchViewportResolution))if((new Date).getTime()-this.lastTimeResized>300){const e=this.getVideoParentElement();if(!e)return;this.onMatchViewportResolutionCallback(e.clientWidth,e.clientHeight),this.lastTimeResized=(new Date).getTime()}else d.Info("Resizing too often - skipping"),clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=window.setTimeout(()=>this.updateVideoStreamSize(),100)}}class Qn{constructor(){this.toStreamerHandlers=new Map,this.fromStreamerHandlers=new Map,this.toStreamerMessages=new Map,this.fromStreamerMessages=new Map}populateDefaultProtocol(){this.toStreamerMessages.set("IFrameRequest",{id:0,structure:[]}),this.toStreamerMessages.set("RequestQualityControl",{id:1,structure:[]}),this.toStreamerMessages.set("FpsRequest",{id:2,structure:[]}),this.toStreamerMessages.set("AverageBitrateRequest",{id:3,structure:[]}),this.toStreamerMessages.set("StartStreaming",{id:4,structure:[]}),this.toStreamerMessages.set("StopStreaming",{id:5,structure:[]}),this.toStreamerMessages.set("LatencyTest",{id:6,structure:["string"]}),this.toStreamerMessages.set("RequestInitialSettings",{id:7,structure:[]}),this.toStreamerMessages.set("TestEcho",{id:8,structure:[]}),this.toStreamerMessages.set("DataChannelLatencyTest",{id:9,structure:[]}),this.toStreamerMessages.set("UIInteraction",{id:50,structure:["string"]}),this.toStreamerMessages.set("Command",{id:51,structure:["string"]}),this.toStreamerMessages.set("TextboxEntry",{id:52,structure:["string"]}),this.toStreamerMessages.set("KeyDown",{id:60,structure:["uint8","uint8"]}),this.toStreamerMessages.set("KeyUp",{id:61,structure:["uint8"]}),this.toStreamerMessages.set("KeyPress",{id:62,structure:["uint16"]}),this.toStreamerMessages.set("MouseEnter",{id:70,structure:[]}),this.toStreamerMessages.set("MouseLeave",{id:71,structure:[]}),this.toStreamerMessages.set("MouseDown",{id:72,structure:["uint8","uint16","uint16"]}),this.toStreamerMessages.set("MouseUp",{id:73,structure:["uint8","uint16","uint16"]}),this.toStreamerMessages.set("MouseMove",{id:74,structure:["uint16","uint16","int16","int16"]}),this.toStreamerMessages.set("MouseWheel",{id:75,structure:["int16","uint16","uint16"]}),this.toStreamerMessages.set("MouseDouble",{id:76,structure:["uint8","uint16","uint16"]}),this.toStreamerMessages.set("TouchStart",{id:80,structure:["uint8","uint16","uint16","uint8","uint8","uint8"]}),this.toStreamerMessages.set("TouchEnd",{id:81,structure:["uint8","uint16","uint16","uint8","uint8","uint8"]}),this.toStreamerMessages.set("TouchMove",{id:82,structure:["uint8","uint16","uint16","uint8","uint8","uint8"]}),this.toStreamerMessages.set("GamepadConnected",{id:93,structure:[]}),this.toStreamerMessages.set("GamepadButtonPressed",{id:90,structure:["uint8","uint8","uint8"]}),this.toStreamerMessages.set("GamepadButtonReleased",{id:91,structure:["uint8","uint8","uint8"]}),this.toStreamerMessages.set("GamepadAnalog",{id:92,structure:["uint8","uint8","double"]}),this.toStreamerMessages.set("GamepadDisconnected",{id:94,structure:["uint8"]}),this.fromStreamerMessages.set(0,"QualityControlOwnership"),this.fromStreamerMessages.set(1,"Response"),this.fromStreamerMessages.set(2,"Command"),this.fromStreamerMessages.set(3,"FreezeFrame"),this.fromStreamerMessages.set(4,"UnfreezeFrame"),this.fromStreamerMessages.set(5,"VideoEncoderAvgQP"),this.fromStreamerMessages.set(6,"LatencyTest"),this.fromStreamerMessages.set(7,"InitialSettings"),this.fromStreamerMessages.set(8,"FileExtension"),this.fromStreamerMessages.set(9,"FileMimeType"),this.fromStreamerMessages.set(10,"FileContents"),this.fromStreamerMessages.set(11,"TestEcho"),this.fromStreamerMessages.set(12,"InputControlOwnership"),this.fromStreamerMessages.set(13,"GamepadResponse"),this.fromStreamerMessages.set(14,"DataChannelLatencyTest"),this.fromStreamerMessages.set(255,"Protocol")}registerMessageHandler(e,t,n){switch(e){case Hn.ToStreamer:this.toStreamerHandlers.set(t,n);break;case Hn.FromStreamer:this.fromStreamerHandlers.set(t,n);break;default:d.Info(`Unknown message direction ${e}`)}}}!function(e){e[e.ToStreamer=0]="ToStreamer",e[e.FromStreamer=1]="FromStreamer"}(Hn||(Hn={}));class Gn{constructor(){this.responseEventListeners=new Map}addResponseEventListener(e,t){this.responseEventListeners.set(e,t)}removeResponseEventListener(e){this.responseEventListeners.delete(e)}onResponse(e){d.Info("DataChannelReceiveMessageType.Response");const t=new TextDecoder("utf-16").decode(e.slice(1));void 0!==window.HandleResponseFromUnreal&&window.HandleResponseFromUnreal(t),d.Info(t),this.responseEventListeners.forEach(e=>{e(t)})}}class $n{constructor(e,t){this.dataChannelSender=e,this.toStreamerMessagesMapProvider=t}sendMessageToStreamer(e,t){void 0===t&&(t=[]);const n=this.toStreamerMessagesMapProvider.toStreamerMessages.get(e);if(void 0===n)return void d.Error(`Attempted to send a message to the streamer with message type: ${e}, but the frontend hasn't been configured to send such a message. Check you've added the message type in your cpp`);if(n.structure&&t&&n.structure.length!==t.length)return void d.Error(`Provided message data doesn't match expected layout. Expected [ ${n.structure.map(e=>{switch(e){case"uint8":case"uint16":case"int16":case"float":case"double":default:return"number";case"string":return"string"}}).toString()} ] but received [ ${t.map(e=>typeof e).toString()} ]`);let i=0;const s=new TextEncoder;t.forEach((e,t)=>{switch(n.structure[t]){case"uint8":i+=1;break;case"uint16":case"int16":i+=2;break;case"float":i+=4;break;case"double":i+=8;break;case"string":i+=2,i+=2*s.encode(e).length}});const r=new DataView(new ArrayBuffer(i+1));r.setUint8(0,n.id);let o=1;t.forEach((e,t)=>{switch(n.structure[t]){case"uint8":r.setUint8(o,e),o+=1;break;case"uint16":r.setUint16(o,e,!0),o+=2;break;case"int16":r.setInt16(o,e,!0),o+=2;break;case"float":r.setFloat32(o,e,!0),o+=4;break;case"double":r.setFloat64(o,e,!0),o+=8;break;case"string":r.setUint16(o,e.length,!0),o+=2;for(let t=0;t<e.length;t++)r.setUint16(o,e.charCodeAt(t),!0),o+=2}}),this.dataChannelSender.canSend()?this.dataChannelSender.sendData(r.buffer):d.Info(`Data channel cannot send yet, skipping sending message: ${e} - ${new Uint8Array(r.buffer)}`)}}class Xn{constructor(e){this.sendMessageController=e}SendRequestQualityControl(){this.sendMessageController.sendMessageToStreamer("RequestQualityControl")}SendMaxFpsRequest(){this.sendMessageController.sendMessageToStreamer("FpsRequest")}SendAverageBitrateRequest(){this.sendMessageController.sendMessageToStreamer("AverageBitrateRequest")}SendStartStreaming(){this.sendMessageController.sendMessageToStreamer("StartStreaming")}SendStopStreaming(){this.sendMessageController.sendMessageToStreamer("StopStreaming")}SendRequestInitialSettings(){this.sendMessageController.sendMessageToStreamer("RequestInitialSettings")}}class Jn{constructor(e){this.dataChannelProvider=e}canSend(){return void 0!==this.dataChannelProvider.getDataChannelInstance().dataChannel&&"open"==this.dataChannelProvider.getDataChannelInstance().dataChannel.readyState}sendData(e){const t=this.dataChannelProvider.getDataChannelInstance();"open"==t.dataChannel.readyState?(t.dataChannel.send(e),d.Info(`Message Sent: ${new Uint8Array(e)}`),this.resetAfkWarningTimerOnDataSend()):d.Error(`Message Failed: ${new Uint8Array(e)}`)}resetAfkWarningTimerOnDataSend(){}}class Zn{reconfigure(e,t){const n=e.height/e.width,i=t.height/t.width;this.playerIsLarger=n>i,this.playerSize=e,this.ratio=this.playerIsLarger?n/i:i/n}translateUnsigned(e,t){const n=this.playerIsLarger?e/this.playerSize.width:this.ratio*(e/this.playerSize.width-.5)+.5,i=this.playerIsLarger?this.ratio*(t/this.playerSize.height-.5)+.5:t/this.playerSize.height;return n<0||n>1||i<0||i>1?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*n,y:65536*i}}translateSigned(e,t){return{x:32767*(this.playerIsLarger?e/(.5*this.playerSize.width):this.ratio*e/(.5*this.playerSize.width)),y:32767*(this.playerIsLarger?this.ratio*t/(.5*this.playerSize.height):t/(.5*this.playerSize.height))}}untranslateUnsigned(e,t){const n=this.playerIsLarger?e/65536:(e/65536-.5)/this.ratio+.5,i=this.playerIsLarger?(t/65536-.5)/this.ratio+.5:t/65536;return{x:n*this.playerSize.width,y:i*this.playerSize.height}}}class Yn{constructor(e){this._urlParams={};const t=new URLSearchParams(e);for(const[e,n]of t)this._urlParams[e.toLowerCase()]=n}has(e){return e.toLowerCase()in this._urlParams}get(e){return this.has(e)?this._urlParams[e.toLowerCase()]:null}}class ei{constructor(e,t){this.shouldShowPlayOverlay=!0,this.autoJoinTimer=void 0,void 0!==window.addToTimeRecords&&window.addToTimeRecords("webRtcPlayerConstructorCalledAt",window.getCurrentDate()),this.config=e,this.pixelStreaming=t,this.responseController=new Gn,this.file=new Pn,this.sdpConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.afkController=new nn(this.config,this.pixelStreaming,this.onAfkTriggered.bind(this)),this.afkController.onAFKTimedOutCallback=()=>{this.closeSignalingServer("You have been disconnected due to inactivity.",!1)},this.freezeFrameController=new Xe(this.pixelStreaming.videoElementParent),this.videoPlayer=new Kn(this.pixelStreaming.videoElementParent,this.config),this.videoPlayer.onVideoInitialized=()=>this.handleVideoInitialized(),this.videoPlayer.onMatchViewportResolutionCallback=(e,t)=>{const n={"Resolution.Width":e,"Resolution.Height":t};this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify(n)])},this.videoPlayer.onResizePlayerCallback=()=>{this.setUpMouseAndFreezeFrame()},this.streamController=new Ge(this.videoPlayer),this.coordinateConverter=new Zn,this.sendrecvDataChannelController=new sn,this.recvDataChannelController=new sn,this.registerDataChannelEventEmitters(this.sendrecvDataChannelController),this.registerDataChannelEventEmitters(this.recvDataChannelController),this.dataChannelSender=new Jn(this.sendrecvDataChannelController),this.dataChannelSender.resetAfkWarningTimerOnDataSend=()=>this.afkController.resetAfkWarningTimer(),this.streamMessageController=new Qn,this.transport=new u(e.webSocketProtocols),this.protocol=new m(this.transport),this.protocol.addListener(ge.typeName,e=>this.handleOnConfigMessage(e)),this.protocol.addListener(De.typeName,e=>this.handlePingMessage(e)),this.protocol.addListener(be.typeName,e=>this.handleStreamerListMessage(e)),this.protocol.addListener(Te.typeName,e=>this.handleSubscribeFailedMessage(e)),this.protocol.addListener(we.typeName,e=>this.handleStreamerIDChangedMessage(e)),this.protocol.addListener(He.typeName,e=>{const t=e;this.pixelStreaming._onPlayerCount(t.count)}),this.protocol.addListener(Ie.typeName,e=>this.handleWebRtcAnswer(e)),this.protocol.addListener(ke.typeName,e=>this.handleWebRtcOffer(e)),this.protocol.addListener(Ue.typeName,e=>this.handleWebRtcSFUPeerDatachannels(e)),this.protocol.addListener(Re.typeName,e=>{const t=e;this.handleIceCandidate(t.candidate)}),this.protocol.transport.addListener("open",()=>{this.reconnectAttempt=0,this.isReconnecting=!1}),this.protocol.transport.addListener("error",()=>{d.Error("Got a transport error.")}),this.protocol.transport.addListener("close",e=>{const t=this.config.getNumericSettingValue(Gt.MaxReconnectAttempts),n=this.reconnectAttempt<t,i=(this.forceReconnect||this.enableAutoReconnect&&t>0&&n)&&1001!=e.code,s=!i,r=this.disconnectMessage?this.disconnectMessage:e.reason;this.forceReconnect=!1,this.config.getSettingOption(Zt.PreferredCodec).options=qt.getSupportedVideoCodecs(),this.afkController.stopAfkWarningTimer(),this.statsTimerHandle&&void 0!==this.statsTimerHandle&&window.clearInterval(this.statsTimerHandle),1==window.shouldCloseStreamOnConnectionDropWithSS&&(this.pixelStreaming._onDisconnect(r,s),this.setVideoEncoderAvgQP(0),this.setTouchInputEnabled(!1),this.setMouseInputEnabled(!1),this.setKeyboardInputEnabled(!1),this.setGamePadInputEnabled(!1)),i&&setTimeout(()=>{this.reconnectAttempt++,this.doReconnect(e.reason)},2e3)}),this.sendMessageController=new $n(this.dataChannelSender,this.streamMessageController),this.toStreamerMessagesController=new Xn(this.sendMessageController),this.registerMessageHandlers(),this.streamMessageController.populateDefaultProtocol(),this.inputClassesFactory=new zn(this.streamMessageController,this.videoPlayer,this.coordinateConverter),this.isUsingSFU=!1,this.isUsingSVC=!1,this.isQualityController=!1,this.preferredCodec="",this.enableAutoReconnect=!0,this.forceReconnect=!1,this.reconnectAttempt=0,this.isReconnecting=!1,this.config._addOnOptionSettingChangedListener(Zt.StreamerId,e=>{if(void 0===e||""===e)return;this.peerConnectionController.peerConnection.close(),this.peerConnectionController.createPeerConnection(this.peerConfig,this.preferredCodec),this.subscribedStream=e;const t=qe(Ce,{streamerId:e});t.uid=window.uid,this.protocol.sendMessage(t)}),this.config._addOnOptionSettingChangedListener(Zt.PreferredQuality,e=>{if(void 0===e||""===e)return;let t;if(this.isUsingSVC)t=qe(Ae,{spatialLayer:+e[1]-1,temporalLayer:+e[3]-1});else{const n=this.config.getSettingOption(Zt.PreferredQuality).options.indexOf(e);t=qe(Ae,{spatialLayer:n,temporalLayer:0})}this.protocol.sendMessage(t)}),this.setVideoEncoderAvgQP(-1),this.signallingUrlBuilder=()=>{let e=this.config.getTextSettingValue(Xt.SignallingServerUrl);return e=window.ss_url,e}}destroyVideoPlayer(){this.videoPlayer.destroy()}handleOnMessage(e){const t=new Uint8Array(e.data);d.Info("Message incoming:"+t);const n=this.streamMessageController.fromStreamerMessages.get(t[0]);this.streamMessageController.fromStreamerHandlers.get(n)(e.data)}registerMessageHandlers(){this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"QualityControlOwnership",e=>this.onQualityControlOwnership(e)),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"Response",e=>this.responseController.onResponse(e)),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"Command",e=>{this.onCommand(e)}),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"FreezeFrame",e=>this.onFreezeFrameMessage(e)),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"UnfreezeFrame",()=>this.invalidateFreezeFrameAndEnableVideo()),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"VideoEncoderAvgQP",e=>this.handleVideoEncoderAvgQP(e)),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"LatencyTest",e=>this.handleLatencyTestResult(e)),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"DataChannelLatencyTest",e=>this.handleDataChannelLatencyTestResponse(e)),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"InitialSettings",e=>this.handleInitialSettings(e)),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"FileExtension",e=>this.onFileExtension(e)),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"FileMimeType",e=>this.onFileMimeType(e)),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"FileContents",e=>this.onFileContents(e)),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"TestEcho",()=>{}),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"InputControlOwnership",e=>this.onInputControlOwnership(e)),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"GamepadResponse",e=>this.onGamepadResponse(e)),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"Multiplexed",()=>{}),this.streamMessageController.registerMessageHandler(Hn.FromStreamer,"Protocol",e=>this.onProtocolMessage(e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"IFrameRequest",()=>this.sendMessageController.sendMessageToStreamer("IFrameRequest")),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"RequestQualityControl",()=>this.sendMessageController.sendMessageToStreamer("RequestQualityControl")),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"FpsRequest",()=>this.sendMessageController.sendMessageToStreamer("FpsRequest")),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"AverageBitrateRequest",()=>this.sendMessageController.sendMessageToStreamer("AverageBitrateRequest")),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"StartStreaming",()=>this.sendMessageController.sendMessageToStreamer("StartStreaming")),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"StopStreaming",()=>this.sendMessageController.sendMessageToStreamer("StopStreaming")),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"LatencyTest",e=>this.sendMessageController.sendMessageToStreamer("LatencyTest",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"RequestInitialSettings",()=>this.sendMessageController.sendMessageToStreamer("RequestInitialSettings")),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"TestEcho",()=>{}),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"UIInteraction",e=>this.sendMessageController.sendMessageToStreamer("UIInteraction",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"Command",e=>this.sendMessageController.sendMessageToStreamer("Command",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"TextboxEntry",e=>this.sendMessageController.sendMessageToStreamer("TextboxEntry",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"KeyDown",e=>this.sendMessageController.sendMessageToStreamer("KeyDown",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"KeyUp",e=>this.sendMessageController.sendMessageToStreamer("KeyUp",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"KeyPress",e=>this.sendMessageController.sendMessageToStreamer("KeyPress",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"MouseEnter",e=>this.sendMessageController.sendMessageToStreamer("MouseEnter",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"MouseLeave",e=>this.sendMessageController.sendMessageToStreamer("MouseLeave",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"MouseDown",e=>this.sendMessageController.sendMessageToStreamer("MouseDown",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"MouseUp",e=>this.sendMessageController.sendMessageToStreamer("MouseUp",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"MouseMove",e=>this.sendMessageController.sendMessageToStreamer("MouseMove",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"MouseWheel",e=>this.sendMessageController.sendMessageToStreamer("MouseWheel",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"MouseDouble",e=>this.sendMessageController.sendMessageToStreamer("MouseDouble",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"TouchStart",e=>this.sendMessageController.sendMessageToStreamer("TouchStart",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"TouchEnd",e=>this.sendMessageController.sendMessageToStreamer("TouchEnd",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"TouchMove",e=>this.sendMessageController.sendMessageToStreamer("TouchMove",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"GamepadConnected",()=>this.sendMessageController.sendMessageToStreamer("GamepadConnected")),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"GamepadButtonPressed",e=>this.sendMessageController.sendMessageToStreamer("GamepadButtonPressed",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"GamepadButtonReleased",e=>this.sendMessageController.sendMessageToStreamer("GamepadButtonReleased",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"GamepadAnalog",e=>this.sendMessageController.sendMessageToStreamer("GamepadAnalog",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"GamepadDisconnected",e=>this.sendMessageController.sendMessageToStreamer("GamepadDisconnected",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"XREyeViews",e=>this.sendMessageController.sendMessageToStreamer("XREyeViews",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"XRHMDTransform",e=>this.sendMessageController.sendMessageToStreamer("XRHMDTransform",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"XRControllerTransform",e=>this.sendMessageController.sendMessageToStreamer("XRControllerTransform",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"XRSystem",e=>this.sendMessageController.sendMessageToStreamer("XRSystem",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"XRButtonTouched",e=>this.sendMessageController.sendMessageToStreamer("XRButtonTouched",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"XRButtonTouchReleased",e=>this.sendMessageController.sendMessageToStreamer("XRButtonTouchReleased",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"XRButtonPressed",e=>this.sendMessageController.sendMessageToStreamer("XRButtonPressed",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"XRButtonReleased",e=>this.sendMessageController.sendMessageToStreamer("XRButtonReleased",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"XRAnalog",e=>this.sendMessageController.sendMessageToStreamer("XRAnalog",e)),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"ChannelRelayStatus",()=>{}),this.streamMessageController.registerMessageHandler(Hn.ToStreamer,"Multiplexed",()=>{})}onCommand(e){d.Info("DataChannelReceiveMessageType.Command");const t=new TextDecoder("utf-16").decode(e.slice(1));d.Info("Data Channel Command: "+t);const n=JSON.parse(t);"onScreenKeyboard"===n.command&&this.handleOnScreenKeyboardCommand(n)}handleOnScreenKeyboardCommand(e){var t,n,i,s;const r={showOnScreenKeyboard:null===(t=e.showOnScreenKeyboard)||void 0===t||t,x:null!==(n=e.x)&&void 0!==n?n:0,y:null!==(i=e.y)&&void 0!==i?i:0,contents:null!==(s=e.contents)&&void 0!==s?s:""};this.pixelStreaming.dispatchEvent(new Ot(r))}onProtocolMessage(e){try{const t=new TextDecoder("utf-16").decode(e.slice(1)),n=JSON.parse(t);Object.prototype.hasOwnProperty.call(n,"Direction")||d.Error("Malformed protocol received. Ensure the protocol message contains a direction");const i=n.Direction;delete n.Direction,d.Info(`Received new ${i==Hn.FromStreamer?"FromStreamer":"ToStreamer"} protocol. Updating existing protocol...`),Object.keys(n).forEach(e=>{const t=n[e];switch(i){case Hn.ToStreamer:if(!Object.prototype.hasOwnProperty.call(t,"id"))return void d.Error(`ToStreamer->${e} protocol definition was malformed as it didn't contain at least an id\n\n                                           Definition was: ${JSON.stringify(t,null,2)}`);if("UIInteraction"===e||"Command"===e||"LatencyTest"===e)return;this.streamMessageController.toStreamerHandlers.get(e)?this.streamMessageController.toStreamerMessages.set(e,t):d.Error(`There was no registered handler for "${e}" - try adding one using registerMessageHandler(MessageDirection.ToStreamer, "${e}", myHandler)`);break;case Hn.FromStreamer:if(!Object.prototype.hasOwnProperty.call(t,"id"))return void d.Error(`FromStreamer->${e} protocol definition was malformed as it didn't contain at least an id\n\n                            Definition was: ${JSON.stringify(t,null,2)}`);this.streamMessageController.fromStreamerHandlers.get(e)?this.streamMessageController.fromStreamerMessages.set(t.id,e):d.Error(`There was no registered handler for "${t}" - try adding one using registerMessageHandler(MessageDirection.FromStreamer, "${e}", myHandler)`);break;default:d.Error(`Unknown direction: ${i}`)}}),this.toStreamerMessagesController.SendRequestInitialSettings(),this.toStreamerMessagesController.SendRequestQualityControl()}catch(e){d.Info(e)}}onInputControlOwnership(e){const t=new Uint8Array(e);d.Info("DataChannelReceiveMessageType.InputControlOwnership");const n=new Boolean(t[1]).valueOf();d.Info(`Received input controller message - will your input control the stream: ${n}`),this.pixelStreaming._onInputControlOwnership(n)}onGamepadResponse(e){const t=new TextDecoder("utf-16").decode(e.slice(1)),n=JSON.parse(t);this.gamePadController.onGamepadResponseReceived(n.controllerId)}onAfkTriggered(){this.afkController.onAfkClick(),this.videoPlayer.isPaused()&&this.videoPlayer.hasVideoSource()&&this.playStream()}setAfkEnabled(e){e?this.onAfkTriggered():this.afkController.stopAfkWarningTimer()}tryReconnect(e){this.forceReconnect=!0,this.doReconnect(e)}doReconnect(e){this.protocol?(this.isReconnecting=!0,this.protocol.isConnected()?(this.forceReconnect||(this.disconnectMessage=`${e} Reconnecting.`),this.closeSignalingServer(e,!0)):this.connectToSignallingServer()):d.Info("This player has no protocol connection.")}loadFreezeFrameOrShowPlayOverlay(){this.pixelStreaming.dispatchEvent(new Mt({shouldShowPlayOverlay:this.shouldShowPlayOverlay,isValid:this.freezeFrameController.valid,jpegData:this.freezeFrameController.jpeg})),!0===this.shouldShowPlayOverlay?(d.Info("showing play overlay"),this.resizePlayerStyle()):(d.Info("showing freeze frame"),this.freezeFrameController.showFreezeFrame()),setTimeout(()=>{this.videoPlayer.setVideoEnabled(!1)},this.freezeFrameController.freezeFrameDelay)}onFreezeFrameMessage(e){d.Info("DataChannelReceiveMessageType.FreezeFrame");const t=new Uint8Array(e);this.freezeFrameController.processFreezeFrameMessage(t,()=>this.loadFreezeFrameOrShowPlayOverlay())}invalidateFreezeFrameAndEnableVideo(){d.Info("DataChannelReceiveMessageType.FreezeFrame"),setTimeout(()=>{this.pixelStreaming.dispatchEvent(new kt),this.freezeFrameController.hideFreezeFrame()},this.freezeFrameController.freezeFrameDelay),this.videoPlayer.getVideoElement()&&this.videoPlayer.setVideoEnabled(!0)}onFileExtension(e){const t=new Uint8Array(e);In.setExtensionFromBytes(t,this.file)}onFileMimeType(e){const t=new Uint8Array(e);In.setMimeTypeFromBytes(t,this.file)}onFileContents(e){const t=new Uint8Array(e);In.setContentsFromBytes(t,this.file)}playStream(){if(!this.videoPlayer.getVideoElement()){const e="Could not play video stream because the video player was not initialized correctly.";return this.pixelStreaming.dispatchEvent(new Et({message:e})),d.Error(e),void this.closeSignalingServer("Stream not initialized correctly",!1)}if(this.videoPlayer.hasVideoSource()){if(this.setTouchInputEnabled(this.config.isFlagEnabled(Kt.TouchInput)),this.pixelStreaming.dispatchEvent(new Tt),this.streamController.audioElement.srcObject){const e=this.config.isFlagEnabled(Kt.StartVideoMuted);this.streamController.audioElement.muted=e,e?this.playVideo():this.streamController.audioElement.play().then(()=>{this.playVideo()}).catch(e=>{d.Info(e),d.Info("Browser does not support autoplaying video without interaction - to resolve this we are going to show the play button overlay."),this.pixelStreaming.dispatchEvent(new xt({reason:e}))})}else this.playVideo();this.shouldShowPlayOverlay=!1,this.freezeFrameController.showFreezeFrame()}else d.Warning("Cannot play stream, the video element has no srcObject to play.")}playVideo(){this.videoPlayer.play().catch(e=>{this.streamController.audioElement.srcObject&&this.streamController.audioElement.pause(),d.Info(e),d.Info("Browser does not support autoplaying video without interaction - to resolve this we are going to show the play button overlay."),this.pixelStreaming.dispatchEvent(new xt({reason:e}))})}autoPlayVideoOrSetUpPlayOverlay(){this.config.isFlagEnabled(Kt.AutoPlayVideo)&&this.playStream(),this.resizePlayerStyle()}connectToSignallingServer(){this.locallyClosed=!1,this.enableAutoReconnect=!0,this.disconnectMessage=null;const e=this.signallingUrlBuilder();this.protocol.connect(e);const t=this.config.getNumericSettingValue(Gt.KeepaliveDelay);t>0&&(this.keepalive=new Qe(this.protocol,t),this.keepalive.onTimeout=()=>{d.Error("Protocol timeout")})}startSession(e){if(this.peerConfig=e,this.config.isFlagEnabled(Kt.ForceTURN)&&!this.checkTurnServerAvailability(e))return d.Info("No turn server was found in the Peer Connection Options. TURN cannot be forced, closing connection. Please use STUN instead"),void this.closeSignalingServer("TURN cannot be forced, closing connection. Please use STUN instead.",!1);this.peerConnectionController=new Cn(this.peerConfig,this.config,this.preferredCodec),this.peerConnectionController.onVideoStats=e=>{this.handleVideoStats(e)},this.peerConnectionController.onLatencyCalculated=e=>{this.pixelStreaming._onLatencyCalculated(e)},this.peerConnectionController.onSendWebRTCOffer=e=>{this.handleSendWebRTCOffer(e)},this.peerConnectionController.onSetLocalDescription=e=>{this.handleSendWebRTCAnswer(e)},this.peerConnectionController.onSetRemoteDescription=e=>{this.pixelStreaming._onWebRtcSdpOffer(e)},this.peerConnectionController.onPeerIceCandidate=e=>this.handleSendIceCandidate(e),this.peerConnectionController.onDataChannel=e=>this.handleDataChannel(e),this.peerConnectionController.showTextOverlayConnecting=()=>this.pixelStreaming._onWebRtcConnecting(),this.peerConnectionController.showTextOverlaySetupFailure=()=>this.pixelStreaming._onWebRtcFailed();let t=!1;this.peerConnectionController.onIceConnectionStateChange=()=>{!t&&["connected","completed"].includes(this.peerConnectionController.peerConnection.iceConnectionState)&&(void 0!==window.addToTimeRecords&&window.addToTimeRecords("iceConnectedAt",window.getCurrentDate()),this.pixelStreaming._onWebRtcConnected(),t=!0)},this.peerConnectionController.onTrack=e=>this.streamController.handleOnTrack(e)}checkTurnServerAvailability(e){if(!e.iceServers)return d.Info("A turn sever was not found"),!1;for(const t of e.iceServers)for(const e of t.urls)if(e.includes("turn"))return d.Info(`A turn sever was found at ${e}`),!0;return d.Info("A turn sever was not found"),!1}handleOnConfigMessage(e){this.resizePlayerStyle(),this.startSession(e.peerConnectionOptions)}handlePingMessage(e){this.protocol.sendMessage(qe(Oe,{time:e.time}))}handleStreamerListMessage(e){if(1==window.hasVideoStreamStarted2)return void console.dir("handleStreamerListMessage() window.hasVideoStreamStarted2 == true. so returnining");d.Info(`Got streamer list ${e.ids}`),console.dir(e);let t="";const n=this.config.getSettingOption(Zt.StreamerId);n.selected.toString().trim()&&(t=n.selected);const i=[...e.ids];i.unshift(""),this.config.setOptionSettingOptions(Zt.StreamerId,i);let s="";const r=this.config.isFlagEnabled(Kt.WaitForStreamer),o=this.config.getNumericSettingValue(Gt.MaxReconnectAttempts),a=this.config.getNumericSettingValue(Gt.StreamerAutoJoinInterval),l=this.config.useUrlParams,c=new Yn(window.location.search);l&&c.has(Zt.StreamerId)?t=window.uid:this.subscribedStream&&(t=this.subscribedStream),t&&e.ids.includes(t)?s=t:t&&r||1!=e.ids.length||(s=e.ids[0]),s?(this.reconnectAttempt=0,this.isReconnecting=!1,this.config.setOptionSettingValue(Zt.StreamerId,s)):r&&(this.reconnectAttempt<o?(this.reconnectAttempt++,this.isReconnecting=!0,setTimeout(()=>{var e,t=qe(Se);t.uid=window.uid,t.isSpectator=null===(e=window.req_data)||void 0===e?void 0:e.isSpectator,t.req_data=window.req_data,this.protocol.sendMessage(t)},a)):(this.reconnectAttempt=0,this.isReconnecting=!1,this.enableAutoReconnect=!1)),this.pixelStreaming.dispatchEvent(new Pt({messageStreamerList:e,autoSelectedStreamerId:s,wantedStreamerId:window.uid}))}handleSubscribeFailedMessage(e){this.reconnectAttempt=0,this.isReconnecting=!1,this.enableAutoReconnect=!1,this.pixelStreaming._onSubscribeFailed(e.message)}handleStreamerIDChangedMessage(e){const t=e.newID,n=this.config.getSettingOption(Zt.StreamerId),i=n.onChange;n.onChange=()=>{};const s=n.options;for(let e=0;e<s.length;++e)if(s[e]==this.subscribedStream){s[e]=t;break}n.options=s,n.selected=t,n.onChange=i,this.subscribedStream=e.newID,this.pixelStreaming.dispatchEvent(new Rt({newID:t}))}handleWebRtcAnswer(e){d.Info(`Got answer sdp ${e.sdp}`);const t={sdp:e.sdp,type:"answer"};this.peerConnectionController.receiveAnswer(t),this.handlePostWebrtcNegotiation()}handleWebRtcOffer(e){d.Info(`Got offer sdp ${e.sdp}`),this.isUsingSFU=!!e.sfu&&e.sfu,this.isUsingSVC=!!e.scalabilityMode&&"L1T1"!=e.scalabilityMode,(this.isUsingSFU||this.isUsingSVC)&&(this.peerConnectionController.preferredCodec="");const t=e.scalabilityMode?e.scalabilityMode:"L1T1";let n=["Default"];if(this.isUsingSFU)if(this.isUsingSVC){n=[];const e=+t[1],i=+t[3];for(let t=1;t<=e;t++)for(let e=1;e<=i;e++)n.push(`S${t}T${e}`)}else n=["Low","Medium","High"];this.config.setOptionSettingOptions(Zt.PreferredQuality,n),this.config.setOptionSettingValue(Zt.PreferredQuality,n.slice(-1)[0]);const i={sdp:e.sdp,type:"offer"};this.peerConnectionController.receiveOffer(i,this.config),this.handlePostWebrtcNegotiation()}handleWebRtcSFUPeerDatachannels(e){const t={ordered:!0,negotiated:!0,id:e.sendStreamId},n=e.sendStreamId!=e.recvStreamId;if(this.sendrecvDataChannelController.createDataChannel(this.peerConnectionController.peerConnection,n?"send-datachannel":"datachannel",t),n){const t={ordered:!0,negotiated:!0,id:e.recvStreamId};this.recvDataChannelController.createDataChannel(this.peerConnectionController.peerConnection,"recv-datachannel",t),this.recvDataChannelController.handleOnOpen=()=>this.protocol.sendMessage(qe(Ne)),this.recvDataChannelController.handleOnMessage=e=>this.handleOnMessage(e)}else this.sendrecvDataChannelController.handleOnMessage=e=>this.handleOnMessage(e)}handlePostWebrtcNegotiation(){this.afkController.startAfkWarningTimer(),this.pixelStreaming._onWebRtcSdp(),this.statsTimerHandle&&void 0!==this.statsTimerHandle&&window.clearInterval(this.statsTimerHandle),this.statsTimerHandle=window.setInterval(()=>this.getStats(),1e3),this.setMouseInputEnabled(this.config.isFlagEnabled(Kt.MouseInput)),this.setKeyboardInputEnabled(this.config.isFlagEnabled(Kt.KeyboardInput)),this.setGamePadInputEnabled(this.config.isFlagEnabled(Kt.GamepadInput))}handleIceCandidate(e){d.Info("Web RTC Controller: onWebRtcIce");const t=new RTCIceCandidate(e);this.peerConnectionController.handleOnIce(t)}handleSendIceCandidate(e){d.Info("OnIceCandidate"),e.candidate&&e.candidate.candidate&&this.protocol.sendMessage(qe(Re,{candidate:e.candidate}))}handleDataChannel(e){d.Info("Data channel created for us by browser as we are a receiving peer."),this.sendrecvDataChannelController.dataChannel=e.channel,this.sendrecvDataChannelController.setupDataChannel(),this.sendrecvDataChannelController.handleOnMessage=e=>this.handleOnMessage(e)}handleSendWebRTCOffer(e){d.Info("Sending the offer to the Server");const t={sdp:e.sdp,minBitrateBps:1e3*this.config.getNumericSettingValue(Gt.WebRTCMinBitrate),maxBitrateBps:1e3*this.config.getNumericSettingValue(Gt.WebRTCMaxBitrate)};this.protocol.sendMessage(qe(ke,t))}handleSendWebRTCAnswer(e){d.Info("Sending the answer to the Server");const t={sdp:e.sdp,minBitrateBps:1e3*this.config.getNumericSettingValue(Gt.WebRTCMinBitrate),maxBitrateBps:1e3*this.config.getNumericSettingValue(Gt.WebRTCMaxBitrate)};this.protocol.sendMessage(qe(Ie,t)),this.isUsingSFU&&this.protocol.sendMessage(qe(_e)),this.pixelStreaming._onWebRtcSdpAnswer(e)}setUpMouseAndFreezeFrame(){const e=this.videoPlayer.getVideoParentElement(),t=this.videoPlayer.getVideoElement();this.coordinateConverter.reconfigure({width:e.clientWidth,height:e.clientHeight},{width:t.videoWidth,height:t.videoHeight}),this.freezeFrameController.freezeFrame.resize()}closeSignalingServer(e,t){var n;this.locallyClosed=!0,this.enableAutoReconnect=t,this.disconnectMessage=e,null===(n=this.protocol)||void 0===n||n.disconnect(1e3,e)}closePeerConnection(){var e;null===(e=this.peerConnectionController)||void 0===e||e.close()}close(){this.closeSignalingServer("",!1),this.closePeerConnection()}getStats(){this.peerConnectionController.generateStats()}sendLatencyTest(){this.latencyStartTime=Date.now(),this.streamMessageController.toStreamerHandlers.get("LatencyTest")([JSON.stringify({StartTime:this.latencyStartTime})])}sendDataChannelLatencyTest(e){this.streamMessageController.toStreamerHandlers.get("DataChannelLatencyTest")([JSON.stringify(e)])}sendEncoderMinQP(e){d.Info(`MinQP=${e}\n`),null!=e&&this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"Encoder.MinQP":e})])}sendEncoderMaxQP(e){d.Info(`MaxQP=${e}\n`),null!=e&&this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"Encoder.MaxQP":e})])}sendEncoderMinQuality(e){d.Info(`MinQuality=${e}\n`),null!=e&&this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"Encoder.MinQuality":e})])}sendEncoderMaxQuality(e){d.Info(`MaxQuality=${e}\n`),null!=e&&this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"Encoder.MaxQuality":e})])}sendWebRTCMinBitrate(e){d.Info(`WebRTC Min Bitrate=${e}`),null!=e&&this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"WebRTC.MinBitrate":e})])}sendWebRTCMaxBitrate(e){d.Info(`WebRTC Max Bitrate=${e}`),null!=e&&this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"WebRTC.MaxBitrate":e})])}sendWebRTCFps(e){d.Info(`WebRTC FPS=${e}`),null!=e&&(this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"WebRTC.Fps":e})]),this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"WebRTC.MaxFps":e})]))}sendShowFps(){d.Info("----   Sending show stat to UE   ----"),this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({"stat.fps":""})])}sendIframeRequest(){d.Info("----   Sending Request for an IFrame  ----"),this.streamMessageController.toStreamerHandlers.get("IFrameRequest")()}emitUIInteraction(e){d.Info("----   Sending custom UIInteraction message   ----"),this.streamMessageController.toStreamerHandlers.get("UIInteraction")([JSON.stringify(e)])}emitCommand(e){d.Info("----   Sending custom Command message   ----"),this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify(e)])}emitConsoleCommand(e){d.Info("----   Sending custom Command:ConsoleCommand message   ----"),this.streamMessageController.toStreamerHandlers.get("Command")([JSON.stringify({ConsoleCommand:e})])}sendRequestQualityControlOwnership(){d.Info("----   Sending Request to Control Quality  ----"),this.toStreamerMessagesController.SendRequestQualityControl()}sendTextboxEntry(e){var t;d.Info("----   Sending TextboxEntry message  ----"),null===(t=this.streamMessageController.toStreamerHandlers.get("TextboxEntry"))||void 0===t||t([e])}handleLatencyTestResult(e){d.Info("DataChannelReceiveMessageType.latencyTest");const t=new TextDecoder("utf-16").decode(e.slice(1)),n=new kn;Object.assign(n,JSON.parse(t)),n.processFields(),n.testStartTimeMs=this.latencyStartTime,n.browserReceiptTimeMs=Date.now(),n.latencyExcludingDecode=~~(n.browserReceiptTimeMs-n.testStartTimeMs),n.testDuration=~~(n.TransmissionTimeMs-n.ReceiptTimeMs),n.networkLatency=~~(n.latencyExcludingDecode-n.testDuration),n.frameDisplayDeltaTimeMs&&n.browserReceiptTimeMs&&(n.endToEndLatency=(n.frameDisplayDeltaTimeMs,n.networkLatency,~~+n.CaptureToSendMs)),this.pixelStreaming._onLatencyTestResult(n)}handleDataChannelLatencyTestResponse(e){d.Info("DataChannelReceiveMessageType.dataChannelLatencyResponse");const t=new TextDecoder("utf-16").decode(e.slice(1)),n=JSON.parse(t);this.pixelStreaming._onDataChannelLatencyTestResponse(n)}handleInitialSettings(e){d.Info("DataChannelReceiveMessageType.InitialSettings");const t=new TextDecoder("utf-16").decode(e.slice(1)),n=JSON.parse(t),i=new En;n.Encoder&&(i.EncoderSettings=n.Encoder),n.WebRTC&&(i.WebRTCSettings=n.WebRTC),n.PixelStreaming&&(i.PixelStreamingSettings=n.PixelStreaming),n.ConfigOptions&&void 0!==n.ConfigOptions.DefaultToHover&&this.config.setFlagEnabled(Kt.HoveringMouseMode,!!n.ConfigOptions.DefaultToHover),i.ueCompatible(),d.Info(t),this.pixelStreaming._onInitialSettings(i)}handleVideoEncoderAvgQP(e){d.Info("DataChannelReceiveMessageType.VideoEncoderAvgQP");const t=Number(new TextDecoder("utf-16").decode(e.slice(1)));this.setVideoEncoderAvgQP(t)}handleVideoInitialized(){this.pixelStreaming._onVideoInitialized(),this.autoPlayVideoOrSetUpPlayOverlay(),this.resizePlayerStyle(),this.videoPlayer.updateVideoStreamSize()}onQualityControlOwnership(e){const t=new Uint8Array(e);d.Info("DataChannelReceiveMessageType.QualityControlOwnership"),this.isQualityController=new Boolean(t[1]).valueOf(),d.Info(`Received quality controller message, will control quality: ${this.isQualityController}`),this.pixelStreaming._onQualityControlOwnership(this.isQualityController)}handleVideoStats(e){this.pixelStreaming._onVideoStats(e)}resizePlayerStyle(){this.videoPlayer.resizePlayerStyle()}setPreferredCodec(e){this.preferredCodec=e,this.peerConnectionController&&(this.peerConnectionController.preferredCodec=e,this.peerConnectionController.updateCodecSelection=!1)}setVideoEncoderAvgQP(e){this.videoAvgQp=e,this.pixelStreaming._onVideoEncoderAvgQP(this.videoAvgQp)}setKeyboardInputEnabled(e){var t;null===(t=this.keyboardController)||void 0===t||t.unregister(),e&&(this.keyboardController=this.inputClassesFactory.registerKeyBoard(this.config))}setMouseInputEnabled(e){var t;if(null===(t=this.mouseController)||void 0===t||t.unregister(),e){const e=this.config.isFlagEnabled(Kt.HoveringMouseMode)?tn.HoveringMouse:tn.LockedMouse;this.mouseController=this.inputClassesFactory.registerMouse(e)}}setTouchInputEnabled(e){var t;null===(t=this.touchController)||void 0===t||t.unregister(),e&&(this.touchController=this.inputClassesFactory.registerTouch(this.config.isFlagEnabled(Kt.FakeMouseWithTouches)))}setGamePadInputEnabled(e){var t;null===(t=this.gamePadController)||void 0===t||t.unregister(),e&&(this.gamePadController=this.inputClassesFactory.registerGamePad())}registerDataChannelEventEmitters(e){e.onOpen=(e,t)=>this.pixelStreaming.dispatchEvent(new gt({label:e,event:t})),e.onClose=(e,t)=>this.pixelStreaming.dispatchEvent(new ft({label:e,event:t})),e.onError=(e,t)=>this.pixelStreaming.dispatchEvent(new yt({label:e,event:t}))}registerMessageHandler(e,t,n){t===Hn.FromStreamer&&void 0===n&&d.Warning(`Unable to register handler for ${e} as no handler was passed`),this.streamMessageController.registerMessageHandler(t,e,i=>void 0===n&&t===Hn.ToStreamer?this.sendMessageController.sendMessageToStreamer(e,i):n(i))}}class ti{constructor(e){this.toStreamerMessagesProvider=e,this.controllers=[]}updateStatus(e,t,n){if(e.gamepad){const i=t.getPose(e.gripSpace,n);if(!i)return;let s=0;e.profiles.includes("htc-vive")?s=1:e.profiles.includes("oculus-touch")&&(s=2),this.toStreamerMessagesProvider.toStreamerHandlers.get("XRSystem")([s]);let r=2;switch(e.handedness){case"left":r=0;break;case"right":r=1}const o=i.transform.matrix,a=[];for(let e=0;e<16;e++)a[e]=new Float32Array([o[e]])[0];this.toStreamerMessagesProvider.toStreamerHandlers.get("XRControllerTransform")([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15],r]),void 0===this.controllers[r]&&(this.controllers[r]={prevState:void 0,currentState:void 0,id:void 0},this.controllers[r].prevState=Vn(e.gamepad)),this.controllers[r].currentState=Vn(e.gamepad);const l=this.controllers[r],d=l.currentState,c=l.prevState;for(let e=0;e<d.buttons.length;e++){const t=d.buttons[e],n=c.buttons[e];if(t.pressed){const i=n.pressed?1:0;this.toStreamerMessagesProvider.toStreamerHandlers.get("XRButtonPressed")([r,e,i,t.value])}else n.pressed&&this.toStreamerMessagesProvider.toStreamerHandlers.get("XRButtonReleased")([r,e,0]);if(t.touched){const t=n.touched?1:0;this.toStreamerMessagesProvider.toStreamerHandlers.get("XRButtonTouched")([r,e,t])}else n.touched&&this.toStreamerMessagesProvider.toStreamerHandlers.get("XRButtonTouchReleased")([r,e,0])}for(let e=0;e<d.axes.length;e++){const t=d.axes[e];t!=c.axes[e]&&this.toStreamerMessagesProvider.toStreamerHandlers.get("XRAnalog")([r,e,t])}this.controllers[r].prevState=d}}}class ni{constructor(e){this.xrViewerPose=null,this.EPSILON=1e-7,this.videoTexture=null,this.prevVideoWidth=0,this.prevVideoHeight=0,this.leftView=null,this.rightView=null,this.lastSentLeftEyeProj=null,this.lastSentRightEyeProj=null,this.lastSentRelativeLeftEyePos=null,this.lastSentRelativeRightEyePos=null,this.xrSession=null,this.webRtcController=e,this.xrGamepadController=new ti(this.webRtcController.streamMessageController),this.onSessionEnded=new EventTarget,this.onSessionStarted=new EventTarget,this.onFrame=new EventTarget}xrClicked(){if(this.xrSession)this.xrSession.end();else{if(!navigator.xr)return void d.Error("This browser does not support XR.");navigator.xr.requestSession("immersive-vr",{optionalFeatures:[]}).then(e=>{this.onXrSessionStarted(e)})}}onXrSessionEnded(){d.Info("XR Session ended"),this.xrSession=null,this.onSessionEnded.dispatchEvent(new Event("xrSessionEnded"))}initGL(){if(this.gl)return;const e=document.createElement("canvas");this.gl=e.getContext("webgl2",{xrCompatible:!0}),this.gl.clearColor(0,0,0,1)}initShaders(){const e=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(e,"\n        attribute vec2 a_position;\n        attribute vec2 a_texCoord;\n\n        // varyings\n        varying vec2 v_texCoord;\n\n        void main() {\n           gl_Position = vec4(a_position.x, a_position.y, 0, 1);\n           // pass the texCoord to the fragment shader\n           // The GPU will interpolate this value between points.\n           v_texCoord = a_texCoord;\n        }\n        "),this.gl.compileShader(e);const t=this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(t,"\n        precision mediump float;\n\n        // our texture\n        uniform sampler2D u_image;\n\n        // the texCoords passed in from the vertex shader.\n        varying vec2 v_texCoord;\n\n        void main() {\n           gl_FragColor = texture2D(u_image, v_texCoord);\n        }\n        "),this.gl.compileShader(t);const n=this.gl.createProgram();this.gl.attachShader(n,e),this.gl.attachShader(n,t),this.gl.linkProgram(n),this.gl.useProgram(n),this.positionLocation=this.gl.getAttribLocation(n,"a_position"),this.texcoordLocation=this.gl.getAttribLocation(n,"a_texCoord")}updateVideoTexture(){this.videoTexture||(this.videoTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.videoTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR));const e=this.webRtcController.videoPlayer.getVideoElement().videoHeight,t=this.webRtcController.videoPlayer.getVideoElement().videoWidth;this.prevVideoHeight!=e||this.prevVideoWidth!=t?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.webRtcController.videoPlayer.getVideoElement()):this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,t,e,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.webRtcController.videoPlayer.getVideoElement()),this.prevVideoHeight=e,this.prevVideoWidth=t}initBuffers(){this.positionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,1,1,1,-1,-1,-1,-1,1,1,1,-1]),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.texcoordBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texcoordBuffer),this.gl.enableVertexAttribArray(this.texcoordLocation),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.texcoordLocation,2,this.gl.FLOAT,!1,0,0)}onXrSessionStarted(e){d.Info("XR Session started"),this.xrSession=e,this.xrSession.addEventListener("end",()=>{this.onXrSessionEnded()}),this.initGL(),this.initShaders(),this.initBuffers(),e.requestReferenceSpace("local").then(t=>{if(this.xrRefSpace=t,this.xrSession.updateRenderState({baseLayer:new XRWebGLLayer(this.xrSession,this.gl)}),this.xrSession.supportedFrameRates)for(const t of this.xrSession.supportedFrameRates)90==t&&e.updateTargetFrameRate(90);this.xrSession.requestAnimationFrame(this.onXrFrame.bind(this))}),this.onSessionStarted.dispatchEvent(new Event("xrSessionStarted"))}areArraysEqual(e,t){return e.length===t.length&&e.every((e,n)=>Math.abs(e-t[n])<=this.EPSILON)}arePointsEqual(e,t){return Math.abs(e.x-t.x)>=this.EPSILON&&Math.abs(e.y-t.y)>=this.EPSILON&&Math.abs(e.z-t.z)>=this.EPSILON}sendXRDataToUE(){var e;if(null==this.leftView||null==this.rightView)return;let t=null==this.lastSentLeftEyeProj||null==this.lastSentRightEyeProj||null==this.lastSentRelativeLeftEyePos||null==this.lastSentRelativeRightEyePos;const n=this.leftView.transform.matrix,i=this.leftView.projectionMatrix,s=this.rightView.transform.matrix,r=this.rightView.projectionMatrix,o=this.xrViewerPose.transform.matrix;if(!t&&null!=this.lastSentLeftEyeProj&&null!=this.lastSentRightEyeProj){const e=this.areArraysEqual(i,this.lastSentLeftEyeProj),n=this.areArraysEqual(r,this.lastSentRightEyeProj);t=0==e||0==n}const a=new DOMPointReadOnly(this.leftView.transform.position.x-this.xrViewerPose.transform.position.x,this.leftView.transform.position.y-this.xrViewerPose.transform.position.y,this.leftView.transform.position.z-this.xrViewerPose.transform.position.z,1),l=new DOMPointReadOnly(this.leftView.transform.position.x-this.xrViewerPose.transform.position.x,this.leftView.transform.position.y-this.xrViewerPose.transform.position.y,this.leftView.transform.position.z-this.xrViewerPose.transform.position.z,1);if(!t&&null!=this.lastSentRelativeLeftEyePos&&null!=this.lastSentRelativeRightEyePos){const e=this.arePointsEqual(a,this.lastSentRelativeLeftEyePos),n=this.arePointsEqual(l,this.lastSentRelativeRightEyePos);t=0==e||0==n}t?(this.webRtcController.streamMessageController.toStreamerHandlers.get("XREyeViews")([n[0],n[4],n[8],n[12],n[1],n[5],n[9],n[13],n[2],n[6],n[10],n[14],n[3],n[7],n[11],n[15],i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15],s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15],r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],r[3],r[7],r[11],r[15],o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]]),this.lastSentLeftEyeProj=i,this.lastSentRightEyeProj=r,this.lastSentRelativeLeftEyePos=a,this.lastSentRelativeRightEyePos=l):1==(null===(e=window.req_data)||void 0===e?void 0:e.isSpectator)||this.webRtcController.streamMessageController.toStreamerHandlers.get("XRHMDTransform")([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]])}onXrFrame(e,t){if(this.xrViewerPose=t.getViewerPose(this.xrRefSpace),this.xrViewerPose){if(this.updateViews(),null==this.leftView||null==this.rightView)return;this.sendXRDataToUE(),this.updateVideoTexture(),this.render()}this.webRtcController.config.isFlagEnabled(Kt.XRControllerInput)&&this.xrSession.inputSources.forEach((e,n,i)=>{this.xrGamepadController.updateStatus(e,t,this.xrRefSpace)},this),this.xrSession.requestAnimationFrame((e,t)=>this.onXrFrame(e,t)),this.onFrame.dispatchEvent(new Wt({time:e,frame:t}))}updateViews(){if(this.xrViewerPose)for(const e of this.xrViewerPose.views)"left"===e.eye?this.leftView=e:"right"===e.eye&&(this.rightView=e)}render(){if(!this.gl)return;const e=this.xrSession.renderState.baseLayer;this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e.framebuffer),this.gl.viewport(0,0,e.framebufferWidth,e.framebufferHeight),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}static isSessionSupported(e){return"https:"!==location.protocol&&d.Info("WebXR requires https, if you want WebXR use https."),navigator.xr?navigator.xr.isSessionSupported(e).catch(e=>(0!==window.isIniFrame&&window.isIniFrame()?console.warn(`${e}. For more information, please visit https://eagle3dstreaming.atlassian.net/wiki/spaces/docs/pages/748027907/Embed+Streaming+within+HTML+Webpage#4.-XR-Session-Permission`):console.warn(e),!1)):new Promise(()=>!1)}}class ii{constructor(e){this.seq=e.Seq,this.playerSentTimestamp=Date.now(),this.requestFillerSize=e.Filler?e.Filler.length:0}update(e){this.playerReceivedTimestamp=Date.now(),this.streamerReceivedTimestamp=e.ReceivedTimestamp,this.streamerSentTimestamp=e.SentTimestamp,this.responseFillerSize=e.Filler?e.Filler.length:0}}class si{constructor(e,t){this.intervalHandle=void 0,this.sink=e,this.callback=t,this.records=new Map,this.seq=0}start(e){return!this.isRunning()&&(this.startTime=Date.now(),this.records.clear(),this.intervalHandle=window.setInterval((()=>{Date.now()-this.startTime>=e.duration?this.stop():this.sendRequest(e.requestSize,e.responseSize)}).bind(this),Math.floor(1e3/e.rps)),!0)}stop(){this.intervalHandle&&(window.clearInterval(this.intervalHandle),this.intervalHandle=void 0,this.callback(this.produceResult()))}produceResult(){const e=new Map(this.records);return{records:e,dataChannelRtt:Math.ceil(Array.from(this.records.values()).reduce((e,t)=>e+(t.playerReceivedTimestamp-t.playerSentTimestamp),0)/this.records.size),playerToStreamerTime:Math.ceil(Array.from(this.records.values()).reduce((e,t)=>e+(t.streamerReceivedTimestamp-t.playerSentTimestamp),0)/this.records.size),streamerToPlayerTime:Math.ceil(Array.from(this.records.values()).reduce((e,t)=>e+(t.playerReceivedTimestamp-t.streamerSentTimestamp),0)/this.records.size),exportLatencyAsCSV:()=>{let t="Timestamp;RTT;PlayerToStreamer;StreamerToPlayer;\n";return e.forEach(e=>{t+=e.playerSentTimestamp+";",t+=e.playerReceivedTimestamp-e.playerSentTimestamp+";",t+=e.streamerReceivedTimestamp-e.playerSentTimestamp+";",t+=e.playerReceivedTimestamp-e.streamerSentTimestamp+";",t+="\n"}),t}}}isRunning(){return!!this.intervalHandle}receive(e){if(!this.isRunning())return;if(!e)return void d.Error("Undefined response from server");const t=this.records.get(e.Seq);t&&t.update(e)}sendRequest(e,t){const n=this.createRequest(e,t),i=new ii(n);this.records.set(i.seq,i),this.sink(n)}createRequest(e,t){return{Seq:this.seq++,FillResponseSize:t,Filler:e?"A".repeat(e):""}}}class ri{constructor(e,t){this.allowConsoleCommands=!1,this.config=e,(null==t?void 0:t.videoElementParent)&&(this._videoElementParent=t.videoElementParent),this._eventEmitter=new zt,this.configureSettings(),this.setWebRtcPlayerController(new ei(this.config,this)),this._webXrController=new ni(this._webRtcController),this._setupWebRtcTCPRelayDetection=this._setupWebRtcTCPRelayDetection.bind(this),this._eventEmitter.addEventListener("webRtcConnected",e=>{this._eventEmitter.addEventListener("statsReceived",this._setupWebRtcTCPRelayDetection)})}get videoElementParent(){return this._videoElementParent||(this._videoElementParent=document.createElement("div"),this._videoElementParent.id="videoElementParent"),this._videoElementParent}configureSettings(){this.config._addOnSettingChangedListener(Kt.IsQualityController,e=>{!0!==e||this._webRtcController.isQualityController||this._webRtcController.sendRequestQualityControlOwnership()}),this.config._addOnSettingChangedListener(Kt.AFKDetection,e=>{this._webRtcController.setAfkEnabled(e)}),this.config._addOnSettingChangedListener(Kt.MatchViewportResolution,()=>{this._webRtcController.videoPlayer.updateVideoStreamSize()}),this.config._addOnSettingChangedListener(Kt.HoveringMouseMode,e=>{this.config.setFlagLabel(Kt.HoveringMouseMode,`Control Scheme: ${e?"Hovering":"Locked"} Mouse`),this._webRtcController.setMouseInputEnabled(this.config.isFlagEnabled(Kt.MouseInput))}),this.config._addOnSettingChangedListener(Kt.KeyboardInput,e=>{this._webRtcController.setKeyboardInputEnabled(e)}),this.config._addOnSettingChangedListener(Kt.MouseInput,e=>{this._webRtcController.setMouseInputEnabled(e)}),this.config._addOnSettingChangedListener(Kt.FakeMouseWithTouches,e=>{this._webRtcController.setTouchInputEnabled(this.config.isFlagEnabled(Kt.TouchInput))}),this.config._addOnSettingChangedListener(Kt.TouchInput,e=>{this._webRtcController.setTouchInputEnabled(e)}),this.config._addOnSettingChangedListener(Kt.GamepadInput,e=>{this._webRtcController.setGamePadInputEnabled(e)}),this.config._addOnNumericSettingChangedListener(Gt.MinQP,e=>{d.Info("--------  Sending MinQP  --------"),this._webRtcController.sendEncoderMinQP(e),d.Info("-------------------------------------------");const t=Math.trunc(100*(1-e/51));this.config.setNumericSetting(Gt.CompatQualityMax,t)}),this.config._addOnNumericSettingChangedListener(Gt.MaxQP,e=>{d.Info("--------  Sending MaxQP  --------"),this._webRtcController.sendEncoderMaxQP(e),d.Info("-------------------------------------------");const t=Math.trunc(100*(1-e/51));this.config.setNumericSetting(Gt.CompatQualityMin,t)}),this.config._addOnNumericSettingChangedListener(Gt.MinQuality,e=>{d.Info("--------  Sending MinQuality  --------"),this._webRtcController.sendEncoderMinQuality(e),d.Info("-------------------------------------------"),this.config.setNumericSetting(Gt.CompatQualityMin,e)}),this.config._addOnNumericSettingChangedListener(Gt.MaxQuality,e=>{d.Info("--------  Sending MaxQuality  --------"),this._webRtcController.sendEncoderMaxQuality(e),d.Info("-------------------------------------------"),this.config.setNumericSetting(Gt.CompatQualityMax,e)}),this.config._addOnNumericSettingChangedListener(Gt.CompatQualityMin,e=>{e=51-e/100*51,d.Info("--------  Sending MinQP from quality value  --------"),this._webRtcController.sendEncoderMaxQP(e),d.Info("-------------------------------------------")}),this.config._addOnNumericSettingChangedListener(Gt.CompatQualityMax,e=>{e=51-e/100*51,d.Info("--------  Sending MaxQP from quality value  --------"),this._webRtcController.sendEncoderMinQP(e),d.Info("-------------------------------------------")}),this.config._addOnNumericSettingChangedListener(Gt.WebRTCMinBitrate,e=>{d.Info("--------  Sending web rtc settings  --------"),this._webRtcController.sendWebRTCMinBitrate(1e3*e),d.Info("-------------------------------------------")}),this.config._addOnNumericSettingChangedListener(Gt.WebRTCMaxBitrate,e=>{d.Info("--------  Sending web rtc settings  --------"),this._webRtcController.sendWebRTCMaxBitrate(1e3*e),d.Info("-------------------------------------------")}),this.config._addOnNumericSettingChangedListener(Gt.WebRTCFPS,e=>{d.Info("--------  Sending web rtc settings  --------"),this._webRtcController.sendWebRTCFps(e),d.Info("-------------------------------------------")}),this.config._addOnOptionSettingChangedListener(Zt.PreferredCodec,e=>{this._webRtcController&&this._webRtcController.setPreferredCodec(e)}),this.config._registerOnChangeEvents(this._eventEmitter)}_onInputControlOwnership(e){this._inputController=e}setWebRtcPlayerController(e){this._webRtcController=e,this._webRtcController.setPreferredCodec(this.config.getSettingOption(Zt.PreferredCodec).selected),this._webRtcController.resizePlayerStyle(),this.checkForAutoConnect()}connect(){this._eventEmitter.dispatchEvent(new St),this._webRtcController.connectToSignallingServer()}reconnect(){this._eventEmitter.dispatchEvent(new Ct),this._webRtcController.tryReconnect("Reconnecting...")}disconnect(){this._eventEmitter.dispatchEvent(new bt),this._webRtcController.close()}play(){this._onStreamLoading(),this._webRtcController.playStream()}checkForAutoConnect(){this.config.isFlagEnabled(Kt.AutoConnect)&&(this._onWebRtcAutoConnect(),this._webRtcController.connectToSignallingServer())}unmuteMicrophone(e=!1){if(!this.config.isFlagEnabled("UseMic"))return e?(this.config.setFlagEnabled("UseMic",!0),void this.reconnect()):void d.Warning("Trying to unmute mic, but PixelStreaming was initialized with no microphone track. Call with forceEnable == true to re-connect with a mic track.");this.setMicrophoneMuted(!1)}muteMicrophone(){this.config.isFlagEnabled("UseMic")?this.setMicrophoneMuted(!0):d.Info("Trying to mute mic, but PixelStreaming has no microphone track, so sending sound is already disabled.")}setMicrophoneMuted(e){var t,n,i,s;for(const r of null!==(s=null===(i=null===(n=null===(t=this._webRtcController)||void 0===t?void 0:t.peerConnectionController)||void 0===n?void 0:n.peerConnection)||void 0===i?void 0:i.getTransceivers())&&void 0!==s?s:[])gn.canTransceiverSendAudio(r)&&(r.sender.track.enabled=!e)}unmuteCamera(e=!1){if(!this.config.isFlagEnabled("UseCamera"))return e?(this.config.setFlagEnabled("UseCamera",!0),void this.reconnect()):void d.Warning("Trying to unmute video, but PixelStreaming was initialized with no video track. Call with forceEnable == true to re-connect with a video track.");this.setCameraMuted(!1)}muteCamera(){this.config.isFlagEnabled("UseCamera")?this.setCameraMuted(!0):d.Info("Trying to mute camera, but PixelStreaming has no video track, so sending video is already disabled.")}setCameraMuted(e){var t,n,i,s;for(const r of null!==(s=null===(i=null===(n=null===(t=this._webRtcController)||void 0===t?void 0:t.peerConnectionController)||void 0===n?void 0:n.peerConnection)||void 0===i?void 0:i.getTransceivers())&&void 0!==s?s:[])gn.canTransceiverSendVideo(r)&&(r.sender.track.enabled=!e)}_onWebRtcAutoConnect(){this._eventEmitter.dispatchEvent(new ct)}_onWebRtcSdp(){this._eventEmitter.dispatchEvent(new at)}_onWebRtcSdpOffer(e){this._eventEmitter.dispatchEvent(new dt({sdp:e}))}_onWebRtcSdpAnswer(e){this._eventEmitter.dispatchEvent(new lt({sdp:e}))}_onLatencyCalculated(e){this._eventEmitter.dispatchEvent(new Dt({latencyInfo:e}))}_onStreamLoading(){this._eventEmitter.dispatchEvent(new wt)}_onDisconnect(e,t){this._eventEmitter.dispatchEvent(new pt({eventString:e,allowClickToReconnect:t}))}_onWebRtcConnecting(){this._eventEmitter.dispatchEvent(new ht)}_onWebRtcConnected(){this._eventEmitter.dispatchEvent(new ut)}_onWebRtcFailed(){this._eventEmitter.dispatchEvent(new mt)}_onVideoInitialized(){this._eventEmitter.dispatchEvent(new vt),this._videoStartTime=Date.now()}_onLatencyTestResult(e){this._eventEmitter.dispatchEvent(new Lt({latencyTimings:e}))}_onDataChannelLatencyTestResponse(e){this._eventEmitter.dispatchEvent(new Ft({response:e}))}_onVideoStats(e){this._videoStartTime&&void 0!==this._videoStartTime||(this._videoStartTime=Date.now()),e.handleSessionStatistics(this._videoStartTime,this._inputController,this._webRtcController.videoAvgQp),this._eventEmitter.dispatchEvent(new It({aggregatedStats:e}))}_onVideoEncoderAvgQP(e){this._eventEmitter.dispatchEvent(new ot({avgQP:e}))}_onInitialSettings(e){var t;this._eventEmitter.dispatchEvent(new Ut({settings:e})),e.PixelStreamingSettings&&(this.allowConsoleCommands=null!==(t=e.PixelStreamingSettings.AllowPixelStreamingCommands)&&void 0!==t&&t,!1===this.allowConsoleCommands&&d.Info("-AllowPixelStreamingCommands=false, sending arbitrary console commands from browser to UE is disabled."));const n=this.config.useUrlParams,i=new Yn(window.location.search);d.Info(`using URL parameters ${n}`),e.EncoderSettings&&(e.EncoderSettings.MinQP&&(this.config.setNumericSetting(Gt.MinQP,n&&i.has(Gt.MinQP)?Number.parseFloat(i.get(Gt.MinQP)):e.EncoderSettings.MinQP||0),this.config.setNumericSetting(Gt.MaxQP,n&&i.has(Gt.MaxQP)?Number.parseFloat(i.get(Gt.MaxQP)):e.EncoderSettings.MaxQP||51)),e.EncoderSettings.MinQuality&&(this.config.setNumericSetting(Gt.MinQuality,n&&i.has(Gt.MinQuality)?Number.parseFloat(i.get(Gt.MinQuality)):e.EncoderSettings.MinQuality||0),this.config.setNumericSetting(Gt.MaxQuality,n&&i.has(Gt.MaxQuality)?Number.parseFloat(i.get(Gt.MaxQuality)):e.EncoderSettings.MaxQuality||100)),n&&(i.has(Gt.CompatQualityMin)&&this.config.setNumericSetting(Gt.CompatQualityMin,Number.parseFloat(i.get(Gt.CompatQualityMin))),i.has(Gt.CompatQualityMax)&&this.config.setNumericSetting(Gt.CompatQualityMax,Number.parseFloat(i.get(Gt.CompatQualityMax))))),e.WebRTCSettings&&(this.config.setNumericSetting(Gt.WebRTCMinBitrate,n&&i.has(Gt.WebRTCMinBitrate)?Number.parseFloat(i.get(Gt.WebRTCMinBitrate)):e.WebRTCSettings.MinBitrate/1e3),this.config.setNumericSetting(Gt.WebRTCMaxBitrate,n&&i.has(Gt.WebRTCMaxBitrate)?Number.parseFloat(i.get(Gt.WebRTCMaxBitrate)):e.WebRTCSettings.MaxBitrate/1e3),this.config.setNumericSetting(Gt.WebRTCFPS,n&&i.has(Gt.WebRTCFPS)?Number.parseFloat(i.get(Gt.WebRTCFPS)):e.WebRTCSettings.FPS))}_onQualityControlOwnership(e){this.config.setFlagEnabled(Kt.IsQualityController,e)}_onPlayerCount(e){this._eventEmitter.dispatchEvent(new Ht({count:e}))}_onSubscribeFailed(e){this._eventEmitter.dispatchEvent(new _t({message:e}))}_setupWebRtcTCPRelayDetection(e){const t=e.data.aggregatedStats.getActiveCandidatePair();if(null!=t){const n=e.data.aggregatedStats.localCandidates.find(e=>e.id==t.localCandidateId,null);null!=n&&"relay"==n.candidateType&&"tcp"==n.relayProtocol&&this._eventEmitter.dispatchEvent(new jt),this._eventEmitter.removeEventListener("statsReceived",this._setupWebRtcTCPRelayDetection)}}requestLatencyTest(){return!!this._webRtcController.videoPlayer.isVideoReady()&&(this._webRtcController.sendLatencyTest(),!0)}requestDataChannelLatencyTest(e){return!!this._webRtcController.videoPlayer.isVideoReady()&&(this._dataChannelLatencyTestController||(this._dataChannelLatencyTestController=new si(this._webRtcController.sendDataChannelLatencyTest.bind(this._webRtcController),e=>{this._eventEmitter.dispatchEvent(new At({result:e}))}),this.addEventListener("dataChannelLatencyTestResponse",({data:{response:e}})=>{this._dataChannelLatencyTestController.receive(e)})),this._dataChannelLatencyTestController.start(e))}requestShowFps(){return!!this._webRtcController.videoPlayer.isVideoReady()&&(this._webRtcController.sendShowFps(),!0)}requestIframe(){return!!this._webRtcController.videoPlayer.isVideoReady()&&(this._webRtcController.sendIframeRequest(),!0)}emitUIInteraction(e){return!!this._webRtcController.videoPlayer.isVideoReady()&&(this._webRtcController.emitUIInteraction(e),!0)}emitCommand(e){return!(!this._webRtcController.videoPlayer.isVideoReady()||!this.allowConsoleCommands&&"ConsoleCommand"in e||(this._webRtcController.emitCommand(e),0))}emitConsoleCommand(e){return!(!this.allowConsoleCommands||!this._webRtcController.videoPlayer.isVideoReady()||(this._webRtcController.emitConsoleCommand(e),0))}sendTextboxEntry(e){return!!this._webRtcController.videoPlayer.isVideoReady()&&(this._webRtcController.sendTextboxEntry(e),!0)}addResponseEventListener(e,t){this._webRtcController.responseController.addResponseEventListener(e,t)}removeResponseEventListener(e){this._webRtcController.responseController.removeResponseEventListener(e)}dispatchEvent(e){return this._eventEmitter.dispatchEvent(e)}addEventListener(e,t){this._eventEmitter.addEventListener(e,t)}removeEventListener(e,t){this._eventEmitter.removeEventListener(e,t)}toggleXR(){this.webXrController.xrClicked()}setSignallingUrlBuilder(e){this._webRtcController.signallingUrlBuilder=e}get webRtcController(){return this._webRtcController}get signallingProtocol(){return this._webRtcController.protocol}get webXrController(){return this._webXrController}registerMessageHandler(e,t,n){t!==Hn.FromStreamer||void 0!==n?t===Hn.ToStreamer&&void 0===n?this._webRtcController.streamMessageController.registerMessageHandler(t,e,t=>this._webRtcController.sendMessageController.sendMessageToStreamer(e,t)):this._webRtcController.streamMessageController.registerMessageHandler(t,e,e=>n(e)):d.Warning(`Unable to register an undefined handler for ${e}`)}get toStreamerHandlers(){return this._webRtcController.streamMessageController.toStreamerHandlers}isReconnecting(){return this._webRtcController.isReconnecting}}class oi{}var ai,li=n(63),di=n.n(li);class ci extends h{constructor(e){super(),this.WS_OPEN_STATE=1,e instanceof di()?(this.webSocket=e,this.setupSocketHandlers(),this.emit("open")):e&&(this.protocols=e)}sendMessage(e){this.webSocket&&this.webSocket.send(e)}connect(e){return this.webSocket=new(di())(e,this.protocols),this.setupSocketHandlers(),!0}disconnect(e,t){this.webSocket&&this.webSocket.close(e,t)}isConnected(){return!!this.webSocket&&this.webSocket.readyState!=di().CLOSED}handleOnMessage(e){this.onMessage&&this.onMessage(e.data)}handleOnOpen(e){this.emit("open",e)}handleOnError(e){this.emit("error",e)}handleOnClose(e){this.emit("close",e)}close(){var e;null===(e=this.webSocket)||void 0===e||e.close()}setupSocketHandlers(){this.webSocket&&(this.webSocket.addEventListener("open",this.handleOnOpen.bind(this)),this.webSocket.addEventListener("error",this.handleOnError.bind(this)),this.webSocket.addEventListener("close",this.handleOnClose.bind(this)),this.webSocket.addEventListener("message",this.handleOnMessage.bind(this)))}}class hi{constructor(e,t,n){this.rootDiv=e,this.rootElement=t,this.textElement=n,this.rootElement.appendChild(this.textElement),this.hide(),this.rootDiv.appendChild(this.rootElement)}show(){this.rootElement.classList.remove("hiddenState")}hide(){this.rootElement.classList.add("hiddenState")}}class ui extends hi{constructor(e,t,n){super(e,t,n),this.onActionCallback=()=>{d.Info("Did you forget to set the onAction callback in your overlay?")}}update(e){null==e&&null==e||(this.textElement.innerHTML=e)}onAction(e){this.onActionCallback=e}activate(){this.onActionCallback()}}class mi extends ui{static createRootElement(){const e=document.createElement("div");return e.id="connectOverlay",e.className="clickableState",e}static createContentElement(){const e=document.createElement("div");return e.id="connectButton",e.innerHTML="Click to start",e}constructor(e){super(e,mi.createRootElement(),mi.createContentElement()),this.rootElement.addEventListener("click",()=>{this.activate()})}}class pi extends ui{static createRootElement(){const e=document.createElement("div");return e.id="disconnectOverlay",e.className="clickableState",e}static createContentElement(){const e=document.createElement("div");return e.id="disconnectButton",e.innerHTML="Click To Restart",e}constructor(e){super(e,pi.createRootElement(),pi.createContentElement()),this.rootElement.addEventListener("click",()=>{this.activate()})}}class gi extends ui{static createRootElement(){const e=document.createElement("div");return e.id="playOverlay",e.className="clickableState",e}static createContentElement(){const e=document.createElement("img");return e.id="playButton",e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPEAAAD5CAYAAAD2mNNkAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMjHxIGmVAAASgklEQVR4Xu2dC7BdVX2HqUCCIRASCPjAFIQREBRBBSRYbFOt8lIrFUWRFqXWsT5wbItUqFWs0KqIMPKoYEWpRS06KDjS1BeVFkVQbCw+wCfiAwGhCKWP9PuZtU24uTe59zz22Y/vm/nGkXtz7jlrr9+sdfZea/03Wb169QtxGW62iYi0D8L7NbwYj8EdcdPyIxFpA4T2P/F/8Ua8CI/GhPnXyq+ISJMhrAlxxX9hRuYL8Sh8SPk1EWkqBHXdEFfcg6vw3fhs3Kb8uog0DQI6XYgr8rOvYsJ8OM4v/0xEmkIJ6ob4P8zIfANegCvQMIs0BQK5sRBXJMy/wIzM5+ByXFBeRkQmBUGcbYjX5S5MmM/AA3CL8nIiUjcEcJAQV9yBX8a/wSeiz5hF6obgDRPikGfMCfOX8DTcu7y0iNQBoRs2xBX/g3diwvwm3Kn8CREZJ4RtVCGuqMKcu9kn4xJ09ZfIuCBgow5xyJ3sTLNzAywrwF6J26NhFhk1BGscIV6XhPluvA6Pxx3KnxaRUUCoxh3iioQ5z5n/BY/FJeUtiMgwEKa6QlyRMN+Hn8Hn4ZblrYjIIBCiukMc8p25Ws6ZMD+zvB0RmSsEaBIhnkrew5V4EHrCiMhcKAFqCv+Nl+J+uBC9my2yMQhKk0Jcke/M78Gsy06YH1TerohMhYA0McQVP8Nz8UDcCl2bLTIVgtHkEFd8D8/E/XFrdGQWqSAQbQhxyKOpm/B03Ac9MkgkEIa2hLgiN78S5lPx0bgIvQEm/YUAtC3EFQnzzfgnuDc6zZZ+Qsdva4jX5Sv4atwXHZmlX9DhuxDikC2Qn8dXYUbmReUjinQbOntXQlyRTRafwldgwrxV+agi3YRO3rUQV/wcV+LL8DHoyZzSTejcXQ1xRc7/uhyzl3kv3Lx8dJFuQKfueohDnjFnZP4o/j7m0ZQH4Es3oDP3IcQV2f6YMF+COZjgUeiZ2dJu6MR9CvG63ILvx4zMCfO80iQi7YLO29cQV3wb34spsr4rumBE2gWdtu8hDln99S1MXeYX4M6leUSaDx3WEK8lRdYT5lR/zPlfnswpzYeOaojXJ4cSfB3Pw+fgtug0W5oJndMQT0/uZGeaXZVyfTZuV5pNpDnQMQ3xxsk0O9Ufz8ZDcdvSfCKThw5piGdP2ioF496JT0c3WcjkKR1T5kYWjCTM78DfQheMyOSgAxriwch35lR/vAbPwOXozS+pHzqeIR6Oal12wvx2fBy6yULqgw5niEdDwpyR+VpMkfXsmHIpp4wfOpohHj234RfwFNwDnWbL+KCDGeLxkJH5p3g1vg53K00uMlroXIZ4vGTBSMJ8FeZkzmWl6UVGA53KENfD/ZiyNCmynvO/FpdLIDIcdCZDXC8ZmfOd+d/wJejZXzIcdCJDXD95xpwjdnP+V74zH4Wu/pLBoPMY4smSMN+FKbJ+BBpmmRt0GkPcDBLmu/FjeAi6lFNmB53FEDeHTLPzaCoj80dwBfqMWTYMncQQN5esAPsw7lcul8j60EEMcfPJDbD3YU7l3KxcOpE10CkMcTvIVDvfmc/E3XELtPqjGOKWkhVgp+GemDD7vbnP0AEMcXtJkfU34GNxAToy9xEuvCFuP6vwJMyOqYXl0kpf4KIb4m5QncyZTRapZGGY+wIX2xB3i3vxOswmi13QaXbX4QIb4m6SY3a/iMdh7mYb5q7ChTXE3aXaaLESq7rMW5ZLL12Bi2qI+8E9eDkmzLuhYe4KXExD3B8yMt+Ol+KL0CLrXYCLaIj7R8J8K16CR6PLOdsMF88Q95fsmPoRXozPxdzNdvVX2+CiGWLJza+EOXWZj8Sd0APw2wIXyxBLqPYy34LnY8K8DA1z0+EiGWKZSgJ9I74LU2R9R3Sa3VS4OIZYZqJaynkWpsj6w0u3kSbBhTHEsjHuwxswpVwPw6Wl+0gT4IIYYpkNmWKnr1yPqf54KG5VupFMknJhRGZLwpzVX6n++DZ8GrpjapJwAQyxDELCnB1TqWTx1/gUdGSeBDS8IZZBSZBjzv76PP4VHoSGuU5ocEMsoyBhTsG4VH98Ix6A80s3k3FCQxtiGSVZMPIT/CwmzPuhz5jHCQ1siGUcZClnwvxpPAX3LF1ORg2Na4hlXGSKnQUjCfNn8PX4CNy0dD8ZBTSoIZZxkzBXI/Pn8ATMumzDPApoSEMsdZEw5zvzDzHT7JdjwuzZX8NAAxpimQSZZifMn8Tj8aGlS8pcofEMsUyKjMw5lTOnjHwcc2TQktI1ZbbQaIZYJk3CnE0WGZmvwOeh+5hnC41liKUpVCNzwvwJPBy9+bUxaCRDLE0jYb4fU/0x0+yD8cGly8pUaBxDLE0kQa7CfCfmML8D0SN2p0KjGGJpOglztWgkh/k9CT1it4LGMMTSFhLmLBrJ3exzcJ/SjfsNDWGIpY0k0D/AM/GRpTv3ExrAEEubqVaAnY5LsX93s/nQhli6QLUF8nWYI3bnYT+Wc/JBDbF0heqO9jfwlfhInI/dDjMf0BBLF0mYr8NsskiNqS2wm2Hmgxli6TJ5zpwjg/4Qd8buLRrhQxli6QM5ZjdHBh2H+c7cnUUjfBhDLH0hU+y7cCU+H7OXeV6JQnvhQxhi6RsJc0bmy/BZ+MsbYCUS7YM3b4ilryTM2QL5QUzBuHxnbt80mzdtiEVWr74NL8KUck2R9faMzLxZQyyyhozMWcp5If4uJszNP5yAN2mIRR5IVn/djOfhEdjsw/x4c4ZYZHryjPkmPBsPwYeV2DQL3pghFpmZTLFzZFDCnLrMz8DtsTkbLXgzhlhk4yTM2cu8CrNjKiNzwjz5OlO8CUMsMjcS5qzLfgumyPr2JU6TgTdgiEUGoyqynrrMv42TOTObP2yIRQYn0+ws5bwaU8r1N3HrEq964A8aYpHhSZjvwBSMS5gPwnrWZfOHDLHI6Mgz5hyxm4Jxf4kH4HjDzB8wxCKjJ2HONPuf8c9xHxzPXmZe2BCLjIdMsWMqWfwTnoiPwdGOzLygIRYZPwlzVWPqtbgXjmbBCC9kiEXqI8+Ys8nicnwN7laiODi8iCEWqZeMylmXnTCnYFxO5tyxRHLu8I8NschkSJizLvv7mJH5pbgY57Zjin9giEUmSzUyfw9TZP1Y3LZEdOPwy4ZYpBkkzKn++B38KB6F25Wozgy/ZIhFmkXCnLO/vosfwpwysqhEdn34oSEWaSYJ8y8w0+wP4GG4/oIR/qMhFmk2VZgzzU6Ys2Nq7T5m/o8hFmkHCXO2PybMF+O++CBDLNIuEuSsy8535lvxZEMs0j6qWszZJbXUEIu0i1vwrZhqFZv5nVikPWTqfA5mF9QDD+fjPxhikeaR777xdrwAn1Aiuz780BCLNIvsdMqBAqkNtRw3XBeKXzDEIpMno27Cezdeik/GBSWmG4ZfNMQikyPhzXrpVGXM6R8rcG7lVfkHhlikfhLe7FzKo6KV+Hu45m7zXOEfGmKReske4oT3k3gMblniOBi8gCEWqYeMvD/GK/F43KHEcDh4IUMsMl5yw+pHmLOoX4aDH8UzHbygIRYZD/nem5H3KjwBd8LRV1HkRQ2xyGjJ3eacNZ1iayfhr+P46hnz4oZYZDRk2pzwph7TX+CuOP76xfwRQywyHNlVVIX3VHx8iVc98AcNscjgZJFGypq+GffHwZ71DgN/1BCLzJ2f47/iWzBlTId71jsM/HFDLDI7crf5HrwG34YHY70FxaeDN2GIRTZMwpvjcK7Fd+BTcfLhreDNGGKRmcnIez2+Ew/FhTi3MivjhjdkiEXWJ0fEfhXPwmfi4hKZ5sGbM8Qia8n65lX4LkzlhYeVqDQX3qQhFlnzrPc/8FzMtsBl2Kxp80zwRg2x9J0cxn4epoBZlkjW/6x3GHjDhlj6SJZI5gTJ9+DzMeHdvMSiXfDGDbH0iWpbYMqgJLy7YLtG3qnwAQyx9IVsC7wEX4C74/h2FtUJH8QQS9fJUTg5QfI43APnle7fDfhAhli6So5//Ri+GBPeya1vHid8MEMsXSMH0X0CX4J74cLS3bsJH9AQS1fITavs6f1VeLEdz3qHgQ9piKXtZHNC1jfnELpfTpux++Gt4MMaYmkrmTZ/GV+LCW+3p80zwQc3xNI2skTyBswhdHtic7YFTgIawBBLm7gRT8HH4dbYn2nzTNAIhljaQCrkvwkT3tywGv8pkm2BxjDE0lRyokbOsjoDUyE/N6wM71RoFEMsTSPhvRPfjY/GBei0eSZoHEMsTeJ2/ADug+3cVVQ3NJQhliaQkfcf8SnoqDsXaDBDLJMij4ruxcvwaejIOwg0nCGWusnyyIT3CjwM+7lIY1TQgIZY6iA3qzLyZmdRSn0eic09QbJN0JCGWMZJwpuR9w78Er4Qu7klcFLQoIZYxkXq9OZuc2oWZXNCv5dHjgsa1hDLqKnCm2qB2Zzw0NLdZBzQwIZYRkWmzT/DhPdE3KV0MxknNLQhlmHJ996ENwXHsjkhq6xcHlkXNLYhlkFJeHPDKhvyszkh4W338a9thEY3xDJX8qgoGxMS3tTpfSzOL11K6obGN8QyWxLeLI/MtDmlPvdHp82ThotgiGU2ZOStwrsCXSLZFLgYhlg2xF2Yc6zOxqejCzWaBhfFEMt0pMj2VzB1eg/BJaXLSNPg4hhiqcjd5izUSIX8lPp8Fi4tXUWaChfJEEtIhfwU2b4QU2R7O3RfbxvgQhnifpOD17+JCW9KfS5F7zi3CS6YIe4nOXj9W/h3eAw+vHQJaRtcPEPcL/Ks92a8CI/FXdFpc5vhAhri/vB9/Hv8A3wUukSyC3AhDXH3+Sn+Ax6PqZDvEskuwQU1xN2kOgonJ0im1Gc2J2xRLrt0CS6sIe4W1c6ij2NG3lROmFcut3QRLrAh7g4J75X4R7g3Gt4+wIU2xO0n0+ZP4aswBcdc39wnuOCGuL3kWe/n8DW4Ly4ql1X6BBfeELeTL+AJ+ATcBn3W21e4+Ia4PeSO89fwT/GJuAhdItl36ASGuPlkZ9G38fWYo3Ay8hpeWQOdwRA3lxwBexO+GVPq07Insj50DEPcTLK++e2Yc6wWo995ZXroHIa4WdyKOQpnOWbavGm5VCLTQycxxM0gp0iej0/G3LAyvDI76CyGeHJUx+G8Hw9Ewytzh05jiCdDDqK7HA/Aheh3XhkMOo8hrpe096fxd9D9vDI8pVPJ+LkXP4vPQafMMjroUIZ4fOQ7b9Y3X4U5x8oi2zJ66FiGePRkeWROkfwiHoee3Szjgw5miEdDRt14D+bw9ZfjDqWZRcYHHc0QD091FE6OgP0z9OB1qQ86myEenKxtTngz8r4BHXmlfuh4hnjuJLwp9Zlqgafh7qU5ReqHDmiIZ0+mzVkeeQO+FR9fmlFkctARDfHsSJ3ef8dqZ5GH0EkzoDMa4pnJ3ea0T07TOAezvnlBaTqRZlA6qTyQhDdrm1fhBXgwGl5pJnROQ7yW6jlvwvtefAZuXppKpJmUTitrp80p9Zn1zQ8uTSTSbOisfQ9xps2pkJ/wPhe3K00j0g7otH0N8f34dXwfHo0W2ZZ2QuftY4izPDKnabwIH4Ee/yrthQ7clxBnldUP8BJ8MSa87uuV9kNH7nqIc4ZVwvshfCkuQ8Mr3YEO3dUQZ4nkD/HDmFKfe5SPLNIt6NxdDHHC+xF8BabsiSOvdBc6eJdCfBtehglvimz7rFe6Dx29CyHOQo0r8NWYOr0W2Zb+QIdva4izRDLPeldi6vSm1OfC8rFE+gMdv40hznu+GlMhfz/cEj0OR/oJnb9NIc57vQZPxCehI69ICUbTydnN1+LJmPAuKW9fRAhEk0OcZ73XYw6hOwg9v1lkKgSjqSHO5oRT8TdwKbq+WWQ6CEeTQpw7zlmocTqmTm/Ob7bomMiGICRNCHGmzT/BszClPjPyuspKZDYQlkmH+Mf4t7gct0enzSJzgdBMKsQJ70X4VHTkFRkUwlN3iFM54YN4KG6LHkQnMgyEqK4Q51nvpZjwZuQ1vCKjgDDVEeIr8XBMeL3bLDJKCNW4QpyR9zo8ArdBb1iJjAPCNeoQJ7ypFngszkc3JoiME0I2qhDnWW8Kjv0xujFBpC4I3DAhzgqrHESXUp/Z0/uQ8rIiUhcEb5AQJ7z34TfwJNy5vJyI1A0BnG2IE9yYsiffwTfizuh3XpFJQghnE+J83014v4upkL8r+qhIpAkQxg2FOOHNzzNtPhf3REdekSZRQjqVTJtzguSNeD4eWH5dRJoGAZ0a4rvxm3ghrkCnzSJNhpBWIc7/plpgwpudRZ7dLNIGCOvtJbwX42G4uPxIRNoAoU2d3iNxUflPItIaNtnk/wEGBoMdpECGHAAAAABJRU5ErkJggg==",e.alt="Start Streaming",e}constructor(e){super(e,gi.createRootElement(),gi.createContentElement()),this.rootElement.addEventListener("click",()=>{const e=window.getCurrentDate();void 0!==window.addToTimeRecords&&window.addToTimeRecords("playBtnClickedAt",e),this.activate()})}}class fi extends hi{constructor(e,t,n){super(e,t,n)}update(e){null==e&&null==e||(this.textElement.innerHTML=e)}}class yi extends fi{static createRootElement(){const e=document.createElement("div");return e.id="infoOverlay",e.className="textDisplayState",e}static createContentElement(){const e=document.createElement("div");return e.id="messageOverlayInner",e}constructor(e){super(e,yi.createRootElement(),yi.createContentElement())}}class vi extends fi{static createRootElement(){const e=document.createElement("div");return e.id="errorOverlay",e.className="textDisplayState",e}static createContentElement(){const e=document.createElement("div");return e.id="errorOverlayInner",e}constructor(e){super(e,vi.createRootElement(),vi.createContentElement())}}class wi extends ui{static createRootElement(){const e=document.createElement("div");return e.id="afkOverlay",e.className="clickableState",e}static createContentElement(){const e=document.createElement("div");return e.id="afkOverlayInner",e.innerHTML='<center>No activity detected<br>Disconnecting in <span id="afkCountDownNumber"></span> seconds<br>Click to continue<br></center>',e}constructor(e){super(e,wi.createRootElement(),wi.createContentElement()),this.rootElement.addEventListener("click",()=>{this.activate()})}updateCountdown(e){this.textElement.innerHTML=`<center>No activity detected<br>Disconnecting in <span id="afkCountDownNumber">${e}</span> seconds<br>Click to continue<br></center>`}}class Si{get rootElement(){return this._rootElement}set rootElement(e){e.onclick=()=>this.toggleFullscreen(),this._rootElement=e}constructor(){this.isFullscreen=!1,document.addEventListener("webkitfullscreenchange",()=>this.onFullscreenChange(),!1),document.addEventListener("mozfullscreenchange",()=>this.onFullscreenChange(),!1),document.addEventListener("fullscreenchange",()=>this.onFullscreenChange(),!1),document.addEventListener("MSFullscreenChange",()=>this.onFullscreenChange(),!1)}toggleFullscreen(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();else{const e=this.fullscreenElement;if(!e)return;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullscreen?e.mozRequestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitEnterFullscreen&&e.webkitEnterFullscreen()}this.onFullscreenChange()}onFullscreenChange(){this.isFullscreen=document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement&&null!==document.msFullscreenElement||document.fullscreenElement&&null!==document.fullscreenElement}}class bi extends Si{constructor(e){super(),this.rootElement=e}}class Ci extends Si{constructor(){super();const e=document.createElement("button");e.type="button",e.classList.add("UiTool"),e.id="fullscreen-btn",e.appendChild(this.maximizeIcon),e.appendChild(this.minimizeIcon),e.appendChild(this.tooltipText),this.rootElement=e}get tooltipText(){return this._tooltipText||(this._tooltipText=document.createElement("span"),this._tooltipText.classList.add("tooltiptext"),this._tooltipText.innerHTML="Fullscreen"),this._tooltipText}get maximizeIcon(){if(!this._maximizeIcon){this._maximizeIcon=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._maximizeIcon.setAttributeNS(null,"id","maximizeIcon"),this._maximizeIcon.setAttributeNS(null,"x","0px"),this._maximizeIcon.setAttributeNS(null,"y","0px"),this._maximizeIcon.setAttributeNS(null,"viewBox","0 0 384.97 384.97");const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("svgIcon"),this._maximizeIcon.appendChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d","M384.97,12.03c0-6.713-5.317-12.03-12.03-12.03H264.847c-6.833,0-11.922,5.39-11.934,12.223c0,6.821,5.101,11.838,11.934,11.838h96.062l-0.193,96.519c0,6.833,5.197,12.03,12.03,12.03c6.833-0.012,12.03-5.197,12.03-12.03l0.193-108.369c0-0.036-0.012-0.06-0.012-0.084C384.958,12.09,384.97,12.066,384.97,12.03z");const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttributeNS(null,"d","M120.496,0H12.403c-0.036,0-0.06,0.012-0.096,0.012C12.283,0.012,12.247,0,12.223,0C5.51,0,0.192,5.317,0.192,12.03L0,120.399c0,6.833,5.39,11.934,12.223,11.934c6.821,0,11.838-5.101,11.838-11.934l0.192-96.339h96.242c6.833,0,12.03-5.197,12.03-12.03C132.514,5.197,127.317,0,120.496,0z");const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M120.123,360.909H24.061v-96.242c0-6.833-5.197-12.03-12.03-12.03S0,257.833,0,264.667v108.092c0,0.036,0.012,0.06,0.012,0.084c0,0.036-0.012,0.06-0.012,0.096c0,6.713,5.317,12.03,12.03,12.03h108.092c6.833,0,11.922-5.39,11.934-12.223C132.057,365.926,126.956,360.909,120.123,360.909z");const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttributeNS(null,"d","M372.747,252.913c-6.833,0-11.85,5.101-11.838,11.934v96.062h-96.242c-6.833,0-12.03,5.197-12.03,12.03s5.197,12.03,12.03,12.03h108.092c0.036,0,0.06-0.012,0.084-0.012c0.036-0.012,0.06,0.012,0.096,0.012c6.713,0,12.03-5.317,12.03-12.03V264.847C384.97,258.014,379.58,252.913,372.747,252.913z"),e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(s)}return this._maximizeIcon}get minimizeIcon(){if(!this._minimizeIcon){this._minimizeIcon=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._minimizeIcon.setAttributeNS(null,"id","minimizeIcon"),this._minimizeIcon.setAttributeNS(null,"x","0px"),this._minimizeIcon.setAttributeNS(null,"y","0px"),this._minimizeIcon.setAttributeNS(null,"viewBox","0 0 385.331 385.331");const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("svgIcon"),this._minimizeIcon.appendChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d","M264.943,156.665h108.273c6.833,0,11.934-5.39,11.934-12.211c0-6.833-5.101-11.85-11.934-11.838h-96.242V36.181c0-6.833-5.197-12.03-12.03-12.03s-12.03,5.197-12.03,12.03v108.273c0,0.036,0.012,0.06,0.012,0.084c0,0.036-0.012,0.06-0.012,0.096C252.913,151.347,258.23,156.677,264.943,156.665z");const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttributeNS(null,"d","M120.291,24.247c-6.821,0-11.838,5.113-11.838,11.934v96.242H12.03c-6.833,0-12.03,5.197-12.03,12.03c0,6.833,5.197,12.03,12.03,12.03h108.273c0.036,0,0.06-0.012,0.084-0.012c0.036,0,0.06,0.012,0.096,0.012c6.713,0,12.03-5.317,12.03-12.03V36.181C132.514,29.36,127.124,24.259,120.291,24.247z");const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M120.387,228.666H12.115c-6.833,0.012-11.934,5.39-11.934,12.223c0,6.833,5.101,11.85,11.934,11.838h96.242v96.423c0,6.833,5.197,12.03,12.03,12.03c6.833,0,12.03-5.197,12.03-12.03V240.877c0-0.036-0.012-0.06-0.012-0.084c0-0.036,0.012-0.06,0.012-0.096C132.418,233.983,127.1,228.666,120.387,228.666z");const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttributeNS(null,"d","M373.3,228.666H265.028c-0.036,0-0.06,0.012-0.084,0.012c-0.036,0-0.06-0.012-0.096-0.012c-6.713,0-12.03,5.317-12.03,12.03v108.273c0,6.833,5.39,11.922,12.223,11.934c6.821,0.012,11.838-5.101,11.838-11.922v-96.242H373.3c6.833,0,12.03-5.197,12.03-12.03S380.134,228.678,373.3,228.666z"),e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(s)}return this._minimizeIcon}onFullscreenChange(){super.onFullscreenChange();const e=this.minimizeIcon,t=this.maximizeIcon;this.isFullscreen?(e.style.display="inline",e.style.transform="translate(0, 0)",t.style.display="none"):(e.style.display="none",t.style.display="inline",t.style.transform="translate(0, 0)")}}class Ei{get rootElement(){return this._rootElement||(this._rootElement=document.createElement("button"),this._rootElement.type="button",this._rootElement.classList.add("UiTool"),this._rootElement.id="settingsBtn",this._rootElement.appendChild(this.settingsIcon),this._rootElement.appendChild(this.tooltipText)),this._rootElement}get tooltipText(){return this._tooltipText||(this._tooltipText=document.createElement("span"),this._tooltipText.classList.add("tooltiptext"),this._tooltipText.innerHTML="Settings"),this._tooltipText}get settingsIcon(){if(!this._settingsIcon){this._settingsIcon=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._settingsIcon.setAttributeNS(null,"id","settingsIcon"),this._settingsIcon.setAttributeNS(null,"x","0px"),this._settingsIcon.setAttributeNS(null,"y","0px"),this._settingsIcon.setAttributeNS(null,"viewBox","0 0 478.703 478.703");const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("svgIcon"),this._settingsIcon.appendChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d","M454.2,189.101l-33.6-5.7c-3.5-11.3-8-22.2-13.5-32.6l19.8-27.7c8.4-11.8,7.1-27.9-3.2-38.1l-29.8-29.8\t\t\tc-5.6-5.6-13-8.7-20.9-8.7c-6.2,0-12.1,1.9-17.1,5.5l-27.8,19.8c-10.8-5.7-22.1-10.4-33.8-13.9l-5.6-33.2\t\t\tc-2.4-14.3-14.7-24.7-29.2-24.7h-42.1c-14.5,0-26.8,10.4-29.2,24.7l-5.8,34c-11.2,3.5-22.1,8.1-32.5,13.7l-27.5-19.8\t\t\tc-5-3.6-11-5.5-17.2-5.5c-7.9,0-15.4,3.1-20.9,8.7l-29.9,29.8c-10.2,10.2-11.6,26.3-3.2,38.1l20,28.1\t\t\tc-5.5,10.5-9.9,21.4-13.3,32.7l-33.2,5.6c-14.3,2.4-24.7,14.7-24.7,29.2v42.1c0,14.5,10.4,26.8,24.7,29.2l34,5.8\t\t\tc3.5,11.2,8.1,22.1,13.7,32.5l-19.7,27.4c-8.4,11.8-7.1,27.9,3.2,38.1l29.8,29.8c5.6,5.6,13,8.7,20.9,8.7c6.2,0,12.1-1.9,17.1-5.5\t\t\tl28.1-20c10.1,5.3,20.7,9.6,31.6,13l5.6,33.6c2.4,14.3,14.7,24.7,29.2,24.7h42.2c14.5,0,26.8-10.4,29.2-24.7l5.7-33.6\t\t\tc11.3-3.5,22.2-8,32.6-13.5l27.7,19.8c5,3.6,11,5.5,17.2,5.5l0,0c7.9,0,15.3-3.1,20.9-8.7l29.8-29.8c10.2-10.2,11.6-26.3,3.2-38.1\t\t\tl-19.8-27.8c5.5-10.5,10.1-21.4,13.5-32.6l33.6-5.6c14.3-2.4,24.7-14.7,24.7-29.2v-42.1\t\t\tC478.9,203.801,468.5,191.501,454.2,189.101z M451.9,260.401c0,1.3-0.9,2.4-2.2,2.6l-42,7c-5.3,0.9-9.5,4.8-10.8,9.9\t\t\tc-3.8,14.7-9.6,28.8-17.4,41.9c-2.7,4.6-2.5,10.3,0.6,14.7l24.7,34.8c0.7,1,0.6,2.5-0.3,3.4l-29.8,29.8c-0.7,0.7-1.4,0.8-1.9,0.8\t\t\tc-0.6,0-1.1-0.2-1.5-0.5l-34.7-24.7c-4.3-3.1-10.1-3.3-14.7-0.6c-13.1,7.8-27.2,13.6-41.9,17.4c-5.2,1.3-9.1,5.6-9.9,10.8l-7.1,42\t\t\tc-0.2,1.3-1.3,2.2-2.6,2.2h-42.1c-1.3,0-2.4-0.9-2.6-2.2l-7-42c-0.9-5.3-4.8-9.5-9.9-10.8c-14.3-3.7-28.1-9.4-41-16.8\t\t\tc-2.1-1.2-4.5-1.8-6.8-1.8c-2.7,0-5.5,0.8-7.8,2.5l-35,24.9c-0.5,0.3-1,0.5-1.5,0.5c-0.4,0-1.2-0.1-1.9-0.8l-29.8-29.8\t\t\tc-0.9-0.9-1-2.3-0.3-3.4l24.6-34.5c3.1-4.4,3.3-10.2,0.6-14.8c-7.8-13-13.8-27.1-17.6-41.8c-1.4-5.1-5.6-9-10.8-9.9l-42.3-7.2\t\t\tc-1.3-0.2-2.2-1.3-2.2-2.6v-42.1c0-1.3,0.9-2.4,2.2-2.6l41.7-7c5.3-0.9,9.6-4.8,10.9-10c3.7-14.7,9.4-28.9,17.1-42\t\t\tc2.7-4.6,2.4-10.3-0.7-14.6l-24.9-35c-0.7-1-0.6-2.5,0.3-3.4l29.8-29.8c0.7-0.7,1.4-0.8,1.9-0.8c0.6,0,1.1,0.2,1.5,0.5l34.5,24.6\t\t\tc4.4,3.1,10.2,3.3,14.8,0.6c13-7.8,27.1-13.8,41.8-17.6c5.1-1.4,9-5.6,9.9-10.8l7.2-42.3c0.2-1.3,1.3-2.2,2.6-2.2h42.1\t\t\tc1.3,0,2.4,0.9,2.6,2.2l7,41.7c0.9,5.3,4.8,9.6,10,10.9c15.1,3.8,29.5,9.7,42.9,17.6c4.6,2.7,10.3,2.5,14.7-0.6l34.5-24.8\t\t\tc0.5-0.3,1-0.5,1.5-0.5c0.4,0,1.2,0.1,1.9,0.8l29.8,29.8c0.9,0.9,1,2.3,0.3,3.4l-24.7,34.7c-3.1,4.3-3.3,10.1-0.6,14.7\t\t\tc7.8,13.1,13.6,27.2,17.4,41.9c1.3,5.2,5.6,9.1,10.8,9.9l42,7.1c1.3,0.2,2.2,1.3,2.2,2.6v42.1H451.9z");const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttributeNS(null,"d","M239.4,136.001c-57,0-103.3,46.3-103.3,103.3s46.3,103.3,103.3,103.3s103.3-46.3,103.3-103.3S296.4,136.001,239.4,136.001z M239.4,315.601c-42.1,0-76.3-34.2-76.3-76.3s34.2-76.3,76.3-76.3s76.3,34.2,76.3,76.3S281.5,315.601,239.4,315.601z"),e.appendChild(t),e.appendChild(n)}return this._settingsIcon}}class Ti{get rootElement(){return this._rootElement||(this._rootElement=document.createElement("button"),this._rootElement.type="button",this._rootElement.classList.add("UiTool"),this._rootElement.id="statsBtn",this._rootElement.appendChild(this.statsIcon),this._rootElement.appendChild(this.tooltipText)),this._rootElement}get tooltipText(){return this._tooltipText||(this._tooltipText=document.createElement("span"),this._tooltipText.classList.add("tooltiptext"),this._tooltipText.innerHTML="Information"),this._tooltipText}get statsIcon(){if(!this._statsIcon){this._statsIcon=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._statsIcon.setAttributeNS(null,"id","statsIcon"),this._statsIcon.setAttributeNS(null,"x","0px"),this._statsIcon.setAttributeNS(null,"y","0px"),this._statsIcon.setAttributeNS(null,"viewBox","0 0 330 330");const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("svgIcon"),this._statsIcon.appendChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d","M165,0.008C74.019,0.008,0,74.024,0,164.999c0,90.977,74.019,164.992,165,164.992s165-74.015,165-164.992C330,74.024,255.981,0.008,165,0.008z M165,299.992c-74.439,0-135-60.557-135-134.992S90.561,30.008,165,30.008s135,60.557,135,134.991C300,239.436,239.439,299.992,165,299.992z");const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttributeNS(null,"d","M165,130.008c-8.284,0-15,6.716-15,15v99.983c0,8.284,6.716,15,15,15s15-6.716,15-15v-99.983C180,136.725,173.284,130.008,165,130.008z");const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M165,70.011c-3.95,0-7.811,1.6-10.61,4.39c-2.79,2.79-4.39,6.66-4.39,10.61s1.6,7.81,4.39,10.61c2.79,2.79,6.66,4.39,10.61,4.39s7.81-1.6,10.609-4.39c2.79-2.8,4.391-6.66,4.391-10.61s-1.601-7.82-4.391-10.61C172.81,71.61,168.95,70.011,165,70.011z"),e.appendChild(t),e.appendChild(n),e.appendChild(i)}return this._statsIcon}}class xi{get rootElement(){return this._rootElement||(this._rootElement=document.createElement("button"),this._rootElement.type="button",this._rootElement.classList.add("UiTool"),this._rootElement.id="xrBtn",this._rootElement.appendChild(this.xrIcon),this._rootElement.appendChild(this.tooltipText)),this._rootElement}get tooltipText(){return this._tooltipText||(this._tooltipText=document.createElement("span"),this._tooltipText.classList.add("tooltiptext"),this._tooltipText.innerHTML="XR"),this._tooltipText}get xrIcon(){if(!this._xrIcon){this._xrIcon=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._xrIcon.setAttributeNS(null,"id","xrIcon"),this._xrIcon.setAttributeNS(null,"x","0px"),this._xrIcon.setAttributeNS(null,"y","0px"),this._xrIcon.setAttributeNS(null,"viewBox","0 0 100 100");const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("svgIcon"),this._xrIcon.appendChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttributeNS(null,"d","M29 41c-5 0-9 4-9 9s4 9 9 9 9-4 9-9-4-9-9-9zm0 14c-2.8 0-5-2.2-5-5s2.2-5 5-5 5 2.2 5 5-2.2 5-5 5zm42-14c-5 0-9 4-9 9s4 9 9 9 9-4 9-9-4-9-9-9zm0 14c-2.8 0-5-2.2-5-5s2.2-5 5-5 5 2.2 5 5-2.2 5-5 5zm12-31H17c-6.6 0-12 5.4-12 12v28c0 6.6 5.4 12 12 12h14.5c3.5 0 6.8-1.5 9-4.1l3.5-4c1.5-1.7 3.7-2.7 6-2.7s4.5 1 6 2.7l3.5 4c2.3 2.6 5.6 4.1 9 4.1H83c6.6 0 12-5.4 12-12V36c0-6.6-5.4-12-12-12zm8 40c0 4.4-3.6 8-8 8H68.5c-2.3 0-4.5-1-6-2.7l-3.5-4c-2.3-2.6-5.6-4.1-9-4.1-3.5 0-6.8 1.5-9 4.1l-3.5 4C36 71 33.8 72 31.5 72H17c-4.4 0-8-3.6-8-8V36c0-4.4 3.6-8 8-8h66c4.4 0 8 3.6 8 8v28z"),e.appendChild(t)}return this._xrIcon}}class Mi{}Mi.LightMode="LightMode";class ki{}ki.PixelStreaming="Pixel Streaming",ki.UI="UI",ki.Input="Input",ki.Encoder="Encoder",ki.WebRTC="WebRTC",ki.Commands="Commands";class Ii{}function Pi(e){return!e||!!e&&e.isEnabled}function Ri(e,t){return!e||!!e&&(!Object.prototype.hasOwnProperty.call(e.sectionVisibility,t)||Object.prototype.hasOwnProperty.call(e.sectionVisibility,t)&&e.sectionVisibility[t])}function Li(e,t){return!e||!!e&&(!Object.prototype.hasOwnProperty.call(e.settingVisibility,t)||Object.prototype.hasOwnProperty.call(e.settingVisibility,t)&&e.settingVisibility[t])}function Di(e){return null==e||e.creationMode===ai.CreateDefaultElement}Ii.SessionStats="Session Stats",Ii.LatencyStats="Latency Stats",Ii.LatencyTest="Latency Test",Ii.DataChannelLatencyTest="Data Channel Latency Test",function(e){e[e.CreateDefaultElement=0]="CreateDefaultElement",e[e.UseCustomElement=1]="UseCustomElement",e[e.Disable=2]="Disable"}(ai||(ai={}));class Oi{constructor(e){this.config=e,e&&!Di(e.statsButtonType)||(this.statsIcon=new Ti),e&&!Di(e.settingsButtonType)||(this.settingsIcon=new Ei),e&&!Di(e.fullscreenButtonType)||(this.fullscreenIcon=new Ci),e&&!Di(e.xrIconType)||(this.xrIcon=new xi)}get rootElement(){return this._rootElement||(this._rootElement=document.createElement("div"),this._rootElement.id="controls",this.fullscreenIcon&&this._rootElement.appendChild(this.fullscreenIcon.rootElement),this.settingsIcon&&this._rootElement.appendChild(this.settingsIcon.rootElement),this.statsIcon&&this._rootElement.appendChild(this.statsIcon.rootElement),this.xrIcon&&ni.isSessionSupported("immersive-vr").then(e=>{e&&this._rootElement.appendChild(this.xrIcon.rootElement)}),document.addEventListener("fullscreenchange",this.handleFullscreenChange.bind(this))),this._rootElement}handleFullscreenChange(){var e;document.fullscreenElement&&(null===(e=this.config)||void 0===e?void 0:e.hideControlsInFullscreen)?this._rootElement.style.visibility="hidden":this._rootElement.style.visibility="visible"}}class Fi{constructor(e,t){this._label=e,this._buttonText=t}addOnClickListener(e){this.button.addEventListener("click",e)}get button(){return this._button||(this._button=document.createElement("input"),this._button.type="button",this._button.value=this._buttonText,this._button.classList.add("overlay-button"),this._button.classList.add("btn-flat")),this._button}get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("div"),this._rootElement.classList.add("setting");const e=document.createElement("div");e.innerText=this._label,this._rootElement.appendChild(e);const t=document.createElement("label");t.classList.add("btn-overlay"),this._rootElement.appendChild(t),t.appendChild(this.button)}return this._rootElement}}class Ai{constructor(){this._rootElement=null}get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("div"),this._rootElement.id="settings-panel",this._rootElement.classList.add("panel-wrap");const e=document.createElement("div");e.classList.add("panel"),this._rootElement.appendChild(e);const t=document.createElement("div");t.id="settingsHeading",t.textContent="Settings",e.appendChild(t),e.appendChild(this.settingsCloseButton),e.appendChild(this.settingsContentElement)}return this._rootElement}get settingsContentElement(){return this._settingsContentElement||(this._settingsContentElement=document.createElement("div"),this._settingsContentElement.id="settingsContent"),this._settingsContentElement}get settingsCloseButton(){return this._settingsCloseButton||(this._settingsCloseButton=document.createElement("div"),this._settingsCloseButton.id="settingsClose"),this._settingsCloseButton}show(){this.rootElement.classList.contains("panel-wrap-visible")||this.rootElement.classList.add("panel-wrap-visible")}toggleVisibility(){this.rootElement.classList.toggle("panel-wrap-visible")}hide(){this.rootElement.classList.contains("panel-wrap-visible")&&this.rootElement.classList.remove("panel-wrap-visible")}}class _i{get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("section"),this._rootElement.classList.add("settingsContainer");const e=document.createElement("div");e.id="latencyTestHeader",e.classList.add("settings-text"),e.classList.add("settingsHeader"),this._rootElement.appendChild(e);const t=document.createElement("div");t.innerHTML=Ii.LatencyTest,e.appendChild(t),e.appendChild(this.latencyTestButton);const n=document.createElement("div");n.id="latencyTestContainer",n.classList.add("d-none"),this._rootElement.appendChild(n),n.appendChild(this.latencyTestResultsElement)}return this._rootElement}get latencyTestResultsElement(){return this._latencyTestResultsElement||(this._latencyTestResultsElement=document.createElement("div"),this._latencyTestResultsElement.id="latencyStatsResults",this._latencyTestResultsElement.classList.add("StatsResult")),this._latencyTestResultsElement}get latencyTestButton(){return this._latencyTestButton||(this._latencyTestButton=document.createElement("input"),this._latencyTestButton.type="button",this._latencyTestButton.value="Run Test",this._latencyTestButton.id="btn-start-latency-test",this._latencyTestButton.classList.add("streamTools-button"),this._latencyTestButton.classList.add("btn-flat")),this._latencyTestButton}handleTestResult(e){d.Info(JSON.stringify(e));let t="";void 0!==e.networkLatency&&e.networkLatency>0&&(t+="<div>Net latency RTT (ms): "+e.networkLatency+"</div>"),void 0!==e.EncodeMs&&e.EncodeMs>0&&(t+="<div>UE Encode (ms): "+e.EncodeMs+"</div>"),void 0!==e.CaptureToSendMs&&e.CaptureToSendMs>0&&(t+="<div>UE Capture (ms): "+e.CaptureToSendMs+"</div>"),void 0!==e.browserSendLatency&&e.browserSendLatency>0&&(t+="<div>Browser send latency (ms): "+e.browserSendLatency+"</div>"),void 0!==e.frameDisplayDeltaTimeMs&&void 0!==e.browserReceiptTimeMs&&(t+=e.frameDisplayDeltaTimeMs&&e.browserReceiptTimeMs?"<div>Browser receive latency (ms): "+e.frameDisplayDeltaTimeMs+"</div>":""),void 0!==e.latencyExcludingDecode&&(t+="<div>Total latency (excluding browser) (ms): "+e.latencyExcludingDecode+"</div>"),void 0!==e.endToEndLatency&&(t+=e.endToEndLatency?"<div>Total latency (ms): "+e.endToEndLatency+"</div>":""),this.latencyTestResultsElement.innerHTML=t}}class Ui{static formatBytes(e,t){if(0===e)return"0";const n=t<0?0:t,i=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,i)).toFixed(n))+" "+["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"][i]}}class Ni{get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("section"),this._rootElement.classList.add("settingsContainer");const e=document.createElement("div");e.id="dataChannelLatencyTestHeader",e.classList.add("settings-text"),e.classList.add("settingsHeader"),this._rootElement.appendChild(e);const t=document.createElement("div");t.innerHTML=Ii.DataChannelLatencyTest,e.appendChild(t),e.appendChild(this.latencyTestButton);const n=document.createElement("div");n.id="dataChannelLatencyTestContainer",n.classList.add("d-none"),this._rootElement.appendChild(n),n.appendChild(this.latencyTestResultsElement)}return this._rootElement}get latencyTestResultsElement(){return this._latencyTestResultsElement||(this._latencyTestResultsElement=document.createElement("div"),this._latencyTestResultsElement.id="dataChannelLatencyStatsResults",this._latencyTestResultsElement.classList.add("StatsResult")),this._latencyTestResultsElement}get latencyTestButton(){return this._latencyTestButton||(this._latencyTestButton=document.createElement("input"),this._latencyTestButton.type="button",this._latencyTestButton.value="Run Test",this._latencyTestButton.id="btn-start-data-channel-latency-test",this._latencyTestButton.classList.add("streamTools-button"),this._latencyTestButton.classList.add("btn-flat")),this._latencyTestButton}handleTestResult(e){if(d.Info(JSON.stringify(e)),isNaN(e.dataChannelRtt))return void(this.latencyTestResultsElement.innerHTML="<div>Not supported</div>");let t="";t+="<div>Data channel RTT (ms): "+e.dataChannelRtt+"</div>",e.playerToStreamerTime>=0&&e.streamerToPlayerTime>=0&&(t+="<div>Player to Streamer path (ms): "+e.playerToStreamerTime+"</div>",t+="<div>Streamer to Player path (ms): "+e.streamerToPlayerTime+"</div>"),this.latencyTestResultsElement.innerHTML=t;const n=document.createElement("input");n.type="button",n.value="Download",n.classList.add("streamTools-button"),n.classList.add("btn-flat"),n.onclick=()=>{const t=new Blob([e.exportLatencyAsCSV()],{type:"text/plain"}),n=document.createElement("a"),i=URL.createObjectURL(t);n.href=i,n.download="data_channel_latency_test_results.csv",document.body.appendChild(n),n.click(),setTimeout(function(){document.body.removeChild(n),window.URL.revokeObjectURL(i)},0)},this.latencyTestResultsElement.appendChild(n)}handleTestStart(){this.latencyTestResultsElement.innerHTML="<div>Test in progress</div>"}}class Bi{}class Vi{constructor(e){this.statsMap=new Map,this._config=e,this.latencyTest=new _i,this.dataChannelLatencyTest=new Ni}get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("div"),this._rootElement.id="stats-panel",this._rootElement.classList.add("panel-wrap");const e=document.createElement("div");e.classList.add("panel"),this._rootElement.appendChild(e);const t=document.createElement("div");t.id="statsHeading",t.textContent="Information",e.appendChild(t),e.appendChild(this.statsCloseButton),e.appendChild(this.statsContentElement)}return this._rootElement}get statsContentElement(){if(!this._statsContentElement){this._statsContentElement=document.createElement("div"),this._statsContentElement.id="statsContent";const e=document.createElement("div");e.id="streamToolsStats",e.classList.add("container");const t=document.createElement("div");t.id="ControlStats",t.classList.add("row");const n=document.createElement("section");n.id="statistics",n.classList.add("settingsContainer");const i=document.createElement("section");i.id="latencyStats",i.classList.add("settingsContainer");const s=document.createElement("div");s.id="statisticsHeader",s.classList.add("settings-text"),s.classList.add("settingsHeader");const r=document.createElement("div");if(r.id="latencyStatsHeader",r.classList.add("settings-text"),r.classList.add("settingsHeader"),this._statsContentElement.appendChild(e),e.appendChild(t),t.appendChild(n),t.appendChild(i),n.appendChild(s),i.appendChild(r),Ri(this._config,Ii.SessionStats)){const e=document.createElement("div");e.innerHTML=Ii.SessionStats,s.appendChild(e)}if(n.appendChild(this.statisticsContainer),Ri(this._config,Ii.LatencyStats)){const e=document.createElement("div");e.innerHTML=Ii.LatencyStats,r.appendChild(e)}i.appendChild(this.latencyStatsContainer),Ri(this._config,Ii.LatencyTest)&&t.appendChild(this.latencyTest.rootElement),Ri(this._config,Ii.DataChannelLatencyTest)&&t.appendChild(this.dataChannelLatencyTest.rootElement)}return this._statsContentElement}get statisticsContainer(){return this._statisticsContainer||(this._statisticsContainer=document.createElement("div"),this._statisticsContainer.id="statisticsContainer",this._statisticsContainer.classList.add("d-none"),this._statisticsContainer.appendChild(this.statsResult)),this._statisticsContainer}get latencyStatsContainer(){return this._latencyStatsContainer||(this._latencyStatsContainer=document.createElement("div"),this._latencyStatsContainer.id="latencyStatsContainer",this._latencyStatsContainer.classList.add("d-none"),this._latencyStatsContainer.appendChild(this.latencyResult)),this._latencyStatsContainer}get statsResult(){return this._statsResult||(this._statsResult=document.createElement("div"),this._statsResult.id="statisticsResult",this._statsResult.classList.add("StatsResult")),this._statsResult}get latencyResult(){return this._latencyResult||(this._latencyResult=document.createElement("div"),this._latencyResult.id="latencyResult",this._latencyResult.classList.add("StatsResult")),this._latencyResult}get statsCloseButton(){return this._statsCloseButton||(this._statsCloseButton=document.createElement("div"),this._statsCloseButton.id="statsClose"),this._statsCloseButton}onDisconnect(){this.latencyTest.latencyTestButton.onclick=()=>{},this.dataChannelLatencyTest.latencyTestButton.onclick=()=>{}}onVideoInitialized(e){this.latencyTest.latencyTestButton.onclick=()=>{e.requestLatencyTest()},this.dataChannelLatencyTest.latencyTestButton.onclick=()=>{e.requestDataChannelLatencyTest({duration:1e3,rps:10,requestSize:200,responseSize:200})&&this.dataChannelLatencyTest.handleTestStart()}}configure(e){e.DisableLatencyTest&&(this.latencyTest.latencyTestButton.disabled=!0,this.latencyTest.latencyTestButton.title="Disabled by -PixelStreamingDisableLatencyTester=true",this.dataChannelLatencyTest.latencyTestButton.disabled=!0,this.dataChannelLatencyTest.latencyTestButton.title="Disabled by -PixelStreamingDisableLatencyTester=true",d.Info("-PixelStreamingDisableLatencyTester=true, requesting latency report from the the browser to UE is disabled."))}show(){this.rootElement.classList.contains("panel-wrap-visible")||this.rootElement.classList.add("panel-wrap-visible")}toggleVisibility(){this.rootElement.classList.toggle("panel-wrap-visible")}hide(){this.rootElement.classList.contains("panel-wrap-visible")&&this.rootElement.classList.remove("panel-wrap-visible")}handlePlayerCount(e){this.addOrUpdateSessionStat("PlayerCountStat","Players",e.toString())}handleStats(e){var t,n,i,s;const r=new Intl.NumberFormat(window.navigator.language,{maximumFractionDigits:0}),o=Ui.formatBytes(e.inboundVideoStats.bytesReceived,2);this.addOrUpdateSessionStat("InboundDataStat","Received",o);const a=Object.prototype.hasOwnProperty.call(e.inboundVideoStats,"packetsLost")?r.format(e.inboundVideoStats.packetsLost):"Chrome only";this.addOrUpdateSessionStat("PacketsLostStat","Packets Lost",a),e.inboundVideoStats.bitrate&&this.addOrUpdateSessionStat("VideoBitrateStat","Video Bitrate (kbps)",e.inboundVideoStats.bitrate.toString()),e.inboundAudioStats.bitrate&&this.addOrUpdateSessionStat("AudioBitrateStat","Audio Bitrate (kbps)",e.inboundAudioStats.bitrate.toString());const l=void 0!==e.inboundVideoStats.frameWidth&&e.inboundVideoStats.frameWidth>0&&void 0!==e.inboundVideoStats.frameHeight&&e.inboundVideoStats.frameHeight>0?e.inboundVideoStats.frameWidth+"x"+e.inboundVideoStats.frameHeight:"Chrome only";if(this.addOrUpdateSessionStat("VideoResStat","Video resolution",l),void 0!==e.inboundVideoStats.framesDecoded){const t=r.format(e.inboundVideoStats.framesDecoded);this.addOrUpdateSessionStat("FramesDecodedStat","Frames Decoded",t)}e.inboundVideoStats.framesPerSecond&&this.addOrUpdateSessionStat("FramerateStat","Framerate",e.inboundVideoStats.framesPerSecond.toString()),void 0!==e.inboundVideoStats.framesDropped&&this.addOrUpdateSessionStat("FramesDroppedStat","Frames dropped",e.inboundVideoStats.framesDropped.toString()),e.inboundVideoStats.codecId&&this.addOrUpdateSessionStat("VideoCodecStat","Video codec",null!==(n=null===(t=e.codecs.get(e.inboundVideoStats.codecId))||void 0===t?void 0:t.mimeType.replace("video/",""))&&void 0!==n?n:""),e.inboundAudioStats.codecId&&this.addOrUpdateSessionStat("AudioCodecStat","Audio codec",null!==(s=null===(i=e.codecs.get(e.inboundAudioStats.codecId))||void 0===i?void 0:i.mimeType.replace("audio/",""))&&void 0!==s?s:"");const c=e.getActiveCandidatePair();if(c){const t=Object.prototype.hasOwnProperty.call(c,"currentRoundTripTime")&&e.isNumber(c.currentRoundTripTime)?Math.ceil(1e3*c.currentRoundTripTime).toString():"Can't calculate";this.addOrUpdateSessionStat("RTTStat","Net RTT (ms)",t)}this.addOrUpdateSessionStat("DurationStat","Duration",e.sessionStats.runTime),this.addOrUpdateSessionStat("ControlsInputStat","Controls stream input",e.sessionStats.controlsStreamInput),void 0===e.sessionStats.videoEncoderAvgQP||Number.isNaN(e.sessionStats.videoEncoderAvgQP)||this.addOrUpdateSessionStat("QPStat","Video quantization parameter",e.sessionStats.videoEncoderAvgQP.toString()),d.Info(`--------- Stats ---------\n ${JSON.stringify(e)}\n------------------------`),window.onStatsReportPrepared(this.statsMap)}handleLatencyInfo(e){void 0!==e.frameTiming&&(void 0!==e.frameTiming.encoderLatencyMs&&this.addOrUpdateLatencyStat("EncodeLatency","Encode latency (ms)",Math.ceil(e.frameTiming.encoderLatencyMs).toString()),void 0!==e.frameTiming.packetizeLatencyMs&&this.addOrUpdateLatencyStat("PacketizerLatency","Packetizer latency (ms)",Math.ceil(e.frameTiming.packetizeLatencyMs).toString()),void 0!==e.frameTiming.pacerLatencyMs&&this.addOrUpdateLatencyStat("PacerLatency","Pacer latency (ms)",Math.ceil(e.frameTiming.pacerLatencyMs).toString()),void 0!==e.frameTiming.captureToSendLatencyMs&&this.addOrUpdateLatencyStat("VideoTimingCaptureToSend","Post-capture to send latency (ms)",Math.ceil(e.frameTiming.captureToSendLatencyMs).toString())),void 0!==e.senderLatencyMs&&this.addOrUpdateLatencyStat("AbsCaptureTimeToSendLatency","Post-capture (abs-ct) to send latency (ms)",Math.ceil(e.senderLatencyMs).toString()),void 0!==e.averageAssemblyDelayMs&&this.addOrUpdateLatencyStat("AvgAssemblyDelay","Assembly delay (ms)",Math.ceil(e.averageAssemblyDelayMs).toString()),void 0!==e.averageDecodeLatencyMs&&this.addOrUpdateLatencyStat("AvgDecodeDelay","Decode time (ms)",Math.ceil(e.averageDecodeLatencyMs).toString()),void 0!==e.averageJitterBufferDelayMs&&this.addOrUpdateLatencyStat("AvgJitterBufferDelay","Jitter buffer (ms)",Math.ceil(e.averageJitterBufferDelayMs).toString()),void 0!==e.averageProcessingDelayMs&&this.addOrUpdateLatencyStat("AvgProcessingDelay","Processing delay (ms)",Math.ceil(e.averageProcessingDelayMs).toString()),void 0!==e.averageE2ELatency&&this.addOrUpdateLatencyStat("AvgE2ELatency","Total latency (ms)",Math.ceil(e.averageE2ELatency).toString())}addOrUpdateSessionStat(e,t,n){this.addOrUpdateStat(Ii.SessionStats,e,t,n)}addOrUpdateLatencyStat(e,t,n){this.addOrUpdateStat(Ii.LatencyStats,e,t,n)}addOrUpdateStat(e,t,n,i){if(e===Ii.SessionStats&&!Ri(this._config,Ii.SessionStats))return;if(e===Ii.LatencyStats&&!Ri(this._config,Ii.LatencyStats))return;if(e!==Ii.SessionStats&&e!==Ii.LatencyStats)return;const s=e===Ii.SessionStats?this.statsResult:this.latencyResult,r=`${n}: ${i}`;if(this.statsMap.has(t)){const e=this.statsMap.get(t);void 0!==e&&(e.element.innerHTML=r)}else{const e=new Bi;e.id=t,e.stat=i,e.title=n,e.element=document.createElement("div"),e.element.innerHTML=r,s.appendChild(e.element),this.statsMap.set(t,e)}}}class Wi{constructor(e){this.videoEncoderAvgQP=-1,this.statsText="",this.color="",this.orangeQP=26,this.redQP=35,this.config=e}get rootElement(){return this._rootElement||(this._rootElement=document.createElement("div"),this._rootElement.id="connection",this._rootElement.classList.add("UiTool"),this._rootElement.appendChild(this.qualityStatus),this._rootElement.appendChild(this.qualityText),this.updateQpTooltip(-1)),this._rootElement}get qualityText(){return this._qualityText||(this._qualityText=document.createElement("span"),this._qualityText.id="qualityText",this._qualityText.classList.add("tooltiptext")),this._qualityText}get qualityStatus(){return this._qualityStatus||(this._qualityStatus=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._qualityStatus.setAttributeNS(null,"id","connectionStrength"),this._qualityStatus.setAttributeNS(null,"x","0px"),this._qualityStatus.setAttributeNS(null,"y","0px"),this._qualityStatus.setAttributeNS(null,"viewBox","0 0 494.45 494.45"),this.qualityStatus.appendChild(this.dot),this.qualityStatus.appendChild(this.middle),this.qualityStatus.appendChild(this.outer),this.qualityStatus.appendChild(this.inner)),this._qualityStatus}get dot(){return this._dot||(this._dot=document.createElementNS("http://www.w3.org/2000/svg","circle"),this._dot.setAttributeNS(null,"id","dot"),this._dot.setAttributeNS(null,"cx","247.125"),this._dot.setAttributeNS(null,"cy","398.925"),this._dot.setAttributeNS(null,"r","35.3")),this._dot}get outer(){return this._outer||(this._outer=document.createElementNS("http://www.w3.org/2000/svg","path"),this._outer.setAttributeNS(null,"id","outer"),this._outer.setAttributeNS(null,"d","M467.925,204.625c-6.8,0-13.5-2.6-18.7-7.8c-111.5-111.4-292.7-111.4-404.1,0c-10.3,10.3-27.1,10.3-37.4,0s-10.3-27.1,0-37.4c64-64,149-99.2,239.5-99.2s175.5,35.2,239.5,99.2c10.3,10.3,10.3,27.1,0,37.4C481.425,202.025,474.625,204.625,467.925,204.625z")),this._outer}get middle(){return this._middle||(this._middle=document.createElementNS("http://www.w3.org/2000/svg","path"),this._middle.setAttributeNS(null,"id","middle"),this._middle.setAttributeNS(null,"d","M395.225,277.325c-6.8,0-13.5-2.6-18.7-7.8c-71.4-71.3-187.4-71.3-258.8,0c-10.3,10.3-27.1,10.3-37.4,0s-10.3-27.1,0-37.4c92-92,241.6-92,333.6,0c10.3,10.3,10.3,27.1,0,37.4C408.725,274.725,401.925,277.325,395.225,277.325z")),this._middle}get inner(){return this._inner||(this._inner=document.createElementNS("http://www.w3.org/2000/svg","path"),this._inner.setAttributeNS(null,"id","inner"),this._inner.setAttributeNS(null,"d","M323.625,348.825c-6.8,0-13.5-2.6-18.7-7.8c-15.4-15.4-36-23.9-57.8-23.9s-42.4,8.5-57.8,23.9c-10.3,10.3-27.1,10.3-37.4,0c-10.3-10.3-10.3-27.1,0-37.4c25.4-25.4,59.2-39.4,95.2-39.4s69.8,14,95.2,39.5c10.3,10.3,10.3,27.1,0,37.4C337.225,346.225,330.425,348.825,323.625,348.825z")),this._inner}blinkVideoQualityStatus(e){let t=e,n=1;const i=setInterval(()=>{n-=.1,this.qualityText.style.opacity=String(Math.abs(2*(n-.5))),n<=.1&&(0==--t?clearInterval(i):n=1)},100/e)}updateQpTooltip(e){var t;this.videoEncoderAvgQP=e,e>this.redQP?(this.color="red",this.blinkVideoQualityStatus(2),this.statsText=`<div style="color: ${this.color}">Poor encoding quality</div>`,this.outer.setAttributeNS(null,"fill","#3c3b40"),this.middle.setAttributeNS(null,"fill","#3c3b40"),this.inner.setAttributeNS(null,"fill",this.color),this.dot.setAttributeNS(null,"fill",this.color)):e>this.orangeQP?(this.color="orange",this.blinkVideoQualityStatus(1),this.statsText=`<div style="color: ${this.color}">Blocky encoding quality</div>`,this.outer.setAttributeNS(null,"fill","#3c3b40"),this.middle.setAttributeNS(null,"fill",this.color),this.inner.setAttributeNS(null,"fill",this.color),this.dot.setAttributeNS(null,"fill",this.color)):e<=0?(this.color="#b0b0b0",this.outer.setAttributeNS(null,"fill","#3c3b40"),this.middle.setAttributeNS(null,"fill","#3c3b40"),this.inner.setAttributeNS(null,"fill","#3c3b40"),this.dot.setAttributeNS(null,"fill","#3c3b40"),this.statsText=`<div style="color: ${this.color}">Not connected</div>`):(this.color="lime",this.qualityStatus.style.opacity=1==(null===(t=this.config)||void 0===t?void 0:t.hideWhenGood)?"0":"1",this.statsText=`<div style="color: ${this.color}">Clear encoding quality</div>`,this.outer.setAttributeNS(null,"fill",this.color),this.middle.setAttributeNS(null,"fill",this.color),this.inner.setAttributeNS(null,"fill",this.color),this.dot.setAttributeNS(null,"fill",this.color)),this.qualityText.innerHTML=this.statsText}}class Hi{constructor(e){this._setting=e}get setting(){return this._setting}get rootElement(){return this._rootElement||(this._rootElement=document.createElement("div")),this._rootElement}}class ji extends Hi{constructor(e){super(e),this.label=e.label,this.flag=e.flag}get setting(){return this._setting}get settingsTextElem(){return this._settingsTextElem||(this._settingsTextElem=document.createElement("div"),this._settingsTextElem.innerText=this.setting._label,this._settingsTextElem.title=this.setting.description),this._settingsTextElem}get checkbox(){return this._checkbox||(this._checkbox=document.createElement("input"),this._checkbox.type="checkbox",this._checkbox.addEventListener("keypress",e=>{e.stopPropagation()}),this._checkbox.addEventListener("keyup",e=>{e.stopPropagation()}),this._checkbox.addEventListener("keydown",e=>{e.stopPropagation()})),this._checkbox}get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("div"),this._rootElement.id=this.setting.id,this._rootElement.classList.add("setting"),this._rootElement.appendChild(this.settingsTextElem);const e=document.createElement("label");e.classList.add("tgl-switch"),this._rootElement.appendChild(e),this.checkbox.title=this.setting.description,this.checkbox.classList.add("tgl"),this.checkbox.classList.add("tgl-flat");const t=document.createElement("div");t.classList.add("tgl-slider"),e.appendChild(this.checkbox),e.appendChild(t),this.checkbox.addEventListener("change",()=>{this.setting.flag!==this.checkbox.checked&&(this.setting.flag=this.checkbox.checked,this.setting.updateURLParams())})}return this._rootElement}set flag(e){this.checkbox.checked=e}get flag(){return this.checkbox.checked}set label(e){this.settingsTextElem.innerText=e}get label(){return this.settingsTextElem.innerText}disable(){this.checkbox.disabled=!0}enable(){this.checkbox.disabled=!1}}class zi extends Hi{constructor(e){super(e),this.label=this.setting.label,this.number=this.setting.number}get setting(){return this._setting}get settingsTextElem(){return this._settingsTextElem||(this._settingsTextElem=document.createElement("label"),this._settingsTextElem.innerText=this.setting.label,this._settingsTextElem.title=this.setting.description),this._settingsTextElem}get spinner(){return this._spinner||(this._spinner=document.createElement("input"),this._spinner.type="number",null!=this.setting.min&&(this._spinner.min=this.setting.min.toString()),null!=this.setting.max&&(this._spinner.max=this.setting.max.toString()),this._spinner.value=this.setting.number.toString(),this._spinner.title=this.setting.description,this._spinner.classList.add("form-control"),this.spinner.addEventListener("keypress",e=>{e.stopPropagation()}),this.spinner.addEventListener("keyup",e=>{e.stopPropagation()}),this.spinner.addEventListener("keydown",e=>{e.stopPropagation()})),this._spinner}get rootElement(){return this._rootElement||(this._rootElement=document.createElement("div"),this._rootElement.classList.add("setting"),this._rootElement.classList.add("form-group"),this._rootElement.appendChild(this.settingsTextElem),this._rootElement.appendChild(this.spinner),this.spinner.onchange=e=>{const t=e.target,n=Number.parseFloat(t.value);Number.isNaN(n)?(d.Warning(`Could not parse value change into a valid number - value was ${t.value}, resetting value to ${this.setting.min}`),this.setting.number!==this.setting.min&&(this.setting.number=this.setting.min)):this.setting.number!==n&&(this.setting.number=n,this.setting.updateURLParams())}),this._rootElement}set number(e){this.spinner.value=this.setting.clamp(e).toString()}get number(){return+this.spinner.value}set label(e){this.settingsTextElem.innerText=e}get label(){return this.settingsTextElem.innerText}disable(){this.spinner.disabled=!0}enable(){this.spinner.disabled=!1}}class qi extends Hi{constructor(e){super(e),this.label=this.setting.label,this.text=this.setting.text}get setting(){return this._setting}get settingsTextElem(){return this._settingsTextElem||(this._settingsTextElem=document.createElement("div"),this._settingsTextElem.innerText=this.setting.label,this._settingsTextElem.title=this.setting.description),this._settingsTextElem}get textbox(){return this._textbox||(this._textbox=document.createElement("input"),this._textbox.classList.add("form-control"),this._textbox.type="textbox"),this._textbox}get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("div"),this._rootElement.id=this.setting.id,this._rootElement.classList.add("setting"),this._rootElement.appendChild(this.settingsTextElem);const e=document.createElement("label");this._rootElement.appendChild(e),this.textbox.title=this.setting.description,e.appendChild(this.textbox),this.textbox.addEventListener("input",e=>{this.setting.text!==this.textbox.value&&(this.setting.text=this.textbox.value,this.setting.updateURLParams()),e.stopPropagation()}),this.textbox.addEventListener("keypress",e=>{e.stopPropagation()}),this.textbox.addEventListener("keyup",e=>{e.stopPropagation()}),this.textbox.addEventListener("keydown",e=>{e.stopPropagation()})}return this._rootElement}set text(e){this.textbox.value=e}get text(){return this.textbox.value}set label(e){this.settingsTextElem.innerText=e}get label(){return this.settingsTextElem.innerText}disable(){this.textbox.disabled=!0}enable(){this.textbox.disabled=!1}}class Ki extends Hi{constructor(e){super(e),this.label=this.setting.label,this.options=this.setting.options,this.selected=this.setting.selected}get setting(){return this._setting}get selector(){return this._selector||(this._selector=document.createElement("select"),this._selector.classList.add("form-control"),this._selector.classList.add("settings-option")),this._selector}get settingsTextElem(){return this._settingsTextElem||(this._settingsTextElem=document.createElement("div"),this._settingsTextElem.innerText=this.setting.label,this._settingsTextElem.title=this.setting.description),this._settingsTextElem}set label(e){this.settingsTextElem.innerText=e}get label(){return this.settingsTextElem.innerText}get rootElement(){if(!this._rootElement){this._rootElement=document.createElement("div"),this._rootElement.id=this.setting.id,this._rootElement.classList.add("setting"),this._rootElement.classList.add("form-group"),this._rootElement.appendChild(this.settingsTextElem);const e=document.createElement("label");this._rootElement.appendChild(e),this.selector.title=this.setting.description,e.appendChild(this.selector),this.selector.onchange=()=>{this.setting.selected!==this.selector.value&&(this.setting.selected=this.selector.value,this.setting.updateURLParams())},this.selector.addEventListener("keypress",e=>{e.stopPropagation()}),this.selector.addEventListener("keyup",e=>{e.stopPropagation()}),this.selector.addEventListener("keydown",e=>{e.stopPropagation()})}return this._rootElement}set options(e){for(let e=this.selector.options.length-1;e>=0;e--)this.selector.remove(e);e.forEach(e=>{const t=document.createElement("option");t.value=e,t.innerHTML=e,this.selector.appendChild(t)})}get options(){return[...this.selector.options].map(e=>e.value)}set selected(e){const t=this.options.filter(t=>-1!==t.indexOf(e));t.length&&(this.selector.value=t[0])}get selected(){return this.selector.value}disable(){this.selector.disabled=!0}enable(){this.selector.disabled=!1}}class Qi{constructor(e){this.customFlags=new Map,this.flagsUi=new Map,this.numericParametersUi=new Map,this.textParametersUi=new Map,this.optionParametersUi=new Map,this.createCustomUISettings(e.useUrlParams),this.registerSettingsUIComponents(e)}createCustomUISettings(e){this.customFlags.set(Mi.LightMode,new Ze(Mi.LightMode,"Color Scheme: Dark Mode","Page styling will be either light or dark",!1,e,(e,t)=>{t.label=`Color Scheme: ${e?"Light":"Dark"} Mode`}))}registerSettingsUIComponents(e){for(const t of e.getFlags())this.flagsUi.set(t.id,new ji(t));for(const e of Array.from(this.customFlags.values()))this.flagsUi.set(e.id,new ji(e));for(const t of e.getTextSettings())this.textParametersUi.set(t.id,new qi(t));for(const t of e.getNumericSettings())this.numericParametersUi.set(t.id,new zi(t));for(const t of e.getOptionSettings())this.optionParametersUi.set(t.id,new Ki(t))}buildSectionWithHeading(e,t){const n=document.createElement("section");n.classList.add("settingsContainer");const i=document.createElement("div");return i.classList.add("settingsHeader"),i.classList.add("settings-text"),i.textContent=t,n.appendChild(i),e.appendChild(n),n}populateSettingsElement(e,t){if(Ri(t,ki.PixelStreaming)){const n=this.buildSectionWithHeading(e,ki.PixelStreaming);Li(t,Xt.SignallingServerUrl)&&this.addSettingText(n,this.textParametersUi.get(Xt.SignallingServerUrl)),Li(t,Zt.StreamerId)&&this.addSettingOption(n,this.optionParametersUi.get(Zt.StreamerId)),Li(t,Kt.AutoConnect)&&this.addSettingFlag(n,this.flagsUi.get(Kt.AutoConnect)),Li(t,Kt.AutoPlayVideo)&&this.addSettingFlag(n,this.flagsUi.get(Kt.AutoPlayVideo)),Li(t,Kt.UseMic)&&this.addSettingFlag(n,this.flagsUi.get(Kt.UseMic)),Li(t,Kt.UseCamera)&&this.addSettingFlag(n,this.flagsUi.get(Kt.UseCamera)),Li(t,Kt.StartVideoMuted)&&this.addSettingFlag(n,this.flagsUi.get(Kt.StartVideoMuted)),Li(t,Kt.IsQualityController)&&this.addSettingFlag(n,this.flagsUi.get(Kt.IsQualityController)),Li(t,Kt.ForceMonoAudio)&&this.addSettingFlag(n,this.flagsUi.get(Kt.ForceMonoAudio)),Li(t,Kt.ForceTURN)&&this.addSettingFlag(n,this.flagsUi.get(Kt.ForceTURN)),Li(t,Kt.SuppressBrowserKeys)&&this.addSettingFlag(n,this.flagsUi.get(Kt.SuppressBrowserKeys)),Li(t,Kt.AFKDetection)&&this.addSettingFlag(n,this.flagsUi.get(Kt.AFKDetection)),Li(t,Kt.WaitForStreamer)&&this.addSettingFlag(n,this.flagsUi.get(Kt.WaitForStreamer)),Li(t,Gt.AFKTimeoutSecs)&&this.addSettingNumeric(n,this.numericParametersUi.get(Gt.AFKTimeoutSecs)),Li(t,Gt.AFKCountdownSecs)&&this.addSettingNumeric(n,this.numericParametersUi.get(Gt.AFKCountdownSecs)),Li(t,Gt.MaxReconnectAttempts)&&this.addSettingNumeric(n,this.numericParametersUi.get(Gt.MaxReconnectAttempts)),Li(t,Gt.StreamerAutoJoinInterval)&&this.addSettingNumeric(n,this.numericParametersUi.get(Gt.StreamerAutoJoinInterval)),Li(t,Gt.KeepaliveDelay)&&this.addSettingNumeric(n,this.numericParametersUi.get(Gt.KeepaliveDelay))}if(Ri(t,ki.UI)){const n=this.buildSectionWithHeading(e,ki.UI);Li(t,Kt.MatchViewportResolution)&&this.addSettingFlag(n,this.flagsUi.get(Kt.MatchViewportResolution)),Li(t,Kt.HoveringMouseMode)&&this.addSettingFlag(n,this.flagsUi.get(Kt.HoveringMouseMode)),Li(t,Mi.LightMode)&&this.addSettingFlag(n,this.flagsUi.get(Mi.LightMode))}if(Ri(t,ki.Input)){const n=this.buildSectionWithHeading(e,ki.Input);Li(t,Kt.KeyboardInput)&&this.addSettingFlag(n,this.flagsUi.get(Kt.KeyboardInput)),Li(t,Kt.MouseInput)&&this.addSettingFlag(n,this.flagsUi.get(Kt.MouseInput)),Li(t,Kt.FakeMouseWithTouches)&&this.addSettingFlag(n,this.flagsUi.get(Kt.FakeMouseWithTouches)),Li(t,Kt.TouchInput)&&this.addSettingFlag(n,this.flagsUi.get(Kt.TouchInput)),Li(t,Kt.GamepadInput)&&this.addSettingFlag(n,this.flagsUi.get(Kt.GamepadInput)),Li(t,Kt.XRControllerInput)&&this.addSettingFlag(n,this.flagsUi.get(Kt.XRControllerInput))}if(Ri(t,ki.Encoder)){const n=this.buildSectionWithHeading(e,ki.Encoder);Li(t,Gt.CompatQualityMin)&&this.addSettingNumeric(n,this.numericParametersUi.get(Gt.CompatQualityMin)),Li(t,Gt.CompatQualityMax)&&this.addSettingNumeric(n,this.numericParametersUi.get(Gt.CompatQualityMax));const i=this.optionParametersUi.get(Zt.PreferredCodec);Li(t,Zt.PreferredCodec)&&this.addSettingOption(n,this.optionParametersUi.get(Zt.PreferredCodec)),i&&[...i.selector.options].map(e=>e.value).includes("Only available on Chrome")&&i.disable(),Li(t,Zt.PreferredQuality)&&this.addSettingOption(n,this.optionParametersUi.get(Zt.PreferredQuality))}if(Ri(t,ki.WebRTC)){const n=this.buildSectionWithHeading(e,ki.WebRTC);Li(t,Gt.WebRTCFPS)&&this.addSettingNumeric(n,this.numericParametersUi.get(Gt.WebRTCFPS)),Li(t,Gt.WebRTCMinBitrate)&&this.addSettingNumeric(n,this.numericParametersUi.get(Gt.WebRTCMinBitrate)),Li(t,Gt.WebRTCMaxBitrate)&&this.addSettingNumeric(n,this.numericParametersUi.get(Gt.WebRTCMaxBitrate))}}addSettingText(e,t){t&&(e.appendChild(t.rootElement),this.textParametersUi.set(t.setting.id,t))}addSettingFlag(e,t){t&&(e.appendChild(t.rootElement),this.flagsUi.set(t.setting.id,t))}addSettingNumeric(e,t){t&&(e.appendChild(t.rootElement),this.numericParametersUi.set(t.setting.id,t))}addSettingOption(e,t){t&&(e.appendChild(t.rootElement),this.optionParametersUi.set(t.setting.id,t))}onSettingsChanged({data:{id:e,target:t,type:n}}){if("flag"===n){const n=e,i=t,s=this.flagsUi.get(n);s&&(s.flag!==i.flag&&(s.flag=i.flag),s.label!==i.label&&(s.label=i.label))}else if("number"===n){const n=e,i=t,s=this.numericParametersUi.get(n);s&&(s.number!==i.number&&(s.number=i.number),s.label!==i.label&&(s.label=i.label))}else if("text"===n){const n=e,i=t,s=this.textParametersUi.get(n);s&&(s.text!==i.text&&(s.text=i.text),s.label!==i.label&&(s.label=i.label))}else if("option"===n){const n=e,i=t,s=this.optionParametersUi.get(n);if(s){const e=s.options,t=i.options;e.length===t.length&&e.every(e=>t.includes(e))||(s.options=i.options),s.selected!==i.selected&&(s.selected=i.selected),s.label!==i.label&&(s.label=i.label)}}}addCustomFlagOnSettingChangedListener(e,t){this.customFlags.has(e)&&(this.customFlags.get(e).onChange=t)}setCustomFlagLabel(e,t){this.customFlags.has(e)?(this.customFlags.get(e).label=t,this.flagsUi.get(e).label=t):d.Warning(`Cannot set label for flag called ${e} - it does not exist in the Config.flags map.`)}isCustomFlagEnabled(e){return this.customFlags.get(e).flag}disableSetting(e){var t,n,i,s;Qt(e)?null===(t=this.flagsUi.get(e))||void 0===t||t.disable():$t(e)?null===(n=this.numericParametersUi.get(e))||void 0===n||n.disable():Jt(e)?null===(i=this.textParametersUi.get(e))||void 0===i||i.disable():Yt(e)&&(null===(s=this.optionParametersUi.get(e))||void 0===s||s.disable())}enableSetting(e){var t,n,i,s;Qt(e)?null===(t=this.flagsUi.get(e))||void 0===t||t.enable():$t(e)?null===(n=this.numericParametersUi.get(e))||void 0===n||n.enable():Jt(e)?null===(i=this.textParametersUi.get(e))||void 0===i||i.enable():Yt(e)&&(null===(s=this.optionParametersUi.get(e))||void 0===s||s.enable())}}class Gi extends CustomEvent{constructor(e){super("editConfirmed",{detail:e,bubbles:!0,cancelable:!0}),this.confirmedText=e}}class $i{constructor(){this._rootElement=this.rootElement,this._events=new EventTarget}get events(){return this._events}showModal(e){e&&(e=e.replace(/\0/g,""),this.textArea.value=e),this.textArea.focus(),this.textArea.selectionStart=this.textArea.value.length}get rootElement(){return this._rootElement||(this._rootElement=document.createElement("div"),this._rootElement.classList.add("modal"),this._rootElement.appendChild(this.innerModal)),this._rootElement}get innerModal(){return this._innerModal||(this._innerModal=document.createElement("div"),this._innerModal.classList.add("innerModal"),this._innerModal.appendChild(this.editTextHeading),this._innerModal.appendChild(this.textArea),this._innerModal.appendChild(this.modalBtnContainer)),this._innerModal}get editTextHeading(){return this._editTextHeading||(this._editTextHeading=document.createElement("h2"),this._editTextHeading.innerText="Edit Text"),this._editTextHeading}get textArea(){return this._textArea||(this._textArea=document.createElement("textarea"),this._textArea.classList.add("form-control"),this._textArea.classList.add("modalTextArea"),this._textArea.title="Edit Text Area",this._textArea.placeholder="UE text widget value here...",this.textArea.addEventListener("keypress",e=>{e.stopPropagation()}),this.textArea.addEventListener("keyup",e=>{e.stopPropagation()}),this.textArea.addEventListener("keydown",e=>{e.stopPropagation()}),this.textArea.addEventListener("compositionend",e=>{e.stopPropagation()})),this._textArea}get modalBtnContainer(){return this._modalBtnContainer||(this._modalBtnContainer=document.createElement("div"),this._modalBtnContainer.classList.add("modalBtnContainer"),this._modalBtnContainer.appendChild(this.cancelBtn),this._modalBtnContainer.appendChild(this.confirmBtn)),this._modalBtnContainer}get cancelBtn(){return this._cancelBtn||(this._cancelBtn=document.createElement("button"),this._cancelBtn.classList.add("btn-flat"),this._cancelBtn.innerText="Cancel",this._cancelBtn.addEventListener("click",e=>{this.rootElement.remove(),e.stopPropagation()})),this._cancelBtn}get confirmBtn(){return this._confirmBtn||(this._confirmBtn=document.createElement("button"),this._confirmBtn.classList.add("btn-flat"),this._confirmBtn.innerText="Confirm",this._confirmBtn.addEventListener("click",e=>{this.events.dispatchEvent(new Gi(this.textArea.value)),this.rootElement.remove(),e.stopPropagation()})),this._confirmBtn}}class Xi{constructor(e){this.editTextModal=null,this._options=e,this.stream=e.stream,this._uiFeatureElement=this.createUIFeaturesElement(),this._rootElement=this.createRootElement(this.stream,this._uiFeatureElement),this.onColorModeChanged=e.onColorModeChanged,this.configUI=new Qi(this.stream.config),this.createOverlays(),Pi(e.statsPanelConfig)&&(this.statsPanel=new Vi(e.statsPanelConfig),this.uiFeaturesElement.appendChild(this.statsPanel.rootElement)),Pi(e.settingsPanelConfig)&&(this.settingsPanel=new Ai,this.uiFeaturesElement.appendChild(this.settingsPanel.rootElement),this.configureSettings()),e.videoQpIndicatorConfig&&e.videoQpIndicatorConfig.disableIndicator||(this.videoQpIndicator=new Wi(e.videoQpIndicatorConfig),this.uiFeaturesElement.appendChild(this.videoQpIndicator.rootElement)),this.createButtons(),this.registerCallbacks(),this.showConnectOrAutoConnectOverlays(),this.setColorMode(this.configUI.isCustomFlagEnabled(Mi.LightMode)),this.stream.config._addOnSettingChangedListener(Kt.HideUI,e=>{this._uiFeatureElement.style.visibility=e?"hidden":"visible"}),this.stream.config.isFlagEnabled(Kt.HideUI)&&(this._uiFeatureElement.style.visibility="hidden")}createOverlays(){this.disconnectOverlay=new pi(this.stream.videoElementParent),this.connectOverlay=new mi(this.stream.videoElementParent),this.playOverlay=new gi(this.stream.videoElementParent),this.infoOverlay=new yi(this.stream.videoElementParent),this.errorOverlay=new vi(this.stream.videoElementParent),this.afkOverlay=new wi(this.stream.videoElementParent),this.disconnectOverlay.onAction(()=>this.stream.reconnect()),this.connectOverlay.onAction(()=>this.stream.connect()),this.playOverlay.onAction(()=>this.stream.play())}createButtons(){const e=/iPhone/.test(navigator.userAgent),t=/iPad/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&"ontouchend"in document,n=navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS"),i=e||!n&&t;void 0===this._options.fullScreenControlsConfig&&i&&(this._options.fullScreenControlsConfig={creationMode:ai.Disable});const s={statsButtonType:this._options.statsPanelConfig?this._options.statsPanelConfig.visibilityButtonConfig:void 0,settingsButtonType:this._options.settingsPanelConfig?this._options.settingsPanelConfig.visibilityButtonConfig:void 0,fullscreenButtonType:this._options.fullScreenControlsConfig,xrIconType:this._options.xrControlsConfig,hideControlsInFullscreen:this._options.hideControlsInFullscreen},r=new Oi(s);this.uiFeaturesElement.appendChild(r.rootElement);const o=this._options.fullScreenControlsConfig&&this._options.fullScreenControlsConfig.creationMode===ai.UseCustomElement?new bi(this._options.fullScreenControlsConfig.customElement):r.fullscreenIcon;o&&(o.fullscreenElement=/iPad|iPhone|iPod/.test(navigator.userAgent)?this.stream.videoElementParent.getElementsByTagName("video")[0]:this.rootElement);const a=r.settingsIcon?r.settingsIcon.rootElement:this._options.settingsPanelConfig.visibilityButtonConfig.customElement;a&&(a.onclick=()=>this.settingsClicked()),this.settingsPanel&&(this.settingsPanel.settingsCloseButton.onclick=()=>this.settingsClicked());const l=r.xrIcon?r.xrIcon.rootElement:this._options.xrControlsConfig.creationMode===ai.UseCustomElement?this._options.xrControlsConfig.customElement:void 0;l&&(l.onclick=()=>this.stream.toggleXR());const d=r.statsIcon?r.statsIcon.rootElement:this._options.statsPanelConfig.visibilityButtonConfig.customElement;if(d&&(d.onclick=()=>this.statsClicked()),this.statsPanel&&(this.statsPanel.statsCloseButton.onclick=()=>this.statsClicked()),this.settingsPanel){const e=new Fi("Show FPS","Toggle");e.addOnClickListener(()=>{this.stream.requestShowFps()});const t=new Fi("Restart Stream","Restart");t.addOnClickListener(()=>{this.stream.reconnect()});const n=new Fi("Request keyframe","Request");n.addOnClickListener(()=>{this.stream.requestIframe()});const i=this.configUI.buildSectionWithHeading(this.settingsPanel.settingsContentElement,"Commands");i.appendChild(e.rootElement),i.appendChild(n.rootElement),i.appendChild(t.rootElement)}}configureSettings(){this.configUI.populateSettingsElement(this.settingsPanel.settingsContentElement,this._options.settingsPanelConfig),this.configUI.addCustomFlagOnSettingChangedListener(Mi.LightMode,e=>{this.configUI.setCustomFlagLabel(Mi.LightMode,`Color Scheme: ${e?"Light":"Dark"} Mode`),this.setColorMode(e)})}registerCallbacks(){this.stream.addEventListener("afkWarningActivate",({data:{countDown:e,dismissAfk:t}})=>this.showAfkOverlay(e,t)),this.stream.addEventListener("afkWarningUpdate",({data:{countDown:e}})=>this.afkOverlay.updateCountdown(e)),this.stream.addEventListener("afkWarningDeactivate",()=>this.afkOverlay.hide()),this.stream.addEventListener("afkTimedOut",()=>this.afkOverlay.hide()),this.stream.addEventListener("videoEncoderAvgQP",({data:{avgQP:e}})=>this.onVideoEncoderAvgQP(e)),this.stream.addEventListener("webRtcSdp",()=>this.onWebRtcSdp()),this.stream.addEventListener("webRtcAutoConnect",()=>this.onWebRtcAutoConnect()),this.stream.addEventListener("webRtcConnecting",()=>this.onWebRtcConnecting()),this.stream.addEventListener("webRtcConnected",()=>this.onWebRtcConnected()),this.stream.addEventListener("webRtcFailed",()=>this.onWebRtcFailed()),this.stream.addEventListener("webRtcDisconnected",({data:{eventString:e,allowClickToReconnect:t}})=>this.onDisconnect(e,t)),this.stream.addEventListener("videoInitialized",()=>this.onVideoInitialized()),this.stream.addEventListener("streamLoading",()=>this.onStreamLoading()),this.stream.addEventListener("playStreamError",({data:{message:e}})=>this.onPlayStreamError(e)),this.stream.addEventListener("playStream",()=>this.onPlayStream()),this.stream.addEventListener("playStreamRejected",({data:{reason:e}})=>this.onPlayStreamRejected(e)),this.stream.addEventListener("loadFreezeFrame",({data:{shouldShowPlayOverlay:e}})=>this.onLoadFreezeFrame(e)),this.stream.addEventListener("statsReceived",({data:{aggregatedStats:e}})=>this.onStatsReceived(e)),this.stream.addEventListener("latencyCalculated",({data:{latencyInfo:e}})=>this.onLatencyUpdate(e)),this.stream.addEventListener("latencyTestResult",({data:{latencyTimings:e}})=>this.onLatencyTestResults(e)),this.stream.addEventListener("dataChannelLatencyTestResult",({data:{result:e}})=>this.onDataChannelLatencyTestResults(e)),this.stream.addEventListener("streamerListMessage",({data:{messageStreamerList:e,autoSelectedStreamerId:t,wantedStreamerId:n}})=>this.handleStreamerListMessage(e,t,n)),this.stream.addEventListener("subscribeFailed",({data:{message:e}})=>this.handleSubscribeFailedMessage(e)),this.stream.addEventListener("settingsChanged",e=>this.onSettingsChanged(e)),this.stream.addEventListener("playerCount",({data:{count:e}})=>this.onPlayerCount(e)),this.stream.addEventListener("webRtcTCPRelayDetected",()=>d.Warning("Stream quailty degraded due to network enviroment, stream is relayed over TCP.")),this.stream.addEventListener("showOnScreenKeyboard",e=>{if(!this.stream.config.isFlagEnabled(Kt.UseModalForTextInput))return;const t=e.data;t.showOnScreenKeyboard&&this.showEditTextModal(t.contents)})}get rootElement(){this._rootElement||(this._rootElement=this.createRootElement(this.stream,this.uiFeaturesElement));let e=document.getElementById("playerUI");if(e)e.classList.add("noselect"),e.appendChild(this.stream.videoElementParent),e.appendChild(this.uiFeaturesElement),document.body.appendChild(e),this._rootElement=e;else{const e=document.createElement("div");e.id="playerUI",e.classList.add("noselect"),e.appendChild(this.stream.videoElementParent),e.appendChild(this.uiFeaturesElement),document.body.appendChild(e),this._rootElement=e}return this._rootElement}createRootElement(e,t){const n=document.createElement("div");if(n.id="playerUI",n.classList.add("noselect"),void 0===e)throw new Error("Could not create root element properly - pixelstreaming object was undefined. Are you calling this too early?");if(void 0===e.videoElementParent)throw new Error("Could not create root element properly - videoElementParent object was undefined. Are you calling this too early?");if(void 0===t)throw new Error("Could not create root element properly - uiFeaturesElement object was undefined. Are you calling this too early?");return n.appendChild(e.videoElementParent),n.appendChild(t),n}get uiFeaturesElement(){return this._uiFeatureElement||(this._uiFeatureElement=this.createUIFeaturesElement()),this._uiFeatureElement}createUIFeaturesElement(){const e=document.createElement("div");return e.id="uiFeatures",e}showDisconnectOverlay(e){this.hideCurrentOverlay(),this.updateDisconnectOverlay(e),this.disconnectOverlay.show(),this.currentOverlay=this.disconnectOverlay}updateDisconnectOverlay(e){this.disconnectOverlay.update(e)}onDisconnectionAction(){this.disconnectOverlay.activate()}hideCurrentOverlay(){null!=this.currentOverlay&&(this.currentOverlay.hide(),this.currentOverlay=null)}showConnectOverlay(){var e,t;1!=(null===(t=null===(e=window.req_data)||void 0===e?void 0:e.E3DSConfigData)||void 0===t?void 0:t.HideUI)?(this.hideCurrentOverlay(),this.connectOverlay.show(),this.currentOverlay=this.connectOverlay):this.hideCurrentOverlay()}showPlayOverlay(){this.hideCurrentOverlay(),this.playOverlay.show(),this.currentOverlay=this.playOverlay}showTextOverlay(e){var t,n;1!=(null===(n=null===(t=window.req_data)||void 0===t?void 0:t.E3DSConfigData)||void 0===n?void 0:n.HideUI)?(this.hideCurrentOverlay(),this.infoOverlay.update(e),this.infoOverlay.show(),this.currentOverlay=this.infoOverlay):this.hideCurrentOverlay()}showErrorOverlay(e){var t,n;1!=(null===(n=null===(t=window.req_data)||void 0===t?void 0:t.E3DSConfigData)||void 0===n?void 0:n.HideUI)?(this.hideCurrentOverlay(),this.errorOverlay.update(e),this.errorOverlay.show(),this.currentOverlay=this.errorOverlay):this.hideCurrentOverlay()}settingsClicked(){var e;null===(e=this.statsPanel)||void 0===e||e.hide(),this.settingsPanel.toggleVisibility()}statsClicked(){var e;null===(e=this.settingsPanel)||void 0===e||e.hide(),this.statsPanel.toggleVisibility()}onConnectAction(){this.connectOverlay.activate()}onPlayAction(){this.playOverlay.activate()}showAfkOverlay(e,t){this.hideCurrentOverlay(),this.afkOverlay.updateCountdown(e),this.afkOverlay.onAction(()=>t()),this.afkOverlay.show(),this.currentOverlay=this.afkOverlay}showConnectOrAutoConnectOverlays(){this.stream.config.isFlagEnabled(Kt.AutoConnect)||this.showConnectOverlay()}onWebRtcAutoConnect(){this.showTextOverlay("Auto Connecting Now")}onWebRtcSdp(){this.showTextOverlay("WebRTC Connection Negotiated")}onStreamLoading(){const e=document.createElement("span");e.className="visually-hidden",e.innerHTML="Loading...";const t=document.createElement("div");t.id="loading-spinner",t.className="spinner-border ms-2",t.setAttribute("role","status"),t.appendChild(e),this.showTextOverlay("Loading Stream "+t.outerHTML)}onDisconnect(e,t){var n;const i="Disconnected"+(e?`: ${e}`:".");t?this.showDisconnectOverlay(`${i} Click To Restart.`):this.showErrorOverlay(i),null===(n=this.statsPanel)||void 0===n||n.onDisconnect()}onWebRtcConnecting(){this.showTextOverlay("Starting connection to server, please wait")}onWebRtcConnected(){this.showTextOverlay("WebRTC connected, waiting for video")}onWebRtcFailed(){this.showErrorOverlay("Unable to setup video")}onLoadFreezeFrame(e){!0===e&&(d.Info("showing play overlay"),this.showPlayOverlay())}onPlayStream(){this.hideCurrentOverlay()}onPlayStreamError(e){this.showErrorOverlay(e)}onPlayStreamRejected(e){this.showPlayOverlay()}onVideoInitialized(){var e;this.stream.config.isFlagEnabled(Kt.AutoPlayVideo)||this.showPlayOverlay(),null===(e=this.statsPanel)||void 0===e||e.onVideoInitialized(this.stream)}onVideoEncoderAvgQP(e){this.videoQpIndicator&&this.videoQpIndicator.updateQpTooltip(e)}onInitialSettings(e){var t;e.PixelStreamingSettings&&(null===(t=this.statsPanel)||void 0===t||t.configure(e.PixelStreamingSettings))}onStatsReceived(e){var t;window.onStatsReceived(e),null===(t=this.statsPanel)||void 0===t||t.handleStats(e)}onLatencyUpdate(e){var t;null===(t=this.statsPanel)||void 0===t||t.handleLatencyInfo(e)}onLatencyTestResults(e){var t;null===(t=this.statsPanel)||void 0===t||t.latencyTest.handleTestResult(e)}onDataChannelLatencyTestResults(e){var t;null===(t=this.statsPanel)||void 0===t||t.dataChannelLatencyTest.handleTestResult(e)}onPlayerCount(e){var t;null===(t=this.statsPanel)||void 0===t||t.handlePlayerCount(e)}handleStreamerListMessage(e,t,n){const i=this.stream.config.isFlagEnabled(Kt.WaitForStreamer),s=this.stream.isReconnecting();let r=null,o=!0;t||(i&&n?s?(r=`Waiting for ${n} to become available.`,o=!1):(r=`Gave up waiting for ${n} to become available. Click to try again`,e.ids.length>0&&(r+=" or select a streamer from the settings menu."),o=!0):0==e.ids.length?s?(r="Waiting for a streamer to become available.",o=!1):(r="No streamers available. Click to try again.",o=!0):(r="Multiple streamers available. Select one from the settings menu.",o=!1),o?this.showDisconnectOverlay(r):this.showTextOverlay(r))}handleSubscribeFailedMessage(e){this.showDisconnectOverlay(`Subscribe failed: "${e}" Click to try again`)}setColorMode(e){this.onColorModeChanged&&this.onColorModeChanged(e)}showEditTextModal(e){var t;null===(t=this.editTextModal)||void 0===t||t.rootElement.remove(),this.editTextModal=new $i,this.rootElement.append(this.editTextModal.rootElement),this.editTextModal.showModal(e),this.editTextModal.events.addEventListener("editConfirmed",e=>{const t=e;this.stream.sendTextboxEntry(t.confirmedText)})}onSettingsChanged(e){this.configUI.onSettingsChanged(e);const{data:{id:t,target:n,type:i}}=e;t==Zt.PreferredQuality&&([...this.stream.config.getSettingOption(Zt.PreferredQuality).options].includes("Default")?this.configUI.disableSetting(Zt.PreferredQuality):this.configUI.enableSetting(Zt.PreferredQuality))}}function Ji(){return Ji=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ji.apply(null,arguments)}var Zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};const Yi="object"===("undefined"==typeof window?"undefined":Zi(window))&&"object"===("undefined"==typeof document?"undefined":Zi(document))&&9===document.nodeType;function es(e){return es="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},es(e)}function ts(e){var t=function(e){if("object"!=es(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=es(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==es(t)?t:t+""}function ns(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,ts(i.key),i)}}function is(e,t,n){return t&&ns(e.prototype,t),n&&ns(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ss(e,t){return ss=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ss(e,t)}function rs(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ss(e,t)}function os(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var as={}.constructor;function ls(e){if(null==e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(ls);if(e.constructor!==as)return e;var t={};for(var n in e)t[n]=ls(e[n]);return t}function ds(e,t,n){void 0===e&&(e="unnamed");var i=n.jss,s=ls(t);return i.plugins.onCreateRule(e,s,n)||(e[0],null)}var cs=function(e,t){for(var n="",i=0;i<e.length&&"!important"!==e[i];i++)n&&(n+=t),n+=e[i];return n},hs=function(e){if(!Array.isArray(e))return e;var t="";if(Array.isArray(e[0]))for(var n=0;n<e.length&&"!important"!==e[n];n++)t&&(t+=", "),t+=cs(e[n]," ");else t=cs(e,", ");return"!important"===e[e.length-1]&&(t+=" !important"),t};function us(e){return e&&!1===e.format?{linebreak:"",space:""}:{linebreak:"\n",space:" "}}function ms(e,t){for(var n="",i=0;i<t;i++)n+="  ";return n+e}function ps(e,t,n){void 0===n&&(n={});var i="";if(!t)return i;var s=n.indent,r=void 0===s?0:s,o=t.fallbacks;!1===n.format&&(r=-1/0);var a=us(n),l=a.linebreak,d=a.space;if(e&&r++,o)if(Array.isArray(o))for(var c=0;c<o.length;c++){var h=o[c];for(var u in h){var m=h[u];null!=m&&(i&&(i+=l),i+=ms(u+":"+d+hs(m)+";",r))}}else for(var p in o){var g=o[p];null!=g&&(i&&(i+=l),i+=ms(p+":"+d+hs(g)+";",r))}for(var f in t){var y=t[f];null!=y&&"fallbacks"!==f&&(i&&(i+=l),i+=ms(f+":"+d+hs(y)+";",r))}return(i||n.allowEmpty)&&e?(i&&(i=""+l+i+l),ms(""+e+d+"{"+i,--r)+ms("}",r)):i}var gs=/([[\].#*$><+~=|^:(),"'`\s])/g,fs="undefined"!=typeof CSS&&CSS.escape,ys=function(e){return fs?fs(e):e.replace(gs,"\\$1")},vs=function(){function e(e,t,n){this.type="style",this.isProcessed=!1;var i=n.sheet,s=n.Renderer;this.key=e,this.options=n,this.style=t,i?this.renderer=i.renderer:s&&(this.renderer=new s)}return e.prototype.prop=function(e,t,n){if(void 0===t)return this.style[e];var i=!!n&&n.force;if(!i&&this.style[e]===t)return this;var s=t;n&&!1===n.process||(s=this.options.jss.plugins.onChangeValue(t,e,this));var r=null==s||!1===s,o=e in this.style;if(r&&!o&&!i)return this;var a=r&&o;if(a?delete this.style[e]:this.style[e]=s,this.renderable&&this.renderer)return a?this.renderer.removeProperty(this.renderable,e):this.renderer.setProperty(this.renderable,e,s),this;var l=this.options.sheet;return l&&l.attached,this},e}(),ws=function(e){function t(t,n,i){var s;s=e.call(this,t,n,i)||this;var r=i.selector,o=i.scoped,a=i.sheet,l=i.generateId;return r?s.selectorText=r:!1!==o&&(s.id=l(os(os(s)),a),s.selectorText="."+ys(s.id)),s}rs(t,e);var n=t.prototype;return n.applyTo=function(e){var t=this.renderer;if(t){var n=this.toJSON();for(var i in n)t.setProperty(e,i,n[i])}return this},n.toJSON=function(){var e={};for(var t in this.style){var n=this.style[t];"object"!=typeof n?e[t]=n:Array.isArray(n)&&(e[t]=hs(n))}return e},n.toString=function(e){var t=this.options.sheet,n=t&&t.options.link?Ji({},e,{allowEmpty:!0}):e;return ps(this.selectorText,this.style,n)},is(t,[{key:"selector",set:function(e){if(e!==this.selectorText){this.selectorText=e;var t=this.renderer,n=this.renderable;n&&t&&(t.setSelector(n,e)||t.replaceRule(n,this))}},get:function(){return this.selectorText}}]),t}(vs),Ss={onCreateRule:function(e,t,n){return"@"===e[0]||n.parent&&"keyframes"===n.parent.type?null:new ws(e,t,n)}},bs={indent:1,children:!0},Cs=/@([\w-]+)/,Es=function(){function e(e,t,n){this.type="conditional",this.isProcessed=!1,this.key=e;var i=e.match(Cs);for(var s in this.at=i?i[1]:"unknown",this.query=n.name||"@"+this.at,this.options=n,this.rules=new Qs(Ji({},n,{parent:this})),t)this.rules.add(s,t[s]);this.rules.process()}var t=e.prototype;return t.getRule=function(e){return this.rules.get(e)},t.indexOf=function(e){return this.rules.indexOf(e)},t.addRule=function(e,t,n){var i=this.rules.add(e,t,n);return i?(this.options.jss.plugins.onProcessRule(i),i):null},t.replaceRule=function(e,t,n){var i=this.rules.replace(e,t,n);return i&&this.options.jss.plugins.onProcessRule(i),i},t.toString=function(e){void 0===e&&(e=bs);var t=us(e).linebreak;if(null==e.indent&&(e.indent=bs.indent),null==e.children&&(e.children=bs.children),!1===e.children)return this.query+" {}";var n=this.rules.toString(e);return n?this.query+" {"+t+n+t+"}":""},e}(),Ts=/@container|@media|@supports\s+/,xs={onCreateRule:function(e,t,n){return Ts.test(e)?new Es(e,t,n):null}},Ms={indent:1,children:!0},ks=/@keyframes\s+([\w-]+)/,Is=function(){function e(e,t,n){this.type="keyframes",this.at="@keyframes",this.isProcessed=!1;var i=e.match(ks);i&&i[1]?this.name=i[1]:this.name="noname",this.key=this.type+"-"+this.name,this.options=n;var s=n.scoped,r=n.sheet,o=n.generateId;for(var a in this.id=!1===s?this.name:ys(o(this,r)),this.rules=new Qs(Ji({},n,{parent:this})),t)this.rules.add(a,t[a],Ji({},n,{parent:this}));this.rules.process()}return e.prototype.toString=function(e){void 0===e&&(e=Ms);var t=us(e).linebreak;if(null==e.indent&&(e.indent=Ms.indent),null==e.children&&(e.children=Ms.children),!1===e.children)return this.at+" "+this.id+" {}";var n=this.rules.toString(e);return n&&(n=""+t+n+t),this.at+" "+this.id+" {"+n+"}"},e}(),Ps=/@keyframes\s+/,Rs=/\$([\w-]+)/g,Ls=function(e,t){return"string"==typeof e?e.replace(Rs,function(e,n){return n in t?t[n]:e}):e},Ds=function(e,t,n){var i=e[t],s=Ls(i,n);s!==i&&(e[t]=s)},Os={onCreateRule:function(e,t,n){return"string"==typeof e&&Ps.test(e)?new Is(e,t,n):null},onProcessStyle:function(e,t,n){return"style"===t.type&&n?("animation-name"in e&&Ds(e,"animation-name",n.keyframes),"animation"in e&&Ds(e,"animation",n.keyframes),e):e},onChangeValue:function(e,t,n){var i=n.options.sheet;if(!i)return e;switch(t){case"animation":case"animation-name":return Ls(e,i.keyframes);default:return e}}},Fs=function(e){function t(){return e.apply(this,arguments)||this}return rs(t,e),t.prototype.toString=function(e){var t=this.options.sheet,n=t&&t.options.link?Ji({},e,{allowEmpty:!0}):e;return ps(this.key,this.style,n)},t}(vs),As={onCreateRule:function(e,t,n){return n.parent&&"keyframes"===n.parent.type?new Fs(e,t,n):null}},_s=function(){function e(e,t,n){this.type="font-face",this.at="@font-face",this.isProcessed=!1,this.key=e,this.style=t,this.options=n}return e.prototype.toString=function(e){var t=us(e).linebreak;if(Array.isArray(this.style)){for(var n="",i=0;i<this.style.length;i++)n+=ps(this.at,this.style[i]),this.style[i+1]&&(n+=t);return n}return ps(this.at,this.style,e)},e}(),Us=/@font-face/,Ns={onCreateRule:function(e,t,n){return Us.test(e)?new _s(e,t,n):null}},Bs=function(){function e(e,t,n){this.type="viewport",this.at="@viewport",this.isProcessed=!1,this.key=e,this.style=t,this.options=n}return e.prototype.toString=function(e){return ps(this.key,this.style,e)},e}(),Vs={onCreateRule:function(e,t,n){return"@viewport"===e||"@-ms-viewport"===e?new Bs(e,t,n):null}},Ws=function(){function e(e,t,n){this.type="simple",this.isProcessed=!1,this.key=e,this.value=t,this.options=n}return e.prototype.toString=function(e){if(Array.isArray(this.value)){for(var t="",n=0;n<this.value.length;n++)t+=this.key+" "+this.value[n]+";",this.value[n+1]&&(t+="\n");return t}return this.key+" "+this.value+";"},e}(),Hs={"@charset":!0,"@import":!0,"@namespace":!0},js={onCreateRule:function(e,t,n){return e in Hs?new Ws(e,t,n):null}},zs=[Ss,xs,Os,As,Ns,Vs,js],qs={process:!0},Ks={force:!0,process:!0},Qs=function(){function e(e){this.map={},this.raw={},this.index=[],this.counter=0,this.options=e,this.classes=e.classes,this.keyframes=e.keyframes}var t=e.prototype;return t.add=function(e,t,n){var i=this.options,s=i.parent,r=i.sheet,o=i.jss,a=i.Renderer,l=i.generateId,d=i.scoped,c=Ji({classes:this.classes,parent:s,sheet:r,jss:o,Renderer:a,generateId:l,scoped:d,name:e,keyframes:this.keyframes,selector:void 0},n),h=e;e in this.raw&&(h=e+"-d"+this.counter++),this.raw[h]=t,h in this.classes&&(c.selector="."+ys(this.classes[h]));var u=ds(h,t,c);if(!u)return null;this.register(u);var m=void 0===c.index?this.index.length:c.index;return this.index.splice(m,0,u),u},t.replace=function(e,t,n){var i=this.get(e),s=this.index.indexOf(i);i&&this.remove(i);var r=n;return-1!==s&&(r=Ji({},n,{index:s})),this.add(e,t,r)},t.get=function(e){return this.map[e]},t.remove=function(e){this.unregister(e),delete this.raw[e.key],this.index.splice(this.index.indexOf(e),1)},t.indexOf=function(e){return this.index.indexOf(e)},t.process=function(){var e=this.options.jss.plugins;this.index.slice(0).forEach(e.onProcessRule,e)},t.register=function(e){this.map[e.key]=e,e instanceof ws?(this.map[e.selector]=e,e.id&&(this.classes[e.key]=e.id)):e instanceof Is&&this.keyframes&&(this.keyframes[e.name]=e.id)},t.unregister=function(e){delete this.map[e.key],e instanceof ws?(delete this.map[e.selector],delete this.classes[e.key]):e instanceof Is&&delete this.keyframes[e.name]},t.update=function(){var e,t,n;if("string"==typeof(arguments.length<=0?void 0:arguments[0])?(e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1],n=arguments.length<=2?void 0:arguments[2]):(t=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1],e=null),e)this.updateOne(this.get(e),t,n);else for(var i=0;i<this.index.length;i++)this.updateOne(this.index[i],t,n)},t.updateOne=function(t,n,i){void 0===i&&(i=qs);var s=this.options,r=s.jss.plugins,o=s.sheet;if(t.rules instanceof e)t.rules.update(n,i);else{var a=t.style;if(r.onUpdate(n,t,o,i),i.process&&a&&a!==t.style){for(var l in r.onProcessStyle(t.style,t,o),t.style){var d=t.style[l];d!==a[l]&&t.prop(l,d,Ks)}for(var c in a){var h=t.style[c],u=a[c];null==h&&h!==u&&t.prop(c,null,Ks)}}}},t.toString=function(e){for(var t="",n=this.options.sheet,i=!!n&&n.options.link,s=us(e).linebreak,r=0;r<this.index.length;r++){var o=this.index[r].toString(e);(o||i)&&(t&&(t+=s),t+=o)}return t},e}(),Gs=function(){function e(e,t){for(var n in this.attached=!1,this.deployed=!1,this.classes={},this.keyframes={},this.options=Ji({},t,{sheet:this,parent:this,classes:this.classes,keyframes:this.keyframes}),t.Renderer&&(this.renderer=new t.Renderer(this)),this.rules=new Qs(this.options),e)this.rules.add(n,e[n]);this.rules.process()}var t=e.prototype;return t.attach=function(){return this.attached||(this.renderer&&this.renderer.attach(),this.attached=!0,this.deployed||this.deploy()),this},t.detach=function(){return this.attached?(this.renderer&&this.renderer.detach(),this.attached=!1,this):this},t.addRule=function(e,t,n){var i=this.queue;this.attached&&!i&&(this.queue=[]);var s=this.rules.add(e,t,n);return s?(this.options.jss.plugins.onProcessRule(s),this.attached?this.deployed?(i?i.push(s):(this.insertRule(s),this.queue&&(this.queue.forEach(this.insertRule,this),this.queue=void 0)),s):s:(this.deployed=!1,s)):null},t.replaceRule=function(e,t,n){var i=this.rules.get(e);if(!i)return this.addRule(e,t,n);var s=this.rules.replace(e,t,n);return s&&this.options.jss.plugins.onProcessRule(s),this.attached?this.deployed?(this.renderer&&(s?i.renderable&&this.renderer.replaceRule(i.renderable,s):this.renderer.deleteRule(i)),s):s:(this.deployed=!1,s)},t.insertRule=function(e){this.renderer&&this.renderer.insertRule(e)},t.addRules=function(e,t){var n=[];for(var i in e){var s=this.addRule(i,e[i],t);s&&n.push(s)}return n},t.getRule=function(e){return this.rules.get(e)},t.deleteRule=function(e){var t="object"==typeof e?e:this.rules.get(e);return!(!t||this.attached&&!t.renderable)&&(this.rules.remove(t),!(this.attached&&t.renderable&&this.renderer)||this.renderer.deleteRule(t.renderable))},t.indexOf=function(e){return this.rules.indexOf(e)},t.deploy=function(){return this.renderer&&this.renderer.deploy(),this.deployed=!0,this},t.update=function(){var e;return(e=this.rules).update.apply(e,arguments),this},t.updateOne=function(e,t,n){return this.rules.updateOne(e,t,n),this},t.toString=function(e){return this.rules.toString(e)},e}(),$s=function(){function e(){this.plugins={internal:[],external:[]},this.registry={}}var t=e.prototype;return t.onCreateRule=function(e,t,n){for(var i=0;i<this.registry.onCreateRule.length;i++){var s=this.registry.onCreateRule[i](e,t,n);if(s)return s}return null},t.onProcessRule=function(e){if(!e.isProcessed){for(var t=e.options.sheet,n=0;n<this.registry.onProcessRule.length;n++)this.registry.onProcessRule[n](e,t);e.style&&this.onProcessStyle(e.style,e,t),e.isProcessed=!0}},t.onProcessStyle=function(e,t,n){for(var i=0;i<this.registry.onProcessStyle.length;i++)t.style=this.registry.onProcessStyle[i](t.style,t,n)},t.onProcessSheet=function(e){for(var t=0;t<this.registry.onProcessSheet.length;t++)this.registry.onProcessSheet[t](e)},t.onUpdate=function(e,t,n,i){for(var s=0;s<this.registry.onUpdate.length;s++)this.registry.onUpdate[s](e,t,n,i)},t.onChangeValue=function(e,t,n){for(var i=e,s=0;s<this.registry.onChangeValue.length;s++)i=this.registry.onChangeValue[s](i,t,n);return i},t.use=function(e,t){void 0===t&&(t={queue:"external"});var n=this.plugins[t.queue];-1===n.indexOf(e)&&(n.push(e),this.registry=[].concat(this.plugins.external,this.plugins.internal).reduce(function(e,t){for(var n in t)n in e&&e[n].push(t[n]);return e},{onCreateRule:[],onProcessRule:[],onProcessStyle:[],onProcessSheet:[],onChangeValue:[],onUpdate:[]}))},e}(),Xs=function(){function e(){this.registry=[]}var t=e.prototype;return t.add=function(e){var t=this.registry,n=e.options.index;if(-1===t.indexOf(e))if(0===t.length||n>=this.index)t.push(e);else for(var i=0;i<t.length;i++)if(t[i].options.index>n)return void t.splice(i,0,e)},t.reset=function(){this.registry=[]},t.remove=function(e){var t=this.registry.indexOf(e);this.registry.splice(t,1)},t.toString=function(e){for(var t=void 0===e?{}:e,n=t.attached,i=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(t,["attached"]),s=us(i).linebreak,r="",o=0;o<this.registry.length;o++){var a=this.registry[o];null!=n&&a.attached!==n||(r&&(r+=s),r+=a.toString(i))}return r},is(e,[{key:"index",get:function(){return 0===this.registry.length?0:this.registry[this.registry.length-1].options.index}}]),e}(),Js=new Xs,Zs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window&&window.Math===Math?window:"undefined"!=typeof self&&self.Math===Math?self:Function("return this")(),Ys="2f1acc6c3a606b082e5eef5e54414ffb";null==Zs[Ys]&&(Zs[Ys]=0);var er=Zs[Ys]++,tr=function(e){void 0===e&&(e={});var t=0;return function(n,i){t+=1;var s="",r="";return i&&(i.options.classNamePrefix&&(r=i.options.classNamePrefix),null!=i.options.jss.id&&(s=String(i.options.jss.id))),e.minify?""+(r||"c")+er+s+t:r+n.key+"-"+er+(s?"-"+s:"")+"-"+t}},nr=function(e){var t;return function(){return t||(t=e()),t}},ir=function(e,t){try{return e.attributeStyleMap?e.attributeStyleMap.get(t):e.style.getPropertyValue(t)}catch(e){return""}},sr=function(e,t,n){try{var i=n;if(Array.isArray(n)&&(i=hs(n)),e.attributeStyleMap)e.attributeStyleMap.set(t,i);else{var s=i?i.indexOf("!important"):-1,r=s>-1?i.substr(0,s-1):i;e.style.setProperty(t,r,s>-1?"important":"")}}catch(e){return!1}return!0},rr=function(e,t){try{e.attributeStyleMap?e.attributeStyleMap.delete(t):e.style.removeProperty(t)}catch(e){}},or=function(e,t){return e.selectorText=t,e.selectorText===t},ar=nr(function(){return document.querySelector("head")}),lr=nr(function(){var e=document.querySelector('meta[property="csp-nonce"]');return e?e.getAttribute("content"):null}),dr=function(e,t,n){try{"insertRule"in e?e.insertRule(t,n):"appendRule"in e&&e.appendRule(t)}catch(e){return!1}return e.cssRules[n]},cr=function(e,t){var n=e.cssRules.length;return void 0===t||t>n?n:t},hr=function(){function e(e){this.getPropertyValue=ir,this.setProperty=sr,this.removeProperty=rr,this.setSelector=or,this.hasInsertedRules=!1,this.cssRules=[],e&&Js.add(e),this.sheet=e;var t,n=this.sheet?this.sheet.options:{},i=n.media,s=n.meta,r=n.element;this.element=r||((t=document.createElement("style")).textContent="\n",t),this.element.setAttribute("data-jss",""),i&&this.element.setAttribute("media",i),s&&this.element.setAttribute("data-meta",s);var o=lr();o&&this.element.setAttribute("nonce",o)}var t=e.prototype;return t.attach=function(){if(!this.element.parentNode&&this.sheet){!function(e,t){var n=t.insertionPoint,i=function(e){var t=Js.registry;if(t.length>0){var n=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i.attached&&i.options.index>t.index&&i.options.insertionPoint===t.insertionPoint)return i}return null}(t,e);if(n&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element};if(n=function(e,t){for(var n=e.length-1;n>=0;n--){var i=e[n];if(i.attached&&i.options.insertionPoint===t.insertionPoint)return i}return null}(t,e),n&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element.nextSibling}}var i=e.insertionPoint;if(i&&"string"==typeof i){var s=function(e){for(var t=ar(),n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];if(8===i.nodeType&&i.nodeValue.trim()===e)return i}return null}(i);if(s)return{parent:s.parentNode,node:s.nextSibling}}return!1}(t);if(!1!==i&&i.parent)i.parent.insertBefore(e,i.node);else if(n&&"number"==typeof n.nodeType){var s=n,r=s.parentNode;r&&r.insertBefore(e,s.nextSibling)}else ar().appendChild(e)}(this.element,this.sheet.options);var e=Boolean(this.sheet&&this.sheet.deployed);this.hasInsertedRules&&e&&(this.hasInsertedRules=!1,this.deploy())}},t.detach=function(){if(this.sheet){var e=this.element.parentNode;e&&e.removeChild(this.element),this.sheet.options.link&&(this.cssRules=[],this.element.textContent="\n")}},t.deploy=function(){var e=this.sheet;e&&(e.options.link?this.insertRules(e.rules):this.element.textContent="\n"+e.toString()+"\n")},t.insertRules=function(e,t){for(var n=0;n<e.index.length;n++)this.insertRule(e.index[n],n,t)},t.insertRule=function(e,t,n){if(void 0===n&&(n=this.element.sheet),e.rules){var i=e,s=n;if("conditional"===e.type||"keyframes"===e.type){var r=cr(n,t);if(!1===(s=dr(n,i.toString({children:!1}),r)))return!1;this.refCssRule(e,r,s)}return this.insertRules(i.rules,s),s}var o=e.toString();if(!o)return!1;var a=cr(n,t),l=dr(n,o,a);return!1!==l&&(this.hasInsertedRules=!0,this.refCssRule(e,a,l),l)},t.refCssRule=function(e,t,n){e.renderable=n,e.options.parent instanceof Gs&&this.cssRules.splice(t,0,n)},t.deleteRule=function(e){var t=this.element.sheet,n=this.indexOf(e);return-1!==n&&(t.deleteRule(n),this.cssRules.splice(n,1),!0)},t.indexOf=function(e){return this.cssRules.indexOf(e)},t.replaceRule=function(e,t){var n=this.indexOf(e);return-1!==n&&(this.element.sheet.deleteRule(n),this.cssRules.splice(n,1),this.insertRule(t,n))},t.getRules=function(){return this.element.sheet.cssRules},e}(),ur=0,mr=function(){function e(e){this.id=ur++,this.version="10.10.0",this.plugins=new $s,this.options={id:{minify:!1},createGenerateId:tr,Renderer:Yi?hr:null,plugins:[]},this.generateId=tr({minify:!1});for(var t=0;t<zs.length;t++)this.plugins.use(zs[t],{queue:"internal"});this.setup(e)}var t=e.prototype;return t.setup=function(e){return void 0===e&&(e={}),e.createGenerateId&&(this.options.createGenerateId=e.createGenerateId),e.id&&(this.options.id=Ji({},this.options.id,e.id)),(e.createGenerateId||e.id)&&(this.generateId=this.options.createGenerateId(this.options.id)),null!=e.insertionPoint&&(this.options.insertionPoint=e.insertionPoint),"Renderer"in e&&(this.options.Renderer=e.Renderer),e.plugins&&this.use.apply(this,e.plugins),this},t.createStyleSheet=function(e,t){void 0===t&&(t={});var n=t.index;"number"!=typeof n&&(n=0===Js.index?0:Js.index+1);var i=new Gs(e,Ji({},t,{jss:this,generateId:t.generateId||this.generateId,insertionPoint:this.options.insertionPoint,Renderer:this.options.Renderer,index:n}));return this.plugins.onProcessSheet(i),i},t.removeStyleSheet=function(e){return e.detach(),Js.remove(e),this},t.createRule=function(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n={}),"object"==typeof e)return this.createRule(void 0,e,t);var i=Ji({},n,{name:e,jss:this,Renderer:this.options.Renderer});i.generateId||(i.generateId=this.generateId),i.classes||(i.classes={}),i.keyframes||(i.keyframes={});var s=ds(e,t,i);return s&&this.plugins.onProcessRule(s),s},t.use=function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach(function(t){e.plugins.use(t)}),this},e}();"object"==typeof CSS&&null!=CSS&&CSS;const pr=new mr(void 0);var gr="@global",fr=function(){function e(e,t,n){for(var i in this.type="global",this.at=gr,this.isProcessed=!1,this.key=e,this.options=n,this.rules=new Qs(Ji({},n,{parent:this})),t)this.rules.add(i,t[i]);this.rules.process()}var t=e.prototype;return t.getRule=function(e){return this.rules.get(e)},t.addRule=function(e,t,n){var i=this.rules.add(e,t,n);return i&&this.options.jss.plugins.onProcessRule(i),i},t.replaceRule=function(e,t,n){var i=this.rules.replace(e,t,n);return i&&this.options.jss.plugins.onProcessRule(i),i},t.indexOf=function(e){return this.rules.indexOf(e)},t.toString=function(e){return this.rules.toString(e)},e}(),yr=function(){function e(e,t,n){this.type="global",this.at=gr,this.isProcessed=!1,this.key=e,this.options=n;var i=e.substr(8);this.rule=n.jss.createRule(i,t,Ji({},n,{parent:this}))}return e.prototype.toString=function(e){return this.rule?this.rule.toString(e):""},e}(),vr=/\s*,\s*/g;function wr(e,t){for(var n=e.split(vr),i="",s=0;s<n.length;s++)i+=t+" "+n[s].trim(),n[s+1]&&(i+=", ");return i}var Sr=/[A-Z]/g,br=/^ms-/,Cr={};function Er(e){return"-"+e.toLowerCase()}const Tr=function(e){if(Cr.hasOwnProperty(e))return Cr[e];var t=e.replace(Sr,Er);return Cr[e]=br.test(t)?"-"+t:t};function xr(e){var t={};for(var n in e)t[0===n.indexOf("--")?n:Tr(n)]=e[n];return e.fallbacks&&(Array.isArray(e.fallbacks)?t.fallbacks=e.fallbacks.map(xr):t.fallbacks=xr(e.fallbacks)),t}class Mr{constructor(e){this.defaultLightModePalette={"--color0":"#e2e0dd80","--color1":"#FFFFFF","--color2":"#000000","--color3":"#0585fe","--color4":"#35b350","--color5":"#ffab00","--color6":"#e1e2dd","--color7":"#c3c4bf"},this.defaultDarkModePalette={"--color0":"#1d1f22e0","--color1":"#000000","--color2":"#FFFFFF","--color3":"#0585fe","--color4":"#35b350","--color5":"#ffab00","--color6":"#1e1d22","--color7":"#3c3b40"},this.defaultStyles={":root":{"--color0":"#1d1f22e0","--color1":"#000000","--color2":"#FFFFFF","--color3":"#0585fe","--color4":"#35b350","--color5":"#ffab00","--color6":"#1e1d22","--color7":"#3c3b40","--color8":"#41008c","--color9":"#3e0070","--color10":"#2e0052","--color11":"rgba(65,0,139,1)"},".noselect":{userSelect:"none"},"#playerUI":{width:"100%",height:"100%",position:"relative"},"#videoElementParent":{width:"100%",height:"100%",position:"absolute",backgroundColor:"var(--color1)"},"#uiFeatures":{width:"100%",height:"100%",zIndex:"30",position:"relative",color:"var(--color2)",pointerEvents:"none",overflow:"hidden"},".UiTool .tooltiptext":{visibility:"hidden",width:"auto",color:"var(--color2)",textAlign:"center",borderRadius:"15px",padding:"0px 10px",fontFamily:"'Montserrat', sans-serif",fontSize:"0.75rem",letterSpacing:"0.75px",position:"absolute",top:"0",transform:"translateY(25%)",left:"125%",zIndex:"20"},".UiTool:hover .tooltiptext":{visibility:"visible",backgroundColor:"var(--color7)"},"#connection .tooltiptext":{top:"125%",transform:"translateX(-25%)",left:"0",zIndex:"20",padding:"5px 10px"},"#connection":{position:"absolute",bottom:"8%",left:"5%",fontFamily:"'Michroma', sans-serif",height:"3rem",width:"3rem",pointerEvents:"all"},"#settings-panel .tooltiptext":{display:"block",top:"125%",transform:"translateX(-50%)",left:"0",zIndex:"20",padding:"5px 10px",border:"3px solid var(--color3)",width:"max-content",fallbacks:[{width:"max-content"},{border:"3px solid var(--color3)"},{padding:"5px 10px"},{zIndex:"20"},{left:"0"},{transform:"translateX(-50%)"},{top:"125%"},{display:"block"}]},"#controls":{position:"absolute",top:"3%",left:"2%",fontFamily:"'Michroma', sans-serif",pointerEvents:"all",display:"block"},"#controls>*":{marginBottom:"0.5rem",borderRadius:"50%",display:"block",height:"2rem",lineHeight:"1.75rem",padding:"0.5rem"},"#controls #additionalinfo":{textAlign:"center",fontFamily:"'Montserrat', sans-serif"},"#fullscreen-btn":{padding:"0.6rem !important"},"#minimizeIcon":{display:"none"},"#settingsBtn, #statsBtn":{cursor:"pointer"},"#uiFeatures button":{backgroundColor:"var(--color7)",border:"1px solid var(--color7)",color:"var(--color2)",position:"relative",width:"3rem",height:"3rem",padding:"0.5rem",textAlign:"center"},"#uiFeatures button:hover":{backgroundColor:"var(--color3)",border:"3px solid var(--color3)",transition:"0.25s ease",paddingLeft:"0.55rem",paddingTop:"0.55rem"},"#uiFeatures button:active":{border:"3px solid var(--color3)",backgroundColor:"var(--color7)",paddingLeft:"0.55rem",paddingTop:"0.55rem"},".btn-flat":{backgroundColor:"transparent",color:"var(--color2)",fontFamily:"'Montserrat'",fontWeight:"bold",border:"3px solid var(--color3)",borderRadius:"1rem",fontSize:"0.75rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",cursor:"pointer",textAlign:"center"},".btn-flat:hover":{backgroundColor:"var(--color3)",transition:"ease 0.3s"},".btn-flat:disabled":{background:"var(--color7)",borderColor:"var(--color3)",color:"var(--color3)",cursor:"default"},".btn-flat:active":{backgroundColor:"transparent"},".btn-flat:focus":{outline:"none"},"#uiFeatures img":{width:"100%",height:"100%"},".panel-wrap":{position:"absolute",top:"0",bottom:"0",right:"0",height:"100%",minWidth:"20vw",maxWidth:"90vw",transform:"translateX(100%)",transition:".3s ease-out",pointerEvents:"all",overflowY:"auto",overflowX:"hidden",backgroundColor:"var(--color0)"},".panel-wrap-visible":{transform:"translateX(0%)"},".panel":{overflowY:"auto",padding:"1em"},"#settingsHeading, #statsHeading":{display:"inline-block",fontSize:"2em",marginBlockStart:"0.67em",marginBlockEnd:"0.67em",marginInlineStart:"0px",marginInlineEnd:"0px",position:"relative",padding:"0 0 0 2rem"},"#settingsClose, #statsClose":{margin:"0.5rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",paddingRight:"0.5rem",fontSize:"2em",float:"right"},"#settingsClose:after, #statsClose:after":{paddingLeft:"0.5rem",display:"inline-block",content:'"\\00d7"'},"#settingsClose:hover, #statsClose:hover":{color:"var(--color3)",transition:"ease 0.3s"},"#settingsContent, #statsContent":{marginLeft:"2rem",marginRight:"2rem"},".setting":{display:"flex",flexDirection:"row",justifyContent:"space-between",padding:"0.15rem 10px 0.15rem 10px"},".settings-text":{color:"var(--color2)",verticalAlign:"middle",fontWeight:"normal"},".settings-option":{width:"100%",textOverflow:"ellipsis",whiteSpace:"nowrap"},"#connectOverlay, #playOverlay, #infoOverlay, #errorOverlay, #afkOverlay, #disconnectOverlay":{zIndex:"30",position:"absolute",color:"var(--color2)",fontSize:"1.8em",width:"100%",height:"100%",backgroundColor:"var(--color1)",alignItems:"center",justifyContent:"center",textTransform:"uppercase"},".clickableState":{alignItems:"center",justifyContent:"center",display:"flex",cursor:"pointer"},".textDisplayState":{display:"flex"},".hiddenState":{display:"none"},"#playButton, #connectButton":{display:"inline-block",height:"auto",zIndex:"30"},"img#playButton":{maxWidth:"241px",width:"10%"},"#uiInteraction":{position:"fixed"},"#UIInteractionButtonBoundary":{padding:"2px"},"#UIInteractionButton":{cursor:"pointer"},".btn-overlay":{verticalAlign:"middle",display:"inline-block"},".tgl-switch":{verticalAlign:"middle",display:"inline-block"},".tgl-switch .tgl":{display:"none"},".tgl, .tgl:after, .tgl:before, .tgl *, .tgl *:after, .tgl *:before, .tgl+.tgl-slider":{"-webkit-box-sizing":"border-box",boxSizing:"border-box"},".tgl::-moz-selection, .tgl:after::-moz-selection, .tgl:before::-moz-selection, .tgl *::-moz-selection, .tgl *:after::-moz-selection, .tgl *:before::-moz-selection, .tgl+.tgl-slider::-moz-selection":{background:"none"},".tgl::selection, .tgl:after::selection, .tgl:before::selection, .tgl *::selection, .tgl *:after::selection, .tgl *:before::selection, .tgl+.tgl-slider::selection":{background:"none"},".tgl-slider":{},".tgl+.tgl-slider":{outline:"0",display:"block",width:"40px",height:"18px",position:"relative",cursor:"pointer",userSelect:"none"},".tgl+.tgl-slider:after, .tgl+.tgl-slider:before":{position:"relative",display:"block",content:'""',width:"50%",height:"100%"},".tgl+.tgl-slider:after":{left:"0"},".tgl+.tgl-slider:before":{display:"none"},".tgl-flat+.tgl-slider":{padding:"2px","-webkit-transition":"all .2s ease",transition:"all .2s ease",background:"var(--color6)",border:"3px solid var(--color7)",borderRadius:"2em"},".tgl-flat+.tgl-slider:after":{"-webkit-transition":"all .2s ease",transition:"all .2s ease",background:"var(--color7)",content:'""',borderRadius:"1em"},".tgl-flat:checked+.tgl-slider":{border:"3px solid var(--color3)"},".tgl-flat:checked+.tgl-slider:after":{left:"50%",background:"var(--color3)"},".btn-apply":{display:"block !important",marginLeft:"auto",marginRight:"auto",width:"40%"},".form-control":{backgroundColor:"var(--color7)",border:"2px solid var(--color7)",borderRadius:"4px",color:"var(--color2)",textAlign:"right",fontFamily:"inherit"},".form-control:hover":{borderColor:"var(--color7)"},".form-group":{paddingTop:"4px",display:"grid",gridTemplateColumns:"80% 20%",rowGap:"4px",paddingRight:"10px",paddingLeft:"10px"},".form-group label":{verticalAlign:"middle",fontWeight:"normal"},".settingsContainer":{display:"flex",flexDirection:"column",borderBottom:"1px solid var(--color7)",paddingTop:"10px",paddingBottom:"10px"},".settingsContainer> :first-child":{marginTop:"4px",marginBottom:"4px",fontWeight:"bold",justifyContent:"space-between",display:"flex",flexDirection:"row",alignItems:"baseline"},".collapse":{paddingLeft:"5%"},"#streamTools":{borderBottomRightRadius:"5px",borderBottomLeftRadius:"5px",userSelect:"none",position:"absolute",top:"0",right:"2%",zIndex:"100",border:"4px solid var(--colour8)",borderTopWidth:"0px"},".settingsHeader":{fontStyle:"italic"},"#streamToolsHeader":{display:"flex",flexDirection:"row",justifyContent:"space-between",borderBottom:"1px solid var(--colour8)",backgroundColor:"var(--color7)"},".streamTools":{backgroundColor:"var(--color2)",fontFamily:"var(--buttonFont)",fontWeight:"lighter",color:"var(--color7)"},".streamTools-shown>#streamToolsSettings, .streamTools-shown>#streamToolsStats":{display:"block"},"#streamToolsToggle":{width:"100%"},"#qualityStatus":{fontSize:"37px",paddingRight:"4px"},".svgIcon":{fill:"var(--color2)"},".modal":{minWidth:"100vw",minHeight:"100vh",left:"0",top:"0",position:"fixed",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",color:"var(--color2)"},".innerModal":{position:"relative",width:"500px",height:"300px",backgroundColor:"var(--color0)",display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",borderRadius:"0.75em"},".modalBtnContainer":{display:"flex",flexDirection:"row",justifyContent:"space-around",width:"100%",paddingTop:"1em",paddingBottom:"1em"},".modalTextArea":{textAlign:"left",width:"95%",height:"100%",resize:"none",fontSize:"1rem",border:"1px solid var(--color2)"},".modalTextArea:focus-visible":{outline:"none !important",border:"1px solid var(--color3)"},".modal .btn-flat":{fontSize:"1.0rem"}};const{customStyles:t,lightModePalette:n,darkModePalette:i,jssInsertionPoint:s}=null!=e?e:{},r={plugins:[{onCreateRule:function(e,t,n){if(!e)return null;if(e===gr)return new fr(e,t,n);if("@"===e[0]&&"@global "===e.substr(0,8))return new yr(e,t,n);var i=n.parent;return i&&("global"===i.type||i.options.parent&&"global"===i.options.parent.type)&&(n.scoped=!1),n.selector||!1!==n.scoped||(n.selector=e),null},onProcessRule:function(e,t){"style"===e.type&&t&&(function(e,t){var n=e.options,i=e.style,s=i?i[gr]:null;if(s){for(var r in s)t.addRule(r,s[r],Ji({},n,{selector:wr(r,e.selector)}));delete i[gr]}}(e,t),function(e,t){var n=e.options,i=e.style;for(var s in i)if("@"===s[0]&&s.substr(0,7)===gr){var r=wr(s.substr(7),e.selector);t.addRule(r,i[s],Ji({},n,{selector:r})),delete i[s]}}(e,t))}},{onProcessStyle:function(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++)e[t]=xr(e[t]);return e}return xr(e)},onChangeValue:function(e,t,n){if(0===t.indexOf("--"))return e;var i=Tr(t);return t===i?e:(n.prop(i,e),null)}}],insertionPoint:s};pr.setup(r),this.customStyles=t,this.lightModePalette=null!=n?n:this.defaultLightModePalette,this.darkModePalette=null!=i?i:this.defaultDarkModePalette}applyStyleSheet(){pr.createStyleSheet({"@global":Object.assign(Object.assign({},this.defaultStyles),this.customStyles)}).attach()}applyPalette(e){const t=document.querySelector(":root");t.style.setProperty("--color0",e["--color0"]),t.style.setProperty("--color1",e["--color1"]),t.style.setProperty("--color2",e["--color2"]),t.style.setProperty("--color3",e["--color3"]),t.style.setProperty("--color4",e["--color4"]),t.style.setProperty("--color5",e["--color5"]),t.style.setProperty("--color6",e["--color6"]),t.style.setProperty("--color7",e["--color7"])}setColorMode(e){e?this.applyPalette(this.lightModePalette):this.applyPalette(this.darkModePalette)}}const kr=new Mr;return kr.applyStyleSheet(),window.callBack_document_body_onload=function(){var e;if(window.onLoadPreExecution(),d.InitLogging(window.LogLevel,window.ShouldLogIncludeStack),console.log("document.body.onload "),null==window.ss_url)return console.log("document.body.onload reschdule 10 ms laster"),void setTimeout(function(){console.log("manual document.body.onload() "),"function"==typeof document.body.onload&&document.body.onload(new Event("load"))},10);{console.log("document.body.onload   starting");const t=new en({useUrlParams:!0});window.psConfigObj=t;const n=new ri(t),i=new Xi({stream:n,onColorModeChanged:e=>kr.setColorMode(e)});null!=window.psConfigObj&&null!=window.applyE3DSConfigOnFlag&&(null===(e=window.req_data)||void 0===e?void 0:e.E3DSConfigData)&&window.applyE3DSConfigOnFlag(),document.body.appendChild(i.rootElement),window.pixelStreaming=n}window.onLoadPostExecution()},"undefined"!=typeof document&&document.body&&(document.body.onload=window.callBack_document_body_onload),i})(),e.exports=ee()}},t={};!function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,n),r.exports}(267)})();